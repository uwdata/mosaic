var hat=Object.defineProperty;var pat=(t,e,n)=>e in t?hat(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Td=(t,e,n)=>pat(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const dP=Uint8Array.of(65,82,82,79,87,49),y2={V1:0,V4:3,V5:4},cc={NONE:0,Schema:1,DictionaryBatch:2,RecordBatch:3,Tensor:4,SparseTensor:5},Y={Dictionary:-1,NONE:0,Null:1,Int:2,Float:3,Binary:4,Utf8:5,Bool:6,Decimal:7,Date:8,Time:9,Timestamp:10,Interval:11,List:12,Struct:13,Union:14,FixedSizeBinary:15,FixedSizeList:16,Map:17,Duration:18,LargeBinary:19,LargeUtf8:20,LargeList:21,RunEndEncoded:22,BinaryView:23,Utf8View:24,ListView:25,LargeListView:26},hP={HALF:0,SINGLE:1,DOUBLE:2},Rv={DAY:0,MILLISECOND:1},ns={SECOND:0,MILLISECOND:1,MICROSECOND:2,NANOSECOND:3},_h={YEAR_MONTH:0,DAY_TIME:1,MONTH_DAY_NANO:2},$M={Sparse:0,Dense:1},gat=Uint8Array,pP=Uint16Array,mat=Uint32Array,gP=BigUint64Array,mP=Int8Array,yat=Int16Array,aa=Int32Array,ua=BigInt64Array,bat=Float32Array,b2=Float64Array;function vat(t,e){const n=Math.log2(t)-3;return(e?[mP,yat,aa,ua]:[gat,pP,mat,gP])[n]}function TM(t,e){let n=0,r=t.length;if(r<=2147483648)do{const i=n+r>>>1;t[i]<=e?n=i+1:r=i}while(n<r);else do{const i=Math.trunc((n+r)/2);t[i]<=e?n=i+1:r=i}while(n<r);return n}function kM(t,e,n){if(e(t))return t;throw new Error(n(t))}function Vs(t,e,n){return e=Array.isArray(e)?e:Object.values(e),kM(t,r=>e.includes(r),n??(()=>`${t} must be one of ${e}`))}function yP(t,e){for(const[n,r]of Object.entries(t))if(r===e)return n;return"<Unknown>"}const MM=t=>`Unsupported data type: "${yP(Y,t)}" (id ${t})`,bP=(t,e,n=!0,r=null)=>({name:t,type:e,nullable:n,metadata:r});function vP(t){return Object.hasOwn(t,"name")&&wP(t.type)}function wP(t){return typeof(t==null?void 0:t.typeId)=="number"}function Mc(t,e="",n=!0){return vP(t)?t:bP(e,kM(t,wP,()=>"Data type expected."),n)}const wat=(t,e,n=!1,r=-1)=>({typeId:Y.Dictionary,id:r,dictionary:t,indices:e||_P(),ordered:n}),xP=(t=32,e=!0)=>({typeId:Y.Int,bitWidth:Vs(t,[8,16,32,64]),signed:e,values:vat(t,e)}),_P=()=>xP(32),xat=(t=2)=>({typeId:Y.Float,precision:Vs(t,hP),values:[pP,bat,b2][t]}),_at=()=>({typeId:Y.Binary,offsets:aa}),Sat=()=>({typeId:Y.Utf8,offsets:aa}),Eat=(t,e,n=128)=>({typeId:Y.Decimal,precision:t,scale:e,bitWidth:Vs(n,[128,256]),values:gP}),Aat=t=>({typeId:Y.Date,unit:Vs(t,Rv),values:t===Rv.DAY?aa:ua}),$at=(t=ns.MILLISECOND,e=32)=>({typeId:Y.Time,unit:Vs(t,ns),bitWidth:Vs(e,[32,64]),values:e===32?aa:ua}),Tat=(t=ns.MILLISECOND,e=null)=>({typeId:Y.Timestamp,unit:Vs(t,ns),timezone:e,values:ua}),kat=(t=_h.MONTH_DAY_NANO)=>({typeId:Y.Interval,unit:Vs(t,_h),values:t===_h.MONTH_DAY_NANO?void 0:aa}),Mat=t=>({typeId:Y.List,children:[Mc(t)],offsets:aa}),Cat=t=>({typeId:Y.Struct,children:Array.isArray(t)&&vP(t[0])?t:Object.entries(t).map(([e,n])=>bP(e,n))}),Iat=(t,e,n,r)=>(n??(n=e.map((i,s)=>s)),{typeId:Y.Union,mode:Vs(t,$M),typeIds:n,typeMap:n.reduce((i,s,o)=>(i[s]=o,i),{}),children:e.map((i,s)=>Mc(i,`_${s}`)),typeIdForValue:r,offsets:aa}),Fat=t=>({typeId:Y.FixedSizeBinary,stride:t}),Nat=(t,e)=>({typeId:Y.FixedSizeList,stride:e,children:[Mc(t)]}),Oat=(t,e)=>({typeId:Y.Map,keysSorted:t,children:[e],offsets:aa}),Rat=(t=ns.MILLISECOND)=>({typeId:Y.Duration,unit:Vs(t,ns),values:ua}),Dat=()=>({typeId:Y.LargeBinary,offsets:ua}),Lat=()=>({typeId:Y.LargeUtf8,offsets:ua}),Bat=t=>({typeId:Y.LargeList,children:[Mc(t)],offsets:ua}),Pat=(t,e)=>({typeId:Y.RunEndEncoded,children:[kM(Mc(t,"run_ends"),n=>n.type.typeId===Y.Int,()=>"Run-ends must have an integer type."),Mc(e,"values")]}),zat=t=>({typeId:Y.ListView,children:[Mc(t,"value")],offsets:aa}),Uat=t=>({typeId:Y.LargeListView,children:[Mc(t,"value")],offsets:ua}),jat=new b2(2),qat=jat.buffer;new ua(qat);function Cc(t){if(t>Number.MAX_SAFE_INTEGER||t<Number.MIN_SAFE_INTEGER)throw Error(`BigInt exceeds integer number representation: ${t}`);return Number(t)}function CM(t,e){return Number(t/e)+Number(t%e)/Number(e)}const uh=t=>BigInt.asUintN(64,t);function Wat(t,e){const n=e<<1;let r;return BigInt.asIntN(64,t[n+1])<0?(r=uh(~t[n])|uh(~t[n+1])<<64n,r=-(r+1n)):r=t[n]|t[n+1]<<64n,r}function Vat(t,e){const n=e<<2;let r;return BigInt.asIntN(64,t[n+3])<0?(r=uh(~t[n])|uh(~t[n+1])<<64n|uh(~t[n+2])<<128n|uh(~t[n+3])<<192n,r=-(r+1n)):r=t[n]|t[n+1]<<64n|t[n+2]<<128n|t[n+3]<<192n,r}const Gat=new TextDecoder("utf-8");new TextEncoder;function v2(t){return Gat.decode(t)}const l0=4;function SP(t,e){return(t[e>>3]&1<<e%8)!==0}function Eu(t,e){const n=e+Ue(t,e),r=n-Ue(t,n),i=Gi(t,r);return(s,o,a=null)=>{if(s<i){const u=Gi(t,r+s);if(u)return o(t,n+u)}return a}}function Jl(t,e){return e}function f0(t,e){return!!Yat(t,e)}function Yat(t,e){return IM(t,e)<<24>>24}function IM(t,e){return t[e]}function Gi(t,e){return Hat(t,e)<<16>>16}function Hat(t,e){return t[e]|t[e+1]<<8}function Ue(t,e){return t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24}function _D(t,e){return Ue(t,e)>>>0}function Hi(t,e){return Cc(BigInt.asIntN(64,BigInt(_D(t,e))+(BigInt(_D(t,e+l0))<<32n)))}function Dv(t,e){let n=e+Ue(t,e);const r=Ue(t,n);return n+=l0,v2(t.subarray(n,n+r))}function _c(t,e,n,r){if(!e)return[];const i=e+Ue(t,e);return Array.from({length:Ue(t,i)},(s,o)=>r(t,i+l0+o*n))}const CE=Symbol("rowIndex");function a3(t,e){class n{constructor(s){this[CE]=s}toJSON(){return AP(t,e,this[CE])}}const r=n.prototype;for(let i=0;i<t.length;++i){if(Object.hasOwn(r,t[i]))continue;const s=e[i];Object.defineProperty(r,t[i],{get(){return s.at(this[CE])},enumerable:!0})}return i=>new n(i)}function EP(t,e){return n=>AP(t,e,n)}function AP(t,e,n){const r={};for(let i=0;i<t.length;++i)r[t[i]]=e[i].at(n);return r}function Xat(t){return t instanceof jb}class dy{constructor({length:e,nullCount:n,type:r,validity:i,values:s,offsets:o,sizes:a,children:u}){this.length=e,this.nullCount=n,this.type=r,this.validity=i,this.values=s,this.offsets=o,this.sizes=a,this.children=u,(!n||!this.validity)&&(this.at=c=>this.value(c))}get[Symbol.toStringTag](){return"Batch"}at(e){return this.isValid(e)?this.value(e):null}isValid(e){return SP(this.validity,e)}value(e){return this.values[e]}slice(e,n){const r=n-e,i=Array(r);for(let s=0;s<r;++s)i[s]=this.at(e+s);return i}*[Symbol.iterator](){for(let e=0;e<this.length;++e)yield this.at(e)}}Td(dy,"ArrayType",null);class jb extends dy{constructor(e){super(e);const{length:n,values:r}=this;this.values=r.subarray(0,n)}slice(e,n){return this.nullCount?super.slice(e,n):this.values.subarray(e,n)}[Symbol.iterator](){return this.nullCount?super[Symbol.iterator]():this.values[Symbol.iterator]()}}class w2 extends dy{}Td(w2,"ArrayType",b2);class on extends dy{}Td(on,"ArrayType",Array);class Kat extends on{value(e){return null}}class Pp extends w2{value(e){return Cc(this.values[e])}}class Qat extends w2{value(e){const n=this.values[e],r=(n&31744)>>10,i=(n&1023)/1024,s=(-1)**((n&32768)>>15);switch(r){case 31:return s*(i?Number.NaN:1/0);case 0:return s*(i?6103515625e-14*i:0)}return s*2**(r-15)*(1+i)}}class Jat extends on{value(e){return SP(this.values,e)}}class $P extends dy{constructor(e){super(e);const{bitWidth:n,scale:r}=this.type;this.decimal=n===128?Wat:Vat,this.scale=10n**BigInt(r)}}class TP extends $P{value(e){return CM(this.decimal(this.values,e),this.scale)}}Td(TP,"ArrayType",b2);class kP extends $P{value(e){return this.decimal(this.values,e)}}Td(kP,"ArrayType",Array);class SD extends on{constructor(e){super(e),this.source=e}value(e){return new Date(this.source.value(e))}}class Zat extends w2{value(e){return 864e5*this.values[e]}}const tut=Pp;class eut extends Pp{value(e){return super.value(e)*1e3}}const nut=Pp;class rut extends Pp{value(e){return CM(this.values[e],1000n)}}class iut extends Pp{value(e){return CM(this.values[e],1000000n)}}class sut extends on{value(e){return this.values.subarray(e<<1,e+1<<1)}}class out extends on{value(e){const n=this.values,r=e<<4;return Float64Array.of(Ue(n,r),Ue(n,r+4),Hi(n,r+8))}}const MP=({values:t,offsets:e},n)=>t.subarray(e[n],e[n+1]),CP=({values:t,offsets:e},n)=>t.subarray(Cc(e[n]),Cc(e[n+1]));class aut extends on{value(e){return MP(this,e)}}class uut extends on{value(e){return CP(this,e)}}class cut extends on{value(e){return v2(MP(this,e))}}class lut extends on{value(e){return v2(CP(this,e))}}class fut extends on{value(e){const n=this.offsets;return this.children[0].slice(n[e],n[e+1])}}class dut extends on{value(e){const n=this.offsets;return this.children[0].slice(Cc(n[e]),Cc(n[e+1]))}}class hut extends on{value(e){const n=this.offsets[e],r=n+this.sizes[e];return this.children[0].slice(n,r)}}class put extends on{value(e){const n=this.offsets[e],r=n+this.sizes[e];return this.children[0].slice(Cc(n),Cc(r))}}class IP extends on{constructor(e){super(e),this.stride=this.type.stride}}class gut extends IP{value(e){const{stride:n,values:r}=this;return r.subarray(e*n,(e+1)*n)}}class mut extends IP{value(e){const{children:n,stride:r}=this;return n[0].slice(e*r,(e+1)*r)}}function FP({children:t,offsets:e},n){const[r,i]=t[0].children,s=e[n],o=e[n+1],a=[];for(let u=s;u<o;++u)a.push([r.at(u),i.at(u)]);return a}class yut extends on{value(e){return FP(this,e)}}class but extends on{value(e){return new Map(FP(this,e))}}class NP extends on{constructor({typeIds:e,...n}){super(n),this.typeIds=e,this.typeMap=this.type.typeMap}value(e,n=e){const{typeIds:r,children:i,typeMap:s}=this;return i[s[r[e]]].at(n)}}class vut extends NP{value(e){return super.value(e,this.offsets[e])}}class OP extends on{constructor(e,n=EP){super(e),this.names=this.type.children.map(r=>r.name),this.factory=n(this.names,this.children)}value(e){return this.factory(e)}}class wut extends OP{constructor(e){super(e,a3)}}class xut extends on{value(e){const[{values:n},r]=this.children;return r.at(TM(n,e))}}let _ut=class extends on{setDictionary(e){return this.dictionary=e,this.cache=e.cache(),this}value(e){return this.cache[this.key(e)]}key(e){return this.values[e]}};class RP extends on{constructor({data:e,...n}){super(n),this.data=e}view(e){const{values:n,data:r}=this,i=e<<4;let s=i+4,o=n;const a=Ue(o,i);return a>12&&(s=Ue(o,i+12),o=r[Ue(o,i+8)]),o.subarray(s,s+a)}}class Sut extends RP{value(e){return this.view(e)}}class Eut extends RP{value(e){return v2(this.view(e))}}function ED(t){let e=[];return{add(n){return e.push(n),this},clear:()=>e=[],done:()=>new Aut(e,t)}}let Aut=class{constructor(e,n=(r=>(r=e[0])==null?void 0:r.type)()){this.type=n,this.length=e.reduce((o,a)=>o+a.length,0),this.nullCount=e.reduce((o,a)=>o+a.nullCount,0),this.data=e;const i=e.length,s=new Int32Array(i+1);if(i===1){const[o]=e;s[1]=o.length,this.at=a=>o.at(a)}else for(let o=0,a=0;o<i;++o)s[o+1]=a+=e[o].length;this.offsets=s}get[Symbol.toStringTag](){return"Column"}[Symbol.iterator](){const e=this.data;return e.length===1?e[0][Symbol.iterator]():$ut(e)}at(e){var s;const{data:n,offsets:r}=this,i=TM(r,e)-1;return(s=n[i])==null?void 0:s.at(e-r[i])}get(e){return this.at(e)}toArray(){const{length:e,nullCount:n,data:r}=this,i=!n&&Xat(r[0]),s=r.length;if(i&&s===1)return r[0].values;const o=!s||n>0?Array:r[0].constructor.ArrayType??r[0].values.constructor,a=new o(e);return i?Tut(a,r):kut(a,r)}cache(){return this._cache??(this._cache=this.toArray())}};function*$ut(t){for(let e=0;e<t.length;++e){const n=t[e][Symbol.iterator]();for(let r=n.next();!r.done;r=n.next())yield r.value}}function Tut(t,e){for(let n=0,r=0;n<e.length;++n){const{values:i}=e[n];t.set(i,r),r+=i.length}return t}function kut(t,e){let n=-1;for(let r=0;r<e.length;++r){const i=e[r];for(let s=0;s<i.length;++s)t[++n]=i.at(s)}return t}let Mut=class DP{constructor(e,n,r=!1){const i=e.fields.map(o=>o.name);this.schema=e,this.names=i,this.children=n,this.factory=r?a3:EP;const s=[];this.getFactory=o=>s[o]??(s[o]=this.factory(i,n.map(a=>a.data[o])))}get[Symbol.toStringTag](){return"Table"}get numCols(){return this.names.length}get numRows(){var e;return((e=this.children[0])==null?void 0:e.length)??0}getChildAt(e){return this.children[e]}getChild(e){const n=this.names.findIndex(r=>r===e);return n>-1?this.children[n]:void 0}selectAt(e,n=[]){const{children:r,factory:i,schema:s}=this,{fields:o}=s;return new DP({...s,fields:e.map((a,u)=>Cut(o[a],n[u]))},e.map(a=>r[a]),i===a3)}select(e,n){const r=this.names,i=e.map(s=>r.indexOf(s));return this.selectAt(i,n)}toColumns(){const{children:e,names:n}=this,r={};return n.forEach((i,s)=>{var o;return r[i]=((o=e[s])==null?void 0:o.toArray())??[]}),r}toArray(){var o;const{children:e,getFactory:n,numRows:r}=this,i=((o=e[0])==null?void 0:o.data)??[],s=Array(r);for(let a=0,u=-1;a<i.length;++a){const c=n(a);for(let l=0;l<i[a].length;++l)s[++u]=c(l)}return s}*[Symbol.iterator](){var i;const{children:e,getFactory:n}=this,r=((i=e[0])==null?void 0:i.data)??[];for(let s=0;s<r.length;++s){const o=n(s);for(let a=0;a<r[s].length;++a)yield o(a)}}at(e){const{children:n,getFactory:r,numRows:i}=this;if(e<0||e>=i)return null;const[{offsets:s}]=n,o=TM(s,e)-1;return r(o)(e-s[o])}get(e){return this.at(e)}};function Cut(t,e){return e!=null&&e!==t.name?{...t,name:e}:t}function Iut(t,e={}){const{typeId:n,bitWidth:r,precision:i,unit:s}=t,{useBigInt:o,useDate:a,useDecimalBigInt:u,useMap:c,useProxy:l}=e;switch(n){case Y.Null:return Kat;case Y.Bool:return Jat;case Y.Int:case Y.Time:case Y.Duration:return o||r<64?jb:Pp;case Y.Float:return i?jb:Qat;case Y.Date:return AD(s===Rv.DAY?Zat:tut,a&&SD);case Y.Timestamp:return AD(s===ns.SECOND?eut:s===ns.MILLISECOND?nut:s===ns.MICROSECOND?rut:iut,a&&SD);case Y.Decimal:return u?kP:TP;case Y.Interval:return s===_h.DAY_TIME?sut:s===_h.YEAR_MONTH?jb:out;case Y.FixedSizeBinary:return gut;case Y.Utf8:return cut;case Y.LargeUtf8:return lut;case Y.Binary:return aut;case Y.LargeBinary:return uut;case Y.BinaryView:return Sut;case Y.Utf8View:return Eut;case Y.List:return fut;case Y.LargeList:return dut;case Y.Map:return c?but:yut;case Y.ListView:return hut;case Y.LargeListView:return put;case Y.FixedSizeList:return mut;case Y.Struct:return l?wut:OP;case Y.RunEndEncoded:return xut;case Y.Dictionary:return _ut;case Y.Union:return t.mode?vut:NP}throw new Error(MM(n))}function AD(t,e){return e?class extends e{constructor(r){super(new t(r))}}:t}function Fut(t,e){return{offset:Hi(t,e),metadataLength:Ue(t,e+8),bodyLength:Hi(t,e+16)}}function $D(t,e){return _c(t,e,24,Fut)}function LP(t,e,n){const r=Eu(t,e);if(r(10,Jl,0))throw new Error("Record batch compression not implemented");const i=n<y2.V4?8:0;return{length:r(4,Hi,0),nodes:_c(t,r(6,Jl),16,(s,o)=>({length:Hi(s,o),nullCount:Hi(s,o+8)})),regions:_c(t,r(8,Jl),16+i,(s,o)=>({offset:Hi(s,o+i),length:Hi(s,o+i+8)})),variadic:_c(t,r(12,Jl),8,Hi)}}function Nut(t,e,n){const r=Eu(t,e);return{id:r(4,Hi,0),data:r(6,(i,s)=>LP(i,s,n)),isDelta:r(8,f0,!1)}}function BP(t,e,n,r){Vs(n,Y,MM);const i=Eu(t,e);switch(n){case Y.Binary:return _at();case Y.Utf8:return Sat();case Y.LargeBinary:return Dat();case Y.LargeUtf8:return Lat();case Y.List:return Mat(r[0]);case Y.ListView:return zat(r[0]);case Y.LargeList:return Bat(r[0]);case Y.LargeListView:return Uat(r[0]);case Y.Struct:return Cat(r);case Y.RunEndEncoded:return Pat(r[0],r[1]);case Y.Int:return xP(i(4,Ue,0),i(6,f0,!1));case Y.Float:return xat(i(4,Gi,hP.HALF));case Y.Decimal:return Eat(i(4,Ue,0),i(6,Ue,0),i(8,Ue,128));case Y.Date:return Aat(i(4,Gi,Rv.MILLISECOND));case Y.Time:return $at(i(4,Gi,ns.MILLISECOND),i(6,Ue,32));case Y.Timestamp:return Tat(i(4,Gi,ns.SECOND),i(6,Dv));case Y.Interval:return kat(i(4,Gi,_h.YEAR_MONTH));case Y.Duration:return Rat(i(4,Gi,ns.MILLISECOND));case Y.FixedSizeBinary:return Fat(i(4,Ue,0));case Y.FixedSizeList:return Nat(r[0],i(4,Ue,0));case Y.Map:return Oat(i(4,f0,!1),r[0]);case Y.Union:return Iat(i(4,Gi,$M.Sparse),r,_c(t,i(6,Jl),4,Ue))}return{typeId:n}}function FM(t,e){const n=_c(t,e,4,(r,i)=>{const s=Eu(r,i);return[s(4,Dv),s(6,Dv)]});return n.length?new Map(n):null}function PP(t,e,n){const r=Eu(t,e);return{version:n,endianness:r(4,Gi,0),fields:r(6,Out,[]),metadata:r(8,FM)}}function Out(t,e){return _c(t,e,4,zP)}function zP(t,e){const n=Eu(t,e),r=n(8,IM,Y.NONE),i=n(10,Jl,0),s=n(12,Dut),o=n(14,(u,c)=>Rut(u,c));let a=BP(t,i,r,o);return s&&(s.dictionary=a,a=s),{name:n(4,Dv),type:a,nullable:n(6,f0,!1),metadata:n(16,FM)}}function Rut(t,e){const n=_c(t,e,4,zP);return n.length?n:null}function Dut(t,e){if(!e)return null;const n=Eu(t,e);return wat(null,n(6,Lut,_P()),n(8,f0,!1),n(4,Hi,0))}function Lut(t,e){return BP(t,e,Y.Int)}const But=(t,e)=>`Expected to read ${t} metadata bytes, but only read ${e}.`,Put=(t,e)=>`Expected to read ${t} bytes for message body, but only read ${e}.`,zut=t=>`Unsupported message type: ${t} (${yP(cc,t)})`;function u3(t,e){let n=Ue(t,e)||0;if(e+=l0,n===-1&&(n=Ue(t,e)||0,e+=l0),n===0)return null;const r=t.subarray(e,e+=n);if(r.byteLength<n)throw new Error(But(n,r.byteLength));const i=Eu(r,0),s=i(4,Gi,y2.V1),o=i(6,IM,cc.NONE),a=i(8,Jl,0),u=i(10,Hi,0);let c;if(a){const l=o===cc.Schema?PP:o===cc.DictionaryBatch?Nut:o===cc.RecordBatch?LP:null;if(!l)throw new Error(zut(o));if(c=l(r,a,s),u>0){const f=t.subarray(e,e+=u);if(f.byteLength<u)throw new Error(Put(u,f.byteLength));c.body=f}}return{version:s,type:o,index:e,content:c}}function Uut(t){const e=t instanceof ArrayBuffer?new Uint8Array(t):t;return e instanceof Uint8Array&&jut(e)?Wut(e):qut(e)}function jut(t){if(!t||t.length<4)return!1;for(let e=0;e<6;++e)if(dP[e]!==t[e])return!1;return!0}function qut(t){const e=[t].flat();let n;const r=[],i=[];for(const s of e){if(!(s instanceof Uint8Array))throw new Error("IPC data batch was not a Uint8Array.");let o=0;for(;;){const a=u3(s,o);if(a===null)break;if(o=a.index,!!a.content)switch(a.type){case cc.Schema:n||(n=a.content);break;case cc.RecordBatch:r.push(a.content);break;case cc.DictionaryBatch:i.push(a.content);break}}}return{schema:n,dictionaries:i,records:r,metadata:null}}function Wut(t){const e=t.byteLength-(dP.length+4),n=Ue(t,e),r=Eu(t,e-n),i=r(4,Gi,y2.V1),s=r(8,$D,[]),o=r(10,$D,[]);return{schema:r(6,(a,u)=>PP(a,u,i)),dictionaries:s.map(({offset:a})=>u3(t,a).content),records:o.map(({offset:a})=>u3(t,a).content),metadata:r(12,FM)}}function Vut(t,e){return Gut(Uut(t),e)}function Gut(t,e={}){const{schema:n={fields:[]},dictionaries:r,records:i}=t,{version:s,fields:o}=n,a=new Map,u=Hut(e,s,a),c=new Map;Yut(n,d=>{const h=d.type;h.typeId===Y.Dictionary&&c.set(h.id,h.dictionary)});const l=new Map;for(const d of r){const{id:h,data:p,isDelta:g,body:m}=d,y=c.get(h),b=c3(y,u({...p,body:m}));if(l.has(h)){const w=l.get(h);g||w.clear(),w.add(b)}else{if(g)throw new Error("Delta update can not be first dictionary batch.");l.set(h,ED(y).add(b))}}l.forEach((d,h)=>a.set(h,d.done()));const f=o.map(d=>ED(d.type));for(const d of i){const h=u(d);o.forEach((p,g)=>f[g].add(c3(p.type,h)))}return new Mut(n,f.map(d=>d.done()),e.useProxy)}function Yut(t,e){t.fields.forEach(function n(r){var i,s,o;e(r),(s=(i=r.type.dictionary)==null?void 0:i.children)==null||s.forEach(n),(o=r.type.children)==null||o.forEach(n)})}function Hut(t,e,n){const r={version:e,options:t,dictionary:i=>n.get(i)};return i=>{const{length:s,nodes:o,regions:a,variadic:u,body:c}=i;let l=-1,f=-1,d=-1;return{...r,length:s,node:()=>o[++l],buffer:h=>{const{length:p,offset:g}=a[++f];return h?new h(c.buffer,c.byteOffset+g,p/h.BYTES_PER_ELEMENT):c.subarray(g,g+p)},variadic:()=>u[++d],visit(h){return h.map(p=>c3(p.type,this))}}}}function c3(t,e){const{typeId:n}=t,{length:r,options:i,node:s,buffer:o,variadic:a,version:u}=e,c=Iut(t,i);if(n===Y.Null)return new c({length:r,nullCount:r,type:t});const l={...s(),type:t};switch(n){case Y.Bool:case Y.Int:case Y.Time:case Y.Duration:case Y.Float:case Y.Decimal:case Y.Date:case Y.Timestamp:case Y.Interval:case Y.FixedSizeBinary:return new c({...l,validity:o(),values:o(t.values)});case Y.Utf8:case Y.LargeUtf8:case Y.Binary:case Y.LargeBinary:return new c({...l,validity:o(),offsets:o(t.offsets),values:o()});case Y.BinaryView:case Y.Utf8View:return new c({...l,validity:o(),values:o(),data:Array.from({length:a()},()=>o())});case Y.List:case Y.LargeList:case Y.Map:return new c({...l,validity:o(),offsets:o(t.offsets),children:e.visit(t.children)});case Y.ListView:case Y.LargeListView:return new c({...l,validity:o(),offsets:o(t.offsets),sizes:o(t.offsets),children:e.visit(t.children)});case Y.FixedSizeList:case Y.Struct:return new c({...l,validity:o(),children:e.visit(t.children)});case Y.RunEndEncoded:return new c({...l,children:e.visit(t.children)});case Y.Dictionary:{const{id:f,indices:d}=t;return new c({...l,validity:o(),values:o(d.values)}).setDictionary(e.dictionary(f))}case Y.Union:return u<y2.V5&&o(),new c({...l,typeIds:o(mP),offsets:t.mode===$M.Sparse?null:o(t.offsets),children:e.visit(t.children)});default:throw new Error(MM(n))}}new Uint16Array(new Uint8Array([1,0]).buffer)[0];function l3(t){return Vut(t,{useDate:!0})}function Xut(t="ws://localhost:3000/"){const e=[];let n=!1,r=null,i;const s={open(){n=!0,u()},close(){for(n=!1,r=null,i=null;e.length;)e.shift().reject("Socket closed")},error(c){if(r){const{reject:l}=r;r=null,u(),l(c)}else console.error("WebSocket error: ",c)},message({data:c}){if(r){const{query:l,resolve:f,reject:d}=r;if(r=null,u(),typeof c=="string"){const h=JSON.parse(c);h.error?d(h.error):f(h)}else if(l.type==="exec")f();else if(l.type==="arrow")f(l3(c));else throw new Error(`Unexpected socket data: ${c}`)}else console.log("WebSocket message: ",c)}};function o(){i=new WebSocket(t),i.binaryType="arraybuffer";for(const c in s)i.addEventListener(c,s[c])}function a(c,l,f){i==null&&o(),e.push({query:c,resolve:l,reject:f}),n&&!r&&u()}function u(){e.length&&(r=e.shift(),i.send(JSON.stringify(r.query)))}return{get connected(){return n},query(c){return new Promise((l,f)=>a(c,l,f))}}}const NM="COLUMN_REF",OM="COLUMN_PARAM",Kut="TABLE_REF",Qut="LITERAL",Jut="ORDER_BY",UP="CAST",Zut="CASE",tct="WHEN",ect="UNARY",nct="UNARY_POSTFIX",jP="BINARY",qP="BETWEEN",WP="NOT_BETWEEN",VP="LOGICAL_OPERATOR",GP="IN",YP="FUNCTION",x2="AGGREGATE",RM="WINDOW",HP="WINDOW_DEF",XP="WINDOW_FRAME",rct="EXPRESSION",DM="FRAGMENT",KP="VERBATIM",LM="PARAM",ict="WITH_CLAUSE",QP="SELECT_CLAUSE",JP="FROM_CLAUSE",sct="SAMPLE_CLAUSE",ZP="WINDOW_CLAUSE",tz="SELECT_QUERY",ez="DESCRIBE_QUERY",nz="SET_OPERATION";function du(t){return t instanceof ca}class ca{constructor(e){this.type=e}}class nr extends ca{}class rz extends nr{constructor(e){super(Qut),this.value=e}toString(){return iz(this.value)}}function iz(t){switch(typeof t){case"number":return Number.isFinite(t)?`${t}`:"NULL";case"string":return`'${t.replaceAll("'","''")}'`;case"boolean":return t?"TRUE":"FALSE";default:if(t==null)return"NULL";if(t instanceof Date){const e=+t;if(Number.isNaN(e))return"NULL";const n=t.getUTCFullYear(),r=t.getUTCMonth(),i=t.getUTCDate();return e===Date.UTC(n,r,i)?`DATE '${n}-${r+1}-${i}'`:`epoch_ms(${e})`}else return t instanceof RegExp?`'${t.source}'`:`${t}`}}class _2 extends nr{constructor(e){super(LM),this.param=e}get value(){return this.param.value}toString(){return iz(this.value)}}function sz(t){return t.split(".")}function zp(t){return`"${t}"`}function IE(t){return t&&oct(t)?t.slice(1,-1):t}function oct(t){return t[0]==='"'&&t[t.length-1]==='"'}function Lv(t){return t instanceof oz}class oz extends nr{constructor(e){super(Kut),this.table=[e].flat()}get name(){return this.table[this.table.length-1]}toString(){return this.table.map(e=>zp(e)).join(".")}}class act extends nr{constructor(e,n=[]){super(YP),this.name=e,this.args=n}toString(){const{name:e,args:n}=this;return`${e}(${n.join(", ")})`}}function os(t,...e){return new act(t,az(e).map(tr))}function la(t,...e){return new pct(t,az(e).map(tr))}function Oo(t,e=tr){return t.flat().filter(n=>n!=null).map(n=>e(n))}function az(t){const e=t.length;let n=e;for(;n>0&&t[n-1]===void 0;--n);return n<e?t.slice(0,n):t}function Ic(t){return typeof t=="string"}function f3(t){return Array.isArray(t)}function hy(t){return t&&typeof t.addEventListener=="function"&&t.dynamic!==!1&&"value"in t}class uct extends ca{constructor(e,n){super(ZP),this.name=e,this.def=n}toString(){return`${zp(this.name)} AS ${this.def}`}}class Vl extends nr{constructor(e,n=new uz){super(RM),this.func=e,this.def=n}over(e){return new Vl(this.func,this.def.over(e))}partitionby(...e){return new Vl(this.func,this.def.partitionby(...e))}orderby(...e){return new Vl(this.func,this.def.orderby(...e))}rows(e){return new Vl(this.func,this.def.rows(e))}range(e){return new Vl(this.func,this.def.range(e))}toString(){return`${this.func} OVER ${this.def}`}}class uz extends ca{constructor(e,n,r,i){super(HP),this.name=e,this.partition=n,this.order=r,this.frame=i}over(e){return Ig(this,{name:e})}partitionby(...e){return Ig(this,{partition:Oo(e)})}orderby(...e){return Ig(this,{order:Oo(e)})}rows(e){return Ig(this,{frame:new TD(e)})}range(e){return Ig(this,{frame:new TD(e,!0)})}toString(){const{name:e,partition:n,order:r,frame:i}=this,s=e&&zp(e),o=[s,(n==null?void 0:n.length)&&`PARTITION BY ${n.join(", ")}`,(r==null?void 0:r.length)&&`ORDER BY ${r.join(", ")}`,i].filter(a=>a);return s&&o.length<2?s:`(${o.join(" ")})`}}class TD extends ca{constructor(e,n=!1,r=void 0){super(XP),this.extent=hy(e)?new _2(e):e,this.range=n,this.exclude=r}toString(){const{range:e,exclude:n,extent:r}=this,i=e?"RANGE":"ROWS",[s,o]=du(r)?r.value:r,a=kD(s,"PRECEDING"),u=kD(o,"FOLLOWING");return`${i} BETWEEN ${a} AND ${u}${n?` ${n}`:""}`}}function Ig(t,e){return new uz(e.name??t.name,e.partition??t.partition,e.order??t.order,e.frame??t.frame)}function kD(t,e){return t===0?"CURRENT ROW":Number.isFinite(t)?`${Math.abs(t)} ${e}`:`UNBOUNDED ${e}`}function S2(t){return t instanceof E2}class E2 extends nr{constructor(e,n){super(e),this.table=n}get column(){return null}toString(){const{column:e,table:n}=this,r=`${n??""}`,i=e==="*"?"*":zp(e);return(r?r+".":"")+i}}class cct extends E2{constructor(e,n){super(NM,n),this.name=e}get column(){return this.name}}function lct(t){return t instanceof cz}class cz extends E2{constructor(e,n){super(OM,n),this.param=e}get column(){return`${this.param.value}`}}function lz(t,e){const n=PM(e);return hy(t)?new cz(new _2(t),n):new cct(t,n)}class fz extends nr{constructor(e){super(KP),this.value=e}toString(){return this.value}}function Fc(t){return new rz(t)}function fct(t){return new fz(t)}function BM(...t){const e=Oo(t,String);return e!=null&&e.length?new oz(e):void 0}function tr(t){return Ic(t)?dct(t):dz(t)}function qb(t){return Ic(t)?fct(t):dz(t)}function dz(t){return t instanceof nr?t:hy(t)?new _2(t):Fc(t)}function PM(t){return Ic(t)?hct(t):f3(t)?BM(t):t}function dct(t){const e=sz(t);return lz(e.pop(),BM(e))}function hct(t){return BM(sz(t))}let pct=class d3 extends nr{constructor(e,n,r,i){super(x2),this.name=e,this.args=n,this.isDistinct=r,this.filter=i}distinct(e=!0){return new d3(this.name,this.args,e,this.filter)}where(e){return Ic(e)&&(e=qb(e)),new d3(this.name,this.args,this.isDistinct,e)}window(){return new Vl(this)}partitionby(...e){return this.window().partitionby(...e)}orderby(...e){return this.window().orderby(...e)}toString(){const{name:e,args:n,isDistinct:r,filter:i}=this,s=r?"DISTINCT ":"",o=n!=null&&n.length?n.join(", "):"*",a=i?` FILTER (WHERE ${i})`:"";return`${e}(${s}${o})${a}`}};const gct=["any_value","approx_count_distinct","approx_quantile","arbitrary","arg_max","arg_max_null","arg_min","arg_min_null","array_agg","avg","bit_and","bit_or","bit_xor","bitstring_agg","bool_and","bool_or","corr","count","covar_pop","covar_samp","entropy","favg","first","fsum","geomean","kurtosis_pop","kurtosis","last","mad","max","max_by","median","min","min_by","mode","product","quantile","quantile_cont","quantile_disc","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_sxx","regr_sxy","regr_syy","regr_slope","reservoir_quantile","skewness","stddev","stddev_pop","stddev_samp","string_agg","sum","variance","var_pop","var_samp"];class hz extends nr{constructor(e,n,r){super(e),this.expr=n,this.extent=r}toSQL(e){const{extent:n,expr:r}=this;return n?`(${r} ${e} ${n[0]} AND ${n[1]})`:""}}class pz extends hz{constructor(e,n){super(qP,e,n)}toString(){return super.toSQL("BETWEEN")}}class mct extends hz{constructor(e,n){super(WP,e,n)}toString(){return super.toSQL("NOT BETWEEN")}}class yct extends nr{constructor(e,n,r){super(jP),this.op=e,this.left=n,this.right=r}toString(){return`(${this.left} ${this.op} ${this.right})`}}class bct extends nr{constructor(e,n){super(UP),this.expr=e,this.cast=n}toString(){return`(${this.expr})::${this.cast}`}}class vct extends nr{constructor(e){super(DM),this.spans=e}toString(){return this.spans.join("")}}class wct extends ca{constructor(e,n=!1,r=void 0,i=void 0){super(sct),this.size=e,this.perc=n,this.method=r,this.seed=i}toString(){const{size:e,perc:n,method:r,seed:i}=this,s=n?"%":" ROWS",o=i!=null?`, ${i}`:"";return`${e}${s}${r?` (${r}${o})`:""}`}}class xct extends ca{constructor(e,n){super(QP),this.expr=e,this.alias=n}toString(){const{expr:e,alias:n}=this;return!n||_ct(e,n)?`${e}`:`${e} AS ${zp(n)}`}}function _ct(t,e){return t instanceof E2&&t.table==null&&t.column===e}class Sct extends ca{constructor(e,n){super(ict),this.name=e,this.query=n}toString(){return`"${this.name}" AS (${this.query})`}}function gz(t){return t instanceof Ni}function A2(t){return t instanceof af}function Ect(t){return t instanceof $2}class Ni extends nr{static select(...e){return new af().select(...e)}static from(...e){return new af().from(...e)}static with(...e){return new af().with(...e)}static union(...e){return new ch("UNION",e.flat())}static unionAll(...e){return new ch("UNION ALL",e.flat())}static intersect(...e){return new ch("INTERSECT",e.flat())}static except(...e){return new ch("EXCEPT",e.flat())}static describe(e){return new $2(e)}constructor(e){super(e),this._orderby=[],this._limit=void 0,this._offset=void 0,this.cteFor=null}get subqueries(){return[]}clone(){return this}orderby(...e){return this._orderby=this._orderby.concat(Oo(e)),this}limit(e){return this._limit=Number.isFinite(e)?e:void 0,this}offset(e){return this._offset=Number.isFinite(e)?e:void 0,this}}class af extends Ni{constructor(){super(tz),this._with=[],this._select=[],this._from=[],this._where=[],this._sample=void 0,this._groupby=[],this._having=[],this._window=[],this._qualify=[]}get subqueries(){const e=this.cteFor||this,r=(e instanceof af?e._with:[]).reduce((s,o)=>(s[o.name]=o.query,s),{}),i=[];return this._from.forEach(({expr:s})=>{if(gz(s))i.push(s);else if(Lv(s)){const o=r[s.name];o&&i.push(o)}}),i}clone(){return Object.assign(new af,this)}with(...e){const n=[],r=(i,s)=>{const o=s.clone();o.cteFor=this,n.push(new Sct(i,o))};return e.flat().forEach(i=>{if(i!=null)for(const s in i)r(s,i[s])}),this._with=this._with.concat(n),this}select(...e){const n=[],r=(s,o)=>n.push(new xct(s==null?s:tr(s),IE(o)));e.flat().forEach(s=>{if(s!=null)if(Ic(s))r(s,s);else if(S2(s))r(s,s.column);else if(f3(s))r(s[1],s[0]);else for(const o in s)r(s[o],o)});const i=new Set(n.map(s=>s.alias));return this._select=this._select.filter(s=>!i.has(s.alias)).concat(n.filter(s=>s.expr)),this}setSelect(...e){return this._select=[],this.select(...e)}distinct(e=!0){return this._distinct=!!e,this}from(...e){const n=[],r=(i,s)=>n.push(new Act(PM(i),IE(s)));return e.flat().forEach(i=>{if(i!=null)if(Ic(i))r(i,i);else if(Lv(i))r(i,i.name);else if(du(i))r(i);else if(f3(i))r(i[1],i[0]);else for(const s in i)r(i[s],s)}),this._from=this._from.concat(n),this}setFrom(...e){return this._from=[],this.from(...e)}sample(e,n,r){let i;if(typeof e=="number"){const s=e>0&&e<1,o=s?e*100:Math.floor(e);i=new wct(o,s,n,r)}else i=e;return this._sample=i,this}where(...e){return this._where=this._where.concat(Oo(e,qb)),this}setWhere(...e){return this._where=[],this.where(...e)}groupby(...e){return this._groupby=this._groupby.concat(Oo(e)),this}setGroupby(...e){return this._groupby=[],this.groupby(...e)}having(...e){return this._having=this._having.concat(Oo(e,qb)),this}window(...e){const n=[];return e.flat().forEach(r=>{if(r!=null)for(const i in r)n.push(new uct(IE(i),r[i]))}),this._window=this._window.concat(n),this}qualify(...e){return this._qualify=this._qualify.concat(Oo(e,qb)),this}toString(){const{_with:e,_select:n,_distinct:r,_from:i,_sample:s,_where:o,_groupby:a,_having:u,_window:c,_qualify:l,_orderby:f,_limit:d,_offset:h}=this,p=[];if(e.length&&p.push(`WITH ${e.join(", ")}`),p.push(`SELECT${r?" DISTINCT":""} ${n.join(", ")}`),i.length&&p.push(`FROM ${i.join(", ")}`),o.length){const g=o.map(String).filter(m=>m).join(" AND ");g&&p.push(`WHERE ${g}`)}if(s&&p.push(`USING SAMPLE ${s}`),a.length&&p.push(`GROUP BY ${a.join(", ")}`),u.length){const g=u.map(String).filter(m=>m).join(" AND ");g&&p.push(`HAVING ${g}`)}if(c.length&&p.push(`WINDOW ${c.join(", ")}`),l.length){const g=l.map(String).filter(m=>m).join(" AND ");g&&p.push(`QUALIFY ${g}`)}return f.length&&p.push(`ORDER BY ${f.join(", ")}`),Number.isFinite(d)&&p.push(`LIMIT ${d}`),Number.isFinite(h)&&p.push(`OFFSET ${h}`),p.join(" ")}}class $2 extends ca{constructor(e){super(ez),this.query=e}clone(){return new $2(this.query.clone())}toString(){return`DESCRIBE ${this.query}`}}class ch extends Ni{constructor(e,n){super(nz),this.op=e,this.queries=n}get subqueries(){const{queries:e,cteFor:n}=this;return n&&e.forEach(r=>r.cteFor=n),e}clone(){const{op:e,queries:n,...r}=this;return Object.assign(new ch(e,n),r)}toString(){const{op:e,queries:n,_orderby:r,_limit:i,_offset:s}=this,o=[n.join(` ${e} `)];return r.length&&o.push(`ORDER BY ${r.join(", ")}`),Number.isFinite(i)&&o.push(`LIMIT ${i}`),Number.isFinite(s)&&o.push(`OFFSET ${s}`),o.join(" ")}}class Act extends ca{constructor(e,n){super(JP),this.expr=e,this.alias=n}toString(){const{expr:e,alias:n}=this,r=gz(e)?`(${e})`:`${e}`;return n&&!(Lv(e)&&e.table.join(".")===n)?`${r} AS ${zp(n)}`:`${r}`}}class $ct extends nr{constructor(e,n){super(GP),this.expr=e,this.values=n}toString(){return`(${this.expr} IN (${this.values.join(", ")}))`}}class mz extends nr{constructor(e,n){super(VP),this.op=e,this.clauses=n}toString(){const e=this.clauses;return e.length===0?"":e.length===1?`${e[0]}`:`(${e.join(` ${this.op} `)})`}}class Tct extends mz{constructor(e){super("AND",e)}}class kct extends mz{constructor(e){super("OR",e)}}class Mct extends nr{constructor(e,n,r){super(e),this.op=n,this.expr=r}}class Cct extends Mct{constructor(e,n){super(nct,e,n)}toString(){return`(${this.expr} ${this.op})`}}function h3(t,e){return la("arg_max",t,e)}function p3(t,e){return la("arg_min",t,e)}function yz(t){return la("avg",t)}function Wb(t){return la("count",t)}function Bv(t){return la("max",t)}function Pv(t){return la("min",t)}function Ict(t,e){return la("regr_avgx",t,e)}function Fct(t,e){return la("regr_avgy",t,e)}function Nct(t,e){return la("regr_count",t,e)}function Mn(t){return la("sum",t)}function bz(t,e){return new bct(tr(t),e)}function vz(t){return bz(t,"INTEGER")}function Wm(t){return bz(t,"DOUBLE")}function Oct(t){return os("epoch_ms",t)}function Fg(t){return os("make_date",2012,os("month",t),1)}function zM(t){return os("exp",t)}function Rct(t){return os("log",t)}function Vm(t){return os("ln",t)}function jh(t){return os("sign",t)}function d0(t){return os("abs",t)}function zv(t){return os("sqrt",t)}function Dct(t){return os("ceil",t)}function wz(t){return os("floor",t)}function Lct(t,e){return os("round",t,e)}function xz(t,e){return new Cct(t,tr(e))}function py(t,e,n){return new yct(t,tr(e),tr(n))}function Bct(t,e,n=!1){const r=n?mct:pz;return new r(tr(t),e==null?void 0:e.map(tr))}function _z(...t){return new Tct(Oo(t))}function Pct(...t){return new kct(Oo(t))}function zct(t){return xz("IS NULL",t)}function Sz(t){return xz("IS NOT NULL",t)}function Uct(t,e){return py("+",t,e)}function Rn(t,e){return py("-",t,e)}function xr(t,e){return py("*",t,e)}function Gn(t,e){return py("/",t,e)}function as(t,e){return py("**",t,e)}function Uv(t,e){return Bct(t,e,!1)}function jct(t,e){return new $ct(tr(t),e.map(tr))}function UM(t,...e){return new vct(qct(t,e))}function qct(t,e){const n=[t[0]],r=e.length;for(let i=0,s=0;i<r;){const o=e[i];du(o)?n[++s]=o:hy(o)?n[++s]=new _2(o):n[s]+=Ic(o)?o:Fc(o);const a=t[++i];du(n[s])?n[++s]=a:n[s]+=a}return n.filter(i=>i).map(i=>Ic(i)?new fz(i):i)}const Ez={[x2]:["args","filter"],[qP]:["expr","extent"],[jP]:["left","right"],[Zut]:["expr","_when","_else"],[UP]:["expr"],[OM]:["param","table"],[NM]:["table"],[ez]:["query"],[rct]:["node"],[DM]:["spans"],[JP]:["expr"],[YP]:["args"],[GP]:["expr","values"],[VP]:["clauses"],[WP]:["expr","extent"],[Jut]:["expr"],[LM]:["value"],[QP]:["expr"],[tz]:["_with","_select","_from","_where","_sample","_groupby","_having","_window","_qualify","_orderby"],[nz]:["subqueries","_orderby"],[ect]:["expr"],[tct]:["when","then"],[RM]:["func","def"],[ZP]:["def"],[HP]:["partition","order","frame"],[XP]:["extent"]};function g3(t,e){if(e.has(t))return e.get(t);if(du(t)){const n=Ez[t.type],r=(n==null?void 0:n.length)??0;for(let i=0;i<r;++i){const s=n[i],o=t[s];if(Array.isArray(o)){const a=o.length;for(let u=0;u<a;++u)o[u]=g3(o[u],e)}else o&&(t[s]=g3(o,e))}}return t}function Ef(t,e){if(!du(t))return;const n=e(t);if(n)return n;const r=Ez[t.type],i=(r==null?void 0:r.length)??0;for(let s=0;s<i;++s){const o=t[r[s]];if(Array.isArray(o)){const a=o.length;for(let u=0;u<a;++u)if(o[u]&&+Ef(o[u],e)<0)return n}else if(o&&+Ef(o,e)<0)return-1}}const Wct=new RegExp(`^(${gct.join("|")})$`),Vct=/(\\'|\\"|"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|\w+\()/g;function Gct(t){return t.split(Vct).some(e=>e.endsWith("(")&&Wct.test(e.slice(0,-1)))}function T2(t){let e=0;return Ef(t,n=>{switch(n.type){case RM:return-1;case x2:return e|=1,-1;case DM:case KP:{let r=`${n}`.toLowerCase();const i=r.indexOf("(select ");return i>=0&&(r=r.slice(0,i)),r.includes(") over ")?-1:Gct(r)?(e|=2,-1):1}}}),e}function Yct(t){const e=new Set;return Ef(t,n=>{n.type===x2&&e.add(n)}),Array.from(e)}function Az(t){const e={};return Ef(t,n=>{(n.type===NM||n.type===OM)&&(e[n]=n)}),Object.values(e)}function Hct(t){const e=new Set;return Ef(t,n=>{n.type===LM&&e.add(n.param)}),Array.from(e)}function $z(t,e,{replace:n=!1,temp:r=!1,view:i=!1}={}){return"CREATE"+(n?" OR REPLACE ":" ")+(r?"TEMP ":"")+(i?"VIEW":"TABLE")+(n?" ":" IF NOT EXISTS ")+t+" AS "+e}function Xct(t,e,n,r={},i={}){const{select:s=["*"],where:o,view:a,temp:u,replace:c,...l}=r,f=Qct({...i,...l}),d=`${t}('${n}'${f?", "+f:""})`,h=o?` WHERE ${o}`:"",p=`SELECT ${s.join(", ")} FROM ${d}${h}`;return $z(e,p,{view:a,temp:u,replace:c})}function Kct(t,e,n){return Xct("read_csv",t,e,n,{auto_detect:!0,sample_size:-1})}function Qct(t){return Object.entries(t).map(([e,n])=>`${e}=${m3(n)}`).join(", ")}function m3(t){switch(typeof t){case"boolean":return String(t);case"string":return`'${t}'`;case"undefined":case"object":return t==null?"NULL":Array.isArray(t)?"["+t.map(e=>m3(e)).join(", ")+"]":"{"+Object.entries(t).map(([e,n])=>`'${e}': ${m3(n)}`).join(", ")+"}";default:return t}}function Jct(t,e,n,r,i){const s=i?Rn(n,Wm(t)):Rn(Wm(t),e),o=n===e?0:r/(n-e);return o?xr(s,Wm(o)):s}function Zct(t,e,n,r,i=[]){const s=vz(wz(e)),o=a=>Ni.from(t).select(a).groupby(s,i);return Ni.union(o([{[n]:Pv(n),[r]:p3(r,n)},...i]),o([{[n]:Bv(n),[r]:h3(r,n)},...i]),o([{[n]:p3(n,r),[r]:Pv(r)},...i]),o([{[n]:h3(n,r),[r]:Bv(r)},...i])).orderby(i,n)}const Vb=t=>t;function MD(){return{apply:Vb,invert:Vb,sqlApply:tr,sqlInvert:Vb}}function tlt({base:t=null}={}){if(t==null||t===Math.E)return{apply:Math.log,invert:Math.exp,sqlApply:e=>Vm(e),sqlInvert:e=>zM(e)};if(t===10)return{apply:Math.log10,invert:e=>Math.pow(10,e),sqlApply:e=>Rct(e),sqlInvert:e=>as(10,e)};{const e=+t;return{apply:n=>Math.log(n)/Math.log(e),invert:n=>Math.pow(e,n),sqlApply:n=>Gn(Vm(n),Vm(e)),sqlInvert:n=>as(e,n)}}}function elt({constant:t=1}={}){const e=+t;return{apply:n=>Math.sign(n)*Math.log1p(Math.abs(n)),invert:n=>Math.sign(n)*Math.exp(Math.abs(n)-e),sqlApply:n=>(n=tr(n),xr(jh(n),Vm(Uct(e,d0(n))))),sqlInvert:n=>xr(jh(n),Rn(zM(d0(n)),e))}}function nlt(){return{apply:t=>Math.sign(t)*Math.sqrt(Math.abs(t)),invert:t=>Math.sign(t)*t*t,sqlApply:t=>(t=tr(t),xr(jh(t),zv(d0(t)))),sqlInvert:t=>xr(jh(t),as(t,2))}}function rlt({exponent:t=1}={}){const e=+t;return{apply:n=>Math.sign(n)*Math.pow(Math.abs(n),e),invert:n=>Math.sign(n)*Math.pow(Math.abs(n),1/e),sqlApply:n=>(n=tr(n),xr(jh(n),as(d0(n),e))),sqlInvert:n=>xr(jh(n),as(d0(n),Gn(1,e)))}}function CD(){return{apply:t=>+t,invert:t=>new Date(t),sqlApply:t=>t instanceof Date?Fc(+t):slt(t)?Fc(+t.value):Oct(t),sqlInvert:Vb}}const ilt={identity:MD,linear:MD,log:tlt,symlog:elt,sqrt:nlt,pow:rlt,time:CD,utc:CD};function Tz(t){const e=ilt[t.type];return e?{...t,...e(t)}:null}function slt(t){return t instanceof rz&&t.value instanceof Date}function kz(t){let e=2166136261;for(let n=0,r=t.length;n<r;++n){const i=t.charCodeAt(n),s=i&65280;s&&(e=ID(e^s>>8)),e=ID(e^i&255)}return olt(e)>>>0}function ID(t){return t+(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)}function olt(t){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,t+=t<<5,t&4294967295}function alt(t,e,n){switch(t.name){case"count":case"sum":return ult(e,t);case"avg":return clt(e,t);case"geomean":return llt(e,t);case"arg_max":return flt(e,t);case"arg_min":return dlt(e,t);case"variance":case"var_samp":return F1(e,t,n);case"var_pop":return F1(e,t,n,!1);case"stddev":case"stddev_samp":return zv(F1(e,t,n));case"stddev_pop":return zv(F1(e,t,n,!1));case"covar_samp":return Gb(e,t,n);case"covar_pop":return Gb(e,t,n,!1);case"corr":return FD(e,t,n);case"regr_count":return Up(e,t).expr;case"regr_avgx":return Iz(e,t);case"regr_avgy":return Fz(e,t);case"regr_syy":return b3(e,0,t,n);case"regr_sxx":return b3(e,1,t,n);case"regr_sxy":return Gb(e,t,n,null);case"regr_slope":return Nz(e,t,n);case"regr_intercept":return hlt(e,t,n);case"regr_r2":return as(FD(e,t,n),2);case"max":case"min":case"bit_and":case"bit_or":case"bit_xor":case"bool_and":case"bool_or":case"product":{const r=Mz(t);return e[r]=t,UM`${t.name}("${r}")`}default:return null}}function Mz(t){return"pre_"+kz(`${t}`).toString(16)}function _r(t,e,n){const r=n==null?void 0:n.filter;r&&(e=e.filter?e.where(_z(r,e.filter)):e.where(r));const i=Mz(e);return t[i]=e,i}function jM(t,e){const n=_r(t,Wb(e.args[0]),e);return{expr:Mn(n),name:n}}function ult(t,e){return Mn(_r(t,e))}function clt(t,e){const n=_r(t,e),{expr:r,name:i}=jM(t,e);return Gn(Mn(xr(n,i)),r)}function llt(t,e){const n=e.args[0],r=_r(t,Mn(Vm(n)),e),{expr:i}=jM(t,e);return zM(Gn(Mn(r),i))}function flt(t,e){const n=_r(t,e),r=_r(t,Bv(e.args[1]),e);return h3(n,r)}function dlt(t,e){const n=_r(t,e),r=_r(t,Pv(e.args[1]),e);return p3(n,r)}function F1(t,e,n,r=!0){const i=e.args[0],{expr:s}=jM(t,e),o=Rn(i,n(i)),a=_r(t,Mn(as(o,2)),e),u=_r(t,Mn(o),e),c=r?Rn(s,1):s;return Gn(Rn(Mn(a),Gn(as(Mn(u),2),s)),c)}function Gb(t,e,n,r=!0){const{expr:i}=Up(t,e),s=Cz(t,e,n),o=h0(t,1,e,n),a=h0(t,0,e,n),u=Rn(s,Gn(xr(o,a),i));return r===null?u:r?Gn(u,Rn(i,1)):Gn(u,i)}function FD(t,e,n){const{expr:r}=Up(t,e),i=Cz(t,e,n),s=y3(t,1,e,n),o=y3(t,0,e,n),a=h0(t,1,e,n),u=h0(t,0,e,n),c=Rn(s,Gn(as(a,2),r)),l=Rn(o,Gn(as(u,2),r));return Gn(Rn(i,Gn(xr(a,u),r)),zv(xr(c,l)))}function Up(t,e){const[n,r]=e.args,i=_r(t,Nct(n,r),e);return{expr:Mn(i),name:i}}function h0(t,e,n,r){const i=n.args,s=i[e],o=i[1-e],a=Mn(Rn(s,r(s))).where(Sz(o));return Mn(_r(t,a,n))}function y3(t,e,n,r){const i=n.args,s=i[e],o=i[1-e],a=Mn(as(Rn(s,r(s)),2)).where(Sz(o));return Mn(_r(t,a,n))}function Cz(t,e,n){const[r,i]=e.args,s=Mn(xr(Rn(i,n(i)),Rn(r,n(r))));return Mn(_r(t,s,e))}function Iz(t,e){const[n,r]=e.args,{expr:i,name:s}=Up(t,e),o=_r(t,Ict(n,r),e);return Gn(Mn(xr(o,s)),i)}function Fz(t,e){const[n,r]=e.args,{expr:i,name:s}=Up(t,e),o=_r(t,Fct(n,r),e);return Gn(Mn(xr(o,s)),i)}function b3(t,e,n,r){const{expr:i}=Up(t,n),s=h0(t,e,n,r),o=y3(t,e,n,r);return Rn(o,Gn(as(s,2),i))}function Nz(t,e,n){const r=Gb(t,e,n,null),i=b3(t,1,e,n);return Gn(r,i)}function hlt(t,e,n){const r=Iz(t,e),i=Fz(t,e),s=Nz(t,e,n);return Rn(i,xr(s,r))}function plt(t){if(!t.filterStable)return null;const e=t.query();if(!A2(e))return null;const n=jv(e,u=>{var l;const c=(l=u._from[0])==null?void 0:l.expr;return Lv(c)?c.name:c});if(typeof n!="string")return null;const r=new Map,i={},s={},o=[],a=u=>{const c=u.column,l=jv(e,f=>{var d;return(d=f._select.find(h=>h.alias===c))==null?void 0:d.expr});return UM`(SELECT avg(${l??u}) FROM "${n}")`};for(const{alias:u,expr:c}of e._select){if(T2(c)>1)return null;const l=Yct(c);if(l.length===0)o.push(u),i[u]=c;else{for(const f of l){if(f.isDistinct)return null;const d=alt(f,i,a);if(!d)return null;r.set(f,d)}s[u]=g3(c,r)}}return r.size?{group:o,preagg:i,output:s}:null}function jv(t,e){const n=t.subqueries;if(A2(t)&&n.length===0)return e(t);const r=jv(n[0],e);for(let i=1;i<n.length;++i){const s=jv(n[i],e);if(s!==void 0&&s!==r)return NaN}return r}const glt={skip:!0,result:null};class mlt{constructor(e,{schema:n="mosaic",enabled:r=!0}={}){this.entries=new Map,this.active=null,this.mc=e,this._schema=n,this._enabled=r}set enabled(e){this._enabled!==e&&(e||this.clear(),this._enabled=e)}get enabled(){return this._enabled}set schema(e){this._schema!==e&&(this.clear(),this._schema=e)}get schema(){return this._schema}dropSchema(){return this.clear(),this.mc.exec(`DROP SCHEMA IF EXISTS "${this.schema}" CASCADE`)}clear(){this.entries.clear(),this.active=null}request(e,n,r){var f;if(!this.enabled)return null;const{entries:i,mc:s,schema:o}=this,{source:a}=r;if(!a||this.active&&(this.active.source!==a&&this.clear(),((f=this.active)==null?void 0:f.source)===null))return null;let{active:u}=this;if(!u&&(this.active=u=ylt(r),u.source===null))return null;if(i.has(e))return i.get(e);const c=plt(e);let l;if(!c)l=null;else if(n.skip(e,r))l=glt;else{const d=n.remove(a).predicate(e);l=wlt(e.query(d),u,c,o),l.result=s.exec([`CREATE SCHEMA IF NOT EXISTS ${o}`,$z(l.table,l.create,{temp:!1})]),l.result.catch(h=>s.logger().error(h))}return i.set(e,l),l}}function ylt(t){const{source:e,meta:n}=t,r=t.predicate,i=Az(r).map(f=>f.column);let s,o;if(!n||!i)return{source:null,columns:o,predicate:s};const{type:a,scales:u,bin:c,pixelSize:l=1}=n;if(a==="point")s=f=>f,o=Object.fromEntries(i.map(f=>[`${f}`,tr(f)]));else if(a==="interval"&&u){const f=u.map(d=>vlt(d,l,c));f.some(d=>!d)||(f.length===1?(s=d=>d?Uv("active0",d.extent.map(f[0])):[],o={active0:f[0](r.expr)}):(s=d=>d?_z(d.clauses.map((h,p)=>Uv(`active${p}`,h.extent.map(f[p])))):[],o=Object.fromEntries(r.clauses.map((d,h)=>[`active${h}`,f[h](d.expr)]))))}return{source:o?e:null,columns:o,predicate:s}}const blt={ceil:Dct,round:Lct};function vlt(t,e,n){const{type:r,domain:i,range:s,apply:o,sqlApply:a}=Tz(t);if(!o)return;const u=blt[`${n}`.toLowerCase()]||wz,c=o(Math.min(...i)),l=o(Math.max(...i)),f=(r==="identity"?1:Math.abs(s[1]-s[0])/(l-c))/e,d=f===1?p=>p:p=>xr(Wm(f),p),h=c===0?p=>p:p=>Rn(p,Wm(c));return p=>vz(u(d(h(a(p)))))}function wlt(t,e,n,r){const{group:i,output:s,preagg:o}=n,{columns:a}=e,u=t.setSelect({...o,...a}).groupby(Object.keys(a)),[c]=u.subqueries;if(c){const m=Object.values(a).flatMap(y=>Az(y).map(b=>b.column));xlt(c,m)}const l=u._having,f=u._orderby;u._having=[],u._orderby=[];const d=u.toString(),h=(kz(d)>>>0).toString(16),p=`${r}.preagg_${h}`,g=Ni.select(i,s).from(p).groupby(i).having(l).orderby(f);return new _lt({table:p,create:d,active:e,select:g})}function xlt(t,e){const n=new Set,r=i=>{n.has(i)||(n.add(i),A2(i)&&i._from.length&&i.select(e),i.subqueries.forEach(r))};r(t)}class _lt{constructor({table:e,create:n,active:r,select:i}){this.table=e,this.create=n,this.result=null,this.active=r,this.select=i,this.skip=!1}query(e){return this.select.clone().where(this.active.predicate(e))}}function Oz(t){switch(t){case"BIGINT":case"HUGEINT":case"INTEGER":case"SMALLINT":case"TINYINT":case"UBIGINT":case"UINTEGER":case"USMALLINT":case"UTINYINT":case"DOUBLE":case"FLOAT":case"REAL":return"number";case"DATE":case"TIMESTAMP":case"TIMESTAMPTZ":case"TIMESTAMP WITH TIME ZONE":case"TIME":case"TIMESTAMP_NS":return"date";case"BOOLEAN":return"boolean";case"VARCHAR":case"UUID":case"JSON":return"string";case"ARRAY":case"LIST":return"array";case"BLOB":case"STRUCT":case"MAP":case"GEOMETRY":return"object";default:if(t.startsWith("DECIMAL"))return"number";if(t.startsWith("STRUCT")||t.startsWith("MAP"))return"object";if(t.endsWith("]"))return"array";throw new Error(`Unsupported type: ${t}`)}}const Slt="count",Elt="nulls",Alt="max",$lt="min",Tlt="distinct",klt={[Slt]:Wb,[Tlt]:t=>Wb(t).distinct(),[Alt]:Bv,[$lt]:Pv,[Elt]:t=>Wb().where(zct(t))};function Mlt({table:t,column:e,stats:n}){return Ni.from(t).select(Array.from(n,r=>({[r]:klt[r](e)})))}async function Clt(t,e){return e.length===1&&e[0].column==="*"?Flt(t,e[0].table):(await Promise.all(e.map(n=>Ilt(t,n)))).filter(n=>n)}async function Ilt(t,{table:e,column:n,stats:r}){const i=Ni.from({source:e}).select({column:n}).groupby(du(n)&&T2(n)?UM`ALL`:[]),[s]=Array.from(await t.query(Ni.describe(i))),o={table:e,column:`${n}`,sqlType:s.column_type,type:Oz(s.column_type),nullable:s.null==="YES"};if(!(r!=null&&r.length))return o;const[a]=await t.query(Mlt({table:e,column:n,stats:r}),{persist:!0});return Object.assign(o,a)}async function Flt(t,e){return Array.from(await t.query(`DESCRIBE ${PM(e)}`)).map(r=>({table:e,column:r.column_name,sqlType:r.column_type,type:Oz(r.column_type),nullable:r.null==="YES"}))}const Zl=Object.freeze({pending:Symbol("pending"),ready:Symbol("ready"),error:Symbol("error"),done:Symbol("done")});class qM extends Promise{constructor(){let e,n;super((r,i)=>{e=r,n=i}),this._resolve=e,this._reject=n,this._state=Zl.pending,this._value=void 0}fulfill(e){if(this._value!==void 0){if(e!==void 0)throw Error("Promise is ready and fulfill has a provided value");this._resolve(this._value)}else{if(e===void 0)throw Error("Promise is neither ready nor has provided value");this._resolve(e)}return this._state=Zl.done,this}ready(e){return this._state=Zl.ready,this._value=e,this}reject(e){return this._state=Zl.error,this._reject(e),this}get state(){return this._state}}qM.prototype.constructor=Promise;function Rz(){return{debug(...t){},info(...t){},log(...t){},warn(...t){},error(...t){}}}function Nlt(t){return(typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:setTimeout)(t)}function Olt(t,e){let n=[],r=0;function i(){const s=Rlt(n,e);n=[],r=0;for(const o of s)Llt(o,t),zlt(o,e)}return{add(s,o){s.request.type==="arrow"?(r=r||Nlt(()=>i()),n.push({entry:s,priority:o,index:n.length})):t(s,o)}}}function Rlt(t,e){const n=[],r=new Map;for(const i of t){const{entry:{request:s}}=i,o=Dlt(s.query,e);if(!r.has(o)){const a=[];n.push(a),r.set(o,a)}r.get(o).push(i)}return n}function Dlt(t,e){const n=`${t}`;if(A2(t)&&!e.get(n)){if(t._orderby.length||t._where.length||t._qualify.length||t._having.length)return n;const r=t.clone().setSelect("*"),i=t._groupby;if(i.length){const s={};t._select.forEach(({alias:o,expr:a})=>s[o]=a),r.setGroupby(i.map(o=>S2(o)&&s[o.column]||o))}else t._select.some(s=>T2(s.expr))&&r.setGroupby("ALL");return`${r}`}else return n}function Llt(t,e){if(Blt(t))e({request:{type:"arrow",cache:!1,query:t.query=Plt(t)},result:t.result=new qM});else for(const{entry:n,priority:r}of t)e(n,r)}function Blt(t){if(t.length>1){const e=`${t[0].entry.request.query}`;for(let n=1;n<t.length;++n)if(e!==`${t[n].entry.request.query}`)return!0}return!1}function Plt(t){const e=t.maps=[],n=new Map;for(const s of t){const{query:o}=s.entry.request,a=[];e.push(a);for(const{alias:u,expr:c}of o._select){const l=`${c}`;n.has(l)||n.set(l,[`col${n.size}`,c]);const[f]=n.get(l);a.push([f,u])}}const r=t[0].entry.request.query.clone(),i=r._groupby;if(i.length){const s={};t.maps[0].forEach(([o,a])=>s[a]=o),r.setGroupby(i.map(o=>S2(o)&&s[o.column]||o))}return r.setSelect(Array.from(n.values()))}async function zlt(t,e){const{maps:n,query:r,result:i}=t;if(!n)return;let s;try{s=await i}catch(a){for(const{entry:u}of t)u.result.reject(a);return}const o=Ect(r);t.forEach(({entry:a},u)=>{const{request:c,result:l}=a,f=n[u],d=o&&f?jlt(s,f):f?Ult(s,f):s;c.cache&&e.set(String(c.query),d),l.fulfill(d)})}function Ult(t,e){return t.select(e.map(n=>n[0]),e.map(n=>n[1]))}function jlt(t,e){const n=new Map(e),r=[];for(const i of t)n.has(i.column_name)&&r.push({...i,column_name:n.get(i.column_name)});return r}const qlt=typeof requestIdleCallback<"u"?requestIdleCallback:setTimeout,Wlt=()=>({get:()=>{},set:(t,e)=>e,clear:()=>{}});function Vlt({max:t=1e3,ttl:e=3*60*60*1e3}={}){let n=new Map;function r(){const i=performance.now()-e;let s=null,o=1/0;for(const[a,u]of n){const{last:c}=u;c<o&&(s=a,o=c),i>c&&n.delete(a)}s&&n.delete(s)}return{get(i){const s=n.get(i);if(s)return s.last=performance.now(),s.value},set(i,s){return n.set(i,{last:performance.now(),value:s}),n.size>t&&qlt(r),s},clear(){n=new Map}}}class Glt{constructor(e){this.queue=Array.from({length:e},()=>({head:null,tail:null}))}isEmpty(){return this.queue.every(e=>!e.head)}insert(e,n){const r=this.queue[n];if(!r)throw new Error(`Invalid queue priority rank: ${n}`);const i={item:e,next:null};r.head===null?r.head=r.tail=i:r.tail=r.tail.next=i}remove(e){for(const n of this.queue){let{head:r,tail:i}=n;for(let s=null,o=r;o;s=o,o=o.next)e(o.item)&&(o===r?r=o.next:s.next=o.next,o===i&&(i=s||r));n.head=r,n.tail=i}}next(){for(const e of this.queue){const{head:n}=e;if(n!==null)return e.head=n.next,e.tail===n&&(e.tail=null),n.item}}}const Qu=Object.freeze({High:0,Normal:1,Low:2});class Ylt{constructor(e=32){this.queue=new Glt(3),this.db=null,this.clientCache=null,this._logger=Rz(),this._logQueries=!1,this._consolidate=null,this.pendingResults=[],this.maxConcurrentRequests=e,this.pendingExec=!1}next(){if(this.queue.isEmpty()||this.pendingResults.length>this.maxConcurrentRequests||this.pendingExec)return;const{request:e,result:n}=this.queue.next();this.pendingResults.push(n),e.type==="exec"&&(this.pendingExec=!0),this.submit(e,n).finally(()=>{for(;this.pendingResults.length&&this.pendingResults[0].state!==Zl.pending;){const r=this.pendingResults.shift();r.state===Zl.ready?r.fulfill():r.state===Zl.done&&this._logger.warn("Found resolved query in pending results.")}e.type==="exec"&&(this.pendingExec=!1),this.next()})}enqueue(e,n=Qu.Normal){this.queue.insert(e,n),this.next()}async submit(e,n){try{const{query:r,type:i,cache:s=!1,options:o}=e,a=r?`${r}`:null;if(s){const f=this.clientCache.get(a);if(f){const d=await f;this._logger.debug("Cache"),n.ready(d);return}}const u=performance.now();this._logQueries&&this._logger.debug("Query",{type:i,sql:a,...o});const c=this.db.query({type:i,sql:a,...o});s&&this.clientCache.set(a,c);const l=await c;s&&this.clientCache.set(a,l),this._logger.debug(`Request: ${(performance.now()-u).toFixed(1)}`),n.ready(i==="exec"?null:l)}catch(r){n.reject(r)}}cache(e){return e!==void 0?this.clientCache=e===!0?Vlt():e||Wlt():this.clientCache}logger(e){return e?this._logger=e:this._logger}logQueries(e){return e!==void 0?this._logQueries=!!e:this._logQueries}connector(e){return e?this.db=e:this.db}consolidate(e){e&&!this._consolidate?this._consolidate=Olt(this.enqueue.bind(this),this.clientCache):!e&&this._consolidate&&(this._consolidate=null)}request(e,n=Qu.Normal){const r=new qM,i={request:e,result:r};return this._consolidate?this._consolidate.add(i,n):this.enqueue(i,n),r}cancel(e){const n=new Set(e);if(n.size){this.queue.remove(({result:r})=>n.has(r)?(r.reject("Canceled"),!0):!1);for(const r of this.pendingResults)n.has(r)&&r.reject("Canceled")}}clear(){this.queue.remove(({result:e})=>(e.reject("Cleared"),!0));for(const e of this.pendingResults)e.reject("Cleared");this.pendingResults=[]}}let FE;function cm(t){return FE==null&&(FE=new Hlt),FE}class Hlt{constructor(e=Xut(),{logger:n=console,manager:r=new Ylt,cache:i=!0,consolidate:s=!0,preagg:o={}}={}){this.manager=r,this.manager.cache(i),this.manager.consolidate(s),this.databaseConnector(e),this.logger(n),this.clear(),this.preaggregator=new mlt(this,o)}clear({clients:e=!0,cache:n=!0}={}){var r,i;this.manager.clear(),e&&((r=this.filterGroups)==null||r.forEach(s=>s.disconnect()),this.filterGroups=new Map,(i=this.clients)==null||i.forEach(s=>this.disconnect(s)),this.clients=new Set),n&&this.manager.cache().clear()}databaseConnector(e){return this.manager.connector(e)}logger(e){return arguments.length&&(this._logger=e||Rz(),this.manager.logger(this._logger)),this._logger}cancel(e){this.manager.cancel(e)}exec(e,{priority:n=Qu.Normal}={}){return e=Array.isArray(e)?e.filter(r=>r).join(`;
`):e,this.manager.request({type:"exec",query:e},n)}query(e,{type:n="arrow",cache:r=!0,priority:i=Qu.Normal,...s}={}){return this.manager.request({type:n,query:e,cache:r,options:s},i)}prefetch(e,n={}){return this.query(e,{...n,cache:!0,priority:Qu.Low})}createBundle(e,n,r=Qu.Low){const i={name:e,queries:n.map(s=>typeof s=="string"?{sql:s}:s)};return this.manager.request({type:"create-bundle",options:i},r)}loadBundle(e,n=Qu.High){const r={name:e};return this.manager.request({type:"load-bundle",options:r},n)}updateClient(e,n,r=Qu.Normal){return e.queryPending(),e._pending=this.query(n,{priority:r}).then(i=>e.queryResult(i).update(),i=>{this._logger.error(i),e.queryError(i)}).catch(i=>this._logger.error(i))}requestQuery(e,n){return this.preaggregator.clear(),n?this.updateClient(e,n):Promise.resolve(e.update())}async connect(e){const{clients:n}=this;if(n.has(e))throw new Error("Client already connected.");n.add(e),e.coordinator=this,e._pending=this.initializeClient(e),Xlt(this,e.filterBy,e)}async initializeClient(e){const n=e.fields();return n!=null&&n.length&&e.fieldInfo(await Clt(this,n)),await e.prepare(),e.requestQuery()}disconnect(e){const{clients:n,filterGroups:r}=this;if(!n.has(e))return;n.delete(e),e.coordinator=null;const i=r.get(e.filterBy);i&&i.clients.delete(e)}}function Xlt(t,e,n){if(!e)return;let r=t.filterGroups.get(e);if(!r){const i=o=>Klt(t,e,o),s=()=>Qlt(t,e);e.addEventListener("activate",i),e.addEventListener("value",s),r={selection:e,clients:new Set,disconnect(){e.removeEventListener("activate",i),e.removeEventListener("value",s)}},t.filterGroups.set(e,r)}r.clients.add(n)}function Klt(t,e,n){const{preaggregator:r,filterGroups:i}=t,{clients:s}=i.get(e);for(const o of s)r.request(o,e,n)}function Qlt(t,e){const{preaggregator:n,filterGroups:r}=t,{clients:i}=r.get(e),{active:s}=e;return Promise.allSettled(Array.from(i,o=>{const a=n.request(o,e,s),u=a?null:e.predicate(o);if(a!=null&&a.skip||!a&&!u)return;const c=(a==null?void 0:a.query(s.predicate))??o.query(u);return t.updateClient(o,c)}))}class Jlt{constructor(){this._callbacks=new Map}addEventListener(e,n){this._callbacks.has(e)||this._callbacks.set(e,{callbacks:new Set,pending:null,queue:new Zlt}),this._callbacks.get(e).callbacks.add(n)}removeEventListener(e,n){const r=this._callbacks.get(e);r&&r.callbacks.delete(n)}willEmit(e,n){return n}emitQueueFilter(e,n){return null}cancel(e){const n=this._callbacks.get(e);n==null||n.queue.clear()}async pending(e){var n;await((n=this._callbacks.get(e))==null?void 0:n.pending)}emit(e,n){const r=this._callbacks.get(e)||{};if(r.pending)r.queue.enqueue(n,this.emitQueueFilter(e,n));else{const i=this.willEmit(e,n),{callbacks:s,queue:o}=r;if(s!=null&&s.size){const a=Array.from(s,u=>u(i));r.pending=Promise.allSettled(a).then(()=>{r.pending=null,o.isEmpty()||this.emit(e,o.dequeue())})}}}}class Zlt{constructor(){this.clear()}clear(){this.next=null}isEmpty(){return!this.next}enqueue(e,n){const r={value:e};if(n&&this.next){let i=this;for(;i.next;)n(i.next.value)?i=i.next:i.next=i.next.next;i.next=r}else this.next=r}dequeue(){const{next:e}=this;return this.next=e==null?void 0:e.next,e==null?void 0:e.value}}function Dz(t,e){return t===e?!1:t instanceof Date&&e instanceof Date?+t!=+e:Array.isArray(t)&&Array.isArray(e)?tft(t,e):!0}function tft(t,e){if(t.length!==e.length)return!0;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!0;return!1}function uf(t){return t instanceof Sh}class Sh extends Jlt{constructor(e){super(),this._value=e}static value(e){return new Sh(e)}static array(e){if(e.some(n=>uf(n))){const n=new Sh,r=()=>{n.update(e.map(i=>uf(i)?i.value:i))};return r(),e.forEach(i=>uf(i)?i.addEventListener("value",r):0),n}return new Sh(e)}get value(){return this._value}update(e,{force:n}={}){return Dz(this._value,e)||n?this.emit("value",e):this.cancel("value"),this}willEmit(e,n){return e==="value"&&(this._value=n),n}}function N1(t){return t instanceof WM}function O1(t,e){return new WM(new Bz(t),e&&[e].flat())}let WM=class Lz extends Sh{static intersect({cross:e=!1,empty:n=!1,include:r=[]}={}){return O1({cross:e,empty:n},r)}static union({cross:e=!1,empty:n=!1,include:r=[]}={}){return O1({cross:e,empty:n,union:!0},r)}static single({cross:e=!1,empty:n=!1,include:r=[]}={}){return O1({cross:e,empty:n,single:!0},r)}static crossfilter({empty:e=!1,include:n=[]}={}){return O1({cross:!0,empty:e},n)}constructor(e=new Bz,n=[]){if(super([]),this._resolved=this._value,this._resolver=e,this._relay=new Set,Array.isArray(n))for(const r of n)r._relay.add(this)}clone(){const e=new Lz(this._resolver);return e._value=e._resolved=this._value,e}remove(e){const n=this.clone();return n._value=n._resolved=n._resolver.resolve(this._resolved,{source:e}),n._value.active={source:e},n}get resolver(){return this._resolver}get single(){return this._resolver.single}get clauses(){return super.value}get active(){return this.clauses.active}get value(){var e;return(e=this.active)==null?void 0:e.value}valueFor(e){var n;return(n=this.clauses.find(r=>r.source===e))==null?void 0:n.value}activate(e){this.emit("activate",e),this._relay.forEach(n=>n.activate(e))}update(e){return this._resolved=this._resolver.resolve(this._resolved,e,!0),this._resolved.active=e,this._relay.forEach(n=>n.update(e)),super.update(this._resolved)}willEmit(e,n){return e==="value"?(this._value=n,this.value):n}emitQueueFilter(e,n){return e==="value"?this._resolver.queueFilter(n):null}skip(e,n){return this._resolver.skip(e,n)}predicate(e,n=!1){const{clauses:r}=this,i=n?null:r.active;return this._resolver.predicate(r,i,e)}};class Bz{constructor({union:e,cross:n,single:r,empty:i}={}){this.union=!!e,this.cross=!!n,this.single=!!r,this.empty=!!i}resolve(e,n,r=!1){const{source:i,predicate:s}=n,o=e.filter(u=>i!==u.source),a=this.single?[]:o;return this.single&&r&&o.forEach(u=>{var c,l;return(l=(c=u.source)==null?void 0:c.reset)==null?void 0:l.call(c)}),s&&a.push(n),a}skip(e,n){var r;return this.cross&&((r=n==null?void 0:n.clients)==null?void 0:r.has(e))}predicate(e,n,r){const{empty:i,union:s}=this;if(i&&!e.length)return[Fc(!1)];if(this.skip(r,n))return;const o=e.filter(a=>!this.skip(r,a)).map(a=>a.predicate);return s&&o.length>1?Pct(o):o}queueFilter(e){var n;if(this.cross){const r=(n=e.active)==null?void 0:n.source;return i=>{var s;return((s=i.active)==null?void 0:s.source)!==r}}return null}}const ND={};function eft(t,e=!1){let n,r,i=ND;function s(c){n=t(c).catch(()=>{}).finally(()=>{if(r){const{value:l}=r;r=null,s(l)}else n=null})}function o(c){r={event:c}}function a(c){n?o(c):s(c)}function u(c){i!==c&&requestAnimationFrame(()=>{const l=i;i=ND,a(l)}),i=c}return e?u:a}class k2{constructor(e){this._filterBy=e,this._requestUpdate=eft(()=>this.requestQuery(),!0),this._coordinator=null,this._pending=Promise.resolve()}get coordinator(){return this._coordinator}set coordinator(e){this._coordinator=e}get pending(){return this._pending}get filterBy(){return this._filterBy}get filterStable(){return!0}fields(){return null}fieldInfo(e){return this}async prepare(){}query(e){return null}queryPending(){return this}queryResult(e){return this}queryError(e){return this}requestQuery(e){var r;const n=e||this.query((r=this.filterBy)==null?void 0:r.predicate(this));return this._coordinator.requestQuery(this,n)}requestUpdate(){this._requestUpdate()}initialize(){return this._coordinator.initializeClient(this)}update(){return this}}function Lt(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?s(l.value):i(l.value).then(a,u)}c((r=r.apply(t,e||[])).next())})}function OD(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ut(t){return this instanceof Ut?(this.v=t,this):new Ut(t)}function Ro(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(h){return function(p){return Promise.resolve(p).then(h,f)}}function a(h,p){r[h]&&(i[h]=function(g){return new Promise(function(m,y){s.push([h,g,m,y])>1||u(h,g)})},p&&(i[h]=p(i[h])))}function u(h,p){try{c(r[h](p))}catch(g){d(s[0][3],g)}}function c(h){h.value instanceof Ut?Promise.resolve(h.value.v).then(l,f):d(s[0][2],h)}function l(h){u("next",h)}function f(h){u("throw",h)}function d(h,p){h(p),s.shift(),s.length&&u(s[0][0],s[0][1])}}function Yb(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:Ut(t[i](o)),done:!1}:s?s(o):o}:s}}function cf(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof OD=="function"?OD(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,u){o=t[s](o),i(a,u,o.done,o.value)})}}function i(s,o,a,u){Promise.resolve(u).then(function(c){s({value:c,done:a})},o)}}const nft=new TextDecoder("utf-8"),v3=t=>nft.decode(t),rft=new TextEncoder,VM=t=>rft.encode(t),ift=t=>typeof t=="number",Pz=t=>typeof t=="boolean",mn=t=>typeof t=="function",ui=t=>t!=null&&Object(t)===t,Af=t=>ui(t)&&mn(t.then),gy=t=>ui(t)&&mn(t[Symbol.iterator]),jp=t=>ui(t)&&mn(t[Symbol.asyncIterator]),w3=t=>ui(t)&&ui(t.schema),zz=t=>ui(t)&&"done"in t&&"value"in t,Uz=t=>ui(t)&&mn(t.stat)&&ift(t.fd),jz=t=>ui(t)&&GM(t.body),M2=t=>"_getDOMStream"in t&&"_getNodeStream"in t,sft=t=>ui(t)&&mn(t.abort)&&mn(t.getWriter)&&!M2(t),GM=t=>ui(t)&&mn(t.cancel)&&mn(t.getReader)&&!M2(t),oft=t=>ui(t)&&mn(t.end)&&mn(t.write)&&Pz(t.writable)&&!M2(t),qz=t=>ui(t)&&mn(t.read)&&mn(t.pipe)&&Pz(t.readable)&&!M2(t),aft=t=>ui(t)&&mn(t.clear)&&mn(t.bytes)&&mn(t.position)&&mn(t.setPosition)&&mn(t.capacity)&&mn(t.getBufferIdentifier)&&mn(t.createLong),YM=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function uft(t){const e=t[0]?[t[0]]:[];let n,r,i,s;for(let o,a,u=0,c=0,l=t.length;++u<l;){if(o=e[c],a=t[u],!o||!a||o.buffer!==a.buffer||a.byteOffset<o.byteOffset){a&&(e[++c]=a);continue}if({byteOffset:n,byteLength:i}=o,{byteOffset:r,byteLength:s}=a,n+i<r||r+s<n){a&&(e[++c]=a);continue}e[c]=new Uint8Array(o.buffer,n,r-n+s)}return e}function RD(t,e,n=0,r=e.byteLength){const i=t.byteLength,s=new Uint8Array(t.buffer,t.byteOffset,i),o=new Uint8Array(e.buffer,e.byteOffset,Math.min(r,i));return s.set(o,n),t}function Go(t,e){const n=uft(t),r=n.reduce((l,f)=>l+f.byteLength,0);let i,s,o,a=0,u=-1;const c=Math.min(e||Number.POSITIVE_INFINITY,r);for(const l=n.length;++u<l;){if(i=n[u],s=i.subarray(0,Math.min(i.length,c-a)),c<=a+s.length){s.length<i.length?n[u]=i.subarray(s.length):s.length===i.length&&u++,o?RD(o,s,a):o=s;break}RD(o||(o=new Uint8Array(c)),s,a),a+=s.length}return[o||new Uint8Array(0),n.slice(u),r-(o?o.byteLength:0)]}function me(t,e){let n=zz(e)?e.value:e;return n instanceof t?t===Uint8Array?new t(n.buffer,n.byteOffset,n.byteLength):n:n?(typeof n=="string"&&(n=VM(n)),n instanceof ArrayBuffer?new t(n):n instanceof YM?new t(n):aft(n)?me(t,n.bytes()):ArrayBuffer.isView(n)?n.byteLength<=0?new t(0):new t(n.buffer,n.byteOffset,n.byteLength/t.BYTES_PER_ELEMENT):t.from(n)):new t(0)}const Ng=t=>me(Int32Array,t),DD=t=>me(BigInt64Array,t),Jt=t=>me(Uint8Array,t),x3=t=>(t.next(),t);function*cft(t,e){const n=function*(i){yield i},r=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof YM?n(e):gy(e)?e:n(e);return yield*x3(function*(i){let s=null;do s=i.next(yield me(t,s));while(!s.done)}(r[Symbol.iterator]())),new t}const lft=t=>cft(Uint8Array,t);function Wz(t,e){return Ro(this,arguments,function*(){if(Af(e))return yield Ut(yield Ut(yield*Yb(cf(Wz(t,yield Ut(e))))));const r=function(o){return Ro(this,arguments,function*(){yield yield Ut(yield Ut(o))})},i=function(o){return Ro(this,arguments,function*(){yield Ut(yield*Yb(cf(x3(function*(a){let u=null;do u=a.next(yield u==null?void 0:u.value);while(!u.done)}(o[Symbol.iterator]())))))})},s=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof YM?r(e):gy(e)?i(e):jp(e)?e:r(e);return yield Ut(yield*Yb(cf(x3(function(o){return Ro(this,arguments,function*(){let a=null;do a=yield Ut(o.next(yield yield Ut(me(t,a))));while(!a.done)})}(s[Symbol.asyncIterator]()))))),yield Ut(new t)})}const fft=t=>Wz(Uint8Array,t);function Vz(t,e,n){if(t!==0){n=n.slice(0,e);for(let r=-1,i=n.length;++r<i;)n[r]+=t}return n.subarray(0,e)}function dft(t,e){let n=0;const r=t.length;if(r!==e.length)return!1;if(r>0)do if(t[n]!==e[n])return!1;while(++n<r);return!0}const Yi={fromIterable(t){return R1(hft(t))},fromAsyncIterable(t){return R1(pft(t))},fromDOMStream(t){return R1(gft(t))},fromNodeStream(t){return R1(yft(t))},toDOMStream(t,e){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(t,e){throw new Error('"toNodeStream" not available in this environment')}},R1=t=>(t.next(),t);function*hft(t){let e,n=!1,r=[],i,s,o,a=0;function u(){return s==="peek"?Go(r,o)[0]:([i,r,a]=Go(r,o),i)}({cmd:s,size:o}=(yield null)||{cmd:"read",size:0});const c=lft(t)[Symbol.iterator]();try{do if({done:e,value:i}=Number.isNaN(o-a)?c.next():c.next(o-a),!e&&i.byteLength>0&&(r.push(i),a+=i.byteLength),e||o<=a)do({cmd:s,size:o}=yield u());while(o<a);while(!e)}catch(l){(n=!0)&&typeof c.throw=="function"&&c.throw(l)}finally{n===!1&&typeof c.return=="function"&&c.return(null)}return null}function pft(t){return Ro(this,arguments,function*(){let n,r=!1,i=[],s,o,a,u=0;function c(){return o==="peek"?Go(i,a)[0]:([s,i,u]=Go(i,a),s)}({cmd:o,size:a}=(yield yield Ut(null))||{cmd:"read",size:0});const l=fft(t)[Symbol.asyncIterator]();try{do if({done:n,value:s}=Number.isNaN(a-u)?yield Ut(l.next()):yield Ut(l.next(a-u)),!n&&s.byteLength>0&&(i.push(s),u+=s.byteLength),n||a<=u)do({cmd:o,size:a}=yield yield Ut(c()));while(a<u);while(!n)}catch(f){(r=!0)&&typeof l.throw=="function"&&(yield Ut(l.throw(f)))}finally{r===!1&&typeof l.return=="function"&&(yield Ut(l.return(new Uint8Array(0))))}return yield Ut(null)})}function gft(t){return Ro(this,arguments,function*(){let n=!1,r=!1,i=[],s,o,a,u=0;function c(){return o==="peek"?Go(i,a)[0]:([s,i,u]=Go(i,a),s)}({cmd:o,size:a}=(yield yield Ut(null))||{cmd:"read",size:0});const l=new mft(t);try{do if({done:n,value:s}=Number.isNaN(a-u)?yield Ut(l.read()):yield Ut(l.read(a-u)),!n&&s.byteLength>0&&(i.push(Jt(s)),u+=s.byteLength),n||a<=u)do({cmd:o,size:a}=yield yield Ut(c()));while(a<u);while(!n)}catch(f){(r=!0)&&(yield Ut(l.cancel(f)))}finally{r===!1?yield Ut(l.cancel()):t.locked&&l.releaseLock()}return yield Ut(null)})}class mft{constructor(e){this.source=e,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(e){return Lt(this,void 0,void 0,function*(){const{reader:n,source:r}=this;n&&(yield n.cancel(e).catch(()=>{})),r&&r.locked&&this.releaseLock()})}read(e){return Lt(this,void 0,void 0,function*(){if(e===0)return{done:this.reader==null,value:new Uint8Array(0)};const n=yield this.reader.read();return!n.done&&(n.value=Jt(n)),n})}}const NE=(t,e)=>{const n=i=>r([e,i]);let r;return[e,n,new Promise(i=>(r=i)&&t.once(e,n))]};function yft(t){return Ro(this,arguments,function*(){const n=[];let r="error",i=!1,s=null,o,a,u=0,c=[],l;function f(){return o==="peek"?Go(c,a)[0]:([l,c,u]=Go(c,a),l)}if({cmd:o,size:a}=(yield yield Ut(null))||{cmd:"read",size:0},t.isTTY)return yield yield Ut(new Uint8Array(0)),yield Ut(null);try{n[0]=NE(t,"end"),n[1]=NE(t,"error");do{if(n[2]=NE(t,"readable"),[r,s]=yield Ut(Promise.race(n.map(h=>h[2]))),r==="error")break;if((i=r==="end")||(Number.isFinite(a-u)?(l=Jt(t.read(a-u)),l.byteLength<a-u&&(l=Jt(t.read()))):l=Jt(t.read()),l.byteLength>0&&(c.push(l),u+=l.byteLength)),i||a<=u)do({cmd:o,size:a}=yield yield Ut(f()));while(a<u)}while(!i)}finally{yield Ut(d(n,r==="error"?s:null))}return yield Ut(null);function d(h,p){return l=c=null,new Promise((g,m)=>{for(const[y,b]of h)t.off(y,b);try{const y=t.destroy;y&&y.call(t,p),p=void 0}catch(y){p=y||p}finally{p!=null?m(p):g()}})}})}var un;(function(t){t[t.V1=0]="V1",t[t.V2=1]="V2",t[t.V3=2]="V3",t[t.V4=3]="V4",t[t.V5=4]="V5"})(un||(un={}));var Sr;(function(t){t[t.Sparse=0]="Sparse",t[t.Dense=1]="Dense"})(Sr||(Sr={}));var mr;(function(t){t[t.HALF=0]="HALF",t[t.SINGLE=1]="SINGLE",t[t.DOUBLE=2]="DOUBLE"})(mr||(mr={}));var us;(function(t){t[t.DAY=0]="DAY",t[t.MILLISECOND=1]="MILLISECOND"})(us||(us={}));var Mt;(function(t){t[t.SECOND=0]="SECOND",t[t.MILLISECOND=1]="MILLISECOND",t[t.MICROSECOND=2]="MICROSECOND",t[t.NANOSECOND=3]="NANOSECOND"})(Mt||(Mt={}));var Yo;(function(t){t[t.YEAR_MONTH=0]="YEAR_MONTH",t[t.DAY_TIME=1]="DAY_TIME",t[t.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(Yo||(Yo={}));const OE=2,To=4,Ya=4,he=4,Ju=new Int32Array(2),LD=new Float32Array(Ju.buffer),BD=new Float64Array(Ju.buffer),D1=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var _3;(function(t){t[t.UTF8_BYTES=1]="UTF8_BYTES",t[t.UTF16_STRING=2]="UTF16_STRING"})(_3||(_3={}));let qh=class Gz{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new Gz(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return Ju[0]=this.readInt32(e),LD[0]}readFloat64(e){return Ju[D1?0:1]=this.readInt32(e),Ju[D1?1:0]=this.readInt32(e+4),BD[0]}writeInt8(e,n){this.bytes_[e]=n}writeUint8(e,n){this.bytes_[e]=n}writeInt16(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8}writeUint16(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8}writeInt32(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8,this.bytes_[e+2]=n>>16,this.bytes_[e+3]=n>>24}writeUint32(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8,this.bytes_[e+2]=n>>16,this.bytes_[e+3]=n>>24}writeInt64(e,n){this.writeInt32(e,Number(BigInt.asIntN(32,n))),this.writeInt32(e+4,Number(BigInt.asIntN(32,n>>BigInt(32))))}writeUint64(e,n){this.writeUint32(e,Number(BigInt.asUintN(32,n))),this.writeUint32(e+4,Number(BigInt.asUintN(32,n>>BigInt(32))))}writeFloat32(e,n){LD[0]=n,this.writeInt32(e,Ju[0])}writeFloat64(e,n){BD[0]=n,this.writeInt32(e,Ju[D1?0:1]),this.writeInt32(e+4,Ju[D1?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+To+Ya)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let n=0;n<Ya;n++)e+=String.fromCharCode(this.readInt8(this.position_+To+n));return e}__offset(e,n){const r=e-this.readInt32(e);return n<this.readInt16(r)?this.readInt16(r+n):0}__union(e,n){return e.bb_pos=n+this.readInt32(n),e.bb=this,e}__string(e,n){e+=this.readInt32(e);const r=this.readInt32(e);e+=To;const i=this.bytes_.subarray(e,e+r);return n===_3.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,n){return typeof e=="string"?this.__string(n):this.__union(e,n)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+To}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Ya)throw new Error("FlatBuffers: file identifier must be length "+Ya);for(let n=0;n<Ya;n++)if(e.charCodeAt(n)!=this.readInt8(this.position()+To+n))return!1;return!0}createScalarList(e,n){const r=[];for(let i=0;i<n;++i){const s=e(i);s!==null&&r.push(s)}return r}createObjList(e,n){const r=[];for(let i=0;i<n;++i){const s=e(i);s!==null&&r.push(s.unpack())}return r}},Yz=class Hz{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let n;e?n=e:n=1024,this.bb=qh.allocate(n),this.space=n}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,n){e>this.minalign&&(this.minalign=e);const r=~(this.bb.capacity()-this.space+n)+1&e-1;for(;this.space<r+e+n;){const i=this.bb.capacity();this.bb=Hz.growByteBuffer(this.bb),this.space+=this.bb.capacity()-i}this.pad(r)}pad(e){for(let n=0;n<e;n++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,n,r){(this.force_defaults||n!=r)&&(this.addInt8(n),this.slot(e))}addFieldInt16(e,n,r){(this.force_defaults||n!=r)&&(this.addInt16(n),this.slot(e))}addFieldInt32(e,n,r){(this.force_defaults||n!=r)&&(this.addInt32(n),this.slot(e))}addFieldInt64(e,n,r){(this.force_defaults||n!==r)&&(this.addInt64(n),this.slot(e))}addFieldFloat32(e,n,r){(this.force_defaults||n!=r)&&(this.addFloat32(n),this.slot(e))}addFieldFloat64(e,n,r){(this.force_defaults||n!=r)&&(this.addFloat64(n),this.slot(e))}addFieldOffset(e,n,r){(this.force_defaults||n!=r)&&(this.addOffset(n),this.slot(e))}addFieldStruct(e,n,r){n!=r&&(this.nested(n),this.slot(e))}nested(e){if(e!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const n=e.capacity();if(n&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const r=n<<1,i=qh.allocate(r);return i.setPosition(r-n),i.bytes().set(e.bytes(),r-n),i}addOffset(e){this.prep(To,0),this.writeInt32(this.offset()-e+To)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let n=0;n<e;n++)this.vtable[n]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let n=this.vtable_in_use-1;for(;n>=0&&this.vtable[n]==0;n--);const r=n+1;for(;n>=0;n--)this.addInt16(this.vtable[n]!=0?e-this.vtable[n]:0);const i=2;this.addInt16(e-this.object_start);const s=(r+i)*OE;this.addInt16(s);let o=0;const a=this.space;t:for(n=0;n<this.vtables.length;n++){const u=this.bb.capacity()-this.vtables[n];if(s==this.bb.readInt16(u)){for(let c=OE;c<s;c+=OE)if(this.bb.readInt16(a+c)!=this.bb.readInt16(u+c))continue t;o=this.vtables[n];break}}return o?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,o-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,n,r){const i=r?he:0;if(n){const s=n;if(this.prep(this.minalign,To+Ya+i),s.length!=Ya)throw new TypeError("FlatBuffers: file identifier must be length "+Ya);for(let o=Ya-1;o>=0;o--)this.writeInt8(s.charCodeAt(o))}this.prep(this.minalign,To+i),this.addOffset(e),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,n){this.finish(e,n,!0)}requiredField(e,n){const r=this.bb.capacity()-e,i=r-this.bb.readInt32(r);if(!(n<this.bb.readInt16(i)&&this.bb.readInt16(i+n)!=0))throw new TypeError("FlatBuffers: field "+n+" must be set")}startVector(e,n,r){this.notNested(),this.vector_num_elems=n,this.prep(To,e*n),this.prep(r,e*n)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const n=this.createString(e);return this.string_maps.set(e,n),n}createString(e){if(e==null)return 0;let n;return e instanceof Uint8Array?n=e:n=this.text_encoder.encode(e),this.addInt8(0),this.startVector(1,n.length,1),this.bb.setPosition(this.space-=n.length),this.bb.bytes().set(n,this.space),this.endVector()}createByteVector(e){return e==null?0:(this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector())}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const n=[];for(let r=0;r<e.length;++r){const i=e[r];if(i!==null)n.push(this.createObjectOffset(i));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return n}createStructOffsetList(e,n){return n(this,e.length),this.createObjectOffsetList(e.slice().reverse()),this.endVector()}};var qv;(function(t){t[t.BUFFER=0]="BUFFER"})(qv||(qv={}));var Wv;(function(t){t[t.LZ4_FRAME=0]="LZ4_FRAME",t[t.ZSTD=1]="ZSTD"})(Wv||(Wv={}));class Zu{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBodyCompression(e,n){return(n||new Zu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBodyCompression(e,n){return e.setPosition(e.position()+he),(n||new Zu).__init(e.readInt32(e.position())+e.position(),e)}codec(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt8(this.bb_pos+e):Wv.LZ4_FRAME}method(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt8(this.bb_pos+e):qv.BUFFER}static startBodyCompression(e){e.startObject(2)}static addCodec(e,n){e.addFieldInt8(0,n,Wv.LZ4_FRAME)}static addMethod(e,n){e.addFieldInt8(1,n,qv.BUFFER)}static endBodyCompression(e){return e.endObject()}static createBodyCompression(e,n,r){return Zu.startBodyCompression(e),Zu.addCodec(e,n),Zu.addMethod(e,r),Zu.endBodyCompression(e)}}let Xz=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(e,n,r){return e.prep(8,16),e.writeInt64(BigInt(r??0)),e.writeInt64(BigInt(n??0)),e.offset()}},Kz=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(e,n,r){return e.prep(8,16),e.writeInt64(BigInt(r??0)),e.writeInt64(BigInt(n??0)),e.offset()}},Ba=class S3{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsRecordBatch(e,n){return(n||new S3).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsRecordBatch(e,n){return e.setPosition(e.position()+he),(n||new S3).__init(e.readInt32(e.position())+e.position(),e)}length(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}nodes(e,n){const r=this.bb.__offset(this.bb_pos,6);return r?(n||new Kz).__init(this.bb.__vector(this.bb_pos+r)+e*16,this.bb):null}nodesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}buffers(e,n){const r=this.bb.__offset(this.bb_pos,8);return r?(n||new Xz).__init(this.bb.__vector(this.bb_pos+r)+e*16,this.bb):null}buffersLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}compression(e){const n=this.bb.__offset(this.bb_pos,10);return n?(e||new Zu).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}static startRecordBatch(e){e.startObject(4)}static addLength(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addNodes(e,n){e.addFieldOffset(1,n,0)}static startNodesVector(e,n){e.startVector(16,n,8)}static addBuffers(e,n){e.addFieldOffset(2,n,0)}static startBuffersVector(e,n){e.startVector(16,n,8)}static addCompression(e,n){e.addFieldOffset(3,n,0)}static endRecordBatch(e){return e.endObject()}},Xd=class E3{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDictionaryBatch(e,n){return(n||new E3).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryBatch(e,n){return e.setPosition(e.position()+he),(n||new E3).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}data(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new Ba).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isDelta(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startDictionaryBatch(e){e.startObject(3)}static addId(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addData(e,n){e.addFieldOffset(1,n,0)}static addIsDelta(e,n){e.addFieldInt8(2,+n,0)}static endDictionaryBatch(e){return e.endObject()}};var Wh;(function(t){t[t.Little=0]="Little",t[t.Big=1]="Big"})(Wh||(Wh={}));var Vv;(function(t){t[t.DenseArray=0]="DenseArray"})(Vv||(Vv={}));class Si{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsInt(e,n){return(n||new Si).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInt(e,n){return e.setPosition(e.position()+he),(n||new Si).__init(e.readInt32(e.position())+e.position(),e)}bitWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}isSigned(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startInt(e){e.startObject(2)}static addBitWidth(e,n){e.addFieldInt32(0,n,0)}static addIsSigned(e,n){e.addFieldInt8(1,+n,0)}static endInt(e){return e.endObject()}static createInt(e,n,r){return Si.startInt(e),Si.addBitWidth(e,n),Si.addIsSigned(e,r),Si.endInt(e)}}class Ha{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDictionaryEncoding(e,n){return(n||new Ha).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryEncoding(e,n){return e.setPosition(e.position()+he),(n||new Ha).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}indexType(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new Si).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isOrdered(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}dictionaryKind(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt16(this.bb_pos+e):Vv.DenseArray}static startDictionaryEncoding(e){e.startObject(4)}static addId(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addIndexType(e,n){e.addFieldOffset(1,n,0)}static addIsOrdered(e,n){e.addFieldInt8(2,+n,0)}static addDictionaryKind(e,n){e.addFieldInt16(3,n,Vv.DenseArray)}static endDictionaryEncoding(e){return e.endObject()}}class yn{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsKeyValue(e,n){return(n||new yn).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsKeyValue(e,n){return e.setPosition(e.position()+he),(n||new yn).__init(e.readInt32(e.position())+e.position(),e)}key(e){const n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,e):null}value(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,e):null}static startKeyValue(e){e.startObject(2)}static addKey(e,n){e.addFieldOffset(0,n,0)}static addValue(e,n){e.addFieldOffset(1,n,0)}static endKeyValue(e){return e.endObject()}static createKeyValue(e,n,r){return yn.startKeyValue(e),yn.addKey(e,n),yn.addValue(e,r),yn.endKeyValue(e)}}let PD=class lm{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBinary(e,n){return(n||new lm).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBinary(e,n){return e.setPosition(e.position()+he),(n||new lm).__init(e.readInt32(e.position())+e.position(),e)}static startBinary(e){e.startObject(0)}static endBinary(e){return e.endObject()}static createBinary(e){return lm.startBinary(e),lm.endBinary(e)}},zD=class fm{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBool(e,n){return(n||new fm).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBool(e,n){return e.setPosition(e.position()+he),(n||new fm).__init(e.readInt32(e.position())+e.position(),e)}static startBool(e){e.startObject(0)}static endBool(e){return e.endObject()}static createBool(e){return fm.startBool(e),fm.endBool(e)}},Hb=class Kd{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDate(e,n){return(n||new Kd).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDate(e,n){return e.setPosition(e.position()+he),(n||new Kd).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):us.MILLISECOND}static startDate(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,us.MILLISECOND)}static endDate(e){return e.endObject()}static createDate(e,n){return Kd.startDate(e),Kd.addUnit(e,n),Kd.endDate(e)}},Qd=class Gu{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDecimal(e,n){return(n||new Gu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDecimal(e,n){return e.setPosition(e.position()+he),(n||new Gu).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}scale(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}bitWidth(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt32(this.bb_pos+e):128}static startDecimal(e){e.startObject(3)}static addPrecision(e,n){e.addFieldInt32(0,n,0)}static addScale(e,n){e.addFieldInt32(1,n,0)}static addBitWidth(e,n){e.addFieldInt32(2,n,128)}static endDecimal(e){return e.endObject()}static createDecimal(e,n,r,i){return Gu.startDecimal(e),Gu.addPrecision(e,n),Gu.addScale(e,r),Gu.addBitWidth(e,i),Gu.endDecimal(e)}},Xb=class Jd{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDuration(e,n){return(n||new Jd).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDuration(e,n){return e.setPosition(e.position()+he),(n||new Jd).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Mt.MILLISECOND}static startDuration(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,Mt.MILLISECOND)}static endDuration(e){return e.endObject()}static createDuration(e,n){return Jd.startDuration(e),Jd.addUnit(e,n),Jd.endDuration(e)}},Kb=class Zd{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFixedSizeBinary(e,n){return(n||new Zd).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeBinary(e,n){return e.setPosition(e.position()+he),(n||new Zd).__init(e.readInt32(e.position())+e.position(),e)}byteWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeBinary(e){e.startObject(1)}static addByteWidth(e,n){e.addFieldInt32(0,n,0)}static endFixedSizeBinary(e){return e.endObject()}static createFixedSizeBinary(e,n){return Zd.startFixedSizeBinary(e),Zd.addByteWidth(e,n),Zd.endFixedSizeBinary(e)}},Qb=class th{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFixedSizeList(e,n){return(n||new th).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeList(e,n){return e.setPosition(e.position()+he),(n||new th).__init(e.readInt32(e.position())+e.position(),e)}listSize(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeList(e){e.startObject(1)}static addListSize(e,n){e.addFieldInt32(0,n,0)}static endFixedSizeList(e){return e.endObject()}static createFixedSizeList(e,n){return th.startFixedSizeList(e),th.addListSize(e,n),th.endFixedSizeList(e)}};class ko{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFloatingPoint(e,n){return(n||new ko).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFloatingPoint(e,n){return e.setPosition(e.position()+he),(n||new ko).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):mr.HALF}static startFloatingPoint(e){e.startObject(1)}static addPrecision(e,n){e.addFieldInt16(0,n,mr.HALF)}static endFloatingPoint(e){return e.endObject()}static createFloatingPoint(e,n){return ko.startFloatingPoint(e),ko.addPrecision(e,n),ko.endFloatingPoint(e)}}class Mo{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsInterval(e,n){return(n||new Mo).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInterval(e,n){return e.setPosition(e.position()+he),(n||new Mo).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Yo.YEAR_MONTH}static startInterval(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,Yo.YEAR_MONTH)}static endInterval(e){return e.endObject()}static createInterval(e,n){return Mo.startInterval(e),Mo.addUnit(e,n),Mo.endInterval(e)}}let UD=class dm{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsLargeBinary(e,n){return(n||new dm).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsLargeBinary(e,n){return e.setPosition(e.position()+he),(n||new dm).__init(e.readInt32(e.position())+e.position(),e)}static startLargeBinary(e){e.startObject(0)}static endLargeBinary(e){return e.endObject()}static createLargeBinary(e){return dm.startLargeBinary(e),dm.endLargeBinary(e)}},jD=class hm{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsLargeUtf8(e,n){return(n||new hm).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsLargeUtf8(e,n){return e.setPosition(e.position()+he),(n||new hm).__init(e.readInt32(e.position())+e.position(),e)}static startLargeUtf8(e){e.startObject(0)}static endLargeUtf8(e){return e.endObject()}static createLargeUtf8(e){return hm.startLargeUtf8(e),hm.endLargeUtf8(e)}},qD=class pm{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsList(e,n){return(n||new pm).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsList(e,n){return e.setPosition(e.position()+he),(n||new pm).__init(e.readInt32(e.position())+e.position(),e)}static startList(e){e.startObject(0)}static endList(e){return e.endObject()}static createList(e){return pm.startList(e),pm.endList(e)}},Jb=class eh{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsMap(e,n){return(n||new eh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMap(e,n){return e.setPosition(e.position()+he),(n||new eh).__init(e.readInt32(e.position())+e.position(),e)}keysSorted(){const e=this.bb.__offset(this.bb_pos,4);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startMap(e){e.startObject(1)}static addKeysSorted(e,n){e.addFieldInt8(0,+n,0)}static endMap(e){return e.endObject()}static createMap(e,n){return eh.startMap(e),eh.addKeysSorted(e,n),eh.endMap(e)}},WD=class gm{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsNull(e,n){return(n||new gm).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsNull(e,n){return e.setPosition(e.position()+he),(n||new gm).__init(e.readInt32(e.position())+e.position(),e)}static startNull(e){e.startObject(0)}static endNull(e){return e.endObject()}static createNull(e){return gm.startNull(e),gm.endNull(e)}};class tf{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsStruct_(e,n){return(n||new tf).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsStruct_(e,n){return e.setPosition(e.position()+he),(n||new tf).__init(e.readInt32(e.position())+e.position(),e)}static startStruct_(e){e.startObject(0)}static endStruct_(e){return e.endObject()}static createStruct_(e){return tf.startStruct_(e),tf.endStruct_(e)}}let mm=class Bl{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsTime(e,n){return(n||new Bl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTime(e,n){return e.setPosition(e.position()+he),(n||new Bl).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Mt.MILLISECOND}bitWidth(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):32}static startTime(e){e.startObject(2)}static addUnit(e,n){e.addFieldInt16(0,n,Mt.MILLISECOND)}static addBitWidth(e,n){e.addFieldInt32(1,n,32)}static endTime(e){return e.endObject()}static createTime(e,n,r){return Bl.startTime(e),Bl.addUnit(e,n),Bl.addBitWidth(e,r),Bl.endTime(e)}};class Xi{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsTimestamp(e,n){return(n||new Xi).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTimestamp(e,n){return e.setPosition(e.position()+he),(n||new Xi).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Mt.SECOND}timezone(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,e):null}static startTimestamp(e){e.startObject(2)}static addUnit(e,n){e.addFieldInt16(0,n,Mt.SECOND)}static addTimezone(e,n){e.addFieldOffset(1,n,0)}static endTimestamp(e){return e.endObject()}static createTimestamp(e,n,r){return Xi.startTimestamp(e),Xi.addUnit(e,n),Xi.addTimezone(e,r),Xi.endTimestamp(e)}}let Pl=class zl{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsUnion(e,n){return(n||new zl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUnion(e,n){return e.setPosition(e.position()+he),(n||new zl).__init(e.readInt32(e.position())+e.position(),e)}mode(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Sr.Sparse}typeIds(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.readInt32(this.bb.__vector(this.bb_pos+n)+e*4):0}typeIdsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}typeIdsArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startUnion(e){e.startObject(2)}static addMode(e,n){e.addFieldInt16(0,n,Sr.Sparse)}static addTypeIds(e,n){e.addFieldOffset(1,n,0)}static createTypeIdsVector(e,n){e.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)e.addInt32(n[r]);return e.endVector()}static startTypeIdsVector(e,n){e.startVector(4,n,4)}static endUnion(e){return e.endObject()}static createUnion(e,n,r){return zl.startUnion(e),zl.addMode(e,n),zl.addTypeIds(e,r),zl.endUnion(e)}},VD=class ym{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsUtf8(e,n){return(n||new ym).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUtf8(e,n){return e.setPosition(e.position()+he),(n||new ym).__init(e.readInt32(e.position())+e.position(),e)}static startUtf8(e){e.startObject(0)}static endUtf8(e){return e.endObject()}static createUtf8(e){return ym.startUtf8(e),ym.endUtf8(e)}};var Ie;(function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.FloatingPoint=3]="FloatingPoint",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct_=13]="Struct_",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Duration=18]="Duration",t[t.LargeBinary=19]="LargeBinary",t[t.LargeUtf8=20]="LargeUtf8",t[t.LargeList=21]="LargeList",t[t.RunEndEncoded=22]="RunEndEncoded"})(Ie||(Ie={}));let Vi=class Zb{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsField(e,n){return(n||new Zb).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsField(e,n){return e.setPosition(e.position()+he),(n||new Zb).__init(e.readInt32(e.position())+e.position(),e)}name(e){const n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,e):null}nullable(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}typeType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):Ie.NONE}type(e){const n=this.bb.__offset(this.bb_pos,10);return n?this.bb.__union(e,this.bb_pos+n):null}dictionary(e){const n=this.bb.__offset(this.bb_pos,12);return n?(e||new Ha).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}children(e,n){const r=this.bb.__offset(this.bb_pos,14);return r?(n||new Zb).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}childrenLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const r=this.bb.__offset(this.bb_pos,16);return r?(n||new yn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}static startField(e){e.startObject(7)}static addName(e,n){e.addFieldOffset(0,n,0)}static addNullable(e,n){e.addFieldInt8(1,+n,0)}static addTypeType(e,n){e.addFieldInt8(2,n,Ie.NONE)}static addType(e,n){e.addFieldOffset(3,n,0)}static addDictionary(e,n){e.addFieldOffset(4,n,0)}static addChildren(e,n){e.addFieldOffset(5,n,0)}static createChildrenVector(e,n){e.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)e.addOffset(n[r]);return e.endVector()}static startChildrenVector(e,n){e.startVector(4,n,4)}static addCustomMetadata(e,n){e.addFieldOffset(6,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)e.addOffset(n[r]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endField(e){return e.endObject()}},vo=class Da{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsSchema(e,n){return(n||new Da).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSchema(e,n){return e.setPosition(e.position()+he),(n||new Da).__init(e.readInt32(e.position())+e.position(),e)}endianness(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Wh.Little}fields(e,n){const r=this.bb.__offset(this.bb_pos,6);return r?(n||new Vi).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}fieldsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const r=this.bb.__offset(this.bb_pos,8);return r?(n||new yn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}features(e){const n=this.bb.__offset(this.bb_pos,10);return n?this.bb.readInt64(this.bb.__vector(this.bb_pos+n)+e*8):BigInt(0)}featuresLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}static startSchema(e){e.startObject(4)}static addEndianness(e,n){e.addFieldInt16(0,n,Wh.Little)}static addFields(e,n){e.addFieldOffset(1,n,0)}static createFieldsVector(e,n){e.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)e.addOffset(n[r]);return e.endVector()}static startFieldsVector(e,n){e.startVector(4,n,4)}static addCustomMetadata(e,n){e.addFieldOffset(2,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)e.addOffset(n[r]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static addFeatures(e,n){e.addFieldOffset(3,n,0)}static createFeaturesVector(e,n){e.startVector(8,n.length,8);for(let r=n.length-1;r>=0;r--)e.addInt64(n[r]);return e.endVector()}static startFeaturesVector(e,n){e.startVector(8,n,8)}static endSchema(e){return e.endObject()}static finishSchemaBuffer(e,n){e.finish(n)}static finishSizePrefixedSchemaBuffer(e,n){e.finish(n,void 0,!0)}static createSchema(e,n,r,i,s){return Da.startSchema(e),Da.addEndianness(e,n),Da.addFields(e,r),Da.addCustomMetadata(e,i),Da.addFeatures(e,s),Da.endSchema(e)}};var se;(function(t){t[t.NONE=0]="NONE",t[t.Schema=1]="Schema",t[t.DictionaryBatch=2]="DictionaryBatch",t[t.RecordBatch=3]="RecordBatch",t[t.Tensor=4]="Tensor",t[t.SparseTensor=5]="SparseTensor"})(se||(se={}));var O;(function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Duration=18]="Duration",t[t.LargeBinary=19]="LargeBinary",t[t.LargeUtf8=20]="LargeUtf8",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth",t[t.DurationSecond=-27]="DurationSecond",t[t.DurationMillisecond=-28]="DurationMillisecond",t[t.DurationMicrosecond=-29]="DurationMicrosecond",t[t.DurationNanosecond=-30]="DurationNanosecond"})(O||(O={}));var Pa;(function(t){t[t.OFFSET=0]="OFFSET",t[t.DATA=1]="DATA",t[t.VALIDITY=2]="VALIDITY",t[t.TYPE=3]="TYPE"})(Pa||(Pa={}));const bft=void 0;function p0(t){if(t===null)return"null";if(t===bft)return"undefined";switch(typeof t){case"number":return`${t}`;case"bigint":return`${t}`;case"string":return`"${t}"`}return typeof t[Symbol.toPrimitive]=="function"?t[Symbol.toPrimitive]("string"):ArrayBuffer.isView(t)?t instanceof BigInt64Array||t instanceof BigUint64Array?`[${[...t].map(e=>p0(e))}]`:`[${t}]`:ArrayBuffer.isView(t)?`[${t}]`:JSON.stringify(t,(e,n)=>typeof n=="bigint"?`${n}`:n)}function Ae(t){if(typeof t=="bigint"&&(t<Number.MIN_SAFE_INTEGER||t>Number.MAX_SAFE_INTEGER))throw new TypeError(`${t} is not safe to convert to a number.`);return Number(t)}function Qz(t,e){return Ae(t/e)+Ae(t%e)/Ae(e)}const vft=Symbol.for("isArrowBigNum");function Zs(t,...e){return e.length===0?Object.setPrototypeOf(me(this.TypedArray,t),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(t,...e),this.constructor.prototype)}Zs.prototype[vft]=!0;Zs.prototype.toJSON=function(){return`"${m0(this)}"`};Zs.prototype.valueOf=function(t){return Jz(this,t)};Zs.prototype.toString=function(){return m0(this)};Zs.prototype[Symbol.toPrimitive]=function(t="default"){switch(t){case"number":return Jz(this);case"string":return m0(this);case"default":return _ft(this)}return m0(this)};function Eh(...t){return Zs.apply(this,t)}function Ah(...t){return Zs.apply(this,t)}function g0(...t){return Zs.apply(this,t)}Object.setPrototypeOf(Eh.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(Ah.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(g0.prototype,Object.create(Uint32Array.prototype));Object.assign(Eh.prototype,Zs.prototype,{constructor:Eh,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(Ah.prototype,Zs.prototype,{constructor:Ah,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(g0.prototype,Zs.prototype,{constructor:g0,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});const wft=BigInt(4294967296)*BigInt(4294967296),xft=wft-BigInt(1);function Jz(t,e){const{buffer:n,byteOffset:r,byteLength:i,signed:s}=t,o=new BigUint64Array(n,r,i/8),a=s&&o.at(-1)&BigInt(1)<<BigInt(63);let u=BigInt(0),c=0;if(a){for(const l of o)u|=(l^xft)*(BigInt(1)<<BigInt(64*c++));u*=BigInt(-1),u-=BigInt(1)}else for(const l of o)u|=l*(BigInt(1)<<BigInt(64*c++));if(typeof e=="number"){const l=BigInt(Math.pow(10,e)),f=u/l,d=u%l;return Ae(f)+Ae(d)/Ae(l)}return Ae(u)}function m0(t){if(t.byteLength===8)return`${new t.BigIntArray(t.buffer,t.byteOffset,1)[0]}`;if(!t.signed)return RE(t);let e=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2);if(new Int16Array([e.at(-1)])[0]>=0)return RE(t);e=e.slice();let r=1;for(let s=0;s<e.length;s++){const o=e[s],a=~o+r;e[s]=a,r&=o===0?1:0}return`-${RE(e)}`}function _ft(t){return t.byteLength===8?new t.BigIntArray(t.buffer,t.byteOffset,1)[0]:m0(t)}function RE(t){let e="";const n=new Uint32Array(2);let r=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2);const i=new Uint32Array((r=new Uint16Array(r).reverse()).buffer);let s=-1;const o=r.length-1;do{for(n[0]=r[s=0];s<o;)r[s++]=n[1]=n[0]/10,n[0]=(n[0]-n[1]*10<<16)+r[s];r[s]=n[1]=n[0]/10,n[0]=n[0]-n[1]*10,e=`${n[0]}${e}`}while(i[0]||i[1]||i[2]||i[3]);return e??"0"}class HM{static new(e,n){switch(n){case!0:return new Eh(e);case!1:return new Ah(e)}switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new Eh(e)}return e.byteLength===16?new g0(e):new Ah(e)}static signed(e){return new Eh(e)}static unsigned(e){return new Ah(e)}static decimal(e){return new g0(e)}constructor(e,n){return HM.new(e,n)}}var Zz,tU,eU,nU,rU,iU,sU,oU,aU,uU,cU,lU,fU,dU,hU,pU,gU,mU,yU,bU,vU,wU;class mt{static isNull(e){return(e==null?void 0:e.typeId)===O.Null}static isInt(e){return(e==null?void 0:e.typeId)===O.Int}static isFloat(e){return(e==null?void 0:e.typeId)===O.Float}static isBinary(e){return(e==null?void 0:e.typeId)===O.Binary}static isLargeBinary(e){return(e==null?void 0:e.typeId)===O.LargeBinary}static isUtf8(e){return(e==null?void 0:e.typeId)===O.Utf8}static isLargeUtf8(e){return(e==null?void 0:e.typeId)===O.LargeUtf8}static isBool(e){return(e==null?void 0:e.typeId)===O.Bool}static isDecimal(e){return(e==null?void 0:e.typeId)===O.Decimal}static isDate(e){return(e==null?void 0:e.typeId)===O.Date}static isTime(e){return(e==null?void 0:e.typeId)===O.Time}static isTimestamp(e){return(e==null?void 0:e.typeId)===O.Timestamp}static isInterval(e){return(e==null?void 0:e.typeId)===O.Interval}static isDuration(e){return(e==null?void 0:e.typeId)===O.Duration}static isList(e){return(e==null?void 0:e.typeId)===O.List}static isStruct(e){return(e==null?void 0:e.typeId)===O.Struct}static isUnion(e){return(e==null?void 0:e.typeId)===O.Union}static isFixedSizeBinary(e){return(e==null?void 0:e.typeId)===O.FixedSizeBinary}static isFixedSizeList(e){return(e==null?void 0:e.typeId)===O.FixedSizeList}static isMap(e){return(e==null?void 0:e.typeId)===O.Map}static isDictionary(e){return(e==null?void 0:e.typeId)===O.Dictionary}static isDenseUnion(e){return mt.isUnion(e)&&e.mode===Sr.Dense}static isSparseUnion(e){return mt.isUnion(e)&&e.mode===Sr.Sparse}constructor(e){this.typeId=e}}Zz=Symbol.toStringTag;mt[Zz]=(t=>(t.children=null,t.ArrayType=Array,t.OffsetArrayType=Int32Array,t[Symbol.toStringTag]="DataType"))(mt.prototype);class Nc extends mt{constructor(){super(O.Null)}toString(){return"Null"}}tU=Symbol.toStringTag;Nc[tU]=(t=>t[Symbol.toStringTag]="Null")(Nc.prototype);class $f extends mt{constructor(e,n){super(O.Int),this.isSigned=e,this.bitWidth=n}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}eU=Symbol.toStringTag;$f[eU]=(t=>(t.isSigned=null,t.bitWidth=null,t[Symbol.toStringTag]="Int"))($f.prototype);class y0 extends $f{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}Object.defineProperty(y0.prototype,"ArrayType",{value:Int32Array});class Gv extends mt{constructor(e){super(O.Float),this.precision=e}get ArrayType(){switch(this.precision){case mr.HALF:return Uint16Array;case mr.SINGLE:return Float32Array;case mr.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}nU=Symbol.toStringTag;Gv[nU]=(t=>(t.precision=null,t[Symbol.toStringTag]="Float"))(Gv.prototype);class Yv extends mt{constructor(){super(O.Binary)}toString(){return"Binary"}}rU=Symbol.toStringTag;Yv[rU]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Binary"))(Yv.prototype);class Hv extends mt{constructor(){super(O.LargeBinary)}toString(){return"LargeBinary"}}iU=Symbol.toStringTag;Hv[iU]=(t=>(t.ArrayType=Uint8Array,t.OffsetArrayType=BigInt64Array,t[Symbol.toStringTag]="LargeBinary"))(Hv.prototype);class Xv extends mt{constructor(){super(O.Utf8)}toString(){return"Utf8"}}sU=Symbol.toStringTag;Xv[sU]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Utf8"))(Xv.prototype);class Kv extends mt{constructor(){super(O.LargeUtf8)}toString(){return"LargeUtf8"}}oU=Symbol.toStringTag;Kv[oU]=(t=>(t.ArrayType=Uint8Array,t.OffsetArrayType=BigInt64Array,t[Symbol.toStringTag]="LargeUtf8"))(Kv.prototype);class Qv extends mt{constructor(){super(O.Bool)}toString(){return"Bool"}}aU=Symbol.toStringTag;Qv[aU]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Bool"))(Qv.prototype);class Jv extends mt{constructor(e,n,r=128){super(O.Decimal),this.scale=e,this.precision=n,this.bitWidth=r}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}}uU=Symbol.toStringTag;Jv[uU]=(t=>(t.scale=null,t.precision=null,t.ArrayType=Uint32Array,t[Symbol.toStringTag]="Decimal"))(Jv.prototype);class Zv extends mt{constructor(e){super(O.Date),this.unit=e}toString(){return`Date${(this.unit+1)*32}<${us[this.unit]}>`}get ArrayType(){return this.unit===us.DAY?Int32Array:BigInt64Array}}cU=Symbol.toStringTag;Zv[cU]=(t=>(t.unit=null,t[Symbol.toStringTag]="Date"))(Zv.prototype);class tw extends mt{constructor(e,n){super(O.Time),this.unit=e,this.bitWidth=n}toString(){return`Time${this.bitWidth}<${Mt[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}lU=Symbol.toStringTag;tw[lU]=(t=>(t.unit=null,t.bitWidth=null,t[Symbol.toStringTag]="Time"))(tw.prototype);class ew extends mt{constructor(e,n){super(O.Timestamp),this.unit=e,this.timezone=n}toString(){return`Timestamp<${Mt[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}fU=Symbol.toStringTag;ew[fU]=(t=>(t.unit=null,t.timezone=null,t.ArrayType=BigInt64Array,t[Symbol.toStringTag]="Timestamp"))(ew.prototype);class nw extends mt{constructor(e){super(O.Interval),this.unit=e}toString(){return`Interval<${Yo[this.unit]}>`}}dU=Symbol.toStringTag;nw[dU]=(t=>(t.unit=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Interval"))(nw.prototype);class rw extends mt{constructor(e){super(O.Duration),this.unit=e}toString(){return`Duration<${Mt[this.unit]}>`}}hU=Symbol.toStringTag;rw[hU]=(t=>(t.unit=null,t.ArrayType=BigInt64Array,t[Symbol.toStringTag]="Duration"))(rw.prototype);class iw extends mt{constructor(e){super(O.List),this.children=[e]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}}pU=Symbol.toStringTag;iw[pU]=(t=>(t.children=null,t[Symbol.toStringTag]="List"))(iw.prototype);class Or extends mt{constructor(e){super(O.Struct),this.children=e}toString(){return`Struct<{${this.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}gU=Symbol.toStringTag;Or[gU]=(t=>(t.children=null,t[Symbol.toStringTag]="Struct"))(Or.prototype);class sw extends mt{constructor(e,n,r){super(O.Union),this.mode=e,this.children=r,this.typeIds=n=Int32Array.from(n),this.typeIdToChildIndex=n.reduce((i,s,o)=>(i[s]=o)&&i||i,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(e=>`${e.type}`).join(" | ")}>`}}mU=Symbol.toStringTag;sw[mU]=(t=>(t.mode=null,t.typeIds=null,t.children=null,t.typeIdToChildIndex=null,t.ArrayType=Int8Array,t[Symbol.toStringTag]="Union"))(sw.prototype);class ow extends mt{constructor(e){super(O.FixedSizeBinary),this.byteWidth=e}toString(){return`FixedSizeBinary[${this.byteWidth}]`}}yU=Symbol.toStringTag;ow[yU]=(t=>(t.byteWidth=null,t.ArrayType=Uint8Array,t[Symbol.toStringTag]="FixedSizeBinary"))(ow.prototype);class aw extends mt{constructor(e,n){super(O.FixedSizeList),this.listSize=e,this.children=[n]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}bU=Symbol.toStringTag;aw[bU]=(t=>(t.children=null,t.listSize=null,t[Symbol.toStringTag]="FixedSizeList"))(aw.prototype);class uw extends mt{constructor(e,n=!1){var r,i,s;if(super(O.Map),this.children=[e],this.keysSorted=n,e&&(e.name="entries",!((r=e==null?void 0:e.type)===null||r===void 0)&&r.children)){const o=(i=e==null?void 0:e.type)===null||i===void 0?void 0:i.children[0];o&&(o.name="key");const a=(s=e==null?void 0:e.type)===null||s===void 0?void 0:s.children[1];a&&(a.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}vU=Symbol.toStringTag;uw[vU]=(t=>(t.children=null,t.keysSorted=null,t[Symbol.toStringTag]="Map_"))(uw.prototype);const Sft=(t=>()=>++t)(-1);class Vh extends mt{constructor(e,n,r,i){super(O.Dictionary),this.indices=n,this.dictionary=e,this.isOrdered=i||!1,this.id=r==null?Sft():Ae(r)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}wU=Symbol.toStringTag;Vh[wU]=(t=>(t.id=null,t.indices=null,t.isOrdered=null,t.dictionary=null,t[Symbol.toStringTag]="Dictionary"))(Vh.prototype);function za(t){const e=t;switch(t.typeId){case O.Decimal:return t.bitWidth/32;case O.Interval:return 1+e.unit;case O.FixedSizeList:return e.listSize;case O.FixedSizeBinary:return e.byteWidth;default:return 1}}class Gt{visitMany(e,...n){return e.map((r,i)=>this.visit(r,...n.map(s=>s[i])))}visit(...e){return this.getVisitFn(e[0],!1).apply(this,e)}getVisitFn(e,n=!0){return Eft(this,e,n)}getVisitFnByTypeId(e,n=!0){return nh(this,e,n)}visitNull(e,...n){return null}visitBool(e,...n){return null}visitInt(e,...n){return null}visitFloat(e,...n){return null}visitUtf8(e,...n){return null}visitLargeUtf8(e,...n){return null}visitBinary(e,...n){return null}visitLargeBinary(e,...n){return null}visitFixedSizeBinary(e,...n){return null}visitDate(e,...n){return null}visitTimestamp(e,...n){return null}visitTime(e,...n){return null}visitDecimal(e,...n){return null}visitList(e,...n){return null}visitStruct(e,...n){return null}visitUnion(e,...n){return null}visitDictionary(e,...n){return null}visitInterval(e,...n){return null}visitDuration(e,...n){return null}visitFixedSizeList(e,...n){return null}visitMap(e,...n){return null}}function Eft(t,e,n=!0){return typeof e=="number"?nh(t,e,n):typeof e=="string"&&e in O?nh(t,O[e],n):e&&e instanceof mt?nh(t,GD(e),n):e!=null&&e.type&&e.type instanceof mt?nh(t,GD(e.type),n):nh(t,O.NONE,n)}function nh(t,e,n=!0){let r=null;switch(e){case O.Null:r=t.visitNull;break;case O.Bool:r=t.visitBool;break;case O.Int:r=t.visitInt;break;case O.Int8:r=t.visitInt8||t.visitInt;break;case O.Int16:r=t.visitInt16||t.visitInt;break;case O.Int32:r=t.visitInt32||t.visitInt;break;case O.Int64:r=t.visitInt64||t.visitInt;break;case O.Uint8:r=t.visitUint8||t.visitInt;break;case O.Uint16:r=t.visitUint16||t.visitInt;break;case O.Uint32:r=t.visitUint32||t.visitInt;break;case O.Uint64:r=t.visitUint64||t.visitInt;break;case O.Float:r=t.visitFloat;break;case O.Float16:r=t.visitFloat16||t.visitFloat;break;case O.Float32:r=t.visitFloat32||t.visitFloat;break;case O.Float64:r=t.visitFloat64||t.visitFloat;break;case O.Utf8:r=t.visitUtf8;break;case O.LargeUtf8:r=t.visitLargeUtf8;break;case O.Binary:r=t.visitBinary;break;case O.LargeBinary:r=t.visitLargeBinary;break;case O.FixedSizeBinary:r=t.visitFixedSizeBinary;break;case O.Date:r=t.visitDate;break;case O.DateDay:r=t.visitDateDay||t.visitDate;break;case O.DateMillisecond:r=t.visitDateMillisecond||t.visitDate;break;case O.Timestamp:r=t.visitTimestamp;break;case O.TimestampSecond:r=t.visitTimestampSecond||t.visitTimestamp;break;case O.TimestampMillisecond:r=t.visitTimestampMillisecond||t.visitTimestamp;break;case O.TimestampMicrosecond:r=t.visitTimestampMicrosecond||t.visitTimestamp;break;case O.TimestampNanosecond:r=t.visitTimestampNanosecond||t.visitTimestamp;break;case O.Time:r=t.visitTime;break;case O.TimeSecond:r=t.visitTimeSecond||t.visitTime;break;case O.TimeMillisecond:r=t.visitTimeMillisecond||t.visitTime;break;case O.TimeMicrosecond:r=t.visitTimeMicrosecond||t.visitTime;break;case O.TimeNanosecond:r=t.visitTimeNanosecond||t.visitTime;break;case O.Decimal:r=t.visitDecimal;break;case O.List:r=t.visitList;break;case O.Struct:r=t.visitStruct;break;case O.Union:r=t.visitUnion;break;case O.DenseUnion:r=t.visitDenseUnion||t.visitUnion;break;case O.SparseUnion:r=t.visitSparseUnion||t.visitUnion;break;case O.Dictionary:r=t.visitDictionary;break;case O.Interval:r=t.visitInterval;break;case O.IntervalDayTime:r=t.visitIntervalDayTime||t.visitInterval;break;case O.IntervalYearMonth:r=t.visitIntervalYearMonth||t.visitInterval;break;case O.Duration:r=t.visitDuration;break;case O.DurationSecond:r=t.visitDurationSecond||t.visitDuration;break;case O.DurationMillisecond:r=t.visitDurationMillisecond||t.visitDuration;break;case O.DurationMicrosecond:r=t.visitDurationMicrosecond||t.visitDuration;break;case O.DurationNanosecond:r=t.visitDurationNanosecond||t.visitDuration;break;case O.FixedSizeList:r=t.visitFixedSizeList;break;case O.Map:r=t.visitMap;break}if(typeof r=="function")return r;if(!n)return()=>null;throw new Error(`Unrecognized type '${O[e]}'`)}function GD(t){switch(t.typeId){case O.Null:return O.Null;case O.Int:{const{bitWidth:e,isSigned:n}=t;switch(e){case 8:return n?O.Int8:O.Uint8;case 16:return n?O.Int16:O.Uint16;case 32:return n?O.Int32:O.Uint32;case 64:return n?O.Int64:O.Uint64}return O.Int}case O.Float:switch(t.precision){case mr.HALF:return O.Float16;case mr.SINGLE:return O.Float32;case mr.DOUBLE:return O.Float64}return O.Float;case O.Binary:return O.Binary;case O.LargeBinary:return O.LargeBinary;case O.Utf8:return O.Utf8;case O.LargeUtf8:return O.LargeUtf8;case O.Bool:return O.Bool;case O.Decimal:return O.Decimal;case O.Time:switch(t.unit){case Mt.SECOND:return O.TimeSecond;case Mt.MILLISECOND:return O.TimeMillisecond;case Mt.MICROSECOND:return O.TimeMicrosecond;case Mt.NANOSECOND:return O.TimeNanosecond}return O.Time;case O.Timestamp:switch(t.unit){case Mt.SECOND:return O.TimestampSecond;case Mt.MILLISECOND:return O.TimestampMillisecond;case Mt.MICROSECOND:return O.TimestampMicrosecond;case Mt.NANOSECOND:return O.TimestampNanosecond}return O.Timestamp;case O.Date:switch(t.unit){case us.DAY:return O.DateDay;case us.MILLISECOND:return O.DateMillisecond}return O.Date;case O.Interval:switch(t.unit){case Yo.DAY_TIME:return O.IntervalDayTime;case Yo.YEAR_MONTH:return O.IntervalYearMonth}return O.Interval;case O.Duration:switch(t.unit){case Mt.SECOND:return O.DurationSecond;case Mt.MILLISECOND:return O.DurationMillisecond;case Mt.MICROSECOND:return O.DurationMicrosecond;case Mt.NANOSECOND:return O.DurationNanosecond}return O.Duration;case O.Map:return O.Map;case O.List:return O.List;case O.Struct:return O.Struct;case O.Union:switch(t.mode){case Sr.Dense:return O.DenseUnion;case Sr.Sparse:return O.SparseUnion}return O.Union;case O.FixedSizeBinary:return O.FixedSizeBinary;case O.FixedSizeList:return O.FixedSizeList;case O.Dictionary:return O.Dictionary}throw new Error(`Unrecognized type '${O[t.typeId]}'`)}Gt.prototype.visitInt8=null;Gt.prototype.visitInt16=null;Gt.prototype.visitInt32=null;Gt.prototype.visitInt64=null;Gt.prototype.visitUint8=null;Gt.prototype.visitUint16=null;Gt.prototype.visitUint32=null;Gt.prototype.visitUint64=null;Gt.prototype.visitFloat16=null;Gt.prototype.visitFloat32=null;Gt.prototype.visitFloat64=null;Gt.prototype.visitDateDay=null;Gt.prototype.visitDateMillisecond=null;Gt.prototype.visitTimestampSecond=null;Gt.prototype.visitTimestampMillisecond=null;Gt.prototype.visitTimestampMicrosecond=null;Gt.prototype.visitTimestampNanosecond=null;Gt.prototype.visitTimeSecond=null;Gt.prototype.visitTimeMillisecond=null;Gt.prototype.visitTimeMicrosecond=null;Gt.prototype.visitTimeNanosecond=null;Gt.prototype.visitDenseUnion=null;Gt.prototype.visitSparseUnion=null;Gt.prototype.visitIntervalDayTime=null;Gt.prototype.visitIntervalYearMonth=null;Gt.prototype.visitDuration=null;Gt.prototype.visitDurationSecond=null;Gt.prototype.visitDurationMillisecond=null;Gt.prototype.visitDurationMicrosecond=null;Gt.prototype.visitDurationNanosecond=null;const xU=new Float64Array(1),kd=new Uint32Array(xU.buffer);function _U(t){const e=(t&31744)>>10,n=(t&1023)/1024,r=Math.pow(-1,(t&32768)>>15);switch(e){case 31:return r*(n?Number.NaN:1/0);case 0:return r*(n?6103515625e-14*n:0)}return r*Math.pow(2,e-15)*(1+n)}function Aft(t){if(t!==t)return 32256;xU[0]=t;const e=(kd[1]&2147483648)>>16&65535;let n=kd[1]&2146435072,r=0;return n>=1089470464?kd[0]>0?n=31744:(n=(n&2080374784)>>16,r=(kd[1]&1048575)>>10):n<=1056964608?(r=1048576+(kd[1]&1048575),r=1048576+(r<<(n>>20)-998)>>21,n=0):(n=n-1056964608>>10,r=(kd[1]&1048575)+512>>10),e|n|r&65535}class Ct extends Gt{}function Nt(t){return(e,n,r)=>{if(e.setValid(n,r!=null))return t(e,n,r)}}const $ft=(t,e,n)=>{t[e]=Math.floor(n/864e5)},SU=(t,e,n,r)=>{if(n+1<e.length){const i=Ae(e[n]),s=Ae(e[n+1]);t.set(r.subarray(0,s-i),i)}},Tft=({offset:t,values:e},n,r)=>{const i=t+n;r?e[i>>3]|=1<<i%8:e[i>>3]&=~(1<<i%8)},Au=({values:t},e,n)=>{t[e]=n},XM=({values:t},e,n)=>{t[e]=n},EU=({values:t},e,n)=>{t[e]=Aft(n)},kft=(t,e,n)=>{switch(t.type.precision){case mr.HALF:return EU(t,e,n);case mr.SINGLE:case mr.DOUBLE:return XM(t,e,n)}},AU=({values:t},e,n)=>{$ft(t,e,n.valueOf())},$U=({values:t},e,n)=>{t[e]=BigInt(n)},Mft=({stride:t,values:e},n,r)=>{e.set(r.subarray(0,t),t*n)},TU=({values:t,valueOffsets:e},n,r)=>SU(t,e,n,r),kU=({values:t,valueOffsets:e},n,r)=>SU(t,e,n,VM(r)),Cft=(t,e,n)=>{t.type.unit===us.DAY?AU(t,e,n):$U(t,e,n)},MU=({values:t},e,n)=>{t[e]=BigInt(n/1e3)},CU=({values:t},e,n)=>{t[e]=BigInt(n)},IU=({values:t},e,n)=>{t[e]=BigInt(n*1e3)},FU=({values:t},e,n)=>{t[e]=BigInt(n*1e6)},Ift=(t,e,n)=>{switch(t.type.unit){case Mt.SECOND:return MU(t,e,n);case Mt.MILLISECOND:return CU(t,e,n);case Mt.MICROSECOND:return IU(t,e,n);case Mt.NANOSECOND:return FU(t,e,n)}},NU=({values:t},e,n)=>{t[e]=n},OU=({values:t},e,n)=>{t[e]=n},RU=({values:t},e,n)=>{t[e]=n},DU=({values:t},e,n)=>{t[e]=n},Fft=(t,e,n)=>{switch(t.type.unit){case Mt.SECOND:return NU(t,e,n);case Mt.MILLISECOND:return OU(t,e,n);case Mt.MICROSECOND:return RU(t,e,n);case Mt.NANOSECOND:return DU(t,e,n)}},Nft=({values:t,stride:e},n,r)=>{t.set(r.subarray(0,e),e*n)},Oft=(t,e,n)=>{const r=t.children[0],i=t.valueOffsets,s=cs.getVisitFn(r);if(Array.isArray(n))for(let o=-1,a=i[e],u=i[e+1];a<u;)s(r,a++,n[++o]);else for(let o=-1,a=i[e],u=i[e+1];a<u;)s(r,a++,n.get(++o))},Rft=(t,e,n)=>{const r=t.children[0],{valueOffsets:i}=t,s=cs.getVisitFn(r);let{[e]:o,[e+1]:a}=i;const u=n instanceof Map?n.entries():Object.entries(n);for(const c of u)if(s(r,o,c),++o>=a)break},Dft=(t,e)=>(n,r,i,s)=>r&&n(r,t,e[s]),Lft=(t,e)=>(n,r,i,s)=>r&&n(r,t,e.get(s)),Bft=(t,e)=>(n,r,i,s)=>r&&n(r,t,e.get(i.name)),Pft=(t,e)=>(n,r,i,s)=>r&&n(r,t,e[i.name]),zft=(t,e,n)=>{const r=t.type.children.map(s=>cs.getVisitFn(s.type)),i=n instanceof Map?Bft(e,n):n instanceof Ye?Lft(e,n):Array.isArray(n)?Dft(e,n):Pft(e,n);t.type.children.forEach((s,o)=>i(r[o],t.children[o],s,o))},Uft=(t,e,n)=>{t.type.mode===Sr.Dense?LU(t,e,n):BU(t,e,n)},LU=(t,e,n)=>{const r=t.type.typeIdToChildIndex[t.typeIds[e]],i=t.children[r];cs.visit(i,t.valueOffsets[e],n)},BU=(t,e,n)=>{const r=t.type.typeIdToChildIndex[t.typeIds[e]],i=t.children[r];cs.visit(i,e,n)},jft=(t,e,n)=>{var r;(r=t.dictionary)===null||r===void 0||r.set(t.values[e],n)},qft=(t,e,n)=>{t.type.unit===Yo.DAY_TIME?PU(t,e,n):zU(t,e,n)},PU=({values:t},e,n)=>{t.set(n.subarray(0,2),2*e)},zU=({values:t},e,n)=>{t[e]=n[0]*12+n[1]%12},UU=({values:t},e,n)=>{t[e]=n},jU=({values:t},e,n)=>{t[e]=n},qU=({values:t},e,n)=>{t[e]=n},WU=({values:t},e,n)=>{t[e]=n},Wft=(t,e,n)=>{switch(t.type.unit){case Mt.SECOND:return UU(t,e,n);case Mt.MILLISECOND:return jU(t,e,n);case Mt.MICROSECOND:return qU(t,e,n);case Mt.NANOSECOND:return WU(t,e,n)}},Vft=(t,e,n)=>{const{stride:r}=t,i=t.children[0],s=cs.getVisitFn(i);if(Array.isArray(n))for(let o=-1,a=e*r;++o<r;)s(i,a+o,n[o]);else for(let o=-1,a=e*r;++o<r;)s(i,a+o,n.get(o))};Ct.prototype.visitBool=Nt(Tft);Ct.prototype.visitInt=Nt(Au);Ct.prototype.visitInt8=Nt(Au);Ct.prototype.visitInt16=Nt(Au);Ct.prototype.visitInt32=Nt(Au);Ct.prototype.visitInt64=Nt(Au);Ct.prototype.visitUint8=Nt(Au);Ct.prototype.visitUint16=Nt(Au);Ct.prototype.visitUint32=Nt(Au);Ct.prototype.visitUint64=Nt(Au);Ct.prototype.visitFloat=Nt(kft);Ct.prototype.visitFloat16=Nt(EU);Ct.prototype.visitFloat32=Nt(XM);Ct.prototype.visitFloat64=Nt(XM);Ct.prototype.visitUtf8=Nt(kU);Ct.prototype.visitLargeUtf8=Nt(kU);Ct.prototype.visitBinary=Nt(TU);Ct.prototype.visitLargeBinary=Nt(TU);Ct.prototype.visitFixedSizeBinary=Nt(Mft);Ct.prototype.visitDate=Nt(Cft);Ct.prototype.visitDateDay=Nt(AU);Ct.prototype.visitDateMillisecond=Nt($U);Ct.prototype.visitTimestamp=Nt(Ift);Ct.prototype.visitTimestampSecond=Nt(MU);Ct.prototype.visitTimestampMillisecond=Nt(CU);Ct.prototype.visitTimestampMicrosecond=Nt(IU);Ct.prototype.visitTimestampNanosecond=Nt(FU);Ct.prototype.visitTime=Nt(Fft);Ct.prototype.visitTimeSecond=Nt(NU);Ct.prototype.visitTimeMillisecond=Nt(OU);Ct.prototype.visitTimeMicrosecond=Nt(RU);Ct.prototype.visitTimeNanosecond=Nt(DU);Ct.prototype.visitDecimal=Nt(Nft);Ct.prototype.visitList=Nt(Oft);Ct.prototype.visitStruct=Nt(zft);Ct.prototype.visitUnion=Nt(Uft);Ct.prototype.visitDenseUnion=Nt(LU);Ct.prototype.visitSparseUnion=Nt(BU);Ct.prototype.visitDictionary=Nt(jft);Ct.prototype.visitInterval=Nt(qft);Ct.prototype.visitIntervalDayTime=Nt(PU);Ct.prototype.visitIntervalYearMonth=Nt(zU);Ct.prototype.visitDuration=Nt(Wft);Ct.prototype.visitDurationSecond=Nt(UU);Ct.prototype.visitDurationMillisecond=Nt(jU);Ct.prototype.visitDurationMicrosecond=Nt(qU);Ct.prototype.visitDurationNanosecond=Nt(WU);Ct.prototype.visitFixedSizeList=Nt(Vft);Ct.prototype.visitMap=Nt(Rft);const cs=new Ct,Is=Symbol.for("parent"),$h=Symbol.for("rowIndex");class KM{constructor(e,n){return this[Is]=e,this[$h]=n,new Proxy(this,new Yft)}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[$h],n=this[Is],r=n.type.children,i={};for(let s=-1,o=r.length;++s<o;)i[r[s].name]=ci.visit(n.children[s],e);return i}toString(){return`{${[...this].map(([e,n])=>`${p0(e)}: ${p0(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new Gft(this[Is],this[$h])}}class Gft{constructor(e,n){this.childIndex=0,this.children=e.children,this.rowIndex=n,this.childFields=e.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const e=this.childIndex;return e<this.numChildren?(this.childIndex=e+1,{done:!1,value:[this.childFields[e].name,ci.visit(this.children[e],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(KM.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Is]:{writable:!0,enumerable:!1,configurable:!1,value:null},[$h]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class Yft{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[Is].type.children.map(n=>n.name)}has(e,n){return e[Is].type.children.findIndex(r=>r.name===n)!==-1}getOwnPropertyDescriptor(e,n){if(e[Is].type.children.findIndex(r=>r.name===n)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,n){if(Reflect.has(e,n))return e[n];const r=e[Is].type.children.findIndex(i=>i.name===n);if(r!==-1){const i=ci.visit(e[Is].children[r],e[$h]);return Reflect.set(e,n,i),i}}set(e,n,r){const i=e[Is].type.children.findIndex(s=>s.name===n);return i!==-1?(cs.visit(e[Is].children[i],e[$h],r),Reflect.set(e,n,r)):Reflect.has(e,n)||typeof n=="symbol"?Reflect.set(e,n,r):!1}}class At extends Gt{}function It(t){return(e,n)=>e.getValid(n)?t(e,n):null}const Hft=(t,e)=>864e5*t[e],Xft=(t,e)=>null,VU=(t,e,n)=>{if(n+1>=e.length)return null;const r=Ae(e[n]),i=Ae(e[n+1]);return t.subarray(r,i)},Kft=({offset:t,values:e},n)=>{const r=t+n;return(e[r>>3]&1<<r%8)!==0},GU=({values:t},e)=>Hft(t,e),YU=({values:t},e)=>Ae(t[e]),ol=({stride:t,values:e},n)=>e[t*n],Qft=({stride:t,values:e},n)=>_U(e[t*n]),HU=({values:t},e)=>t[e],Jft=({stride:t,values:e},n)=>e.subarray(t*n,t*(n+1)),XU=({values:t,valueOffsets:e},n)=>VU(t,e,n),KU=({values:t,valueOffsets:e},n)=>{const r=VU(t,e,n);return r!==null?v3(r):null},Zft=({values:t},e)=>t[e],tdt=({type:t,values:e},n)=>t.precision!==mr.HALF?e[n]:_U(e[n]),edt=(t,e)=>t.type.unit===us.DAY?GU(t,e):YU(t,e),QU=({values:t},e)=>1e3*Ae(t[e]),JU=({values:t},e)=>Ae(t[e]),ZU=({values:t},e)=>Qz(t[e],BigInt(1e3)),tj=({values:t},e)=>Qz(t[e],BigInt(1e6)),ndt=(t,e)=>{switch(t.type.unit){case Mt.SECOND:return QU(t,e);case Mt.MILLISECOND:return JU(t,e);case Mt.MICROSECOND:return ZU(t,e);case Mt.NANOSECOND:return tj(t,e)}},ej=({values:t},e)=>t[e],nj=({values:t},e)=>t[e],rj=({values:t},e)=>t[e],ij=({values:t},e)=>t[e],rdt=(t,e)=>{switch(t.type.unit){case Mt.SECOND:return ej(t,e);case Mt.MILLISECOND:return nj(t,e);case Mt.MICROSECOND:return rj(t,e);case Mt.NANOSECOND:return ij(t,e)}},idt=({values:t,stride:e},n)=>HM.decimal(t.subarray(e*n,e*(n+1))),sdt=(t,e)=>{const{valueOffsets:n,stride:r,children:i}=t,{[e*r]:s,[e*r+1]:o}=n,u=i[0].slice(s,o-s);return new Ye([u])},odt=(t,e)=>{const{valueOffsets:n,children:r}=t,{[e]:i,[e+1]:s}=n,o=r[0];return new QM(o.slice(i,s-i))},adt=(t,e)=>new KM(t,e),udt=(t,e)=>t.type.mode===Sr.Dense?sj(t,e):oj(t,e),sj=(t,e)=>{const n=t.type.typeIdToChildIndex[t.typeIds[e]],r=t.children[n];return ci.visit(r,t.valueOffsets[e])},oj=(t,e)=>{const n=t.type.typeIdToChildIndex[t.typeIds[e]],r=t.children[n];return ci.visit(r,e)},cdt=(t,e)=>{var n;return(n=t.dictionary)===null||n===void 0?void 0:n.get(t.values[e])},ldt=(t,e)=>t.type.unit===Yo.DAY_TIME?aj(t,e):uj(t,e),aj=({values:t},e)=>t.subarray(2*e,2*(e+1)),uj=({values:t},e)=>{const n=t[e],r=new Int32Array(2);return r[0]=Math.trunc(n/12),r[1]=Math.trunc(n%12),r},cj=({values:t},e)=>t[e],lj=({values:t},e)=>t[e],fj=({values:t},e)=>t[e],dj=({values:t},e)=>t[e],fdt=(t,e)=>{switch(t.type.unit){case Mt.SECOND:return cj(t,e);case Mt.MILLISECOND:return lj(t,e);case Mt.MICROSECOND:return fj(t,e);case Mt.NANOSECOND:return dj(t,e)}},ddt=(t,e)=>{const{stride:n,children:r}=t,s=r[0].slice(e*n,n);return new Ye([s])};At.prototype.visitNull=It(Xft);At.prototype.visitBool=It(Kft);At.prototype.visitInt=It(Zft);At.prototype.visitInt8=It(ol);At.prototype.visitInt16=It(ol);At.prototype.visitInt32=It(ol);At.prototype.visitInt64=It(HU);At.prototype.visitUint8=It(ol);At.prototype.visitUint16=It(ol);At.prototype.visitUint32=It(ol);At.prototype.visitUint64=It(HU);At.prototype.visitFloat=It(tdt);At.prototype.visitFloat16=It(Qft);At.prototype.visitFloat32=It(ol);At.prototype.visitFloat64=It(ol);At.prototype.visitUtf8=It(KU);At.prototype.visitLargeUtf8=It(KU);At.prototype.visitBinary=It(XU);At.prototype.visitLargeBinary=It(XU);At.prototype.visitFixedSizeBinary=It(Jft);At.prototype.visitDate=It(edt);At.prototype.visitDateDay=It(GU);At.prototype.visitDateMillisecond=It(YU);At.prototype.visitTimestamp=It(ndt);At.prototype.visitTimestampSecond=It(QU);At.prototype.visitTimestampMillisecond=It(JU);At.prototype.visitTimestampMicrosecond=It(ZU);At.prototype.visitTimestampNanosecond=It(tj);At.prototype.visitTime=It(rdt);At.prototype.visitTimeSecond=It(ej);At.prototype.visitTimeMillisecond=It(nj);At.prototype.visitTimeMicrosecond=It(rj);At.prototype.visitTimeNanosecond=It(ij);At.prototype.visitDecimal=It(idt);At.prototype.visitList=It(sdt);At.prototype.visitStruct=It(adt);At.prototype.visitUnion=It(udt);At.prototype.visitDenseUnion=It(sj);At.prototype.visitSparseUnion=It(oj);At.prototype.visitDictionary=It(cdt);At.prototype.visitInterval=It(ldt);At.prototype.visitIntervalDayTime=It(aj);At.prototype.visitIntervalYearMonth=It(uj);At.prototype.visitDuration=It(fdt);At.prototype.visitDurationSecond=It(cj);At.prototype.visitDurationMillisecond=It(lj);At.prototype.visitDurationMicrosecond=It(fj);At.prototype.visitDurationNanosecond=It(dj);At.prototype.visitFixedSizeList=It(ddt);At.prototype.visitMap=It(odt);const ci=new At,rh=Symbol.for("keys"),Th=Symbol.for("vals"),ih=Symbol.for("kKeysAsStrings"),A3=Symbol.for("_kKeysAsStrings");class QM{constructor(e){return this[rh]=new Ye([e.children[0]]).memoize(),this[Th]=e.children[1],new Proxy(this,new pdt)}get[ih](){return this[A3]||(this[A3]=Array.from(this[rh].toArray(),String))}[Symbol.iterator](){return new hdt(this[rh],this[Th])}get size(){return this[rh].length}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[rh],n=this[Th],r={};for(let i=-1,s=e.length;++i<s;)r[e.get(i)]=ci.visit(n,i);return r}toString(){return`{${[...this].map(([e,n])=>`${p0(e)}: ${p0(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class hdt{constructor(e,n){this.keys=e,this.vals=n,this.keyIndex=0,this.numKeys=e.length}[Symbol.iterator](){return this}next(){const e=this.keyIndex;return e===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(e),ci.visit(this.vals,e)]})}}class pdt{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[ih]}has(e,n){return e[ih].includes(n)}getOwnPropertyDescriptor(e,n){if(e[ih].indexOf(n)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,n){if(Reflect.has(e,n))return e[n];const r=e[ih].indexOf(n);if(r!==-1){const i=ci.visit(Reflect.get(e,Th),r);return Reflect.set(e,n,i),i}}set(e,n,r){const i=e[ih].indexOf(n);return i!==-1?(cs.visit(Reflect.get(e,Th),i,r),Reflect.set(e,n,r)):Reflect.has(e,n)?Reflect.set(e,n,r):!1}}Object.defineProperties(QM.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[rh]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Th]:{writable:!0,enumerable:!1,configurable:!1,value:null},[A3]:{writable:!0,enumerable:!1,configurable:!1,value:null}});let YD;function hj(t,e,n,r){const{length:i=0}=t;let s=typeof e!="number"?0:e,o=typeof n!="number"?i:n;return s<0&&(s=(s%i+i)%i),o<0&&(o=(o%i+i)%i),o<s&&(YD=s,s=o,o=YD),o>i&&(o=i),r?r(t,s,o):[s,o]}const JM=(t,e)=>t<0?e+t:t,HD=t=>t!==t;function qp(t){if(typeof t!=="object"||t===null)return HD(t)?HD:n=>n===t;if(t instanceof Date){const n=t.valueOf();return r=>r instanceof Date?r.valueOf()===n:!1}return ArrayBuffer.isView(t)?n=>n?dft(t,n):!1:t instanceof Map?mdt(t):Array.isArray(t)?gdt(t):t instanceof Ye?ydt(t):bdt(t,!0)}function gdt(t){const e=[];for(let n=-1,r=t.length;++n<r;)e[n]=qp(t[n]);return C2(e)}function mdt(t){let e=-1;const n=[];for(const r of t.values())n[++e]=qp(r);return C2(n)}function ydt(t){const e=[];for(let n=-1,r=t.length;++n<r;)e[n]=qp(t.get(n));return C2(e)}function bdt(t,e=!1){const n=Object.keys(t);if(!e&&n.length===0)return()=>!1;const r=[];for(let i=-1,s=n.length;++i<s;)r[i]=qp(t[n[i]]);return C2(r,n)}function C2(t,e){return n=>{if(!n||typeof n!="object")return!1;switch(n.constructor){case Array:return vdt(t,n);case Map:return XD(t,n,n.keys());case QM:case KM:case Object:case void 0:return XD(t,n,e||Object.keys(n))}return n instanceof Ye?wdt(t,n):!1}}function vdt(t,e){const n=t.length;if(e.length!==n)return!1;for(let r=-1;++r<n;)if(!t[r](e[r]))return!1;return!0}function wdt(t,e){const n=t.length;if(e.length!==n)return!1;for(let r=-1;++r<n;)if(!t[r](e.get(r)))return!1;return!0}function XD(t,e,n){const r=n[Symbol.iterator](),i=e instanceof Map?e.keys():Object.keys(e)[Symbol.iterator](),s=e instanceof Map?e.values():Object.values(e)[Symbol.iterator]();let o=0;const a=t.length;let u=s.next(),c=r.next(),l=i.next();for(;o<a&&!c.done&&!l.done&&!u.done&&!(c.value!==l.value||!t[o](u.value));++o,c=r.next(),l=i.next(),u=s.next());return o===a&&c.done&&l.done&&u.done?!0:(r.return&&r.return(),i.return&&i.return(),s.return&&s.return(),!1)}function pj(t,e,n,r){return(n&1<<r)!==0}function xdt(t,e,n,r){return(n&1<<r)>>r}function cw(t,e,n){const r=n.byteLength+7&-8;if(t>0||n.byteLength<r){const i=new Uint8Array(r);return i.set(t%8===0?n.subarray(t>>3):lw(new ZM(n,t,e,null,pj)).subarray(0,r)),i}return n}function lw(t){const e=[];let n=0,r=0,i=0;for(const o of t)o&&(i|=1<<r),++r===8&&(e[n++]=i,i=r=0);(n===0||r>0)&&(e[n++]=i);const s=new Uint8Array(e.length+7&-8);return s.set(e),s}class ZM{constructor(e,n,r,i,s){this.bytes=e,this.length=r,this.context=i,this.get=s,this.bit=n%8,this.byteIndex=n>>3,this.byte=e[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function $3(t,e,n){if(n-e<=0)return 0;if(n-e<8){let s=0;for(const o of new ZM(t,e,n-e,t,xdt))s+=o;return s}const r=n>>3<<3,i=e+(e%8===0?0:8-e%8);return $3(t,e,i)+$3(t,r,n)+_dt(t,i>>3,r-i>>3)}function _dt(t,e,n){let r=0,i=Math.trunc(e);const s=new DataView(t.buffer,t.byteOffset,t.byteLength),o=n===void 0?t.byteLength:i+n;for(;o-i>=4;)r+=DE(s.getUint32(i)),i+=4;for(;o-i>=2;)r+=DE(s.getUint16(i)),i+=2;for(;o-i>=1;)r+=DE(s.getUint8(i)),i+=1;return r}function DE(t){let e=Math.trunc(t);return e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),(e+(e>>>4)&252645135)*16843009>>>24}const Sdt=-1;class pe{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){const{type:e}=this;return mt.isSparseUnion(e)?this.children.some(n=>n.nullable):mt.isDenseUnion(e)?this.children.some(n=>n.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let e=0;const{valueOffsets:n,values:r,nullBitmap:i,typeIds:s}=this;return n&&(e+=n.byteLength),r&&(e+=r.byteLength),i&&(e+=i.byteLength),s&&(e+=s.byteLength),this.children.reduce((o,a)=>o+a.byteLength,e)}get nullCount(){if(mt.isUnion(this.type))return this.children.reduce((r,i)=>r+i.nullCount,0);let e=this._nullCount,n;return e<=Sdt&&(n=this.nullBitmap)&&(this._nullCount=e=n.length===0?0:this.length-$3(n,this.offset,this.offset+this.length)),e}constructor(e,n,r,i,s,o=[],a){this.type=e,this.children=o,this.dictionary=a,this.offset=Math.floor(Math.max(n||0,0)),this.length=Math.floor(Math.max(r||0,0)),this._nullCount=Math.floor(Math.max(i||0,-1));let u;s instanceof pe?(this.stride=s.stride,this.values=s.values,this.typeIds=s.typeIds,this.nullBitmap=s.nullBitmap,this.valueOffsets=s.valueOffsets):(this.stride=za(e),s&&((u=s[0])&&(this.valueOffsets=u),(u=s[1])&&(this.values=u),(u=s[2])&&(this.nullBitmap=u),(u=s[3])&&(this.typeIds=u)))}getValid(e){const{type:n}=this;if(mt.isUnion(n)){const r=n,i=this.children[r.typeIdToChildIndex[this.typeIds[e]]],s=r.mode===Sr.Dense?this.valueOffsets[e]:e;return i.getValid(s)}if(this.nullable&&this.nullCount>0){const r=this.offset+e;return(this.nullBitmap[r>>3]&1<<r%8)!==0}return!0}setValid(e,n){let r;const{type:i}=this;if(mt.isUnion(i)){const s=i,o=this.children[s.typeIdToChildIndex[this.typeIds[e]]],a=s.mode===Sr.Dense?this.valueOffsets[e]:e;r=o.getValid(a),o.setValid(a,n)}else{let{nullBitmap:s}=this;const{offset:o,length:a}=this,u=o+e,c=1<<u%8,l=u>>3;(!s||s.byteLength<=l)&&(s=new Uint8Array((o+a+63&-64)>>3).fill(255),this.nullCount>0?(s.set(cw(o,a,this.nullBitmap),0),Object.assign(this,{nullBitmap:s})):Object.assign(this,{nullBitmap:s,_nullCount:0}));const f=s[l];r=(f&c)!==0,s[l]=n?f|c:f&~c}return r!==!!n&&(this._nullCount=this.nullCount+(n?-1:1)),n}clone(e=this.type,n=this.offset,r=this.length,i=this._nullCount,s=this,o=this.children){return new pe(e,n,r,i,s,o,this.dictionary)}slice(e,n){const{stride:r,typeId:i,children:s}=this,o=+(this._nullCount===0)-1,a=i===16?r:1,u=this._sliceBuffers(e,n,r,i);return this.clone(this.type,this.offset+e,n,o,u,s.length===0||this.valueOffsets?s:this._sliceChildren(s,a*e,a*n))}_changeLengthAndBackfillNullBitmap(e){if(this.typeId===O.Null)return this.clone(this.type,0,e,0);const{length:n,nullCount:r}=this,i=new Uint8Array((e+63&-64)>>3).fill(255,0,n>>3);i[n>>3]=(1<<n-(n&-8))-1,r>0&&i.set(cw(this.offset,n,this.nullBitmap),0);const s=this.buffers;return s[Pa.VALIDITY]=i,this.clone(this.type,0,e,r+(e-n),s)}_sliceBuffers(e,n,r,i){let s;const{buffers:o}=this;return(s=o[Pa.TYPE])&&(o[Pa.TYPE]=s.subarray(e,e+n)),(s=o[Pa.OFFSET])&&(o[Pa.OFFSET]=s.subarray(e,e+n+1))||(s=o[Pa.DATA])&&(o[Pa.DATA]=i===6?s:s.subarray(r*e,r*(e+n))),o}_sliceChildren(e,n,r){return e.map(i=>i.slice(n,r))}}pe.prototype.children=Object.freeze([]);class Gm extends Gt{visit(e){return this.getVisitFn(e.type).call(this,e)}visitNull(e){const{["type"]:n,["offset"]:r=0,["length"]:i=0}=e;return new pe(n,r,i,i)}visitBool(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.nullBitmap),s=me(n.ArrayType,e.data),{["length"]:o=s.length>>3,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new pe(n,r,o,a,[void 0,s,i])}visitInt(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.nullBitmap),s=me(n.ArrayType,e.data),{["length"]:o=s.length,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new pe(n,r,o,a,[void 0,s,i])}visitFloat(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.nullBitmap),s=me(n.ArrayType,e.data),{["length"]:o=s.length,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new pe(n,r,o,a,[void 0,s,i])}visitUtf8(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.data),s=Jt(e.nullBitmap),o=Ng(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new pe(n,r,a,u,[o,i,s])}visitLargeUtf8(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.data),s=Jt(e.nullBitmap),o=DD(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new pe(n,r,a,u,[o,i,s])}visitBinary(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.data),s=Jt(e.nullBitmap),o=Ng(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new pe(n,r,a,u,[o,i,s])}visitLargeBinary(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.data),s=Jt(e.nullBitmap),o=DD(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new pe(n,r,a,u,[o,i,s])}visitFixedSizeBinary(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.nullBitmap),s=me(n.ArrayType,e.data),{["length"]:o=s.length/za(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new pe(n,r,o,a,[void 0,s,i])}visitDate(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.nullBitmap),s=me(n.ArrayType,e.data),{["length"]:o=s.length/za(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new pe(n,r,o,a,[void 0,s,i])}visitTimestamp(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.nullBitmap),s=me(n.ArrayType,e.data),{["length"]:o=s.length/za(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new pe(n,r,o,a,[void 0,s,i])}visitTime(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.nullBitmap),s=me(n.ArrayType,e.data),{["length"]:o=s.length/za(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new pe(n,r,o,a,[void 0,s,i])}visitDecimal(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.nullBitmap),s=me(n.ArrayType,e.data),{["length"]:o=s.length/za(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new pe(n,r,o,a,[void 0,s,i])}visitList(e){const{["type"]:n,["offset"]:r=0,["child"]:i}=e,s=Jt(e.nullBitmap),o=Ng(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new pe(n,r,a,u,[o,void 0,s],[i])}visitStruct(e){const{["type"]:n,["offset"]:r=0,["children"]:i=[]}=e,s=Jt(e.nullBitmap),{length:o=i.reduce((u,{length:c})=>Math.max(u,c),0),nullCount:a=e.nullBitmap?-1:0}=e;return new pe(n,r,o,a,[void 0,void 0,s],i)}visitUnion(e){const{["type"]:n,["offset"]:r=0,["children"]:i=[]}=e,s=me(n.ArrayType,e.typeIds),{["length"]:o=s.length,["nullCount"]:a=-1}=e;if(mt.isSparseUnion(n))return new pe(n,r,o,a,[void 0,void 0,void 0,s],i);const u=Ng(e.valueOffsets);return new pe(n,r,o,a,[u,void 0,void 0,s],i)}visitDictionary(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.nullBitmap),s=me(n.indices.ArrayType,e.data),{["dictionary"]:o=new Ye([new Gm().visit({type:n.dictionary})])}=e,{["length"]:a=s.length,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new pe(n,r,a,u,[void 0,s,i],[],o)}visitInterval(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.nullBitmap),s=me(n.ArrayType,e.data),{["length"]:o=s.length/za(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new pe(n,r,o,a,[void 0,s,i])}visitDuration(e){const{["type"]:n,["offset"]:r=0}=e,i=Jt(e.nullBitmap),s=me(n.ArrayType,e.data),{["length"]:o=s.length,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new pe(n,r,o,a,[void 0,s,i])}visitFixedSizeList(e){const{["type"]:n,["offset"]:r=0,["child"]:i=new Gm().visit({type:n.valueType})}=e,s=Jt(e.nullBitmap),{["length"]:o=i.length/za(n),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new pe(n,r,o,a,[void 0,void 0,s],[i])}visitMap(e){const{["type"]:n,["offset"]:r=0,["child"]:i=new Gm().visit({type:n.childType})}=e,s=Jt(e.nullBitmap),o=Ng(e.valueOffsets),{["length"]:a=o.length-1,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new pe(n,r,a,u,[o,void 0,s],[i])}}const Edt=new Gm;function Yt(t){return Edt.visit(t)}class KD{constructor(e=0,n){this.numChunks=e,this.getChunkIterator=n,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const e=this.chunkIterator.next();if(!e.done)return e;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function Adt(t){return t.some(e=>e.nullable)}function gj(t){return t.reduce((e,n)=>e+n.nullCount,0)}function mj(t){return t.reduce((e,n,r)=>(e[r+1]=e[r]+n.length,e),new Uint32Array(t.length+1))}function yj(t,e,n,r){const i=[];for(let s=-1,o=t.length;++s<o;){const a=t[s],u=e[s],{length:c}=a;if(u>=r)break;if(n>=u+c)continue;if(u>=n&&u+c<=r){i.push(a);continue}const l=Math.max(0,n-u),f=Math.min(r-u,c);i.push(a.slice(l,f-l))}return i.length===0&&i.push(t[0].slice(0,0)),i}function tC(t,e,n,r){let i=0,s=0,o=e.length-1;do{if(i>=o-1)return n<e[o]?r(t,i,n-e[i]):null;s=i+Math.trunc((o-i)*.5),n<e[s]?o=s:i=s}while(i<o)}function eC(t,e){return t.getValid(e)}function fw(t){function e(n,r,i){return t(n[r],i)}return function(n){const r=this.data;return tC(r,this._offsets,n,e)}}function bj(t){let e;function n(r,i,s){return t(r[i],s,e)}return function(r,i){const s=this.data;e=i;const o=tC(s,this._offsets,r,n);return e=void 0,o}}function vj(t){let e;function n(r,i,s){let o=s,a=0,u=0;for(let c=i-1,l=r.length;++c<l;){const f=r[c];if(~(a=t(f,e,o)))return u+a;o=0,u+=f.length}return-1}return function(r,i){e=r;const s=this.data,o=typeof i!="number"?n(s,0,0):tC(s,this._offsets,i,n);return e=void 0,o}}class $t extends Gt{}function $dt(t,e){return e===null&&t.length>0?0:-1}function Tdt(t,e){const{nullBitmap:n}=t;if(!n||t.nullCount<=0)return-1;let r=0;for(const i of new ZM(n,t.offset+(e||0),t.length,n,pj)){if(!i)return r;++r}return-1}function Dt(t,e,n){if(e===void 0)return-1;if(e===null)switch(t.typeId){case O.Union:break;case O.Dictionary:break;default:return Tdt(t,n)}const r=ci.getVisitFn(t),i=qp(e);for(let s=(n||0)-1,o=t.length;++s<o;)if(i(r(t,s)))return s;return-1}function wj(t,e,n){const r=ci.getVisitFn(t),i=qp(e);for(let s=(n||0)-1,o=t.length;++s<o;)if(i(r(t,s)))return s;return-1}$t.prototype.visitNull=$dt;$t.prototype.visitBool=Dt;$t.prototype.visitInt=Dt;$t.prototype.visitInt8=Dt;$t.prototype.visitInt16=Dt;$t.prototype.visitInt32=Dt;$t.prototype.visitInt64=Dt;$t.prototype.visitUint8=Dt;$t.prototype.visitUint16=Dt;$t.prototype.visitUint32=Dt;$t.prototype.visitUint64=Dt;$t.prototype.visitFloat=Dt;$t.prototype.visitFloat16=Dt;$t.prototype.visitFloat32=Dt;$t.prototype.visitFloat64=Dt;$t.prototype.visitUtf8=Dt;$t.prototype.visitLargeUtf8=Dt;$t.prototype.visitBinary=Dt;$t.prototype.visitLargeBinary=Dt;$t.prototype.visitFixedSizeBinary=Dt;$t.prototype.visitDate=Dt;$t.prototype.visitDateDay=Dt;$t.prototype.visitDateMillisecond=Dt;$t.prototype.visitTimestamp=Dt;$t.prototype.visitTimestampSecond=Dt;$t.prototype.visitTimestampMillisecond=Dt;$t.prototype.visitTimestampMicrosecond=Dt;$t.prototype.visitTimestampNanosecond=Dt;$t.prototype.visitTime=Dt;$t.prototype.visitTimeSecond=Dt;$t.prototype.visitTimeMillisecond=Dt;$t.prototype.visitTimeMicrosecond=Dt;$t.prototype.visitTimeNanosecond=Dt;$t.prototype.visitDecimal=Dt;$t.prototype.visitList=Dt;$t.prototype.visitStruct=Dt;$t.prototype.visitUnion=Dt;$t.prototype.visitDenseUnion=wj;$t.prototype.visitSparseUnion=wj;$t.prototype.visitDictionary=Dt;$t.prototype.visitInterval=Dt;$t.prototype.visitIntervalDayTime=Dt;$t.prototype.visitIntervalYearMonth=Dt;$t.prototype.visitDuration=Dt;$t.prototype.visitDurationSecond=Dt;$t.prototype.visitDurationMillisecond=Dt;$t.prototype.visitDurationMicrosecond=Dt;$t.prototype.visitDurationNanosecond=Dt;$t.prototype.visitFixedSizeList=Dt;$t.prototype.visitMap=Dt;const dw=new $t;class Tt extends Gt{}function Ft(t){const{type:e}=t;if(t.nullCount===0&&t.stride===1&&(mt.isInt(e)&&e.bitWidth!==64||mt.isTime(e)&&e.bitWidth!==64||mt.isFloat(e)&&e.precision!==mr.HALF))return new KD(t.data.length,r=>{const i=t.data[r];return i.values.subarray(0,i.length)[Symbol.iterator]()});let n=0;return new KD(t.data.length,r=>{const s=t.data[r].length,o=t.slice(n,n+s);return n+=s,new kdt(o)})}class kdt{constructor(e){this.vector=e,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}Tt.prototype.visitNull=Ft;Tt.prototype.visitBool=Ft;Tt.prototype.visitInt=Ft;Tt.prototype.visitInt8=Ft;Tt.prototype.visitInt16=Ft;Tt.prototype.visitInt32=Ft;Tt.prototype.visitInt64=Ft;Tt.prototype.visitUint8=Ft;Tt.prototype.visitUint16=Ft;Tt.prototype.visitUint32=Ft;Tt.prototype.visitUint64=Ft;Tt.prototype.visitFloat=Ft;Tt.prototype.visitFloat16=Ft;Tt.prototype.visitFloat32=Ft;Tt.prototype.visitFloat64=Ft;Tt.prototype.visitUtf8=Ft;Tt.prototype.visitLargeUtf8=Ft;Tt.prototype.visitBinary=Ft;Tt.prototype.visitLargeBinary=Ft;Tt.prototype.visitFixedSizeBinary=Ft;Tt.prototype.visitDate=Ft;Tt.prototype.visitDateDay=Ft;Tt.prototype.visitDateMillisecond=Ft;Tt.prototype.visitTimestamp=Ft;Tt.prototype.visitTimestampSecond=Ft;Tt.prototype.visitTimestampMillisecond=Ft;Tt.prototype.visitTimestampMicrosecond=Ft;Tt.prototype.visitTimestampNanosecond=Ft;Tt.prototype.visitTime=Ft;Tt.prototype.visitTimeSecond=Ft;Tt.prototype.visitTimeMillisecond=Ft;Tt.prototype.visitTimeMicrosecond=Ft;Tt.prototype.visitTimeNanosecond=Ft;Tt.prototype.visitDecimal=Ft;Tt.prototype.visitList=Ft;Tt.prototype.visitStruct=Ft;Tt.prototype.visitUnion=Ft;Tt.prototype.visitDenseUnion=Ft;Tt.prototype.visitSparseUnion=Ft;Tt.prototype.visitDictionary=Ft;Tt.prototype.visitInterval=Ft;Tt.prototype.visitIntervalDayTime=Ft;Tt.prototype.visitIntervalYearMonth=Ft;Tt.prototype.visitDuration=Ft;Tt.prototype.visitDurationSecond=Ft;Tt.prototype.visitDurationMillisecond=Ft;Tt.prototype.visitDurationMicrosecond=Ft;Tt.prototype.visitDurationNanosecond=Ft;Tt.prototype.visitFixedSizeList=Ft;Tt.prototype.visitMap=Ft;const nC=new Tt;var xj;const _j={},Sj={};let Ye=class Ul{constructor(e){var n,r,i;const s=e[0]instanceof Ul?e.flatMap(a=>a.data):e;if(s.length===0||s.some(a=>!(a instanceof pe)))throw new TypeError("Vector constructor expects an Array of Data instances.");const o=(n=s[0])===null||n===void 0?void 0:n.type;switch(s.length){case 0:this._offsets=[0];break;case 1:{const{get:a,set:u,indexOf:c}=_j[o.typeId],l=s[0];this.isValid=f=>eC(l,f),this.get=f=>a(l,f),this.set=(f,d)=>u(l,f,d),this.indexOf=f=>c(l,f),this._offsets=[0,l.length];break}default:Object.setPrototypeOf(this,Sj[o.typeId]),this._offsets=mj(s);break}this.data=s,this.type=o,this.stride=za(o),this.numChildren=(i=(r=o.children)===null||r===void 0?void 0:r.length)!==null&&i!==void 0?i:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((e,n)=>e+n.byteLength,0)}get nullable(){return Adt(this.data)}get nullCount(){return gj(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${O[this.type.typeId]}Vector`}isValid(e){return!1}get(e){return null}at(e){return this.get(JM(e,this.length))}set(e,n){}indexOf(e,n){return-1}includes(e,n){return this.indexOf(e,n)>-1}[Symbol.iterator](){return nC.visit(this)}concat(...e){return new Ul(this.data.concat(e.flatMap(n=>n.data).flat(Number.POSITIVE_INFINITY)))}slice(e,n){return new Ul(hj(this,e,n,({data:r,_offsets:i},s,o)=>yj(r,i,s,o)))}toJSON(){return[...this]}toArray(){const{type:e,data:n,length:r,stride:i,ArrayType:s}=this;switch(e.typeId){case O.Int:case O.Float:case O.Decimal:case O.Time:case O.Timestamp:switch(n.length){case 0:return new s;case 1:return n[0].values.subarray(0,r*i);default:return n.reduce((o,{values:a,length:u})=>(o.array.set(a.subarray(0,u*i),o.offset),o.offset+=u*i,o),{array:new s(r*i),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(e){var n;return this.getChildAt((n=this.type.children)===null||n===void 0?void 0:n.findIndex(r=>r.name===e))}getChildAt(e){return e>-1&&e<this.numChildren?new Ul(this.data.map(({children:n})=>n[e])):null}get isMemoized(){return mt.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(mt.isDictionary(this.type)){const e=new hw(this.data[0].dictionary),n=this.data.map(r=>{const i=r.clone();return i.dictionary=e,i});return new Ul(n)}return new hw(this)}unmemoize(){if(mt.isDictionary(this.type)&&this.isMemoized){const e=this.data[0].dictionary.unmemoize(),n=this.data.map(r=>{const i=r.clone();return i.dictionary=e,i});return new Ul(n)}return this}};xj=Symbol.toStringTag;Ye[xj]=(t=>{t.type=mt.prototype,t.data=[],t.length=0,t.stride=1,t.numChildren=0,t._offsets=new Uint32Array([0]),t[Symbol.isConcatSpreadable]=!0;const e=Object.keys(O).map(n=>O[n]).filter(n=>typeof n=="number"&&n!==O.NONE);for(const n of e){const r=ci.getVisitFnByTypeId(n),i=cs.getVisitFnByTypeId(n),s=dw.getVisitFnByTypeId(n);_j[n]={get:r,set:i,indexOf:s},Sj[n]=Object.create(t,{isValid:{value:fw(eC)},get:{value:fw(ci.getVisitFnByTypeId(n))},set:{value:bj(cs.getVisitFnByTypeId(n))},indexOf:{value:vj(dw.getVisitFnByTypeId(n))}})}return"Vector"})(Ye.prototype);class hw extends Ye{constructor(e){super(e.data);const n=this.get,r=this.set,i=this.slice,s=new Array(this.length);Object.defineProperty(this,"get",{value(o){const a=s[o];if(a!==void 0)return a;const u=n.call(this,o);return s[o]=u,u}}),Object.defineProperty(this,"set",{value(o,a){r.call(this,o,a),s[o]=a}}),Object.defineProperty(this,"slice",{value:(o,a)=>new hw(i.call(this,o,a))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new Ye(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}class T3{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(e,n,r,i){return e.prep(8,24),e.writeInt64(BigInt(i??0)),e.pad(4),e.writeInt32(r),e.writeInt64(BigInt(n??0)),e.offset()}}class xi{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFooter(e,n){return(n||new xi).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFooter(e,n){return e.setPosition(e.position()+he),(n||new xi).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):un.V1}schema(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new vo).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}dictionaries(e,n){const r=this.bb.__offset(this.bb_pos,8);return r?(n||new T3).__init(this.bb.__vector(this.bb_pos+r)+e*24,this.bb):null}dictionariesLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}recordBatches(e,n){const r=this.bb.__offset(this.bb_pos,10);return r?(n||new T3).__init(this.bb.__vector(this.bb_pos+r)+e*24,this.bb):null}recordBatchesLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const r=this.bb.__offset(this.bb_pos,12);return r?(n||new yn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFooter(e){e.startObject(5)}static addVersion(e,n){e.addFieldInt16(0,n,un.V1)}static addSchema(e,n){e.addFieldOffset(1,n,0)}static addDictionaries(e,n){e.addFieldOffset(2,n,0)}static startDictionariesVector(e,n){e.startVector(24,n,8)}static addRecordBatches(e,n){e.addFieldOffset(3,n,0)}static startRecordBatchesVector(e,n){e.startVector(24,n,8)}static addCustomMetadata(e,n){e.addFieldOffset(4,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)e.addOffset(n[r]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endFooter(e){return e.endObject()}static finishFooterBuffer(e,n){e.finish(n)}static finishSizePrefixedFooterBuffer(e,n){e.finish(n,void 0,!0)}}class de{constructor(e=[],n,r,i=un.V5){this.fields=e||[],this.metadata=n||new Map,r||(r=M3(this.fields)),this.dictionaries=r,this.metadataVersion=i}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(e=>e.name)}toString(){return`Schema<{ ${this.fields.map((e,n)=>`${n}: ${e}`).join(", ")} }>`}select(e){const n=new Set(e),r=this.fields.filter(i=>n.has(i.name));return new de(r,this.metadata)}selectAt(e){const n=e.map(r=>this.fields[r]).filter(Boolean);return new de(n,this.metadata)}assign(...e){const n=e[0]instanceof de?e[0]:Array.isArray(e[0])?new de(e[0]):new de(e),r=[...this.fields],i=L1(L1(new Map,this.metadata),n.metadata),s=n.fields.filter(a=>{const u=r.findIndex(c=>c.name===a.name);return~u?(r[u]=a.clone({metadata:L1(L1(new Map,r[u].metadata),a.metadata)}))&&!1:!0}),o=M3(s,new Map);return new de([...r,...s],i,new Map([...this.dictionaries,...o]))}}de.prototype.fields=null;de.prototype.metadata=null;de.prototype.dictionaries=null;let nn=class k3{static new(...e){let[n,r,i,s]=e;return e[0]&&typeof e[0]=="object"&&({name:n}=e[0],r===void 0&&(r=e[0].type),i===void 0&&(i=e[0].nullable),s===void 0&&(s=e[0].metadata)),new k3(`${n}`,r,i,s)}constructor(e,n,r=!1,i){this.name=e,this.type=n,this.nullable=r,this.metadata=i||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...e){let[n,r,i,s]=e;return!e[0]||typeof e[0]!="object"?[n=this.name,r=this.type,i=this.nullable,s=this.metadata]=e:{name:n=this.name,type:r=this.type,nullable:i=this.nullable,metadata:s=this.metadata}=e[0],k3.new(n,r,i,s)}};nn.prototype.type=null;nn.prototype.name=null;nn.prototype.nullable=null;nn.prototype.metadata=null;function L1(t,e){return new Map([...t||new Map,...e||new Map])}function M3(t,e=new Map){for(let n=-1,r=t.length;++n<r;){const s=t[n].type;if(mt.isDictionary(s)){if(!e.has(s.id))e.set(s.id,s.dictionary);else if(e.get(s.id)!==s.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}s.children&&s.children.length>0&&M3(s.children,e)}return e}var Mdt=Yz,Cdt=qh;class b0{static decode(e){e=new Cdt(Jt(e));const n=xi.getRootAsFooter(e),r=de.decode(n.schema(),new Map,n.version());return new Idt(r,n)}static encode(e){const n=new Mdt,r=de.encode(n,e.schema);xi.startRecordBatchesVector(n,e.numRecordBatches);for(const o of[...e.recordBatches()].slice().reverse())Oc.encode(n,o);const i=n.endVector();xi.startDictionariesVector(n,e.numDictionaries);for(const o of[...e.dictionaryBatches()].slice().reverse())Oc.encode(n,o);const s=n.endVector();return xi.startFooter(n),xi.addSchema(n,r),xi.addVersion(n,un.V5),xi.addRecordBatches(n,i),xi.addDictionaries(n,s),xi.finishFooterBuffer(n,xi.endFooter(n)),n.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(e,n=un.V5,r,i){this.schema=e,this.version=n,r&&(this._recordBatches=r),i&&(this._dictionaryBatches=i)}*recordBatches(){for(let e,n=-1,r=this.numRecordBatches;++n<r;)(e=this.getRecordBatch(n))&&(yield e)}*dictionaryBatches(){for(let e,n=-1,r=this.numDictionaries;++n<r;)(e=this.getDictionaryBatch(n))&&(yield e)}getRecordBatch(e){return e>=0&&e<this.numRecordBatches&&this._recordBatches[e]||null}getDictionaryBatch(e){return e>=0&&e<this.numDictionaries&&this._dictionaryBatches[e]||null}}class Idt extends b0{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(e,n){super(e,n.version()),this._footer=n}getRecordBatch(e){if(e>=0&&e<this.numRecordBatches){const n=this._footer.recordBatches(e);if(n)return Oc.decode(n)}return null}getDictionaryBatch(e){if(e>=0&&e<this.numDictionaries){const n=this._footer.dictionaries(e);if(n)return Oc.decode(n)}return null}}class Oc{static decode(e){return new Oc(e.metaDataLength(),e.bodyLength(),e.offset())}static encode(e,n){const{metaDataLength:r}=n,i=BigInt(n.offset),s=BigInt(n.bodyLength);return T3.createBlock(e,i,r,s)}constructor(e,n,r){this.metaDataLength=e,this.offset=Ae(r),this.bodyLength=Ae(n)}}const He=Object.freeze({done:!0,value:void 0});class QD{constructor(e){this._json=e}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class rC{tee(){return this._getDOMStream().tee()}pipe(e,n){return this._getNodeStream().pipe(e,n)}pipeTo(e,n){return this._getDOMStream().pipeTo(e,n)}pipeThrough(e,n){return this._getDOMStream().pipeThrough(e,n)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class Fdt extends rC{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}get closed(){return this._closedPromise}cancel(e){return Lt(this,void 0,void 0,function*(){yield this.return(e)})}write(e){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(e):this.resolvers.shift().resolve({done:!1,value:e}))}abort(e){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:e}:this.resolvers.shift().reject({done:!0,value:e}))}close(){if(this._closedPromiseResolve){const{resolvers:e}=this;for(;e.length>0;)e.shift().resolve(He);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(e){return Yi.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,e)}toNodeStream(e){return Yi.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,e)}throw(e){return Lt(this,void 0,void 0,function*(){return yield this.abort(e),He})}return(e){return Lt(this,void 0,void 0,function*(){return yield this.close(),He})}read(e){return Lt(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return Lt(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(...e){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((n,r)=>{this.resolvers.push({resolve:n,reject:r})}):Promise.resolve(He)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class tv extends Fdt{write(e){if((e=Jt(e)).byteLength>0)return super.write(e)}toString(e=!1){return e?v3(this.toUint8Array(!0)):this.toUint8Array(!1).then(v3)}toUint8Array(e=!1){return e?Go(this._values)[0]:Lt(this,void 0,void 0,function*(){var n,r,i,s;const o=[];let a=0;try{for(var u=!0,c=cf(this),l;l=yield c.next(),n=l.done,!n;u=!0){s=l.value,u=!1;const f=s;o.push(f),a+=f.byteLength}}catch(f){r={error:f}}finally{try{!u&&!n&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}return Go(o,a)[0]})}}class pw{constructor(e){e&&(this.source=new Ndt(Yi.fromIterable(e)))}[Symbol.iterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class Gh{constructor(e){e instanceof Gh?this.source=e.source:e instanceof tv?this.source=new $l(Yi.fromAsyncIterable(e)):qz(e)?this.source=new $l(Yi.fromNodeStream(e)):GM(e)?this.source=new $l(Yi.fromDOMStream(e)):jz(e)?this.source=new $l(Yi.fromDOMStream(e.body)):gy(e)?this.source=new $l(Yi.fromIterable(e)):Af(e)?this.source=new $l(Yi.fromAsyncIterable(e)):jp(e)&&(this.source=new $l(Yi.fromAsyncIterable(e)))}[Symbol.asyncIterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}get closed(){return this.source.closed}cancel(e){return this.source.cancel(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class Ndt{constructor(e){this.source=e}cancel(e){this.return(e)}peek(e){return this.next(e,"peek").value}read(e){return this.next(e,"read").value}next(e,n="read"){return this.source.next({cmd:n,size:e})}throw(e){return Object.create(this.source.throw&&this.source.throw(e)||He)}return(e){return Object.create(this.source.return&&this.source.return(e)||He)}}class $l{constructor(e){this.source=e,this._closedPromise=new Promise(n=>this._closedPromiseResolve=n)}cancel(e){return Lt(this,void 0,void 0,function*(){yield this.return(e)})}get closed(){return this._closedPromise}read(e){return Lt(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return Lt(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(e){return Lt(this,arguments,void 0,function*(n,r="read"){return yield this.source.next({cmd:r,size:n})})}throw(e){return Lt(this,void 0,void 0,function*(){const n=this.source.throw&&(yield this.source.throw(e))||He;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}return(e){return Lt(this,void 0,void 0,function*(){const n=this.source.return&&(yield this.source.return(e))||He;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}}class JD extends pw{constructor(e,n){super(),this.position=0,this.buffer=Jt(e),this.size=n===void 0?this.buffer.byteLength:n}readInt32(e){const{buffer:n,byteOffset:r}=this.readAt(e,4);return new DataView(n,r).getInt32(0,!0)}seek(e){return this.position=Math.min(e,this.size),e<this.size}read(e){const{buffer:n,size:r,position:i}=this;return n&&i<r?(typeof e!="number"&&(e=Number.POSITIVE_INFINITY),this.position=Math.min(r,i+Math.min(r-i,e)),n.subarray(i,this.position)):null}readAt(e,n){const r=this.buffer,i=Math.min(this.size,e+n);return r?r.subarray(e,i):new Uint8Array(n)}close(){this.buffer&&(this.buffer=null)}throw(e){return this.close(),{done:!0,value:e}}return(e){return this.close(),{done:!0,value:e}}}class gw extends Gh{constructor(e,n){super(),this.position=0,this._handle=e,typeof n=="number"?this.size=n:this._pending=Lt(this,void 0,void 0,function*(){this.size=(yield e.stat()).size,delete this._pending})}readInt32(e){return Lt(this,void 0,void 0,function*(){const{buffer:n,byteOffset:r}=yield this.readAt(e,4);return new DataView(n,r).getInt32(0,!0)})}seek(e){return Lt(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(e,this.size),e<this.size})}read(e){return Lt(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:n,size:r,position:i}=this;if(n&&i<r){typeof e!="number"&&(e=Number.POSITIVE_INFINITY);let s=i,o=0,a=0;const u=Math.min(r,s+Math.min(r-s,e)),c=new Uint8Array(Math.max(0,(this.position=u)-s));for(;(s+=a)<u&&(o+=a)<c.byteLength;)({bytesRead:a}=yield n.read(c,o,c.byteLength-o,s));return c}return null})}readAt(e,n){return Lt(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:r,size:i}=this;if(r&&e+n<i){const s=Math.min(i,e+n),o=new Uint8Array(s-e);return(yield r.read(o,0,n,e)).buffer}return new Uint8Array(n)})}close(){return Lt(this,void 0,void 0,function*(){const e=this._handle;this._handle=null,e&&(yield e.close())})}throw(e){return Lt(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}return(e){return Lt(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}}const Odt=65536;function lh(t){return t<0&&(t=4294967295+t+1),`0x${t.toString(16)}`}const Yh=8,iC=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class Ej{constructor(e){this.buffer=e}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(e){const n=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),r=new Uint32Array([e.buffer[1]>>>16,e.buffer[1]&65535,e.buffer[0]>>>16,e.buffer[0]&65535]);let i=n[3]*r[3];this.buffer[0]=i&65535;let s=i>>>16;return i=n[2]*r[3],s+=i,i=n[3]*r[2]>>>0,s+=i,this.buffer[0]+=s<<16,this.buffer[1]=s>>>0<i?Odt:0,this.buffer[1]+=s>>>16,this.buffer[1]+=n[1]*r[3]+n[2]*r[2]+n[3]*r[1],this.buffer[1]+=n[0]*r[3]+n[1]*r[2]+n[2]*r[1]+n[3]*r[0]<<16,this}_plus(e){const n=this.buffer[0]+e.buffer[0]>>>0;this.buffer[1]+=e.buffer[1],n<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=n}lessThan(e){return this.buffer[1]<e.buffer[1]||this.buffer[1]===e.buffer[1]&&this.buffer[0]<e.buffer[0]}equals(e){return this.buffer[1]===e.buffer[1]&&this.buffer[0]==e.buffer[0]}greaterThan(e){return e.lessThan(this)}hex(){return`${lh(this.buffer[1])} ${lh(this.buffer[0])}`}}class ge extends Ej{times(e){return this._times(e),this}plus(e){return this._plus(e),this}static from(e,n=new Uint32Array(2)){return ge.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(2)){return ge.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(2)){const r=e.length,i=new ge(n);for(let s=0;s<r;){const o=Yh<r-s?Yh:r-s,a=new ge(new Uint32Array([Number.parseInt(e.slice(s,s+o),10),0])),u=new ge(new Uint32Array([iC[o],0]));i.times(u),i.plus(a),s+=o}return i}static convertArray(e){const n=new Uint32Array(e.length*2);for(let r=-1,i=e.length;++r<i;)ge.from(e[r],new Uint32Array(n.buffer,n.byteOffset+2*r*4,2));return n}static multiply(e,n){return new ge(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new ge(new Uint32Array(e.buffer)).plus(n)}}class Jr extends Ej{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(e){return this._times(e),this}plus(e){return this._plus(e),this}lessThan(e){const n=this.buffer[1]<<0,r=e.buffer[1]<<0;return n<r||n===r&&this.buffer[0]<e.buffer[0]}static from(e,n=new Uint32Array(2)){return Jr.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(2)){return Jr.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(2)){const r=e.startsWith("-"),i=e.length,s=new Jr(n);for(let o=r?1:0;o<i;){const a=Yh<i-o?Yh:i-o,u=new Jr(new Uint32Array([Number.parseInt(e.slice(o,o+a),10),0])),c=new Jr(new Uint32Array([iC[a],0]));s.times(c),s.plus(u),o+=a}return r?s.negate():s}static convertArray(e){const n=new Uint32Array(e.length*2);for(let r=-1,i=e.length;++r<i;)Jr.from(e[r],new Uint32Array(n.buffer,n.byteOffset+2*r*4,2));return n}static multiply(e,n){return new Jr(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new Jr(new Uint32Array(e.buffer)).plus(n)}}class wo{constructor(e){this.buffer=e}high(){return new Jr(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new Jr(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(e){const n=new ge(new Uint32Array([this.buffer[3],0])),r=new ge(new Uint32Array([this.buffer[2],0])),i=new ge(new Uint32Array([this.buffer[1],0])),s=new ge(new Uint32Array([this.buffer[0],0])),o=new ge(new Uint32Array([e.buffer[3],0])),a=new ge(new Uint32Array([e.buffer[2],0])),u=new ge(new Uint32Array([e.buffer[1],0])),c=new ge(new Uint32Array([e.buffer[0],0]));let l=ge.multiply(s,c);this.buffer[0]=l.low();const f=new ge(new Uint32Array([l.high(),0]));return l=ge.multiply(i,c),f.plus(l),l=ge.multiply(s,u),f.plus(l),this.buffer[1]=f.low(),this.buffer[3]=f.lessThan(l)?1:0,this.buffer[2]=f.high(),new ge(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(ge.multiply(r,c)).plus(ge.multiply(i,u)).plus(ge.multiply(s,a)),this.buffer[3]+=ge.multiply(n,c).plus(ge.multiply(r,u)).plus(ge.multiply(i,a)).plus(ge.multiply(s,o)).low(),this}plus(e){const n=new Uint32Array(4);return n[3]=this.buffer[3]+e.buffer[3]>>>0,n[2]=this.buffer[2]+e.buffer[2]>>>0,n[1]=this.buffer[1]+e.buffer[1]>>>0,n[0]=this.buffer[0]+e.buffer[0]>>>0,n[0]<this.buffer[0]>>>0&&++n[1],n[1]<this.buffer[1]>>>0&&++n[2],n[2]<this.buffer[2]>>>0&&++n[3],this.buffer[3]=n[3],this.buffer[2]=n[2],this.buffer[1]=n[1],this.buffer[0]=n[0],this}hex(){return`${lh(this.buffer[3])} ${lh(this.buffer[2])} ${lh(this.buffer[1])} ${lh(this.buffer[0])}`}static multiply(e,n){return new wo(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new wo(new Uint32Array(e.buffer)).plus(n)}static from(e,n=new Uint32Array(4)){return wo.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(4)){return wo.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(4)){const r=e.startsWith("-"),i=e.length,s=new wo(n);for(let o=r?1:0;o<i;){const a=Yh<i-o?Yh:i-o,u=new wo(new Uint32Array([Number.parseInt(e.slice(o,o+a),10),0,0,0])),c=new wo(new Uint32Array([iC[a],0,0,0]));s.times(c),s.plus(u),o+=a}return r?s.negate():s}static convertArray(e){const n=new Uint32Array(e.length*4);for(let r=-1,i=e.length;++r<i;)wo.from(e[r],new Uint32Array(n.buffer,n.byteOffset+4*4*r,4));return n}}class Aj extends Gt{constructor(e,n,r,i,s=un.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=e,this.nodes=n,this.buffers=r,this.dictionaries=i,this.metadataVersion=s}visit(e){return super.visit(e instanceof nn?e.type:e)}visitNull(e,{length:n}=this.nextFieldNode()){return Yt({type:e,length:n})}visitBool(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),data:this.readData(e)})}visitInt(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),data:this.readData(e)})}visitFloat(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),data:this.readData(e)})}visitUtf8(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeUtf8(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitBinary(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeBinary(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitFixedSizeBinary(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),data:this.readData(e)})}visitDate(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),data:this.readData(e)})}visitTimestamp(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),data:this.readData(e)})}visitTime(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),data:this.readData(e)})}visitDecimal(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),data:this.readData(e)})}visitList(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}visitStruct(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),children:this.visitMany(e.children)})}visitUnion(e,{length:n,nullCount:r}=this.nextFieldNode()){return this.metadataVersion<un.V5&&this.readNullBitmap(e,r),e.mode===Sr.Sparse?this.visitSparseUnion(e,{length:n,nullCount:r}):this.visitDenseUnion(e,{length:n,nullCount:r})}visitDenseUnion(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,typeIds:this.readTypeIds(e),valueOffsets:this.readOffsets(e),children:this.visitMany(e.children)})}visitSparseUnion(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,typeIds:this.readTypeIds(e),children:this.visitMany(e.children)})}visitDictionary(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),data:this.readData(e.indices),dictionary:this.readDictionary(e)})}visitInterval(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),data:this.readData(e)})}visitDuration(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),data:this.readData(e)})}visitFixedSizeList(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),child:this.visit(e.children[0])})}visitMap(e,{length:n,nullCount:r}=this.nextFieldNode()){return Yt({type:e,length:n,nullCount:r,nullBitmap:this.readNullBitmap(e,r),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(e,n,r=this.nextBufferRange()){return n>0&&this.readData(e,r)||new Uint8Array(0)}readOffsets(e,n){return this.readData(e,n)}readTypeIds(e,n){return this.readData(e,n)}readData(e,{length:n,offset:r}=this.nextBufferRange()){return this.bytes.subarray(r,r+n)}readDictionary(e){return this.dictionaries.get(e.id)}}class Rdt extends Aj{constructor(e,n,r,i,s){super(new Uint8Array(0),n,r,i,s),this.sources=e}readNullBitmap(e,n,{offset:r}=this.nextBufferRange()){return n<=0?new Uint8Array(0):lw(this.sources[r])}readOffsets(e,{offset:n}=this.nextBufferRange()){return me(Uint8Array,me(e.OffsetArrayType,this.sources[n]))}readTypeIds(e,{offset:n}=this.nextBufferRange()){return me(Uint8Array,me(e.ArrayType,this.sources[n]))}readData(e,{offset:n}=this.nextBufferRange()){const{sources:r}=this;return mt.isTimestamp(e)||(mt.isInt(e)||mt.isTime(e))&&e.bitWidth===64||mt.isDuration(e)||mt.isDate(e)&&e.unit===us.MILLISECOND?me(Uint8Array,Jr.convertArray(r[n])):mt.isDecimal(e)?me(Uint8Array,wo.convertArray(r[n])):mt.isBinary(e)||mt.isLargeBinary(e)||mt.isFixedSizeBinary(e)?Ddt(r[n]):mt.isBool(e)?lw(r[n]):mt.isUtf8(e)||mt.isLargeUtf8(e)?VM(r[n].join("")):me(Uint8Array,me(e.ArrayType,r[n].map(i=>+i)))}}function Ddt(t){const e=t.join(""),n=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)n[r>>1]=Number.parseInt(e.slice(r,r+2),16);return n}class kt extends Gt{compareSchemas(e,n){return e===n||n instanceof e.constructor&&this.compareManyFields(e.fields,n.fields)}compareManyFields(e,n){return e===n||Array.isArray(e)&&Array.isArray(n)&&e.length===n.length&&e.every((r,i)=>this.compareFields(r,n[i]))}compareFields(e,n){return e===n||n instanceof e.constructor&&e.name===n.name&&e.nullable===n.nullable&&this.visit(e.type,n.type)}}function Yr(t,e){return e instanceof t.constructor}function nd(t,e){return t===e||Yr(t,e)}function $u(t,e){return t===e||Yr(t,e)&&t.bitWidth===e.bitWidth&&t.isSigned===e.isSigned}function I2(t,e){return t===e||Yr(t,e)&&t.precision===e.precision}function Ldt(t,e){return t===e||Yr(t,e)&&t.byteWidth===e.byteWidth}function sC(t,e){return t===e||Yr(t,e)&&t.unit===e.unit}function my(t,e){return t===e||Yr(t,e)&&t.unit===e.unit&&t.timezone===e.timezone}function yy(t,e){return t===e||Yr(t,e)&&t.unit===e.unit&&t.bitWidth===e.bitWidth}function Bdt(t,e){return t===e||Yr(t,e)&&t.children.length===e.children.length&&Rc.compareManyFields(t.children,e.children)}function Pdt(t,e){return t===e||Yr(t,e)&&t.children.length===e.children.length&&Rc.compareManyFields(t.children,e.children)}function oC(t,e){return t===e||Yr(t,e)&&t.mode===e.mode&&t.typeIds.every((n,r)=>n===e.typeIds[r])&&Rc.compareManyFields(t.children,e.children)}function zdt(t,e){return t===e||Yr(t,e)&&t.id===e.id&&t.isOrdered===e.isOrdered&&Rc.visit(t.indices,e.indices)&&Rc.visit(t.dictionary,e.dictionary)}function aC(t,e){return t===e||Yr(t,e)&&t.unit===e.unit}function by(t,e){return t===e||Yr(t,e)&&t.unit===e.unit}function Udt(t,e){return t===e||Yr(t,e)&&t.listSize===e.listSize&&t.children.length===e.children.length&&Rc.compareManyFields(t.children,e.children)}function jdt(t,e){return t===e||Yr(t,e)&&t.keysSorted===e.keysSorted&&t.children.length===e.children.length&&Rc.compareManyFields(t.children,e.children)}kt.prototype.visitNull=nd;kt.prototype.visitBool=nd;kt.prototype.visitInt=$u;kt.prototype.visitInt8=$u;kt.prototype.visitInt16=$u;kt.prototype.visitInt32=$u;kt.prototype.visitInt64=$u;kt.prototype.visitUint8=$u;kt.prototype.visitUint16=$u;kt.prototype.visitUint32=$u;kt.prototype.visitUint64=$u;kt.prototype.visitFloat=I2;kt.prototype.visitFloat16=I2;kt.prototype.visitFloat32=I2;kt.prototype.visitFloat64=I2;kt.prototype.visitUtf8=nd;kt.prototype.visitLargeUtf8=nd;kt.prototype.visitBinary=nd;kt.prototype.visitLargeBinary=nd;kt.prototype.visitFixedSizeBinary=Ldt;kt.prototype.visitDate=sC;kt.prototype.visitDateDay=sC;kt.prototype.visitDateMillisecond=sC;kt.prototype.visitTimestamp=my;kt.prototype.visitTimestampSecond=my;kt.prototype.visitTimestampMillisecond=my;kt.prototype.visitTimestampMicrosecond=my;kt.prototype.visitTimestampNanosecond=my;kt.prototype.visitTime=yy;kt.prototype.visitTimeSecond=yy;kt.prototype.visitTimeMillisecond=yy;kt.prototype.visitTimeMicrosecond=yy;kt.prototype.visitTimeNanosecond=yy;kt.prototype.visitDecimal=nd;kt.prototype.visitList=Bdt;kt.prototype.visitStruct=Pdt;kt.prototype.visitUnion=oC;kt.prototype.visitDenseUnion=oC;kt.prototype.visitSparseUnion=oC;kt.prototype.visitDictionary=zdt;kt.prototype.visitInterval=aC;kt.prototype.visitIntervalDayTime=aC;kt.prototype.visitIntervalYearMonth=aC;kt.prototype.visitDuration=by;kt.prototype.visitDurationSecond=by;kt.prototype.visitDurationMillisecond=by;kt.prototype.visitDurationMicrosecond=by;kt.prototype.visitDurationNanosecond=by;kt.prototype.visitFixedSizeList=Udt;kt.prototype.visitMap=jdt;const Rc=new kt;function C3(t,e){return Rc.compareSchemas(t,e)}function LE(t,e){return qdt(t,e.map(n=>n.data.concat()))}function qdt(t,e){const n=[...t.fields],r=[],i={numBatches:e.reduce((f,d)=>Math.max(f,d.length),0)};let s=0,o=0,a=-1;const u=e.length;let c,l=[];for(;i.numBatches-- >0;){for(o=Number.POSITIVE_INFINITY,a=-1;++a<u;)l[a]=c=e[a].shift(),o=Math.min(o,c?c.length:o);Number.isFinite(o)&&(l=Wdt(n,o,l,e,i),o>0&&(r[s++]=Yt({type:new Or(n),length:o,nullCount:0,children:l.slice()})))}return[t=t.assign(n),r.map(f=>new ei(t,f))]}function Wdt(t,e,n,r,i){var s;const o=(e+63&-64)>>3;for(let a=-1,u=r.length;++a<u;){const c=n[a],l=c==null?void 0:c.length;if(l>=e)l===e?n[a]=c:(n[a]=c.slice(0,e),i.numBatches=Math.max(i.numBatches,r[a].unshift(c.slice(e,l-e))));else{const f=t[a];t[a]=f.clone({nullable:!0}),n[a]=(s=c==null?void 0:c._changeLengthAndBackfillNullBitmap(e))!==null&&s!==void 0?s:Yt({type:f.type,length:e,nullCount:e,nullBitmap:new Uint8Array(o)})}}return n}var $j;class Cr{constructor(...e){var n,r;if(e.length===0)return this.batches=[],this.schema=new de([]),this._offsets=[0],this;let i,s;e[0]instanceof de&&(i=e.shift()),e.at(-1)instanceof Uint32Array&&(s=e.pop());const o=u=>{if(u){if(u instanceof ei)return[u];if(u instanceof Cr)return u.batches;if(u instanceof pe){if(u.type instanceof Or)return[new ei(new de(u.type.children),u)]}else{if(Array.isArray(u))return u.flatMap(c=>o(c));if(typeof u[Symbol.iterator]=="function")return[...u].flatMap(c=>o(c));if(typeof u=="object"){const c=Object.keys(u),l=c.map(h=>new Ye([u[h]])),f=i??new de(c.map((h,p)=>new nn(String(h),l[p].type,l[p].nullable))),[,d]=LE(f,l);return d.length===0?[new ei(u)]:d}}}return[]},a=e.flatMap(u=>o(u));if(i=(r=i??((n=a[0])===null||n===void 0?void 0:n.schema))!==null&&r!==void 0?r:new de([]),!(i instanceof de))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const u of a){if(!(u instanceof ei))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!C3(i,u.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=i,this.batches=a,this._offsets=s??mj(this.data)}get data(){return this.batches.map(({data:e})=>e)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((e,n)=>e+n.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=gj(this.data)),this._nullCount}isValid(e){return!1}get(e){return null}at(e){return this.get(JM(e,this.numRows))}set(e,n){}indexOf(e,n){return-1}[Symbol.iterator](){return this.batches.length>0?nC.visit(new Ye(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...e){const n=this.schema,r=this.data.concat(e.flatMap(({data:i})=>i));return new Cr(n,r.map(i=>new ei(n,i)))}slice(e,n){const r=this.schema;[e,n]=hj({length:this.numRows},e,n);const i=yj(this.data,this._offsets,e,n);return new Cr(r,i.map(s=>new ei(r,s)))}getChild(e){return this.getChildAt(this.schema.fields.findIndex(n=>n.name===e))}getChildAt(e){if(e>-1&&e<this.schema.fields.length){const n=this.data.map(r=>r.children[e]);if(n.length===0){const{type:r}=this.schema.fields[e],i=Yt({type:r,length:0,nullCount:0});n.push(i._changeLengthAndBackfillNullBitmap(this.numRows))}return new Ye(n)}return null}setChild(e,n){var r;return this.setChildAt((r=this.schema.fields)===null||r===void 0?void 0:r.findIndex(i=>i.name===e),n)}setChildAt(e,n){let r=this.schema,i=[...this.batches];if(e>-1&&e<this.numCols){n||(n=new Ye([Yt({type:new Nc,length:this.numRows})]));const s=r.fields.slice(),o=s[e].clone({type:n.type}),a=this.schema.fields.map((u,c)=>this.getChildAt(c));[s[e],a[e]]=[o,n],[r,i]=LE(r,a)}return new Cr(r,i)}select(e){const n=this.schema.fields.reduce((r,i,s)=>r.set(i.name,s),new Map);return this.selectAt(e.map(r=>n.get(r)).filter(r=>r>-1))}selectAt(e){const n=this.schema.selectAt(e),r=this.batches.map(i=>i.selectAt(e));return new Cr(n,r)}assign(e){const n=this.schema.fields,[r,i]=e.schema.fields.reduce((a,u,c)=>{const[l,f]=a,d=n.findIndex(h=>h.name===u.name);return~d?f[d]=c:l.push(c),a},[[],[]]),s=this.schema.assign(e.schema),o=[...n.map((a,u)=>[u,i[u]]).map(([a,u])=>u===void 0?this.getChildAt(a):e.getChildAt(u)),...r.map(a=>e.getChildAt(a))].filter(Boolean);return new Cr(...LE(s,o))}}$j=Symbol.toStringTag;Cr[$j]=(t=>(t.schema=null,t.batches=[],t._offsets=new Uint32Array([0]),t._nullCount=-1,t[Symbol.isConcatSpreadable]=!0,t.isValid=fw(eC),t.get=fw(ci.getVisitFn(O.Struct)),t.set=bj(cs.getVisitFn(O.Struct)),t.indexOf=vj(dw.getVisitFn(O.Struct)),"Table"))(Cr.prototype);var Tj;let ei=class bm{constructor(...e){switch(e.length){case 2:{if([this.schema]=e,!(this.schema instanceof de))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=Yt({nullCount:0,type:new Or(this.schema.fields),children:this.schema.fields.map(n=>Yt({type:n.type,nullCount:0}))})]=e,!(this.data instanceof pe))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=ZD(this.schema,this.data.children);break}case 1:{const[n]=e,{fields:r,children:i,length:s}=Object.keys(n).reduce((u,c,l)=>(u.children[l]=n[c],u.length=Math.max(u.length,n[c].length),u.fields[l]=nn.new({name:c,type:n[c].type,nullable:!0}),u),{length:0,fields:new Array,children:new Array}),o=new de(r),a=Yt({type:new Or(r),length:s,children:i,nullCount:0});[this.schema,this.data]=ZD(o,a.children,s);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=kj(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(e){return this.data.getValid(e)}get(e){return ci.visit(this.data,e)}at(e){return this.get(JM(e,this.numRows))}set(e,n){return cs.visit(this.data,e,n)}indexOf(e,n){return dw.visit(this.data,e,n)}[Symbol.iterator](){return nC.visit(new Ye([this.data]))}toArray(){return[...this]}concat(...e){return new Cr(this.schema,[this,...e])}slice(e,n){const[r]=new Ye([this.data]).slice(e,n).data;return new bm(this.schema,r)}getChild(e){var n;return this.getChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(r=>r.name===e))}getChildAt(e){return e>-1&&e<this.schema.fields.length?new Ye([this.data.children[e]]):null}setChild(e,n){var r;return this.setChildAt((r=this.schema.fields)===null||r===void 0?void 0:r.findIndex(i=>i.name===e),n)}setChildAt(e,n){let r=this.schema,i=this.data;if(e>-1&&e<this.numCols){n||(n=new Ye([Yt({type:new Nc,length:this.numRows})]));const s=r.fields.slice(),o=i.children.slice(),a=s[e].clone({type:n.type});[s[e],o[e]]=[a,n.data[0]],r=new de(s,new Map(this.schema.metadata)),i=Yt({type:new Or(s),children:o})}return new bm(r,i)}select(e){const n=this.schema.select(e),r=new Or(n.fields),i=[];for(const s of e){const o=this.schema.fields.findIndex(a=>a.name===s);~o&&(i[o]=this.data.children[o])}return new bm(n,Yt({type:r,length:this.numRows,children:i}))}selectAt(e){const n=this.schema.selectAt(e),r=e.map(s=>this.data.children[s]).filter(Boolean),i=Yt({type:new Or(n.fields),length:this.numRows,children:r});return new bm(n,i)}};Tj=Symbol.toStringTag;ei[Tj]=(t=>(t._nullCount=-1,t[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(ei.prototype);function ZD(t,e,n=e.reduce((r,i)=>Math.max(r,i.length),0)){var r;const i=[...t.fields],s=[...e],o=(n+63&-64)>>3;for(const[a,u]of t.fields.entries()){const c=e[a];(!c||c.length!==n)&&(i[a]=u.clone({nullable:!0}),s[a]=(r=c==null?void 0:c._changeLengthAndBackfillNullBitmap(n))!==null&&r!==void 0?r:Yt({type:u.type,length:n,nullCount:n,nullBitmap:new Uint8Array(o)}))}return[t.assign(i),Yt({type:new Or(i),length:n,children:s})]}function kj(t,e,n=new Map){var r,i;if(((r=t==null?void 0:t.length)!==null&&r!==void 0?r:0)>0&&(t==null?void 0:t.length)===(e==null?void 0:e.length))for(let s=-1,o=t.length;++s<o;){const{type:a}=t[s],u=e[s];for(const c of[u,...((i=u==null?void 0:u.dictionary)===null||i===void 0?void 0:i.data)||[]])kj(a.children,c==null?void 0:c.children,n);if(mt.isDictionary(a)){const{id:c}=a;if(!n.has(c))u!=null&&u.dictionary&&n.set(c,u.dictionary);else if(n.get(c)!==u.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return n}class uC extends ei{constructor(e){const n=e.fields.map(i=>Yt({type:i.type})),r=Yt({type:new Or(e.fields),nullCount:0,children:n});super(e,r)}}let qu=class yo{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsMessage(e,n){return(n||new yo).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMessage(e,n){return e.setPosition(e.position()+he),(n||new yo).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):un.V1}headerType(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):se.NONE}header(e){const n=this.bb.__offset(this.bb_pos,8);return n?this.bb.__union(e,this.bb_pos+n):null}bodyLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}customMetadata(e,n){const r=this.bb.__offset(this.bb_pos,12);return r?(n||new yn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startMessage(e){e.startObject(5)}static addVersion(e,n){e.addFieldInt16(0,n,un.V1)}static addHeaderType(e,n){e.addFieldInt8(1,n,se.NONE)}static addHeader(e,n){e.addFieldOffset(2,n,0)}static addBodyLength(e,n){e.addFieldInt64(3,n,BigInt("0"))}static addCustomMetadata(e,n){e.addFieldOffset(4,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)e.addOffset(n[r]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endMessage(e){return e.endObject()}static finishMessageBuffer(e,n){e.finish(n)}static finishSizePrefixedMessageBuffer(e,n){e.finish(n,void 0,!0)}static createMessage(e,n,r,i,s,o){return yo.startMessage(e),yo.addVersion(e,n),yo.addHeaderType(e,r),yo.addHeader(e,i),yo.addBodyLength(e,s),yo.addCustomMetadata(e,o),yo.endMessage(e)}};class Vdt extends Gt{visit(e,n){return e==null||n==null?void 0:super.visit(e,n)}visitNull(e,n){return WD.startNull(n),WD.endNull(n)}visitInt(e,n){return Si.startInt(n),Si.addBitWidth(n,e.bitWidth),Si.addIsSigned(n,e.isSigned),Si.endInt(n)}visitFloat(e,n){return ko.startFloatingPoint(n),ko.addPrecision(n,e.precision),ko.endFloatingPoint(n)}visitBinary(e,n){return PD.startBinary(n),PD.endBinary(n)}visitLargeBinary(e,n){return UD.startLargeBinary(n),UD.endLargeBinary(n)}visitBool(e,n){return zD.startBool(n),zD.endBool(n)}visitUtf8(e,n){return VD.startUtf8(n),VD.endUtf8(n)}visitLargeUtf8(e,n){return jD.startLargeUtf8(n),jD.endLargeUtf8(n)}visitDecimal(e,n){return Qd.startDecimal(n),Qd.addScale(n,e.scale),Qd.addPrecision(n,e.precision),Qd.addBitWidth(n,e.bitWidth),Qd.endDecimal(n)}visitDate(e,n){return Hb.startDate(n),Hb.addUnit(n,e.unit),Hb.endDate(n)}visitTime(e,n){return mm.startTime(n),mm.addUnit(n,e.unit),mm.addBitWidth(n,e.bitWidth),mm.endTime(n)}visitTimestamp(e,n){const r=e.timezone&&n.createString(e.timezone)||void 0;return Xi.startTimestamp(n),Xi.addUnit(n,e.unit),r!==void 0&&Xi.addTimezone(n,r),Xi.endTimestamp(n)}visitInterval(e,n){return Mo.startInterval(n),Mo.addUnit(n,e.unit),Mo.endInterval(n)}visitDuration(e,n){return Xb.startDuration(n),Xb.addUnit(n,e.unit),Xb.endDuration(n)}visitList(e,n){return qD.startList(n),qD.endList(n)}visitStruct(e,n){return tf.startStruct_(n),tf.endStruct_(n)}visitUnion(e,n){Pl.startTypeIdsVector(n,e.typeIds.length);const r=Pl.createTypeIdsVector(n,e.typeIds);return Pl.startUnion(n),Pl.addMode(n,e.mode),Pl.addTypeIds(n,r),Pl.endUnion(n)}visitDictionary(e,n){const r=this.visit(e.indices,n);return Ha.startDictionaryEncoding(n),Ha.addId(n,BigInt(e.id)),Ha.addIsOrdered(n,e.isOrdered),r!==void 0&&Ha.addIndexType(n,r),Ha.endDictionaryEncoding(n)}visitFixedSizeBinary(e,n){return Kb.startFixedSizeBinary(n),Kb.addByteWidth(n,e.byteWidth),Kb.endFixedSizeBinary(n)}visitFixedSizeList(e,n){return Qb.startFixedSizeList(n),Qb.addListSize(n,e.listSize),Qb.endFixedSizeList(n)}visitMap(e,n){return Jb.startMap(n),Jb.addKeysSorted(n,e.keysSorted),Jb.endMap(n)}}const BE=new Vdt;function Gdt(t,e=new Map){return new de(Hdt(t,e),ev(t.metadata),e)}function Mj(t){return new Oi(t.count,Cj(t.columns),Ij(t.columns))}function Ydt(t){return new Ho(Mj(t.data),t.id,t.isDelta)}function Hdt(t,e){return(t.fields||[]).filter(Boolean).map(n=>nn.fromJSON(n,e))}function t5(t,e){return(t.children||[]).filter(Boolean).map(n=>nn.fromJSON(n,e))}function Cj(t){return(t||[]).reduce((e,n)=>[...e,new Dc(n.count,Xdt(n.VALIDITY)),...Cj(n.children)],[])}function Ij(t,e=[]){for(let n=-1,r=(t||[]).length;++n<r;){const i=t[n];i.VALIDITY&&e.push(new Do(e.length,i.VALIDITY.length)),i.TYPE_ID&&e.push(new Do(e.length,i.TYPE_ID.length)),i.OFFSET&&e.push(new Do(e.length,i.OFFSET.length)),i.DATA&&e.push(new Do(e.length,i.DATA.length)),e=Ij(i.children,e)}return e}function Xdt(t){return(t||[]).reduce((e,n)=>e+ +(n===0),0)}function Kdt(t,e){let n,r,i,s,o,a;return!e||!(s=t.dictionary)?(o=n5(t,t5(t,e)),i=new nn(t.name,o,t.nullable,ev(t.metadata))):e.has(n=s.id)?(r=(r=s.indexType)?e5(r):new y0,a=new Vh(e.get(n),r,n,s.isOrdered),i=new nn(t.name,a,t.nullable,ev(t.metadata))):(r=(r=s.indexType)?e5(r):new y0,e.set(n,o=n5(t,t5(t,e))),a=new Vh(o,r,n,s.isOrdered),i=new nn(t.name,a,t.nullable,ev(t.metadata))),i||null}function ev(t=[]){return new Map(t.map(({key:e,value:n})=>[e,n]))}function e5(t){return new $f(t.isSigned,t.bitWidth)}function n5(t,e){const n=t.type.name;switch(n){case"NONE":return new Nc;case"null":return new Nc;case"binary":return new Yv;case"largebinary":return new Hv;case"utf8":return new Xv;case"largeutf8":return new Kv;case"bool":return new Qv;case"list":return new iw((e||[])[0]);case"struct":return new Or(e||[]);case"struct_":return new Or(e||[])}switch(n){case"int":{const r=t.type;return new $f(r.isSigned,r.bitWidth)}case"floatingpoint":{const r=t.type;return new Gv(mr[r.precision])}case"decimal":{const r=t.type;return new Jv(r.scale,r.precision,r.bitWidth)}case"date":{const r=t.type;return new Zv(us[r.unit])}case"time":{const r=t.type;return new tw(Mt[r.unit],r.bitWidth)}case"timestamp":{const r=t.type;return new ew(Mt[r.unit],r.timezone)}case"interval":{const r=t.type;return new nw(Yo[r.unit])}case"duration":{const r=t.type;return new rw(Mt[r.unit])}case"union":{const r=t.type,[i,...s]=(r.mode+"").toLowerCase(),o=i.toUpperCase()+s.join("");return new sw(Sr[o],r.typeIds||[],e||[])}case"fixedsizebinary":{const r=t.type;return new ow(r.byteWidth)}case"fixedsizelist":{const r=t.type;return new aw(r.listSize,(e||[])[0])}case"map":{const r=t.type;return new uw((e||[])[0],r.keysSorted)}}throw new Error(`Unrecognized type: "${n}"`)}var Qdt=Yz,Jdt=qh;class Rr{static fromJSON(e,n){const r=new Rr(0,un.V5,n);return r._createHeader=Zdt(e,n),r}static decode(e){e=new Jdt(Jt(e));const n=qu.getRootAsMessage(e),r=n.bodyLength(),i=n.version(),s=n.headerType(),o=new Rr(r,i,s);return o._createHeader=tht(n,s),o}static encode(e){const n=new Qdt;let r=-1;return e.isSchema()?r=de.encode(n,e.header()):e.isRecordBatch()?r=Oi.encode(n,e.header()):e.isDictionaryBatch()&&(r=Ho.encode(n,e.header())),qu.startMessage(n),qu.addVersion(n,un.V5),qu.addHeader(n,r),qu.addHeaderType(n,e.headerType),qu.addBodyLength(n,BigInt(e.bodyLength)),qu.finishMessageBuffer(n,qu.endMessage(n)),n.asUint8Array()}static from(e,n=0){if(e instanceof de)return new Rr(0,un.V5,se.Schema,e);if(e instanceof Oi)return new Rr(n,un.V5,se.RecordBatch,e);if(e instanceof Ho)return new Rr(n,un.V5,se.DictionaryBatch,e);throw new Error(`Unrecognized Message header: ${e}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===se.Schema}isRecordBatch(){return this.headerType===se.RecordBatch}isDictionaryBatch(){return this.headerType===se.DictionaryBatch}constructor(e,n,r,i){this._version=n,this._headerType=r,this.body=new Uint8Array(0),i&&(this._createHeader=()=>i),this._bodyLength=Ae(e)}}class Oi{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(e,n,r){this._nodes=n,this._buffers=r,this._length=Ae(e)}}class Ho{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(e,n,r=!1){this._data=e,this._isDelta=r,this._id=Ae(n)}}class Do{constructor(e,n){this.offset=Ae(e),this.length=Ae(n)}}class Dc{constructor(e,n){this.length=Ae(e),this.nullCount=Ae(n)}}function Zdt(t,e){return()=>{switch(e){case se.Schema:return de.fromJSON(t);case se.RecordBatch:return Oi.fromJSON(t);case se.DictionaryBatch:return Ho.fromJSON(t)}throw new Error(`Unrecognized Message type: { name: ${se[e]}, type: ${e} }`)}}function tht(t,e){return()=>{switch(e){case se.Schema:return de.decode(t.header(new vo),new Map,t.version());case se.RecordBatch:return Oi.decode(t.header(new Ba),t.version());case se.DictionaryBatch:return Ho.decode(t.header(new Xd),t.version())}throw new Error(`Unrecognized Message type: { name: ${se[e]}, type: ${e} }`)}}nn.encode=fht;nn.decode=cht;nn.fromJSON=Kdt;de.encode=lht;de.decode=eht;de.fromJSON=Gdt;Oi.encode=dht;Oi.decode=nht;Oi.fromJSON=Mj;Ho.encode=hht;Ho.decode=rht;Ho.fromJSON=Ydt;Dc.encode=pht;Dc.decode=sht;Do.encode=ght;Do.decode=iht;function eht(t,e=new Map,n=un.V5){const r=uht(t,e);return new de(r,nv(t),e,n)}function nht(t,e=un.V5){if(t.compression()!==null)throw new Error("Record batch compression not implemented");return new Oi(t.length(),oht(t),aht(t,e))}function rht(t,e=un.V5){return new Ho(Oi.decode(t.data(),e),t.id(),t.isDelta())}function iht(t){return new Do(t.offset(),t.length())}function sht(t){return new Dc(t.length(),t.nullCount())}function oht(t){const e=[];for(let n,r=-1,i=-1,s=t.nodesLength();++r<s;)(n=t.nodes(r))&&(e[++i]=Dc.decode(n));return e}function aht(t,e){const n=[];for(let r,i=-1,s=-1,o=t.buffersLength();++i<o;)(r=t.buffers(i))&&(e<un.V4&&(r.bb_pos+=8*(i+1)),n[++s]=Do.decode(r));return n}function uht(t,e){const n=[];for(let r,i=-1,s=-1,o=t.fieldsLength();++i<o;)(r=t.fields(i))&&(n[++s]=nn.decode(r,e));return n}function r5(t,e){const n=[];for(let r,i=-1,s=-1,o=t.childrenLength();++i<o;)(r=t.children(i))&&(n[++s]=nn.decode(r,e));return n}function cht(t,e){let n,r,i,s,o,a;return!e||!(a=t.dictionary())?(i=s5(t,r5(t,e)),r=new nn(t.name(),i,t.nullable(),nv(t))):e.has(n=Ae(a.id()))?(s=(s=a.indexType())?i5(s):new y0,o=new Vh(e.get(n),s,n,a.isOrdered()),r=new nn(t.name(),o,t.nullable(),nv(t))):(s=(s=a.indexType())?i5(s):new y0,e.set(n,i=s5(t,r5(t,e))),o=new Vh(i,s,n,a.isOrdered()),r=new nn(t.name(),o,t.nullable(),nv(t))),r||null}function nv(t){const e=new Map;if(t)for(let n,r,i=-1,s=Math.trunc(t.customMetadataLength());++i<s;)(n=t.customMetadata(i))&&(r=n.key())!=null&&e.set(r,n.value());return e}function i5(t){return new $f(t.isSigned(),t.bitWidth())}function s5(t,e){const n=t.typeType();switch(n){case Ie.NONE:return new Nc;case Ie.Null:return new Nc;case Ie.Binary:return new Yv;case Ie.LargeBinary:return new Hv;case Ie.Utf8:return new Xv;case Ie.LargeUtf8:return new Kv;case Ie.Bool:return new Qv;case Ie.List:return new iw((e||[])[0]);case Ie.Struct_:return new Or(e||[])}switch(n){case Ie.Int:{const r=t.type(new Si);return new $f(r.isSigned(),r.bitWidth())}case Ie.FloatingPoint:{const r=t.type(new ko);return new Gv(r.precision())}case Ie.Decimal:{const r=t.type(new Qd);return new Jv(r.scale(),r.precision(),r.bitWidth())}case Ie.Date:{const r=t.type(new Hb);return new Zv(r.unit())}case Ie.Time:{const r=t.type(new mm);return new tw(r.unit(),r.bitWidth())}case Ie.Timestamp:{const r=t.type(new Xi);return new ew(r.unit(),r.timezone())}case Ie.Interval:{const r=t.type(new Mo);return new nw(r.unit())}case Ie.Duration:{const r=t.type(new Xb);return new rw(r.unit())}case Ie.Union:{const r=t.type(new Pl);return new sw(r.mode(),r.typeIdsArray()||[],e||[])}case Ie.FixedSizeBinary:{const r=t.type(new Kb);return new ow(r.byteWidth())}case Ie.FixedSizeList:{const r=t.type(new Qb);return new aw(r.listSize(),(e||[])[0])}case Ie.Map:{const r=t.type(new Jb);return new uw((e||[])[0],r.keysSorted())}}throw new Error(`Unrecognized type: "${Ie[n]}" (${n})`)}function lht(t,e){const n=e.fields.map(s=>nn.encode(t,s));vo.startFieldsVector(t,n.length);const r=vo.createFieldsVector(t,n),i=e.metadata&&e.metadata.size>0?vo.createCustomMetadataVector(t,[...e.metadata].map(([s,o])=>{const a=t.createString(`${s}`),u=t.createString(`${o}`);return yn.startKeyValue(t),yn.addKey(t,a),yn.addValue(t,u),yn.endKeyValue(t)})):-1;return vo.startSchema(t),vo.addFields(t,r),vo.addEndianness(t,mht?Wh.Little:Wh.Big),i!==-1&&vo.addCustomMetadata(t,i),vo.endSchema(t)}function fht(t,e){let n=-1,r=-1,i=-1;const s=e.type;let o=e.typeId;mt.isDictionary(s)?(o=s.dictionary.typeId,i=BE.visit(s,t),r=BE.visit(s.dictionary,t)):r=BE.visit(s,t);const a=(s.children||[]).map(l=>nn.encode(t,l)),u=Vi.createChildrenVector(t,a),c=e.metadata&&e.metadata.size>0?Vi.createCustomMetadataVector(t,[...e.metadata].map(([l,f])=>{const d=t.createString(`${l}`),h=t.createString(`${f}`);return yn.startKeyValue(t),yn.addKey(t,d),yn.addValue(t,h),yn.endKeyValue(t)})):-1;return e.name&&(n=t.createString(e.name)),Vi.startField(t),Vi.addType(t,r),Vi.addTypeType(t,o),Vi.addChildren(t,u),Vi.addNullable(t,!!e.nullable),n!==-1&&Vi.addName(t,n),i!==-1&&Vi.addDictionary(t,i),c!==-1&&Vi.addCustomMetadata(t,c),Vi.endField(t)}function dht(t,e){const n=e.nodes||[],r=e.buffers||[];Ba.startNodesVector(t,n.length);for(const o of n.slice().reverse())Dc.encode(t,o);const i=t.endVector();Ba.startBuffersVector(t,r.length);for(const o of r.slice().reverse())Do.encode(t,o);const s=t.endVector();return Ba.startRecordBatch(t),Ba.addLength(t,BigInt(e.length)),Ba.addNodes(t,i),Ba.addBuffers(t,s),Ba.endRecordBatch(t)}function hht(t,e){const n=Oi.encode(t,e.data);return Xd.startDictionaryBatch(t),Xd.addId(t,BigInt(e.id)),Xd.addIsDelta(t,e.isDelta),Xd.addData(t,n),Xd.endDictionaryBatch(t)}function pht(t,e){return Kz.createFieldNode(t,BigInt(e.length),BigInt(e.nullCount))}function ght(t,e){return Xz.createBuffer(t,BigInt(e.offset),BigInt(e.length))}const mht=(()=>{const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),new Int16Array(t)[0]===256})(),cC=t=>`Expected ${se[t]} Message in stream, but was null or length 0.`,lC=t=>`Header pointer of flatbuffer-encoded ${se[t]} Message is null or length 0.`,Fj=(t,e)=>`Expected to read ${t} metadata bytes, but only read ${e}.`,Nj=(t,e)=>`Expected to read ${t} bytes for message body, but only read ${e}.`;class Oj{constructor(e){this.source=e instanceof pw?e:new pw(e)}[Symbol.iterator](){return this}next(){let e;return(e=this.readMetadataLength()).done||e.value===-1&&(e=this.readMetadataLength()).done||(e=this.readMetadata(e.value)).done?He:e}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}readMessage(e){let n;if((n=this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(cC(e));return n.value}readMessageBody(e){if(e<=0)return new Uint8Array(0);const n=Jt(this.source.read(e));if(n.byteLength<e)throw new Error(Nj(e,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()}readSchema(e=!1){const n=se.Schema,r=this.readMessage(n),i=r==null?void 0:r.header();if(e&&!i)throw new Error(lC(n));return i}readMetadataLength(){const e=this.source.read(F2),n=e&&new qh(e),r=(n==null?void 0:n.readInt32(0))||0;return{done:r===0,value:r}}readMetadata(e){const n=this.source.read(e);if(!n)return He;if(n.byteLength<e)throw new Error(Fj(e,n.byteLength));return{done:!1,value:Rr.decode(n)}}}class yht{constructor(e,n){this.source=e instanceof Gh?e:Uz(e)?new gw(e,n):new Gh(e)}[Symbol.asyncIterator](){return this}next(){return Lt(this,void 0,void 0,function*(){let e;return(e=yield this.readMetadataLength()).done||e.value===-1&&(e=yield this.readMetadataLength()).done||(e=yield this.readMetadata(e.value)).done?He:e})}throw(e){return Lt(this,void 0,void 0,function*(){return yield this.source.throw(e)})}return(e){return Lt(this,void 0,void 0,function*(){return yield this.source.return(e)})}readMessage(e){return Lt(this,void 0,void 0,function*(){let n;if((n=yield this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(cC(e));return n.value})}readMessageBody(e){return Lt(this,void 0,void 0,function*(){if(e<=0)return new Uint8Array(0);const n=Jt(yield this.source.read(e));if(n.byteLength<e)throw new Error(Nj(e,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()})}readSchema(){return Lt(this,arguments,void 0,function*(e=!1){const n=se.Schema,r=yield this.readMessage(n),i=r==null?void 0:r.header();if(e&&!i)throw new Error(lC(n));return i})}readMetadataLength(){return Lt(this,void 0,void 0,function*(){const e=yield this.source.read(F2),n=e&&new qh(e),r=(n==null?void 0:n.readInt32(0))||0;return{done:r===0,value:r}})}readMetadata(e){return Lt(this,void 0,void 0,function*(){const n=yield this.source.read(e);if(!n)return He;if(n.byteLength<e)throw new Error(Fj(e,n.byteLength));return{done:!1,value:Rr.decode(n)}})}}class bht extends Oj{constructor(e){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=e instanceof QD?e:new QD(e)}next(){const{_json:e}=this;if(!this._schema)return this._schema=!0,{done:!1,value:Rr.fromJSON(e.schema,se.Schema)};if(this._dictionaryIndex<e.dictionaries.length){const n=e.dictionaries[this._dictionaryIndex++];return this._body=n.data.columns,{done:!1,value:Rr.fromJSON(n,se.DictionaryBatch)}}if(this._batchIndex<e.batches.length){const n=e.batches[this._batchIndex++];return this._body=n.columns,{done:!1,value:Rr.fromJSON(n,se.RecordBatch)}}return this._body=[],He}readMessageBody(e){return n(this._body);function n(r){return(r||[]).reduce((i,s)=>[...i,...s.VALIDITY&&[s.VALIDITY]||[],...s.TYPE_ID&&[s.TYPE_ID]||[],...s.OFFSET&&[s.OFFSET]||[],...s.DATA&&[s.DATA]||[],...n(s.children)],[])}}readMessage(e){let n;if((n=this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(cC(e));return n.value}readSchema(){const e=se.Schema,n=this.readMessage(e),r=n==null?void 0:n.header();if(!n||!r)throw new Error(lC(e));return r}}const F2=4,I3="ARROW1",v0=new Uint8Array(I3.length);for(let t=0;t<I3.length;t+=1)v0[t]=I3.codePointAt(t);function fC(t,e=0){for(let n=-1,r=v0.length;++n<r;)if(v0[n]!==t[e+n])return!1;return!0}const vy=v0.length,Rj=vy+F2,vht=vy*2+F2;class rs extends rC{constructor(e){super(),this._impl=e}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(e){return this._impl.throw(e)}return(e){return this._impl.return(e)}cancel(){return this._impl.cancel()}reset(e){return this._impl.reset(e),this._DOMStream=void 0,this._nodeStream=void 0,this}open(e){const n=this._impl.open(e);return Af(n)?n.then(()=>this):this}readRecordBatch(e){return this._impl.isFile()?this._impl.readRecordBatch(e):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return Yi.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return Yi.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,n){throw new Error('"throughDOM" not available in this environment')}static from(e){return e instanceof rs?e:w3(e)?Sht(e):Uz(e)?$ht(e):Af(e)?Lt(this,void 0,void 0,function*(){return yield rs.from(yield e)}):jz(e)||GM(e)||qz(e)||jp(e)?Aht(new Gh(e)):Eht(new pw(e))}static readAll(e){return e instanceof rs?e.isSync()?o5(e):a5(e):w3(e)||ArrayBuffer.isView(e)||gy(e)||zz(e)?o5(e):a5(e)}}class mw extends rs{constructor(e){super(e),this._impl=e}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return Ro(this,arguments,function*(){yield Ut(yield*Yb(cf(this[Symbol.iterator]())))})}}class yw extends rs{constructor(e){super(e),this._impl=e}readAll(){return Lt(this,void 0,void 0,function*(){var e,n,r,i;const s=new Array;try{for(var o=!0,a=cf(this),u;u=yield a.next(),e=u.done,!e;o=!0){i=u.value,o=!1;const c=i;s.push(c)}}catch(c){n={error:c}}finally{try{!o&&!e&&(r=a.return)&&(yield r.call(a))}finally{if(n)throw n.error}}return s})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class Dj extends mw{constructor(e){super(e),this._impl=e}}class wht extends yw{constructor(e){super(e),this._impl=e}}class Lj{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(e=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=e}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(e){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=e,this.dictionaries=new Map,this}_loadRecordBatch(e,n){const r=this._loadVectors(e,n,this.schema.fields),i=Yt({type:new Or(this.schema.fields),length:e.length,children:r});return new ei(this.schema,i)}_loadDictionaryBatch(e,n){const{id:r,isDelta:i}=e,{dictionaries:s,schema:o}=this,a=s.get(r),u=o.dictionaries.get(r),c=this._loadVectors(e.data,n,[u]);return(a&&i?a.concat(new Ye(c)):new Ye(c)).memoize()}_loadVectors(e,n,r){return new Aj(n,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(r)}}class bw extends Lj{constructor(e,n){super(n),this._reader=w3(e)?new bht(this._handle=e):new Oj(this._handle=e)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(e){return this.closed||(this.autoDestroy=Pj(this,e),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(e):He}return(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(e):He}next(){if(this.closed)return He;let e;const{_reader:n}=this;for(;e=this._readNextMessageAndValidate();)if(e.isSchema())this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const r=e.header(),i=n.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(r,i)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const r=e.header(),i=n.readMessageBody(e.bodyLength),s=this._loadDictionaryBatch(r,i);this.dictionaries.set(r.id,s)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new uC(this.schema)}):this.return()}_readNextMessageAndValidate(e){return this._reader.readMessage(e)}}class vw extends Lj{constructor(e,n){super(n),this._reader=new yht(this._handle=e)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return Lt(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(e){return Lt(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=Pj(this,e),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(e){return Lt(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(e):He})}return(e){return Lt(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(e):He})}next(){return Lt(this,void 0,void 0,function*(){if(this.closed)return He;let e;const{_reader:n}=this;for(;e=yield this._readNextMessageAndValidate();)if(e.isSchema())yield this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const r=e.header(),i=yield n.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(r,i)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const r=e.header(),i=yield n.readMessageBody(e.bodyLength),s=this._loadDictionaryBatch(r,i);this.dictionaries.set(r.id,s)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new uC(this.schema)}):yield this.return()})}_readNextMessageAndValidate(e){return Lt(this,void 0,void 0,function*(){return yield this._reader.readMessage(e)})}}class Bj extends bw{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,n){super(e instanceof JD?e:new JD(e),n)}isSync(){return!0}isFile(){return!0}open(e){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const n of this._footer.dictionaryBatches())n&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(e)}readRecordBatch(e){var n;if(this.closed)return null;this._footer||this.open();const r=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(e);if(r&&this._handle.seek(r.offset)){const i=this._reader.readMessage(se.RecordBatch);if(i!=null&&i.isRecordBatch()){const s=i.header(),o=this._reader.readMessageBody(i.bodyLength);return this._loadRecordBatch(s,o)}}return null}_readDictionaryBatch(e){var n;const r=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(e);if(r&&this._handle.seek(r.offset)){const i=this._reader.readMessage(se.DictionaryBatch);if(i!=null&&i.isDictionaryBatch()){const s=i.header(),o=this._reader.readMessageBody(i.bodyLength),a=this._loadDictionaryBatch(s,o);this.dictionaries.set(s.id,a)}}}_readFooter(){const{_handle:e}=this,n=e.size-Rj,r=e.readInt32(n),i=e.readAt(n-r,r);return b0.decode(i)}_readNextMessageAndValidate(e){var n;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const r=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(this._recordBatchIndex);if(r&&this._handle.seek(r.offset))return this._reader.readMessage(e)}return null}}class xht extends vw{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,...n){const r=typeof n[0]!="number"?n.shift():void 0,i=n[0]instanceof Map?n.shift():void 0;super(e instanceof gw?e:new gw(e,r),i)}isFile(){return!0}isAsync(){return!0}open(e){const n=Object.create(null,{open:{get:()=>super.open}});return Lt(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const r of this._footer.dictionaryBatches())r&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield n.open.call(this,e)})}readRecordBatch(e){return Lt(this,void 0,void 0,function*(){var n;if(this.closed)return null;this._footer||(yield this.open());const r=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(e);if(r&&(yield this._handle.seek(r.offset))){const i=yield this._reader.readMessage(se.RecordBatch);if(i!=null&&i.isRecordBatch()){const s=i.header(),o=yield this._reader.readMessageBody(i.bodyLength);return this._loadRecordBatch(s,o)}}return null})}_readDictionaryBatch(e){return Lt(this,void 0,void 0,function*(){var n;const r=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(e);if(r&&(yield this._handle.seek(r.offset))){const i=yield this._reader.readMessage(se.DictionaryBatch);if(i!=null&&i.isDictionaryBatch()){const s=i.header(),o=yield this._reader.readMessageBody(i.bodyLength),a=this._loadDictionaryBatch(s,o);this.dictionaries.set(s.id,a)}}})}_readFooter(){return Lt(this,void 0,void 0,function*(){const{_handle:e}=this;e._pending&&(yield e._pending);const n=e.size-Rj,r=yield e.readInt32(n),i=yield e.readAt(n-r,r);return b0.decode(i)})}_readNextMessageAndValidate(e){return Lt(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const n=this._footer.getRecordBatch(this._recordBatchIndex);if(n&&(yield this._handle.seek(n.offset)))return yield this._reader.readMessage(e)}return null})}}class _ht extends bw{constructor(e,n){super(e,n)}_loadVectors(e,n,r){return new Rdt(n,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(r)}}function Pj(t,e){return e&&typeof e.autoDestroy=="boolean"?e.autoDestroy:t.autoDestroy}function*o5(t){const e=rs.from(t);try{if(!e.open({autoDestroy:!1}).closed)do yield e;while(!e.reset().open().closed)}finally{e.cancel()}}function a5(t){return Ro(this,arguments,function*(){const n=yield Ut(rs.from(t));try{if(!(yield Ut(n.open({autoDestroy:!1}))).closed)do yield yield Ut(n);while(!(yield Ut(n.reset().open())).closed)}finally{yield Ut(n.cancel())}})}function Sht(t){return new mw(new _ht(t))}function Eht(t){const e=t.peek(vy+7&-8);return e&&e.byteLength>=4?fC(e)?new Dj(new Bj(t.read())):new mw(new bw(t)):new mw(new bw(function*(){}()))}function Aht(t){return Lt(this,void 0,void 0,function*(){const e=yield t.peek(vy+7&-8);return e&&e.byteLength>=4?fC(e)?new Dj(new Bj(yield t.read())):new yw(new vw(t)):new yw(new vw(function(){return Ro(this,arguments,function*(){})}()))})}function $ht(t){return Lt(this,void 0,void 0,function*(){const{size:e}=yield t.stat(),n=new gw(t,e);return e>=vht&&fC(yield n.readAt(0,vy+7&-8))?new wht(new xht(n)):new yw(new vw(n))})}class Qe extends Gt{static assemble(...e){const n=i=>i.flatMap(s=>Array.isArray(s)?n(s):s instanceof ei?s.data.children:s.data),r=new Qe;return r.visitMany(n(e)),r}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(e){if(e instanceof Ye)return this.visitMany(e.data),this;const{type:n}=e;if(!mt.isDictionary(n)){const{length:r}=e;if(r>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(mt.isUnion(n))this.nodes.push(new Dc(r,0));else{const{nullCount:i}=e;mt.isNull(n)||Us.call(this,i<=0?new Uint8Array(0):cw(e.offset,r,e.nullBitmap)),this.nodes.push(new Dc(r,i))}}return super.visit(e)}visitNull(e){return this}visitDictionary(e){return this.visit(e.clone(e.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}}function Us(t){const e=t.byteLength+7&-8;return this.buffers.push(t),this.bufferRegions.push(new Do(this._byteLength,e)),this._byteLength+=e,this}function Tht(t){var e;const{type:n,length:r,typeIds:i,valueOffsets:s}=t;if(Us.call(this,i),n.mode===Sr.Sparse)return F3.call(this,t);if(n.mode===Sr.Dense){if(t.offset<=0)return Us.call(this,s),F3.call(this,t);{const o=new Int32Array(r),a=Object.create(null),u=Object.create(null);for(let c,l,f=-1;++f<r;)(c=i[f])!==void 0&&((l=a[c])===void 0&&(l=a[c]=s[f]),o[f]=s[f]-l,u[c]=((e=u[c])!==null&&e!==void 0?e:0)+1);Us.call(this,o),this.visitMany(t.children.map((c,l)=>{const f=n.typeIds[l],d=a[f],h=u[f];return c.slice(d,Math.min(r,h))}))}}return this}function kht(t){let e;return t.nullCount>=t.length?Us.call(this,new Uint8Array(0)):(e=t.values)instanceof Uint8Array?Us.call(this,cw(t.offset,t.length,e)):Us.call(this,lw(t.values))}function Tu(t){return Us.call(this,t.values.subarray(0,t.length*t.stride))}function N2(t){const{length:e,values:n,valueOffsets:r}=t,i=Ae(r[0]),s=Ae(r[e]),o=Math.min(s-i,n.byteLength-i);return Us.call(this,Vz(-i,e+1,r)),Us.call(this,n.subarray(i,i+o)),this}function dC(t){const{length:e,valueOffsets:n}=t;if(n){const{[0]:r,[e]:i}=n;return Us.call(this,Vz(-r,e+1,n)),this.visit(t.children[0].slice(r,i-r))}return this.visit(t.children[0])}function F3(t){return this.visitMany(t.type.children.map((e,n)=>t.children[n]).filter(Boolean))[0]}Qe.prototype.visitBool=kht;Qe.prototype.visitInt=Tu;Qe.prototype.visitFloat=Tu;Qe.prototype.visitUtf8=N2;Qe.prototype.visitLargeUtf8=N2;Qe.prototype.visitBinary=N2;Qe.prototype.visitLargeBinary=N2;Qe.prototype.visitFixedSizeBinary=Tu;Qe.prototype.visitDate=Tu;Qe.prototype.visitTimestamp=Tu;Qe.prototype.visitTime=Tu;Qe.prototype.visitDecimal=Tu;Qe.prototype.visitList=dC;Qe.prototype.visitStruct=F3;Qe.prototype.visitUnion=Tht;Qe.prototype.visitInterval=Tu;Qe.prototype.visitDuration=Tu;Qe.prototype.visitFixedSizeList=dC;Qe.prototype.visitMap=dC;class zj extends rC{static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,n){throw new Error('"throughDOM" not available in this environment')}constructor(e){super(),this._position=0,this._started=!1,this._sink=new tv,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,ui(e)||(e={autoDestroy:!0,writeLegacyIpcFormat:!1}),this._autoDestroy=typeof e.autoDestroy=="boolean"?e.autoDestroy:!0,this._writeLegacyIpcFormat=typeof e.writeLegacyIpcFormat=="boolean"?e.writeLegacyIpcFormat:!1}toString(e=!1){return this._sink.toString(e)}toUint8Array(e=!1){return this._sink.toUint8Array(e)}writeAll(e){return Af(e)?e.then(n=>this.writeAll(n)):jp(e)?mC(this,e):gC(this,e)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(e){return this._sink.toDOMStream(e)}toNodeStream(e){return this._sink.toNodeStream(e)}close(){return this.reset()._sink.close()}abort(e){return this.reset()._sink.abort(e)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(e=this._sink,n=null){return e===this._sink||e instanceof tv?this._sink=e:(this._sink=new tv,e&&sft(e)?this.toDOMStream({type:"bytes"}).pipeTo(e):e&&oft(e)&&this.toNodeStream({objectMode:!1}).pipe(e)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,(!n||!C3(n,this._schema))&&(n==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=n,this._writeSchema(n))),this}write(e){let n=null;if(this._sink){if(e==null)return this.finish()&&void 0;if(e instanceof Cr&&!(n=e.schema))return this.finish()&&void 0;if(e instanceof ei&&!(n=e.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(n&&!C3(n,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,n)}e instanceof ei?e instanceof uC||this._writeRecordBatch(e):e instanceof Cr?this.writeAll(e.batches):gy(e)&&this.writeAll(e)}_writeMessage(e,n=8){const r=n-1,i=Rr.encode(e),s=i.byteLength,o=this._writeLegacyIpcFormat?4:8,a=s+o+r&~r,u=a-s-o;return e.headerType===se.RecordBatch?this._recordBatchBlocks.push(new Oc(a,e.bodyLength,this._position)):e.headerType===se.DictionaryBatch&&this._dictionaryBlocks.push(new Oc(a,e.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(a-o)),s>0&&this._write(i),this._writePadding(u)}_write(e){if(this._started){const n=Jt(e);n&&n.byteLength>0&&(this._sink.write(n),this._position+=n.byteLength)}return this}_writeSchema(e){return this._writeMessage(Rr.from(e))}_writeFooter(e){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(v0)}_writePadding(e){return e>0?this._write(new Uint8Array(e)):this}_writeRecordBatch(e){const{byteLength:n,nodes:r,bufferRegions:i,buffers:s}=Qe.assemble(e),o=new Oi(e.numRows,r,i),a=Rr.from(o,n);return this._writeDictionaries(e)._writeMessage(a)._writeBodyBuffers(s)}_writeDictionaryBatch(e,n,r=!1){const{byteLength:i,nodes:s,bufferRegions:o,buffers:a}=Qe.assemble(new Ye([e])),u=new Oi(e.length,s,o),c=new Ho(u,n,r),l=Rr.from(c,i);return this._writeMessage(l)._writeBodyBuffers(a)}_writeBodyBuffers(e){let n,r,i;for(let s=-1,o=e.length;++s<o;)(n=e[s])&&(r=n.byteLength)>0&&(this._write(n),(i=(r+7&-8)-r)>0&&this._writePadding(i));return this}_writeDictionaries(e){var n,r;for(const[i,s]of e.dictionaries){const o=(n=s==null?void 0:s.data)!==null&&n!==void 0?n:[],a=this._seenDictionaries.get(i),u=(r=this._dictionaryDeltaOffsets.get(i))!==null&&r!==void 0?r:0;if(!a||a.data[0]!==o[0])for(const[c,l]of o.entries())this._writeDictionaryBatch(l,i,c>0);else if(u<o.length)for(const c of o.slice(u))this._writeDictionaryBatch(c,i,!0);this._seenDictionaries.set(i,s),this._dictionaryDeltaOffsets.set(i,o.length)}return this}}class hC extends zj{static writeAll(e,n){const r=new hC(n);return Af(e)?e.then(i=>r.writeAll(i)):jp(e)?mC(r,e):gC(r,e)}}class pC extends zj{static writeAll(e){const n=new pC;return Af(e)?e.then(r=>n.writeAll(r)):jp(e)?mC(n,e):gC(n,e)}constructor(){super(),this._autoDestroy=!0}_writeSchema(e){return this._writeMagic()._writePadding(2)}_writeDictionaryBatch(e,n,r=!1){if(!r&&this._seenDictionaries.has(n))throw new Error("The Arrow File format does not support replacement dictionaries. ");return super._writeDictionaryBatch(e,n,r)}_writeFooter(e){const n=b0.encode(new b0(e,un.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(e)._write(n)._write(Int32Array.of(n.byteLength))._writeMagic()}}function gC(t,e){let n=e;e instanceof Cr&&(n=e.batches,t.reset(void 0,e.schema));for(const r of n)t.write(r);return t.finish()}function mC(t,e){return Lt(this,void 0,void 0,function*(){var n,r,i,s,o,a,u;try{for(n=!0,r=cf(e);i=yield r.next(),s=i.done,!s;n=!0){u=i.value,n=!1;const c=u;t.write(c)}}catch(c){o={error:c}}finally{try{!n&&!s&&(a=r.return)&&(yield a.call(r))}finally{if(o)throw o.error}}return t.finish()})}function Mht(t,e="stream"){return(e==="stream"?hC:pC).writeAll(t).toUint8Array(!0)}var Cht=Object.create,Uj=Object.defineProperty,Iht=Object.getOwnPropertyDescriptor,Fht=Object.getOwnPropertyNames,Nht=Object.getPrototypeOf,Oht=Object.prototype.hasOwnProperty,Rht=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Dht=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Fht(e))!Oht.call(t,i)&&i!==n&&Uj(t,i,{get:()=>e[i],enumerable:!(r=Iht(e,i))||r.enumerable});return t},Lht=(t,e,n)=>(n=t!=null?Cht(Nht(t)):{},Dht(!t||!t.__esModule?Uj(n,"default",{value:t,enumerable:!0}):n,t)),Bht=Rht((t,e)=>{e.exports=Worker}),Pht=(t=>(t[t.UNDEFINED=0]="UNDEFINED",t[t.AUTOMATIC=1]="AUTOMATIC",t[t.READ_ONLY=2]="READ_ONLY",t[t.READ_WRITE=3]="READ_WRITE",t))(Pht||{}),zht=(t=>(t[t.IDENTIFIER=0]="IDENTIFIER",t[t.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",t[t.STRING_CONSTANT=2]="STRING_CONSTANT",t[t.OPERATOR=3]="OPERATOR",t[t.KEYWORD=4]="KEYWORD",t[t.COMMENT=5]="COMMENT",t))(zht||{}),Uht=(t=>(t[t.NONE=0]="NONE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARNING=3]="WARNING",t[t.ERROR=4]="ERROR",t))(Uht||{}),jht=(t=>(t[t.NONE=0]="NONE",t[t.CONNECT=1]="CONNECT",t[t.DISCONNECT=2]="DISCONNECT",t[t.OPEN=3]="OPEN",t[t.QUERY=4]="QUERY",t[t.INSTANTIATE=5]="INSTANTIATE",t))(jht||{}),qht=(t=>(t[t.NONE=0]="NONE",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR",t[t.START=3]="START",t[t.RUN=4]="RUN",t[t.CAPTURE=5]="CAPTURE",t))(qht||{}),Wht=(t=>(t[t.NONE=0]="NONE",t[t.WEB_WORKER=1]="WEB_WORKER",t[t.NODE_WORKER=2]="NODE_WORKER",t[t.BINDINGS=3]="BINDINGS",t[t.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",t))(Wht||{}),Vht=class{log(e){}},Ght=class{constructor(t=2){this.level=t}log(t){t.level>=this.level&&console.log(t)}},Yht=(t=>(t[t.SUCCESS=0]="SUCCESS",t))(Yht||{}),Hht=class{constructor(e,n){this._bindings=e,this._conn=n}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(e){return e(this._bindings,this._conn)}async query(e){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let n=await this._bindings.runQuery(this._conn,e),r=rs.from(n);return console.assert(r.isSync(),"Reader is not sync"),console.assert(r.isFile(),"Reader is not file"),new Cr(r)}async send(e){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let n=await this._bindings.startPendingQuery(this._conn,e);for(;n==null;)n=await this._bindings.pollPendingQuery(this._conn);let r=new jj(this._bindings,this._conn,n),i=await rs.from(r);return console.assert(i.isAsync()),console.assert(i.isStream()),i}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(e){return await this._bindings.getTableNames(this._conn,e)}async prepare(e){let n=await this._bindings.createPrepared(this._conn,e);return new Xht(this._bindings,this._conn,n)}async insertArrowTable(e,n){let r=Mht(e,"stream");await this.insertArrowFromIPCStream(r,n)}async insertArrowFromIPCStream(e,n){await this._bindings.insertArrowFromIPCStream(this._conn,e,n)}async insertCSVFromPath(e,n){await this._bindings.insertCSVFromPath(this._conn,e,n)}async insertJSONFromPath(e,n){await this._bindings.insertJSONFromPath(this._conn,e,n)}},jj=class{constructor(t,e,n){this.db=t,this.conn=e,this.header=n,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let t;return this._inFlight!=null?(t=await this._inFlight,this._inFlight=null):t=await this.db.fetchQueryResults(this.conn),this._depleted=t.length==0,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:t}}[Symbol.asyncIterator](){return this}},Xht=class{constructor(e,n,r){this.bindings=e,this.connectionId=n,this.statementId=r}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...e){let n=await this.bindings.runPrepared(this.connectionId,this.statementId,e),r=rs.from(n);return console.assert(r.isSync()),console.assert(r.isFile()),new Cr(r)}async send(...e){let n=await this.bindings.sendPrepared(this.connectionId,this.statementId,e),r=new jj(this.bindings,this.connectionId,n),i=await rs.from(r);return console.assert(i.isAsync()),console.assert(i.isStream()),i}},Kht=(t=>(t.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",t.CLOSE_PREPARED="CLOSE_PREPARED",t.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",t.CONNECT="CONNECT",t.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",t.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",t.CREATE_PREPARED="CREATE_PREPARED",t.DISCONNECT="DISCONNECT",t.DROP_FILE="DROP_FILE",t.DROP_FILES="DROP_FILES",t.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",t.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",t.FLUSH_FILES="FLUSH_FILES",t.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",t.GET_TABLE_NAMES="GET_TABLE_NAMES",t.GET_VERSION="GET_VERSION",t.GLOB_FILE_INFOS="GLOB_FILE_INFOS",t.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",t.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",t.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",t.INSTANTIATE="INSTANTIATE",t.OPEN="OPEN",t.PING="PING",t.POLL_PENDING_QUERY="POLL_PENDING_QUERY",t.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",t.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",t.REGISTER_FILE_URL="REGISTER_FILE_URL",t.RESET="RESET",t.RUN_PREPARED="RUN_PREPARED",t.RUN_QUERY="RUN_QUERY",t.SEND_PREPARED="SEND_PREPARED",t.START_PENDING_QUERY="START_PENDING_QUERY",t.TOKENIZE="TOKENIZE",t))(Kht||{}),Qht=(t=>(t.CONNECTION_INFO="CONNECTION_INFO",t.ERROR="ERROR",t.FEATURE_FLAGS="FEATURE_FLAGS",t.FILE_BUFFER="FILE_BUFFER",t.FILE_INFOS="FILE_INFOS",t.FILE_SIZE="FILE_SIZE",t.FILE_STATISTICS="FILE_STATISTICS",t.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",t.LOG="LOG",t.OK="OK",t.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",t.QUERY_PLAN="QUERY_PLAN",t.QUERY_RESULT="QUERY_RESULT",t.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",t.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",t.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",t.REGISTERED_FILE="REGISTERED_FILE",t.SCRIPT_TOKENS="SCRIPT_TOKENS",t.SUCCESS="SUCCESS",t.TABLE_NAMES="TABLE_NAMES",t.VERSION_STRING="VERSION_STRING",t))(Qht||{}),re=class{constructor(t,e){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=t,this.data=e,this.promise=new Promise((n,r)=>{this.promiseResolver=n,this.promiseRejecter=r})}};function rv(t){switch(t.typeId){case O.Binary:return{sqlType:"binary"};case O.Bool:return{sqlType:"bool"};case O.Date:return{sqlType:"date"};case O.DateDay:return{sqlType:"date32[d]"};case O.DateMillisecond:return{sqlType:"date64[ms]"};case O.Decimal:{let e=t;return{sqlType:"decimal",precision:e.precision,scale:e.scale}}case O.Float:return{sqlType:"float"};case O.Float16:return{sqlType:"float16"};case O.Float32:return{sqlType:"float32"};case O.Float64:return{sqlType:"float64"};case O.Int:return{sqlType:"int32"};case O.Int16:return{sqlType:"int16"};case O.Int32:return{sqlType:"int32"};case O.Int64:return{sqlType:"int64"};case O.Uint16:return{sqlType:"uint16"};case O.Uint32:return{sqlType:"uint32"};case O.Uint64:return{sqlType:"uint64"};case O.Uint8:return{sqlType:"uint8"};case O.IntervalDayTime:return{sqlType:"interval[dt]"};case O.IntervalYearMonth:return{sqlType:"interval[m]"};case O.List:return{sqlType:"list",valueType:rv(t.valueType)};case O.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:t.byteWidth};case O.Null:return{sqlType:"null"};case O.Utf8:return{sqlType:"utf8"};case O.Struct:return{sqlType:"struct",fields:t.children.map(e=>N3(e.name,e.type))};case O.Map:{let e=t;return{sqlType:"map",keyType:rv(e.keyType),valueType:rv(e.valueType)}}case O.Time:return{sqlType:"time[s]"};case O.TimeMicrosecond:return{sqlType:"time[us]"};case O.TimeMillisecond:return{sqlType:"time[ms]"};case O.TimeNanosecond:return{sqlType:"time[ns]"};case O.TimeSecond:return{sqlType:"time[s]"};case O.Timestamp:return{sqlType:"timestamp",timezone:t.timezone||void 0};case O.TimestampSecond:return{sqlType:"timestamp[s]",timezone:t.timezone||void 0};case O.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:t.timezone||void 0};case O.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:t.timezone||void 0};case O.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:t.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(t.toString()))}function N3(t,e){let n=rv(e);return n.name=t,n}var Jht=new TextEncoder,Zht=class{constructor(t,e=null){this._onInstantiationProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._logger=t,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),e!=null&&this.attach(e)}get logger(){return this._logger}attach(t){this._worker=t,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((e,n)=>{this._workerShutdownResolver=e})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(t,e=[]){if(!this._worker){console.error("cannot send a message since the worker is not set!");return}let n=this._nextMessageId++;return this._pendingRequests.set(n,t),this._worker.postMessage({messageId:n,type:t.type,data:t.data},e),await t.promise}onMessage(t){var e;let n=t.data;switch(n.type){case"LOG":{this._logger.log(n.data);return}case"INSTANTIATE_PROGRESS":{for(let i of this._onInstantiationProgress)i(n.data);return}}let r=this._pendingRequests.get(n.requestId);if(!r){console.warn("unassociated response: [".concat(n.requestId,", ").concat(n.type.toString(),"]"));return}if(this._pendingRequests.delete(n.requestId),n.type=="ERROR"){let i=new Error(n.data.message);i.name=n.data.name,(e=Object.getOwnPropertyDescriptor(i,"stack"))!=null&&e.writable&&(i.stack=n.data.stack),r.promiseRejecter(i);return}switch(r.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if(n.type=="OK"){r.promiseResolver(n.data);return}break;case"INSTANTIATE":if(this._onInstantiationProgress=[],n.type=="OK"){r.promiseResolver(n.data);return}break;case"GLOB_FILE_INFOS":if(n.type=="FILE_INFOS"){r.promiseResolver(n.data);return}break;case"GET_VERSION":if(n.type=="VERSION_STRING"){r.promiseResolver(n.data);return}break;case"GET_FEATURE_FLAGS":if(n.type=="FEATURE_FLAGS"){r.promiseResolver(n.data);return}break;case"GET_TABLE_NAMES":if(n.type=="TABLE_NAMES"){r.promiseResolver(n.data);return}break;case"TOKENIZE":if(n.type=="SCRIPT_TOKENS"){r.promiseResolver(n.data);return}break;case"COPY_FILE_TO_BUFFER":if(n.type=="FILE_BUFFER"){r.promiseResolver(n.data);return}break;case"EXPORT_FILE_STATISTICS":if(n.type=="FILE_STATISTICS"){r.promiseResolver(n.data);return}break;case"CONNECT":if(n.type=="CONNECTION_INFO"){r.promiseResolver(n.data);return}break;case"RUN_PREPARED":case"RUN_QUERY":if(n.type=="QUERY_RESULT"){r.promiseResolver(n.data);return}break;case"SEND_PREPARED":if(n.type=="QUERY_RESULT_HEADER"){r.promiseResolver(n.data);return}break;case"START_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){r.promiseResolver(n.data);return}break;case"POLL_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){r.promiseResolver(n.data);return}break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],n.type=="SUCCESS"){r.promiseResolver(n.data);return}break;case"FETCH_QUERY_RESULTS":if(n.type=="QUERY_RESULT_CHUNK"){r.promiseResolver(n.data);return}break;case"CREATE_PREPARED":if(n.type=="PREPARED_STATEMENT_ID"){r.promiseResolver(n.data);return}break}r.promiseRejecter(new Error("unexpected response type: ".concat(n.type.toString())))}onError(t){console.error(t),console.error("error in duckdb worker: ".concat(t.message)),this._pendingRequests.clear()}onClose(){if(this._workerShutdownResolver(null),this._pendingRequests.size!=0){console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"));return}this._pendingRequests.clear()}async reset(){let t=new re("RESET",null);return await this.postTask(t)}async ping(){let t=new re("PING",null);await this.postTask(t)}async dropFile(t){let e=new re("DROP_FILE",t);return await this.postTask(e)}async dropFiles(){let t=new re("DROP_FILES",null);return await this.postTask(t)}async flushFiles(){let t=new re("FLUSH_FILES",null);return await this.postTask(t)}async instantiate(t,e=null,n=r=>{}){this._onInstantiationProgress.push(n);let r=new re("INSTANTIATE",[t,e]);return await this.postTask(r)}async getVersion(){let t=new re("GET_VERSION",null);return await this.postTask(t)}async getFeatureFlags(){let t=new re("GET_FEATURE_FLAGS",null);return await this.postTask(t)}async open(t){let e=new re("OPEN",t);await this.postTask(e)}async tokenize(t){let e=new re("TOKENIZE",t);return await this.postTask(e)}async connectInternal(){let t=new re("CONNECT",null);return await this.postTask(t)}async connect(){let t=await this.connectInternal();return new Hht(this,t)}async disconnect(t){let e=new re("DISCONNECT",t);await this.postTask(e)}async runQuery(t,e){let n=new re("RUN_QUERY",[t,e]);return await this.postTask(n)}async startPendingQuery(t,e){let n=new re("START_PENDING_QUERY",[t,e]);return await this.postTask(n)}async pollPendingQuery(t){let e=new re("POLL_PENDING_QUERY",t);return await this.postTask(e)}async cancelPendingQuery(t){let e=new re("CANCEL_PENDING_QUERY",t);return await this.postTask(e)}async fetchQueryResults(t){let e=new re("FETCH_QUERY_RESULTS",t);return await this.postTask(e)}async getTableNames(t,e){let n=new re("GET_TABLE_NAMES",[t,e]);return await this.postTask(n)}async createPrepared(t,e){let n=new re("CREATE_PREPARED",[t,e]);return await this.postTask(n)}async closePrepared(t,e){let n=new re("CLOSE_PREPARED",[t,e]);await this.postTask(n)}async runPrepared(t,e,n){let r=new re("RUN_PREPARED",[t,e,n]);return await this.postTask(r)}async sendPrepared(t,e,n){let r=new re("SEND_PREPARED",[t,e,n]);return await this.postTask(r)}async globFiles(t){let e=new re("GLOB_FILE_INFOS",t);return await this.postTask(e)}async registerFileText(t,e){let n=Jht.encode(e);await this.registerFileBuffer(t,n)}async registerFileURL(t,e,n,r){e===void 0&&(e=t);let i=new re("REGISTER_FILE_URL",[t,e,n,r]);await this.postTask(i)}async registerEmptyFileBuffer(t){}async registerFileBuffer(t,e){let n=new re("REGISTER_FILE_BUFFER",[t,e]);await this.postTask(n,[e.buffer])}async registerFileHandle(t,e,n,r){let i=new re("REGISTER_FILE_HANDLE",[t,e,n,r]);await this.postTask(i,[])}async collectFileStatistics(t,e){let n=new re("COLLECT_FILE_STATISTICS",[t,e]);await this.postTask(n,[])}async exportFileStatistics(t){let e=new re("EXPORT_FILE_STATISTICS",t);return await this.postTask(e,[])}async copyFileToBuffer(t){let e=new re("COPY_FILE_TO_BUFFER",t);return await this.postTask(e)}async copyFileToPath(t,e){let n=new re("COPY_FILE_TO_PATH",[t,e]);await this.postTask(n)}async insertArrowFromIPCStream(t,e,n){if(e.length==0)return;let r=new re("INSERT_ARROW_FROM_IPC_STREAM",[t,e,n]);await this.postTask(r,[e.buffer])}async insertCSVFromPath(t,e,n){if(n.columns!==void 0){let i=[];for(let s in n.columns){let o=n.columns[s];i.push(N3(s,o))}n.columnsFlat=i,delete n.columns}let r=new re("IMPORT_CSV_FROM_PATH",[t,e,n]);await this.postTask(r)}async insertJSONFromPath(t,e,n){if(n.columns!==void 0){let i=[];for(let s in n.columns){let o=n.columns[s];i.push(N3(s,o))}n.columnsFlat=i,delete n.columns}let r=new re("IMPORT_JSON_FROM_PATH",[t,e,n]);await this.postTask(r)}},tpt=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),ept=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),npt=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),rpt=()=>(async t=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(t)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),yC={name:"@duckdb/duckdb-wasm",version:"1.29.0"},ipt=yC.name,spt=yC.version,bC=yC.version.split(".");bC[0];bC[1];bC[2];var opt=()=>typeof navigator>"u";function apt(){let t="https://cdn.jsdelivr.net/npm/".concat(ipt,"@").concat(spt,"/dist/");return{mvp:{mainModule:"".concat(t,"duckdb-mvp.wasm"),mainWorker:"".concat(t,"duckdb-browser-mvp.worker.js")},eh:{mainModule:"".concat(t,"duckdb-eh.wasm"),mainWorker:"".concat(t,"duckdb-browser-eh.worker.js")}}}var PE=null,zE=null,UE=null,jE=null,qE=null;async function upt(){return PE==null&&(PE=typeof BigInt64Array<"u"),zE==null&&(zE=await ept()),UE==null&&(UE=await rpt()),jE==null&&(jE=await npt()),qE==null&&(qE=await tpt()),{bigInt64Array:PE,crossOriginIsolated:opt()||globalThis.crossOriginIsolated||!1,wasmExceptions:zE,wasmSIMD:jE,wasmThreads:UE,wasmBulkMemory:qE}}async function cpt(t){let e=await upt();if(e.wasmExceptions){if(e.wasmSIMD&&e.wasmThreads&&e.crossOriginIsolated&&t.coi)return{mainModule:t.coi.mainModule,mainWorker:t.coi.mainWorker,pthreadWorker:t.coi.pthreadWorker};if(t.eh)return{mainModule:t.eh.mainModule,mainWorker:t.eh.mainWorker,pthreadWorker:null}}return{mainModule:t.mvp.mainModule,mainWorker:t.mvp.mainWorker,pthreadWorker:null}}Lht(Bht());function lpt(){let t=new TextDecoder;return e=>(typeof SharedArrayBuffer<"u"&&e.buffer instanceof SharedArrayBuffer&&(e=new Uint8Array(e)),t.decode(e))}lpt();var fpt=(t=>(t[t.BUFFER=0]="BUFFER",t[t.NODE_FS=1]="NODE_FS",t[t.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",t[t.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",t[t.HTTP=4]="HTTP",t[t.S3=5]="S3",t))(fpt||{});function dpt(t,e){return new Promise((n,r)=>{t.useUnsafe(async(i,s)=>{try{const o=await i.runQuery(s,e);n(o)}catch(o){r(o)}})})}function hpt(t={}){const{duckdb:e,connection:n,...r}=t;let i=e,s=n,o;function a(){return o||(o=(i?Promise.resolve(i):ppt(r).then(l=>i=l)).then(l=>l.connect()).then(l=>s=l)),o}async function u(){return i||await a(),i}async function c(){return s||await a(),s}return{getDuckDB:u,getConnection:c,query:async l=>{const{type:f,sql:d}=l,h=await c(),p=await dpt(h,d);return f==="exec"?void 0:f==="arrow"?l3(p):l3(p).toArray()}}}async function ppt({log:t=!1}={}){const e=apt(),n=await cpt(e),r=URL.createObjectURL(new Blob([`importScripts("${n.mainWorker}");`],{type:"text/javascript"})),i=new Worker(r),s=t?new Ght:new Vht,o=new Zht(s,i);return await o.instantiate(n.mainModule,n.pthreadWorker),URL.revokeObjectURL(r),o}function u5(t,e,{source:n,clients:r=n?new Set([n]):void 0}){const i=e!==void 0?jct(t,[Fc(e)]):null;return{meta:{type:"point"},source:n,clients:r,value:e,predicate:i}}function gpt(t,e,{source:n,clients:r=n?new Set([n]):void 0,bin:i,scale:s,pixelSize:o=1}){const a=e!=null?Uv(t,e):null;return{meta:{type:"interval",scales:s&&[s],bin:i,pixelSize:o},source:n,clients:r,value:e,predicate:a}}function mpt(t){return typeof(t==null?void 0:t.getChild)=="function"}function ypt(){const t=new Set;let e,n=new Promise(r=>e=r);return{pending(r){t.add(r)},ready(r){return t.delete(r),t.size===0},resolve(){n=new Promise(r=>{e(),e=r})},get promise(){return n}}}function c5(t){return mpt(t)?bpt(t):vpt(t)}function bpt(t){const{numRows:e}=t;return{numRows:e,columns:t.toColumns()}}function vpt(t){const e=t.length;if(typeof t[0]=="object"){const n=e?Object.keys(t[0]):[],r={};return n.length>0&&n.forEach(i=>{r[i]=t.map(s=>s[i])}),{numRows:e,columns:r}}else return{numRows:e,values:t}}const qj=Symbol("Fixed"),wpt=Symbol("Transform");function Fe(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Tf(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function rd(t){let e,n,r;t.length!==2?(e=Fe,n=(a,u)=>Fe(t(a),u),r=(a,u)=>t(a)-u):(e=t===Fe||t===Tf?t:xpt,n=t,r=t);function i(a,u,c=0,l=a.length){if(c<l){if(e(u,u)!==0)return l;do{const f=c+l>>>1;n(a[f],u)<0?c=f+1:l=f}while(c<l)}return c}function s(a,u,c=0,l=a.length){if(c<l){if(e(u,u)!==0)return l;do{const f=c+l>>>1;n(a[f],u)<=0?c=f+1:l=f}while(c<l)}return c}function o(a,u,c=0,l=a.length){const f=i(a,u,c,l-1);return f>c&&r(a[f-1],u)>-r(a[f],u)?f-1:f}return{left:i,center:o,right:s}}function xpt(){return 0}function Wj(t){return t===null?NaN:+t}function*_pt(t,e){if(e===void 0)for(let n of t)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of t)(r=e(r,++n,t))!=null&&(r=+r)>=r&&(yield r)}}const Vj=rd(Fe),hu=Vj.right,Spt=Vj.left;rd(Wj).center;const Gj=Yj(Hj),Ept=Yj(Apt);function Yj(t){return function(e,n,r=n){if(!((n=+n)>=0))throw new RangeError("invalid rx");if(!((r=+r)>=0))throw new RangeError("invalid ry");let{data:i,width:s,height:o}=e;if(!((s=Math.floor(s))>=0))throw new RangeError("invalid width");if(!((o=Math.floor(o!==void 0?o:i.length/s))>=0))throw new RangeError("invalid height");if(!s||!o||!n&&!r)return e;const a=n&&t(n),u=r&&t(r),c=i.slice();return a&&u?(Md(a,c,i,s,o),Md(a,i,c,s,o),Md(a,c,i,s,o),Cd(u,i,c,s,o),Cd(u,c,i,s,o),Cd(u,i,c,s,o)):a?(Md(a,i,c,s,o),Md(a,c,i,s,o),Md(a,i,c,s,o)):u&&(Cd(u,i,c,s,o),Cd(u,c,i,s,o),Cd(u,i,c,s,o)),e}}function Md(t,e,n,r,i){for(let s=0,o=r*i;s<o;)t(e,n,s,s+=r,1)}function Cd(t,e,n,r,i){for(let s=0,o=r*i;s<r;++s)t(e,n,s,s+o,r)}function Apt(t){const e=Hj(t);return(n,r,i,s,o)=>{i<<=2,s<<=2,o<<=2,e(n,r,i+0,s+0,o),e(n,r,i+1,s+1,o),e(n,r,i+2,s+2,o),e(n,r,i+3,s+3,o)}}function Hj(t){const e=Math.floor(t);if(e===t)return $pt(t);const n=t-e,r=2*t+1;return(i,s,o,a,u)=>{if(!((a-=u)>=o))return;let c=e*s[o];const l=u*e,f=l+u;for(let d=o,h=o+l;d<h;d+=u)c+=s[Math.min(a,d)];for(let d=o,h=a;d<=h;d+=u)c+=s[Math.min(a,d+l)],i[d]=(c+n*(s[Math.max(o,d-f)]+s[Math.min(a,d+f)]))/r,c-=s[Math.max(o,d-l)]}}function $pt(t){const e=2*t+1;return(n,r,i,s,o)=>{if(!((s-=o)>=i))return;let a=t*r[i];const u=o*t;for(let c=i,l=i+u;c<l;c+=o)a+=r[Math.min(s,c)];for(let c=i,l=s;c<=l;c+=o)a+=r[Math.min(s,c+u)],n[c]=a/e,a-=r[Math.max(i,c-u)]}}function O2(t,e){let n=0;if(e===void 0)for(let r of t)r!=null&&(r=+r)>=r&&++n;else{let r=-1;for(let i of t)(i=e(i,++r,t))!=null&&(i=+i)>=i&&++n}return n}function Tpt(t){return t.length|0}function kpt(t){return!(t>0)}function Mpt(t){return typeof t!="object"||"length"in t?t:Array.from(t)}function Cpt(t){return e=>t(...e)}function Ipt(...t){const e=typeof t[t.length-1]=="function"&&Cpt(t.pop());t=t.map(Mpt);const n=t.map(Tpt),r=t.length-1,i=new Array(r+1).fill(0),s=[];if(r<0||n.some(kpt))return s;for(;;){s.push(i.map((a,u)=>t[u][a]));let o=r;for(;++i[o]===n[o];){if(o===0)return e?s.map(e):s;i[o--]=0}}}function Fpt(t,e){var n=0;return Float64Array.from(t,r=>n+=+r||0)}function vC(t,e){let n=0,r,i=0,s=0;if(e===void 0)for(let o of t)o!=null&&(o=+o)>=o&&(r=o-i,i+=r/++n,s+=r*(o-i));else{let o=-1;for(let a of t)(a=e(a,++o,t))!=null&&(a=+a)>=a&&(r=a-i,i+=r/++n,s+=r*(a-i))}if(n>1)return s/(n-1)}function Wp(t,e){const n=vC(t,e);return n&&Math.sqrt(n)}function pn(t,e){let n,r;if(e===void 0)for(const i of t)i!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let s of t)(s=e(s,++i,t))!=null&&(n===void 0?s>=s&&(n=r=s):(n>s&&(n=s),r<s&&(r=s)))}return[n,r]}class Pr{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=n[i],o=e+s,a=Math.abs(e)<Math.abs(s)?e-(o-s):s-(o-e);a&&(n[r++]=a),e=o}return n[r]=e,this._n=r+1,this}valueOf(){const e=this._partials;let n=this._n,r,i,s,o=0;if(n>0){for(o=e[--n];n>0&&(r=o,i=e[--n],o=r+i,s=i-(o-r),!s););n>0&&(s<0&&e[n-1]<0||s>0&&e[n-1]>0)&&(i=s*2,r=o+i,i==r-o&&(o=r))}return o}}class kf extends Map{constructor(e,n=Qj){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[r,i]of e)this.set(r,i)}get(e){return super.get(O3(this,e))}has(e){return super.has(O3(this,e))}set(e,n){return super.set(Xj(this,e),n)}delete(e){return super.delete(Kj(this,e))}}class pu extends Set{constructor(e,n=Qj){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const r of e)this.add(r)}has(e){return super.has(O3(this,e))}add(e){return super.add(Xj(this,e))}delete(e){return super.delete(Kj(this,e))}}function O3({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function Xj({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function Kj({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function Qj(t){return t!==null&&typeof t=="object"?t.valueOf():t}function R3(t){return t}function al(t,...e){return wC(t,R3,R3,e)}function kh(t,e,...n){return wC(t,R3,e,n)}function Npt(t,e,...n){return wC(t,Array.from,e,n)}function wC(t,e,n,r){return function i(s,o){if(o>=r.length)return n(s);const a=new kf,u=r[o++];let c=-1;for(const l of s){const f=u(l,++c,s),d=a.get(f);d?d.push(l):a.set(f,[l])}for(const[l,f]of a)a.set(l,i(f,o));return e(a)}(t,0)}function Jj(t,e){return Array.from(e,n=>t[n])}function ww(t,...e){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");t=Array.from(t);let[n]=e;if(n&&n.length!==2||e.length>1){const r=Uint32Array.from(t,(i,s)=>s);return e.length>1?(e=e.map(i=>t.map(i)),r.sort((i,s)=>{for(const o of e){const a=w0(o[i],o[s]);if(a)return a}})):(n=t.map(n),r.sort((i,s)=>w0(n[i],n[s]))),Jj(t,r)}return t.sort(xC(n))}function xC(t=Fe){if(t===Fe)return w0;if(typeof t!="function")throw new TypeError("compare is not a function");return(e,n)=>{const r=t(e,n);return r||r===0?r:(t(n,n)===0)-(t(e,e)===0)}}function w0(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}function _C(t,e,n){return(e.length!==2?ww(kh(t,e,n),([r,i],[s,o])=>Fe(i,o)||Fe(r,s)):ww(al(t,n),([r,i],[s,o])=>e(i,o)||Fe(r,s))).map(([r])=>r)}const Opt=Math.sqrt(50),Rpt=Math.sqrt(10),Dpt=Math.sqrt(2);function xw(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=Opt?10:s>=Rpt?5:s>=Dpt?2:1;let a,u,c;return i<0?(c=Math.pow(10,-i)/o,a=Math.round(t*c),u=Math.round(e*c),a/c<t&&++a,u/c>e&&--u,c=-c):(c=Math.pow(10,i)*o,a=Math.round(t/c),u=Math.round(e/c),a*c<t&&++a,u*c>e&&--u),u<a&&.5<=n&&n<2?xw(t,e,n*2):[a,u,c]}function Lc(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,s,o]=r?xw(e,t,n):xw(t,e,n);if(!(s>=i))return[];const a=s-i+1,u=new Array(a);if(r)if(o<0)for(let c=0;c<a;++c)u[c]=(s-c)/-o;else for(let c=0;c<a;++c)u[c]=(s-c)*o;else if(o<0)for(let c=0;c<a;++c)u[c]=(i+c)/-o;else for(let c=0;c<a;++c)u[c]=(i+c)*o;return u}function x0(t,e,n){return e=+e,t=+t,n=+n,xw(t,e,n)[2]}function Bc(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?x0(e,t,n):x0(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function Zj(t,e,n){let r;for(;;){const i=x0(t,e,n);if(i===r||i===0||!isFinite(i))return[t,e];i>0?(t=Math.floor(t/i)*i,e=Math.ceil(e/i)*i):i<0&&(t=Math.ceil(t*i)/i,e=Math.floor(e*i)/i),r=i}}function SC(t){return Math.max(1,Math.ceil(Math.log(O2(t))/Math.LN2)+1)}function Be(t,e){let n;if(e===void 0)for(const r of t)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of t)(i=e(i,++r,t))!=null&&(n<i||n===void 0&&i>=i)&&(n=i)}return n}function Lpt(t,e){let n,r=-1,i=-1;if(e===void 0)for(const s of t)++i,s!=null&&(n<s||n===void 0&&s>=s)&&(n=s,r=i);else for(let s of t)(s=e(s,++i,t))!=null&&(n<s||n===void 0&&s>=s)&&(n=s,r=i);return r}function wn(t,e){let n;if(e===void 0)for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of t)(i=e(i,++r,t))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function Bpt(t,e){let n,r=-1,i=-1;if(e===void 0)for(const s of t)++i,s!=null&&(n>s||n===void 0&&s>=s)&&(n=s,r=i);else for(let s of t)(s=e(s,++i,t))!=null&&(n>s||n===void 0&&s>=s)&&(n=s,r=i);return r}function tq(t,e,n=0,r=1/0,i){if(e=Math.floor(e),n=Math.floor(Math.max(0,n)),r=Math.floor(Math.min(t.length-1,r)),!(n<=e&&e<=r))return t;for(i=i===void 0?w0:xC(i);r>n;){if(r-n>600){const u=r-n+1,c=e-n+1,l=Math.log(u),f=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*f*(u-f)/u)*(c-u/2<0?-1:1),h=Math.max(n,Math.floor(e-c*f/u+d)),p=Math.min(r,Math.floor(e+(u-c)*f/u+d));tq(t,e,h,p,i)}const s=t[e];let o=n,a=r;for(Og(t,n,e),i(t[r],s)>0&&Og(t,n,r);o<a;){for(Og(t,o,a),++o,--a;i(t[o],s)<0;)++o;for(;i(t[a],s)>0;)--a}i(t[n],s)===0?Og(t,n,a):(++a,Og(t,a,r)),a<=e&&(n=a+1),e<=a&&(r=a-1)}return t}function Og(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function EC(t,e=Fe){let n,r=!1;if(e.length===1){let i;for(const s of t){const o=e(s);(r?Fe(o,i)>0:Fe(o,o)===0)&&(n=s,i=o,r=!0)}}else for(const i of t)(r?e(i,n)>0:e(i,i)===0)&&(n=i,r=!0);return n}function Xo(t,e,n){if(t=Float64Array.from(_pt(t,n)),!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return wn(t);if(e>=1)return Be(t);var r,i=(r-1)*e,s=Math.floor(i),o=Be(tq(t,s).subarray(0,s+1)),a=wn(t.subarray(s+1));return o+(a-o)*(i-s)}}function eq(t,e,n=Wj){if(!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,s=Math.floor(i),o=+n(t[s],s,t),a=+n(t[s+1],s+1,t);return o+(a-o)*(i-s)}}function Ppt(t,e,n){const r=O2(t),i=Xo(t,.75)-Xo(t,.25);return r&&i?Math.ceil((n-e)/(2*i*Math.pow(r,-1/3))):1}function nq(t,e,n){const r=O2(t),i=Wp(t);return r&&i?Math.ceil((n-e)*Math.cbrt(r)/(3.49*i)):1}function wy(t,e){let n=0,r=0;if(e===void 0)for(let i of t)i!=null&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let s of t)(s=e(s,++i,t))!=null&&(s=+s)>=s&&(++n,r+=s)}if(n)return r/n}function Mf(t,e){return Xo(t,.5,e)}function*zpt(t){for(const e of t)yield*e}function rq(t){return Array.from(zpt(t))}function iq(t,e){const n=new kf;if(e===void 0)for(let s of t)s!=null&&s>=s&&n.set(s,(n.get(s)||0)+1);else{let s=-1;for(let o of t)(o=e(o,++s,t))!=null&&o>=o&&n.set(o,(n.get(o)||0)+1)}let r,i=0;for(const[s,o]of n)o>i&&(i=o,r=s);return r}function Upt(t,e=jpt){const n=[];let r,i=!1;for(const s of t)i&&n.push(e(r,s)),r=s,i=!0;return n}function jpt(t,e){return[t,e]}function xn(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((e-t)/n))|0,s=new Array(i);++r<i;)s[r]=t+r*n;return s}function sq(t,e=Fe){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");let n=Array.from(t);const r=new Float64Array(n.length);e.length!==2&&(n=n.map(e),e=Fe);const i=(a,u)=>e(n[a],n[u]);let s,o;return t=Uint32Array.from(n,(a,u)=>u),t.sort(e===Fe?(a,u)=>w0(n[a],n[u]):xC(i)),t.forEach((a,u)=>{const c=i(a,s===void 0?a:s);c>=0?((s===void 0||c>0)&&(s=a,o=u),r[a]=o):r[a]=NaN}),r}function qpt(t,e=Fe){let n,r=!1;if(e.length===1){let i;for(const s of t){const o=e(s);(r?Fe(o,i)<0:Fe(o,o)===0)&&(n=s,i=o,r=!0)}}else for(const i of t)(r?e(i,n)<0:e(i,i)===0)&&(n=i,r=!0);return n}function ls(t,e){let n=0;if(e===void 0)for(let r of t)(r=+r)&&(n+=r);else{let r=-1;for(let i of t)(i=+e(i,++r,t))&&(n+=i)}return n}function _w(t){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");return Array.from(t).reverse()}function Wpt(t,...e){t=new pu(t),e=e.map(Vpt);t:for(const n of t)for(const r of e)if(!r.has(n)){t.delete(n);continue t}return t}function Vpt(t){return t instanceof pu?t:new pu(t)}function Gpt(...t){const e=new pu;for(const n of t)for(const r of n)e.add(r);return e}function Ypt(t){return t}var Hpt=3,l5=1e-6;function Xpt(t){return"translate("+t+",0)"}function Kpt(t){return e=>+t(e)}function Qpt(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function Jpt(){return!this.__axis}function Zpt(t,e){var n=[],r=null,i=null,s=6,o=6,a=3,u=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=1,l="y",f=Xpt;function d(h){var p=r??(e.ticks?e.ticks.apply(e,n):e.domain()),g=i??(e.tickFormat?e.tickFormat.apply(e,n):Ypt),m=Math.max(s,0)+a,y=e.range(),b=+y[0]+u,w=+y[y.length-1]+u,v=(e.bandwidth?Qpt:Kpt)(e.copy(),u),x=h.selection?h.selection():h,S=x.selectAll(".domain").data([null]),_=x.selectAll(".tick").data(p,e).order(),E=_.exit(),A=_.enter().append("g").attr("class","tick"),$=_.select("line"),T=_.select("text");S=S.merge(S.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),_=_.merge(A),$=$.merge(A.append("line").attr("stroke","currentColor").attr(l+"2",c*s)),T=T.merge(A.append("text").attr("fill","currentColor").attr(l,c*m).attr("dy","0.71em")),h!==x&&(S=S.transition(h),_=_.transition(h),$=$.transition(h),T=T.transition(h),E=E.transition(h).attr("opacity",l5).attr("transform",function(C){return isFinite(C=v(C))?f(C+u):this.getAttribute("transform")}),A.attr("opacity",l5).attr("transform",function(C){var F=this.parentNode.__axis;return f((F&&isFinite(F=F(C))?F:v(C))+u)})),E.remove(),S.attr("d",o?"M"+b+","+c*o+"V"+u+"H"+w+"V"+c*o:"M"+b+","+u+"H"+w),_.attr("opacity",1).attr("transform",function(C){return f(v(C)+u)}),$.attr(l+"2",c*s),T.attr(l,c*m).text(g),x.filter(Jpt).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","middle"),x.each(function(){this.__axis=v})}return d.scale=function(h){return arguments.length?(e=h,d):e},d.ticks=function(){return n=Array.from(arguments),d},d.tickArguments=function(h){return arguments.length?(n=h==null?[]:Array.from(h),d):n.slice()},d.tickValues=function(h){return arguments.length?(r=h==null?null:Array.from(h),d):r&&r.slice()},d.tickFormat=function(h){return arguments.length?(i=h,d):i},d.tickSize=function(h){return arguments.length?(s=o=+h,d):s},d.tickSizeInner=function(h){return arguments.length?(s=+h,d):s},d.tickSizeOuter=function(h){return arguments.length?(o=+h,d):o},d.tickPadding=function(h){return arguments.length?(a=+h,d):a},d.offset=function(h){return arguments.length?(u=+h,d):u},d}function tgt(t){return Zpt(Hpt,t)}var egt={value:()=>{}};function R2(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new iv(n)}function iv(t){this._=t}function ngt(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}iv.prototype=R2.prototype={constructor:iv,on:function(t,e){var n=this._,r=ngt(t+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(t=r[s]).type)&&(i=rgt(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(t=r[s]).type)n[i]=f5(n[i],t.name,e);else if(e==null)for(i in n)n[i]=f5(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new iv(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],r=0,i=s.length;r<i;++r)s[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};function rgt(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function f5(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=egt,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var D3="http://www.w3.org/1999/xhtml";const gu={svg:"http://www.w3.org/2000/svg",xhtml:D3,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function D2(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),gu.hasOwnProperty(e)?{space:gu[e],local:t}:t}function igt(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===D3&&e.documentElement.namespaceURI===D3?e.createElement(t):e.createElementNS(n,t)}}function sgt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function L2(t){var e=D2(t);return(e.local?sgt:igt)(e)}function ogt(){}function AC(t){return t==null?ogt:function(){return this.querySelector(t)}}function agt(t){typeof t!="function"&&(t=AC(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,a=r[i]=new Array(o),u,c,l=0;l<o;++l)(u=s[l])&&(c=t.call(u,u.__data__,l,s))&&("__data__"in u&&(c.__data__=u.__data__),a[l]=c);return new Ri(r,this._parents)}function ugt(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function cgt(){return[]}function oq(t){return t==null?cgt:function(){return this.querySelectorAll(t)}}function lgt(t){return function(){return ugt(t.apply(this,arguments))}}function fgt(t){typeof t=="function"?t=lgt(t):t=oq(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o=e[s],a=o.length,u,c=0;c<a;++c)(u=o[c])&&(r.push(t.call(u,u.__data__,c,o)),i.push(u));return new Ri(r,i)}function aq(t){return function(){return this.matches(t)}}function uq(t){return function(e){return e.matches(t)}}var dgt=Array.prototype.find;function hgt(t){return function(){return dgt.call(this.children,t)}}function pgt(){return this.firstElementChild}function ggt(t){return this.select(t==null?pgt:hgt(typeof t=="function"?t:uq(t)))}var mgt=Array.prototype.filter;function ygt(){return Array.from(this.children)}function bgt(t){return function(){return mgt.call(this.children,t)}}function vgt(t){return this.selectAll(t==null?ygt:bgt(typeof t=="function"?t:uq(t)))}function wgt(t){typeof t!="function"&&(t=aq(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,a=r[i]=[],u,c=0;c<o;++c)(u=s[c])&&t.call(u,u.__data__,c,s)&&a.push(u);return new Ri(r,this._parents)}function cq(t){return new Array(t.length)}function xgt(){return new Ri(this._enter||this._groups.map(cq),this._parents)}function Sw(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Sw.prototype={constructor:Sw,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function _gt(t){return function(){return t}}function Sgt(t,e,n,r,i,s){for(var o=0,a,u=e.length,c=s.length;o<c;++o)(a=e[o])?(a.__data__=s[o],r[o]=a):n[o]=new Sw(t,s[o]);for(;o<u;++o)(a=e[o])&&(i[o]=a)}function Egt(t,e,n,r,i,s,o){var a,u,c=new Map,l=e.length,f=s.length,d=new Array(l),h;for(a=0;a<l;++a)(u=e[a])&&(d[a]=h=o.call(u,u.__data__,a,e)+"",c.has(h)?i[a]=u:c.set(h,u));for(a=0;a<f;++a)h=o.call(t,s[a],a,s)+"",(u=c.get(h))?(r[a]=u,u.__data__=s[a],c.delete(h)):n[a]=new Sw(t,s[a]);for(a=0;a<l;++a)(u=e[a])&&c.get(d[a])===u&&(i[a]=u)}function Agt(t){return t.__data__}function $gt(t,e){if(!arguments.length)return Array.from(this,Agt);var n=e?Egt:Sgt,r=this._parents,i=this._groups;typeof t!="function"&&(t=_gt(t));for(var s=i.length,o=new Array(s),a=new Array(s),u=new Array(s),c=0;c<s;++c){var l=r[c],f=i[c],d=f.length,h=Tgt(t.call(l,l&&l.__data__,c,r)),p=h.length,g=a[c]=new Array(p),m=o[c]=new Array(p),y=u[c]=new Array(d);n(l,f,g,m,y,h,e);for(var b=0,w=0,v,x;b<p;++b)if(v=g[b]){for(b>=w&&(w=b+1);!(x=m[w])&&++w<p;);v._next=x||null}}return o=new Ri(o,r),o._enter=a,o._exit=u,o}function Tgt(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function kgt(){return new Ri(this._exit||this._groups.map(cq),this._parents)}function Mgt(t,e,n){var r=this.enter(),i=this,s=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function Cgt(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),a=new Array(i),u=0;u<o;++u)for(var c=n[u],l=r[u],f=c.length,d=a[u]=new Array(f),h,p=0;p<f;++p)(h=c[p]||l[p])&&(d[p]=h);for(;u<i;++u)a[u]=n[u];return new Ri(a,this._parents)}function Igt(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Fgt(t){t||(t=Ngt);function e(f,d){return f&&d?t(f.__data__,d.__data__):!f-!d}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],a=o.length,u=i[s]=new Array(a),c,l=0;l<a;++l)(c=o[l])&&(u[l]=c);u.sort(e)}return new Ri(i,this._parents).order()}function Ngt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Ogt(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Rgt(){return Array.from(this)}function Dgt(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function Lgt(){let t=0;for(const e of this)++t;return t}function Bgt(){return!this.node()}function Pgt(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],s=0,o=i.length,a;s<o;++s)(a=i[s])&&t.call(a,a.__data__,s,i);return this}function zgt(t){return function(){this.removeAttribute(t)}}function Ugt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function jgt(t,e){return function(){this.setAttribute(t,e)}}function qgt(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Wgt(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Vgt(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Ggt(t,e){var n=D2(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?Ugt:zgt:typeof e=="function"?n.local?Vgt:Wgt:n.local?qgt:jgt)(n,e))}function lq(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Ygt(t){return function(){this.style.removeProperty(t)}}function Hgt(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Xgt(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Kgt(t,e,n){return arguments.length>1?this.each((e==null?Ygt:typeof e=="function"?Xgt:Hgt)(t,e,n??"")):Hh(this.node(),t)}function Hh(t,e){return t.style.getPropertyValue(e)||lq(t).getComputedStyle(t,null).getPropertyValue(e)}function Qgt(t){return function(){delete this[t]}}function Jgt(t,e){return function(){this[t]=e}}function Zgt(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function tmt(t,e){return arguments.length>1?this.each((e==null?Qgt:typeof e=="function"?Zgt:Jgt)(t,e)):this.node()[t]}function fq(t){return t.trim().split(/^|\s+/)}function $C(t){return t.classList||new dq(t)}function dq(t){this._node=t,this._names=fq(t.getAttribute("class")||"")}dq.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function hq(t,e){for(var n=$C(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function pq(t,e){for(var n=$C(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function emt(t){return function(){hq(this,t)}}function nmt(t){return function(){pq(this,t)}}function rmt(t,e){return function(){(e.apply(this,arguments)?hq:pq)(this,t)}}function imt(t,e){var n=fq(t+"");if(arguments.length<2){for(var r=$C(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?rmt:e?emt:nmt)(n,e))}function smt(){this.textContent=""}function omt(t){return function(){this.textContent=t}}function amt(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function umt(t){return arguments.length?this.each(t==null?smt:(typeof t=="function"?amt:omt)(t)):this.node().textContent}function cmt(){this.innerHTML=""}function lmt(t){return function(){this.innerHTML=t}}function fmt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function dmt(t){return arguments.length?this.each(t==null?cmt:(typeof t=="function"?fmt:lmt)(t)):this.node().innerHTML}function hmt(){this.nextSibling&&this.parentNode.appendChild(this)}function pmt(){return this.each(hmt)}function gmt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function mmt(){return this.each(gmt)}function ymt(t){var e=typeof t=="function"?t:L2(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function bmt(){return null}function vmt(t,e){var n=typeof t=="function"?t:L2(t),r=e==null?bmt:typeof e=="function"?e:AC(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function wmt(){var t=this.parentNode;t&&t.removeChild(this)}function xmt(){return this.each(wmt)}function _mt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Smt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Emt(t){return this.select(t?Smt:_mt)}function Amt(t){return arguments.length?this.property("__data__",t):this.node().__data__}function $mt(t){return function(e){t.call(this,e,this.__data__)}}function Tmt(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function kmt(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,s;n<i;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function Mmt(t,e,n){return function(){var r=this.__on,i,s=$mt(e);if(r){for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=e;return}}this.addEventListener(t.type,s,n),i={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(i):this.__on=[i]}}function Cmt(t,e,n){var r=Tmt(t+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var u=0,c=a.length,l;u<c;++u)for(i=0,l=a[u];i<s;++i)if((o=r[i]).type===l.type&&o.name===l.name)return l.value}return}for(a=e?Mmt:kmt,i=0;i<s;++i)this.each(a(r[i],e,n));return this}function gq(t,e,n){var r=lq(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function Imt(t,e){return function(){return gq(this,t,e)}}function Fmt(t,e){return function(){return gq(this,t,e.apply(this,arguments))}}function Nmt(t,e){return this.each((typeof e=="function"?Fmt:Imt)(t,e))}function*Omt(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var mq=[null];function Ri(t,e){this._groups=t,this._parents=e}function xy(){return new Ri([[document.documentElement]],mq)}function Rmt(){return this}Ri.prototype=xy.prototype={constructor:Ri,select:agt,selectAll:fgt,selectChild:ggt,selectChildren:vgt,filter:wgt,data:$gt,enter:xgt,exit:kgt,join:Mgt,merge:Cgt,selection:Rmt,order:Igt,sort:Fgt,call:Ogt,nodes:Rgt,node:Dgt,size:Lgt,empty:Bgt,each:Pgt,attr:Ggt,style:Kgt,property:tmt,classed:imt,text:umt,html:dmt,raise:pmt,lower:mmt,append:ymt,insert:vmt,remove:xmt,clone:Emt,datum:Amt,on:Cmt,dispatch:Nmt,[Symbol.iterator]:Omt};function fr(t){return typeof t=="string"?new Ri([[document.querySelector(t)]],[document.documentElement]):new Ri([[t]],mq)}function Dmt(t){let e;for(;e=t.sourceEvent;)t=e;return t}function L3(t,e){if(t=Dmt(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const B3={capture:!0,passive:!1};function P3(t){t.preventDefault(),t.stopImmediatePropagation()}function Lmt(t){var e=t.document.documentElement,n=fr(t).on("dragstart.drag",P3,B3);"onselectstart"in e?n.on("selectstart.drag",P3,B3):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Bmt(t,e){var n=t.document.documentElement,r=fr(t).on("dragstart.drag",null);e&&(r.on("click.drag",P3,B3),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function Vp(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function _y(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ul(){}var Cf=.7,Xh=1/Cf,Mh="\\s*([+-]?\\d+)\\s*",_0="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",zo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Pmt=/^#([0-9a-f]{3,8})$/,zmt=new RegExp(`^rgb\\(${Mh},${Mh},${Mh}\\)$`),Umt=new RegExp(`^rgb\\(${zo},${zo},${zo}\\)$`),jmt=new RegExp(`^rgba\\(${Mh},${Mh},${Mh},${_0}\\)$`),qmt=new RegExp(`^rgba\\(${zo},${zo},${zo},${_0}\\)$`),Wmt=new RegExp(`^hsl\\(${_0},${zo},${zo}\\)$`),Vmt=new RegExp(`^hsla\\(${_0},${zo},${zo},${_0}\\)$`),d5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Vp(ul,Pc,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:h5,formatHex:h5,formatHex8:Gmt,formatHsl:Ymt,formatRgb:p5,toString:p5});function h5(){return this.rgb().formatHex()}function Gmt(){return this.rgb().formatHex8()}function Ymt(){return yq(this).formatHsl()}function p5(){return this.rgb().formatRgb()}function Pc(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Pmt.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?g5(e):n===3?new Cn(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?B1(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?B1(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=zmt.exec(t))?new Cn(e[1],e[2],e[3],1):(e=Umt.exec(t))?new Cn(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=jmt.exec(t))?B1(e[1],e[2],e[3],e[4]):(e=qmt.exec(t))?B1(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Wmt.exec(t))?b5(e[1],e[2]/100,e[3]/100,1):(e=Vmt.exec(t))?b5(e[1],e[2]/100,e[3]/100,e[4]):d5.hasOwnProperty(t)?g5(d5[t]):t==="transparent"?new Cn(NaN,NaN,NaN,0):null}function g5(t){return new Cn(t>>16&255,t>>8&255,t&255,1)}function B1(t,e,n,r){return r<=0&&(t=e=n=NaN),new Cn(t,e,n,r)}function TC(t){return t instanceof ul||(t=Pc(t)),t?(t=t.rgb(),new Cn(t.r,t.g,t.b,t.opacity)):new Cn}function li(t,e,n,r){return arguments.length===1?TC(t):new Cn(t,e,n,r??1)}function Cn(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Vp(Cn,li,_y(ul,{brighter(t){return t=t==null?Xh:Math.pow(Xh,t),new Cn(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Cf:Math.pow(Cf,t),new Cn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Cn(lf(this.r),lf(this.g),lf(this.b),Ew(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:m5,formatHex:m5,formatHex8:Hmt,formatRgb:y5,toString:y5}));function m5(){return`#${ef(this.r)}${ef(this.g)}${ef(this.b)}`}function Hmt(){return`#${ef(this.r)}${ef(this.g)}${ef(this.b)}${ef((isNaN(this.opacity)?1:this.opacity)*255)}`}function y5(){const t=Ew(this.opacity);return`${t===1?"rgb(":"rgba("}${lf(this.r)}, ${lf(this.g)}, ${lf(this.b)}${t===1?")":`, ${t})`}`}function Ew(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function lf(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ef(t){return t=lf(t),(t<16?"0":"")+t.toString(16)}function b5(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Rs(t,e,n,r)}function yq(t){if(t instanceof Rs)return new Rs(t.h,t.s,t.l,t.opacity);if(t instanceof ul||(t=Pc(t)),!t)return new Rs;if(t instanceof Rs)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,a=s-i,u=(s+i)/2;return a?(e===s?o=(n-r)/a+(n<r)*6:n===s?o=(r-e)/a+2:o=(e-n)/a+4,a/=u<.5?s+i:2-s-i,o*=60):a=u>0&&u<1?0:o,new Rs(o,a,u,t.opacity)}function Aw(t,e,n,r){return arguments.length===1?yq(t):new Rs(t,e,n,r??1)}function Rs(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Vp(Rs,Aw,_y(ul,{brighter(t){return t=t==null?Xh:Math.pow(Xh,t),new Rs(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Cf:Math.pow(Cf,t),new Rs(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Cn(WE(t>=240?t-240:t+120,i,r),WE(t,i,r),WE(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Rs(v5(this.h),P1(this.s),P1(this.l),Ew(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ew(this.opacity);return`${t===1?"hsl(":"hsla("}${v5(this.h)}, ${P1(this.s)*100}%, ${P1(this.l)*100}%${t===1?")":`, ${t})`}`}}));function v5(t){return t=(t||0)%360,t<0?t+360:t}function P1(t){return Math.max(0,Math.min(1,t||0))}function WE(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const bq=Math.PI/180,vq=180/Math.PI,$w=18,wq=.96422,xq=1,_q=.82521,Sq=4/29,Ch=6/29,Eq=3*Ch*Ch,Xmt=Ch*Ch*Ch;function Aq(t){if(t instanceof Uo)return new Uo(t.l,t.a,t.b,t.opacity);if(t instanceof Ka)return $q(t);t instanceof Cn||(t=TC(t));var e=HE(t.r),n=HE(t.g),r=HE(t.b),i=VE((.2225045*e+.7168786*n+.0606169*r)/xq),s,o;return e===n&&n===r?s=o=i:(s=VE((.4360747*e+.3850649*n+.1430804*r)/wq),o=VE((.0139322*e+.0971045*n+.7141733*r)/_q)),new Uo(116*i-16,500*(s-i),200*(i-o),t.opacity)}function Tw(t,e,n,r){return arguments.length===1?Aq(t):new Uo(t,e,n,r??1)}function Uo(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}Vp(Uo,Tw,_y(ul,{brighter(t){return new Uo(this.l+$w*(t??1),this.a,this.b,this.opacity)},darker(t){return new Uo(this.l-$w*(t??1),this.a,this.b,this.opacity)},rgb(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return e=wq*GE(e),t=xq*GE(t),n=_q*GE(n),new Cn(YE(3.1338561*e-1.6168667*t-.4906146*n),YE(-.9787684*e+1.9161415*t+.033454*n),YE(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}}));function VE(t){return t>Xmt?Math.pow(t,1/3):t/Eq+Sq}function GE(t){return t>Ch?t*t*t:Eq*(t-Sq)}function YE(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function HE(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Kmt(t){if(t instanceof Ka)return new Ka(t.h,t.c,t.l,t.opacity);if(t instanceof Uo||(t=Aq(t)),t.a===0&&t.b===0)return new Ka(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*vq;return new Ka(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function kw(t,e,n,r){return arguments.length===1?Kmt(t):new Ka(t,e,n,r??1)}function Ka(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function $q(t){if(isNaN(t.h))return new Uo(t.l,0,0,t.opacity);var e=t.h*bq;return new Uo(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}Vp(Ka,kw,_y(ul,{brighter(t){return new Ka(this.h,this.c,this.l+$w*(t??1),this.opacity)},darker(t){return new Ka(this.h,this.c,this.l-$w*(t??1),this.opacity)},rgb(){return $q(this).rgb()}}));var Tq=-.14861,kC=1.78277,MC=-.29227,B2=-.90649,S0=1.97294,w5=S0*B2,x5=S0*kC,_5=kC*MC-B2*Tq;function Qmt(t){if(t instanceof ff)return new ff(t.h,t.s,t.l,t.opacity);t instanceof Cn||(t=TC(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(_5*r+w5*e-x5*n)/(_5+w5-x5),s=r-i,o=(S0*(n-i)-MC*s)/B2,a=Math.sqrt(o*o+s*s)/(S0*i*(1-i)),u=a?Math.atan2(o,s)*vq-120:NaN;return new ff(u<0?u+360:u,a,i,t.opacity)}function Ko(t,e,n,r){return arguments.length===1?Qmt(t):new ff(t,e,n,r??1)}function ff(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Vp(ff,Ko,_y(ul,{brighter(t){return t=t==null?Xh:Math.pow(Xh,t),new ff(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Cf:Math.pow(Cf,t),new ff(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*bq,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new Cn(255*(e+n*(Tq*r+kC*i)),255*(e+n*(MC*r+B2*i)),255*(e+n*(S0*r)),this.opacity)}}));function kq(t,e,n,r,i){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*n+(1+3*t+3*s-3*o)*r+o*i)/6}function Mq(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],s=t[r+1],o=r>0?t[r-1]:2*i-s,a=r<e-1?t[r+2]:2*s-i;return kq((n-r/e)*e,o,i,s,a)}}function Cq(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],s=t[r%e],o=t[(r+1)%e],a=t[(r+2)%e];return kq((n-r/e)*e,i,s,o,a)}}const P2=t=>()=>t;function Iq(t,e){return function(n){return t+n*e}}function Jmt(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function z2(t,e){var n=e-t;return n?Iq(t,n>180||n<-180?n-360*Math.round(n/360):n):P2(isNaN(t)?e:t)}function Zmt(t){return(t=+t)==1?In:function(e,n){return n-e?Jmt(e,n,t):P2(isNaN(e)?n:e)}}function In(t,e){var n=e-t;return n?Iq(t,n):P2(isNaN(t)?e:t)}const zc=function t(e){var n=Zmt(e);function r(i,s){var o=n((i=li(i)).r,(s=li(s)).r),a=n(i.g,s.g),u=n(i.b,s.b),c=In(i.opacity,s.opacity);return function(l){return i.r=o(l),i.g=a(l),i.b=u(l),i.opacity=c(l),i+""}}return r.gamma=t,r}(1);function Fq(t){return function(e){var n=e.length,r=new Array(n),i=new Array(n),s=new Array(n),o,a;for(o=0;o<n;++o)a=li(e[o]),r[o]=a.r||0,i[o]=a.g||0,s[o]=a.b||0;return r=t(r),i=t(i),s=t(s),a.opacity=1,function(u){return a.r=r(u),a.g=i(u),a.b=s(u),a+""}}}var Nq=Fq(Mq),t0t=Fq(Cq);function CC(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=t[i]*(1-s)+e[i]*s;return r}}function Oq(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function e0t(t,e){return(Oq(e)?CC:Rq)(t,e)}function Rq(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),s=new Array(n),o;for(o=0;o<r;++o)i[o]=ku(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function Dq(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function qn(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Lq(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=ku(t[i],e[i]):r[i]=e[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var z3=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,XE=new RegExp(z3.source,"g");function n0t(t){return function(){return t}}function r0t(t){return function(e){return t(e)+""}}function IC(t,e){var n=z3.lastIndex=XE.lastIndex=0,r,i,s,o=-1,a=[],u=[];for(t=t+"",e=e+"";(r=z3.exec(t))&&(i=XE.exec(e));)(s=i.index)>n&&(s=e.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,u.push({i:o,x:qn(r,i)})),n=XE.lastIndex;return n<e.length&&(s=e.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?u[0]?r0t(u[0].x):n0t(e):(e=u.length,function(c){for(var l=0,f;l<e;++l)a[(f=u[l]).i]=f.x(c);return a.join("")})}function ku(t,e){var n=typeof e,r;return e==null||n==="boolean"?P2(e):(n==="number"?qn:n==="string"?(r=Pc(e))?(e=r,zc):IC:e instanceof Pc?zc:e instanceof Date?Dq:Oq(e)?CC:Array.isArray(e)?Rq:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Lq:qn)(t,e)}function i0t(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}function s0t(t,e){var n=z2(+t,+e);return function(r){var i=n(r);return i-360*Math.floor(i/360)}}function Gp(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var S5=180/Math.PI,U3={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Bq(t,e,n,r,i,s){var o,a,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,u/=a),t*r<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*S5,skewX:Math.atan(u)*S5,scaleX:o,scaleY:a}}var z1;function o0t(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?U3:Bq(e.a,e.b,e.c,e.d,e.e,e.f)}function a0t(t){return t==null||(z1||(z1=document.createElementNS("http://www.w3.org/2000/svg","g")),z1.setAttribute("transform",t),!(t=z1.transform.baseVal.consolidate()))?U3:(t=t.matrix,Bq(t.a,t.b,t.c,t.d,t.e,t.f))}function Pq(t,e,n,r){function i(c){return c.length?c.pop()+" ":""}function s(c,l,f,d,h,p){if(c!==f||l!==d){var g=h.push("translate(",null,e,null,n);p.push({i:g-4,x:qn(c,f)},{i:g-2,x:qn(l,d)})}else(f||d)&&h.push("translate("+f+e+d+n)}function o(c,l,f,d){c!==l?(c-l>180?l+=360:l-c>180&&(c+=360),d.push({i:f.push(i(f)+"rotate(",null,r)-2,x:qn(c,l)})):l&&f.push(i(f)+"rotate("+l+r)}function a(c,l,f,d){c!==l?d.push({i:f.push(i(f)+"skewX(",null,r)-2,x:qn(c,l)}):l&&f.push(i(f)+"skewX("+l+r)}function u(c,l,f,d,h,p){if(c!==f||l!==d){var g=h.push(i(h)+"scale(",null,",",null,")");p.push({i:g-4,x:qn(c,f)},{i:g-2,x:qn(l,d)})}else(f!==1||d!==1)&&h.push(i(h)+"scale("+f+","+d+")")}return function(c,l){var f=[],d=[];return c=t(c),l=t(l),s(c.translateX,c.translateY,l.translateX,l.translateY,f,d),o(c.rotate,l.rotate,f,d),a(c.skewX,l.skewX,f,d),u(c.scaleX,c.scaleY,l.scaleX,l.scaleY,f,d),c=l=null,function(h){for(var p=-1,g=d.length,m;++p<g;)f[(m=d[p]).i]=m.x(h);return f.join("")}}}var zq=Pq(o0t,"px, ","px)","deg)"),Uq=Pq(a0t,", ",")",")"),u0t=1e-12;function E5(t){return((t=Math.exp(t))+1/t)/2}function c0t(t){return((t=Math.exp(t))-1/t)/2}function l0t(t){return((t=Math.exp(2*t))-1)/(t+1)}const f0t=function t(e,n,r){function i(s,o){var a=s[0],u=s[1],c=s[2],l=o[0],f=o[1],d=o[2],h=l-a,p=f-u,g=h*h+p*p,m,y;if(g<u0t)y=Math.log(d/c)/e,m=function(_){return[a+_*h,u+_*p,c*Math.exp(e*_*y)]};else{var b=Math.sqrt(g),w=(d*d-c*c+r*g)/(2*c*n*b),v=(d*d-c*c-r*g)/(2*d*n*b),x=Math.log(Math.sqrt(w*w+1)-w),S=Math.log(Math.sqrt(v*v+1)-v);y=(S-x)/e,m=function(_){var E=_*y,A=E5(x),$=c/(n*b)*(A*l0t(e*E+x)-c0t(x));return[a+$*h,u+$*p,c*A/E5(e*E+x)]}}return m.duration=y*1e3*e/Math.SQRT2,m}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,u=a*a;return t(o,a,u)},i}(Math.SQRT2,2,4);function jq(t){return function(e,n){var r=t((e=Aw(e)).h,(n=Aw(n)).h),i=In(e.s,n.s),s=In(e.l,n.l),o=In(e.opacity,n.opacity);return function(a){return e.h=r(a),e.s=i(a),e.l=s(a),e.opacity=o(a),e+""}}}const qq=jq(z2);var d0t=jq(In);function Wq(t,e){var n=In((t=Tw(t)).l,(e=Tw(e)).l),r=In(t.a,e.a),i=In(t.b,e.b),s=In(t.opacity,e.opacity);return function(o){return t.l=n(o),t.a=r(o),t.b=i(o),t.opacity=s(o),t+""}}function Vq(t){return function(e,n){var r=t((e=kw(e)).h,(n=kw(n)).h),i=In(e.c,n.c),s=In(e.l,n.l),o=In(e.opacity,n.opacity);return function(a){return e.h=r(a),e.c=i(a),e.l=s(a),e.opacity=o(a),e+""}}}const Gq=Vq(z2);var h0t=Vq(In);function Yq(t){return function e(n){n=+n;function r(i,s){var o=t((i=Ko(i)).h,(s=Ko(s)).h),a=In(i.s,s.s),u=In(i.l,s.l),c=In(i.opacity,s.opacity);return function(l){return i.h=o(l),i.s=a(l),i.l=u(Math.pow(l,n)),i.opacity=c(l),i+""}}return r.gamma=e,r}(1)}const p0t=Yq(z2);var U2=Yq(In);function Yp(t,e){e===void 0&&(e=t,t=ku);for(var n=0,r=e.length-1,i=e[0],s=new Array(r<0?0:r);n<r;)s[n]=t(i,i=e[++n]);return function(o){var a=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return s[a](o-a)}}function fs(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t(r/(e-1));return n}const g0t=Object.freeze(Object.defineProperty({__proto__:null,interpolate:ku,interpolateArray:e0t,interpolateBasis:Mq,interpolateBasisClosed:Cq,interpolateCubehelix:p0t,interpolateCubehelixLong:U2,interpolateDate:Dq,interpolateDiscrete:i0t,interpolateHcl:Gq,interpolateHclLong:h0t,interpolateHsl:qq,interpolateHslLong:d0t,interpolateHue:s0t,interpolateLab:Wq,interpolateNumber:qn,interpolateNumberArray:CC,interpolateObject:Lq,interpolateRgb:zc,interpolateRgbBasis:Nq,interpolateRgbBasisClosed:t0t,interpolateRound:Gp,interpolateString:IC,interpolateTransformCss:zq,interpolateTransformSvg:Uq,interpolateZoom:f0t,piecewise:Yp,quantize:fs},Symbol.toStringTag,{value:"Module"}));var Kh=0,vm=0,Rg=0,Hq=1e3,Mw,wm,Cw=0,If=0,j2=0,E0=typeof performance=="object"&&performance.now?performance:Date,Xq=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function q2(){return If||(Xq(m0t),If=E0.now()+j2)}function m0t(){If=0}function A0(){this._call=this._time=this._next=null}A0.prototype=FC.prototype={constructor:A0,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?q2():+n)+(e==null?0:+e),!this._next&&wm!==this&&(wm?wm._next=this:Mw=this,wm=this),this._call=t,this._time=n,j3()},stop:function(){this._call&&(this._call=null,this._time=1/0,j3())}};function FC(t,e,n){var r=new A0;return r.restart(t,e,n),r}function y0t(){q2(),++Kh;for(var t=Mw,e;t;)(e=If-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Kh}function A5(){If=(Cw=E0.now())+j2,Kh=vm=0;try{y0t()}finally{Kh=0,v0t(),If=0}}function b0t(){var t=E0.now(),e=t-Cw;e>Hq&&(j2-=e,Cw=t)}function v0t(){for(var t,e=Mw,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Mw=n);wm=t,j3(r)}function j3(t){if(!Kh){vm&&(vm=clearTimeout(vm));var e=t-If;e>24?(t<1/0&&(vm=setTimeout(A5,t-E0.now()-j2)),Rg&&(Rg=clearInterval(Rg))):(Rg||(Cw=E0.now(),Rg=setInterval(b0t,Hq)),Kh=1,Xq(A5))}}function $5(t,e,n){var r=new A0;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}function w0t(t,e,n){var r=new A0,i=e;return e==null?(r.restart(t,e,n),r):(r._restart=r.restart,r.restart=function(s,o,a){o=+o,a=a==null?q2():+a,r._restart(function u(c){c+=i,r._restart(u,i+=o,a),s(c)},o,a)},r.restart(t,e,n),r)}var x0t=R2("start","end","cancel","interrupt"),_0t=[],Kq=0,T5=1,q3=2,sv=3,k5=4,W3=5,ov=6;function W2(t,e,n,r,i,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;S0t(t,n,{name:e,index:r,group:i,on:x0t,tween:_0t,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Kq})}function NC(t,e){var n=to(t,e);if(n.state>Kq)throw new Error("too late; already scheduled");return n}function fa(t,e){var n=to(t,e);if(n.state>sv)throw new Error("too late; already running");return n}function to(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function S0t(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=FC(s,0,n.time);function s(c){n.state=T5,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var l,f,d,h;if(n.state!==T5)return u();for(l in r)if(h=r[l],h.name===n.name){if(h.state===sv)return $5(o);h.state===k5?(h.state=ov,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete r[l]):+l<e&&(h.state=ov,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete r[l])}if($5(function(){n.state===sv&&(n.state=k5,n.timer.restart(a,n.delay,n.time),a(c))}),n.state=q3,n.on.call("start",t,t.__data__,n.index,n.group),n.state===q3){for(n.state=sv,i=new Array(d=n.tween.length),l=0,f=-1;l<d;++l)(h=n.tween[l].value.call(t,t.__data__,n.index,n.group))&&(i[++f]=h);i.length=f+1}}function a(c){for(var l=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(u),n.state=W3,1),f=-1,d=i.length;++f<d;)i[f].call(t,l);n.state===W3&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=ov,n.timer.stop(),delete r[e];for(var c in r)return;delete t.__transition}}function V3(t,e){var n=t.__transition,r,i,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){s=!1;continue}i=r.state>q3&&r.state<W3,r.state=ov,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}s&&delete t.__transition}}function E0t(t){return this.each(function(){V3(this,t)})}function A0t(t,e){var n,r;return function(){var i=fa(this,t),s=i.tween;if(s!==n){r=n=s;for(var o=0,a=r.length;o<a;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function $0t(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=fa(this,t),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:e,value:n},u=0,c=i.length;u<c;++u)if(i[u].name===e){i[u]=a;break}u===c&&i.push(a)}s.tween=i}}function T0t(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=to(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?A0t:$0t)(n,t,e))}function OC(t,e,n){var r=t._id;return t.each(function(){var i=fa(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return to(i,r).value[e]}}function Qq(t,e){var n;return(typeof e=="number"?qn:e instanceof Pc?zc:(n=Pc(e))?(e=n,zc):IC)(t,e)}function k0t(t){return function(){this.removeAttribute(t)}}function M0t(t){return function(){this.removeAttributeNS(t.space,t.local)}}function C0t(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttribute(t);return o===i?null:o===r?s:s=e(r=o,n)}}function I0t(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?s:s=e(r=o,n)}}function F0t(t,e,n){var r,i,s;return function(){var o,a=n(this),u;return a==null?void this.removeAttribute(t):(o=this.getAttribute(t),u=a+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,a)))}}function N0t(t,e,n){var r,i,s;return function(){var o,a=n(this),u;return a==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),u=a+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,a)))}}function O0t(t,e){var n=D2(t),r=n==="transform"?Uq:Qq;return this.attrTween(t,typeof e=="function"?(n.local?N0t:F0t)(n,r,OC(this,"attr."+t,e)):e==null?(n.local?M0t:k0t)(n):(n.local?I0t:C0t)(n,r,e))}function R0t(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function D0t(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function L0t(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&D0t(t,s)),n}return i._value=e,i}function B0t(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&R0t(t,s)),n}return i._value=e,i}function P0t(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=D2(t);return this.tween(n,(r.local?L0t:B0t)(r,e))}function z0t(t,e){return function(){NC(this,t).delay=+e.apply(this,arguments)}}function U0t(t,e){return e=+e,function(){NC(this,t).delay=e}}function j0t(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?z0t:U0t)(e,t)):to(this.node(),e).delay}function q0t(t,e){return function(){fa(this,t).duration=+e.apply(this,arguments)}}function W0t(t,e){return e=+e,function(){fa(this,t).duration=e}}function V0t(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?q0t:W0t)(e,t)):to(this.node(),e).duration}function G0t(t,e){if(typeof e!="function")throw new Error;return function(){fa(this,t).ease=e}}function Y0t(t){var e=this._id;return arguments.length?this.each(G0t(e,t)):to(this.node(),e).ease}function H0t(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;fa(this,t).ease=n}}function X0t(t){if(typeof t!="function")throw new Error;return this.each(H0t(this._id,t))}function K0t(t){typeof t!="function"&&(t=aq(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,a=r[i]=[],u,c=0;c<o;++c)(u=s[c])&&t.call(u,u.__data__,c,s)&&a.push(u);return new mu(r,this._parents,this._name,this._id)}function Q0t(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var u=e[a],c=n[a],l=u.length,f=o[a]=new Array(l),d,h=0;h<l;++h)(d=u[h]||c[h])&&(f[h]=d);for(;a<r;++a)o[a]=e[a];return new mu(o,this._parents,this._name,this._id)}function J0t(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Z0t(t,e,n){var r,i,s=J0t(e)?NC:fa;return function(){var o=s(this,t),a=o.on;a!==r&&(i=(r=a).copy()).on(e,n),o.on=i}}function tyt(t,e){var n=this._id;return arguments.length<2?to(this.node(),n).on.on(t):this.each(Z0t(n,t,e))}function eyt(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function nyt(){return this.on("end.remove",eyt(this._id))}function ryt(t){var e=this._name,n=this._id;typeof t!="function"&&(t=AC(t));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a=r[o],u=a.length,c=s[o]=new Array(u),l,f,d=0;d<u;++d)(l=a[d])&&(f=t.call(l,l.__data__,d,a))&&("__data__"in l&&(f.__data__=l.__data__),c[d]=f,W2(c[d],e,n,d,c,to(l,n)));return new mu(s,this._parents,e,n)}function iyt(t){var e=this._name,n=this._id;typeof t!="function"&&(t=oq(t));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var u=r[a],c=u.length,l,f=0;f<c;++f)if(l=u[f]){for(var d=t.call(l,l.__data__,f,u),h,p=to(l,n),g=0,m=d.length;g<m;++g)(h=d[g])&&W2(h,e,n,g,d,p);s.push(d),o.push(l)}return new mu(s,o,e,n)}var syt=xy.prototype.constructor;function oyt(){return new syt(this._groups,this._parents)}function ayt(t,e){var n,r,i;return function(){var s=Hh(this,t),o=(this.style.removeProperty(t),Hh(this,t));return s===o?null:s===n&&o===r?i:i=e(n=s,r=o)}}function Jq(t){return function(){this.style.removeProperty(t)}}function uyt(t,e,n){var r,i=n+"",s;return function(){var o=Hh(this,t);return o===i?null:o===r?s:s=e(r=o,n)}}function cyt(t,e,n){var r,i,s;return function(){var o=Hh(this,t),a=n(this),u=a+"";return a==null&&(u=a=(this.style.removeProperty(t),Hh(this,t))),o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,a))}}function lyt(t,e){var n,r,i,s="style."+e,o="end."+s,a;return function(){var u=fa(this,t),c=u.on,l=u.value[s]==null?a||(a=Jq(e)):void 0;(c!==n||i!==l)&&(r=(n=c).copy()).on(o,i=l),u.on=r}}function fyt(t,e,n){var r=(t+="")=="transform"?zq:Qq;return e==null?this.styleTween(t,ayt(t,r)).on("end.style."+t,Jq(t)):typeof e=="function"?this.styleTween(t,cyt(t,r,OC(this,"style."+t,e))).each(lyt(this._id,t)):this.styleTween(t,uyt(t,r,e),n).on("end.style."+t,null)}function dyt(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function hyt(t,e,n){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&dyt(t,o,n)),r}return s._value=e,s}function pyt(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,hyt(t,e,n??""))}function gyt(t){return function(){this.textContent=t}}function myt(t){return function(){var e=t(this);this.textContent=e??""}}function yyt(t){return this.tween("text",typeof t=="function"?myt(OC(this,"text",t)):gyt(t==null?"":t+""))}function byt(t){return function(e){this.textContent=t.call(this,e)}}function vyt(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&byt(i)),e}return r._value=t,r}function wyt(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,vyt(t))}function xyt(){for(var t=this._name,e=this._id,n=Zq(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,u,c=0;c<a;++c)if(u=o[c]){var l=to(u,e);W2(u,t,n,c,o,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new mu(r,this._parents,t,n)}function _yt(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var a={value:o},u={value:function(){--i===0&&s()}};n.each(function(){var c=fa(this,r),l=c.on;l!==t&&(e=(t=l).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(u)),c.on=e}),i===0&&s()})}var Syt=0;function mu(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Zq(){return++Syt}var $a=xy.prototype;mu.prototype={constructor:mu,select:ryt,selectAll:iyt,selectChild:$a.selectChild,selectChildren:$a.selectChildren,filter:K0t,merge:Q0t,selection:oyt,transition:xyt,call:$a.call,nodes:$a.nodes,node:$a.node,size:$a.size,empty:$a.empty,each:$a.each,on:tyt,attr:O0t,attrTween:P0t,style:fyt,styleTween:pyt,text:yyt,textTween:wyt,remove:nyt,tween:T0t,delay:j0t,duration:V0t,ease:Y0t,easeVarying:X0t,end:_yt,[Symbol.iterator]:$a[Symbol.iterator]};function Eyt(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Ayt={time:null,delay:0,duration:250,ease:Eyt};function $yt(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Tyt(t){var e,n;t instanceof mu?(e=t._id,t=t._name):(e=Zq(),(n=Ayt).time=q2(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,u,c=0;c<a;++c)(u=o[c])&&W2(u,t,e,c,o,n||$yt(u,e));return new mu(r,this._parents,t,e)}xy.prototype.interrupt=E0t;xy.prototype.transition=Tyt;const KE=t=>()=>t;function kyt(t,{sourceEvent:e,target:n,selection:r,mode:i,dispatch:s}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},selection:{value:r,enumerable:!0,configurable:!0},mode:{value:i,enumerable:!0,configurable:!0},_:{value:s}})}function Myt(t){t.stopImmediatePropagation()}function QE(t){t.preventDefault(),t.stopImmediatePropagation()}var M5={name:"drag"},JE={name:"space"},Id={name:"handle"},Fd={name:"center"};const{abs:C5,max:ir,min:sr}=Math;function I5(t){return[+t[0],+t[1]]}function F5(t){return[I5(t[0]),I5(t[1])]}var av={name:"x",handles:["w","e"].map(Iw),input:function(t,e){return t==null?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},uv={name:"y",handles:["n","s"].map(Iw),input:function(t,e){return t==null?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},Ta={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},N5={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},O5={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},Cyt={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Iyt={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function Iw(t){return{type:t}}function Fyt(t){return!t.ctrlKey&&!t.button}function Nyt(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function Oyt(){return navigator.maxTouchPoints||"ontouchstart"in this}function ZE(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function Ryt(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function Dyt(){return tW(av)}function Lyt(){return tW(uv)}function tW(t){var e=Nyt,n=Fyt,r=Oyt,i=!0,s=R2("start","brush","end"),o=6,a;function u(m){var y=m.property("__brush",g).selectAll(".overlay").data([Iw("overlay")]);y.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Ta.overlay).merge(y).each(function(){var w=ZE(this).extent;fr(this).attr("x",w[0][0]).attr("y",w[0][1]).attr("width",w[1][0]-w[0][0]).attr("height",w[1][1]-w[0][1])}),m.selectAll(".selection").data([Iw("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Ta.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var b=m.selectAll(".handle").data(t.handles,function(w){return w.type});b.exit().remove(),b.enter().append("rect").attr("class",function(w){return"handle handle--"+w.type}).attr("cursor",function(w){return Ta[w.type]}),m.each(c).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",d).filter(r).on("touchstart.brush",d).on("touchmove.brush",h).on("touchend.brush touchcancel.brush",p).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}u.move=function(m,y,b){m.tween?m.on("start.brush",function(w){l(this,arguments).beforestart().start(w)}).on("interrupt.brush end.brush",function(w){l(this,arguments).end(w)}).tween("brush",function(){var w=this,v=w.__brush,x=l(w,arguments),S=v.selection,_=t.input(typeof y=="function"?y.apply(this,arguments):y,v.extent),E=ku(S,_);function A($){v.selection=$===1&&_===null?null:E($),c.call(w),x.brush()}return S!==null&&_!==null?A:A(1)}):m.each(function(){var w=this,v=arguments,x=w.__brush,S=t.input(typeof y=="function"?y.apply(w,v):y,x.extent),_=l(w,v).beforestart();V3(w),x.selection=S===null?null:S,c.call(w),_.start(b).brush(b).end(b)})},u.clear=function(m,y){u.move(m,null,y)};function c(){var m=fr(this),y=ZE(this).selection;y?(m.selectAll(".selection").style("display",null).attr("x",y[0][0]).attr("y",y[0][1]).attr("width",y[1][0]-y[0][0]).attr("height",y[1][1]-y[0][1]),m.selectAll(".handle").style("display",null).attr("x",function(b){return b.type[b.type.length-1]==="e"?y[1][0]-o/2:y[0][0]-o/2}).attr("y",function(b){return b.type[0]==="s"?y[1][1]-o/2:y[0][1]-o/2}).attr("width",function(b){return b.type==="n"||b.type==="s"?y[1][0]-y[0][0]+o:o}).attr("height",function(b){return b.type==="e"||b.type==="w"?y[1][1]-y[0][1]+o:o})):m.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function l(m,y,b){var w=m.__brush.emitter;return w&&(!b||!w.clean)?w:new f(m,y,b)}function f(m,y,b){this.that=m,this.args=y,this.state=m.__brush,this.active=0,this.clean=b}f.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(m,y){return this.starting?(this.starting=!1,this.emit("start",m,y)):this.emit("brush",m),this},brush:function(m,y){return this.emit("brush",m,y),this},end:function(m,y){return--this.active===0&&(delete this.state.emitter,this.emit("end",m,y)),this},emit:function(m,y,b){var w=fr(this.that).datum();s.call(m,this.that,new kyt(m,{sourceEvent:y,target:u,selection:t.output(this.state.selection),mode:b,dispatch:s}),w)}};function d(m){if(a&&!m.touches||!n.apply(this,arguments))return;var y=this,b=m.target.__data__.type,w=(i&&m.metaKey?b="overlay":b)==="selection"?M5:i&&m.altKey?Fd:Id,v=t===uv?null:Cyt[b],x=t===av?null:Iyt[b],S=ZE(y),_=S.extent,E=S.selection,A=_[0][0],$,T,C=_[0][1],F,M,k=_[1][0],I,N,R=_[1][1],D,L,P=0,B=0,G,ct=v&&x&&i&&m.shiftKey,Z,lt,et=Array.from(m.touches||[m],ht=>{const ie=ht.identifier;return ht=L3(ht,y),ht.point0=ht.slice(),ht.identifier=ie,ht});V3(y);var ut=l(y,arguments,!0).beforestart();if(b==="overlay"){E&&(G=!0);const ht=[et[0],et[1]||et[0]];S.selection=E=[[$=t===uv?A:sr(ht[0][0],ht[1][0]),F=t===av?C:sr(ht[0][1],ht[1][1])],[I=t===uv?k:ir(ht[0][0],ht[1][0]),D=t===av?R:ir(ht[0][1],ht[1][1])]],et.length>1&&Ot(m)}else $=E[0][0],F=E[0][1],I=E[1][0],D=E[1][1];T=$,M=F,N=I,L=D;var V=fr(y).attr("pointer-events","none"),rt=V.selectAll(".overlay").attr("cursor",Ta[b]);if(m.touches)ut.moved=q,ut.ended=yt;else{var dt=fr(m.view).on("mousemove.brush",q,!0).on("mouseup.brush",yt,!0);i&&dt.on("keydown.brush",Wt,!0).on("keyup.brush",qt,!0),Lmt(m.view)}c.call(y),ut.start(m,w.name);function q(ht){for(const ie of ht.changedTouches||[ht])for(const vi of et)vi.identifier===ie.identifier&&(vi.cur=L3(ie,y));if(ct&&!Z&&!lt&&et.length===1){const ie=et[0];C5(ie.cur[0]-ie[0])>C5(ie.cur[1]-ie[1])?lt=!0:Z=!0}for(const ie of et)ie.cur&&(ie[0]=ie.cur[0],ie[1]=ie.cur[1]);G=!0,QE(ht),Ot(ht)}function Ot(ht){const ie=et[0],vi=ie.point0;var po;switch(P=ie[0]-vi[0],B=ie[1]-vi[1],w){case JE:case M5:{v&&(P=ir(A-$,sr(k-I,P)),T=$+P,N=I+P),x&&(B=ir(C-F,sr(R-D,B)),M=F+B,L=D+B);break}case Id:{et[1]?(v&&(T=ir(A,sr(k,et[0][0])),N=ir(A,sr(k,et[1][0])),v=1),x&&(M=ir(C,sr(R,et[0][1])),L=ir(C,sr(R,et[1][1])),x=1)):(v<0?(P=ir(A-$,sr(k-$,P)),T=$+P,N=I):v>0&&(P=ir(A-I,sr(k-I,P)),T=$,N=I+P),x<0?(B=ir(C-F,sr(R-F,B)),M=F+B,L=D):x>0&&(B=ir(C-D,sr(R-D,B)),M=F,L=D+B));break}case Fd:{v&&(T=ir(A,sr(k,$-P*v)),N=ir(A,sr(k,I+P*v))),x&&(M=ir(C,sr(R,F-B*x)),L=ir(C,sr(R,D+B*x)));break}}N<T&&(v*=-1,po=$,$=I,I=po,po=T,T=N,N=po,b in N5&&rt.attr("cursor",Ta[b=N5[b]])),L<M&&(x*=-1,po=F,F=D,D=po,po=M,M=L,L=po,b in O5&&rt.attr("cursor",Ta[b=O5[b]])),S.selection&&(E=S.selection),Z&&(T=E[0][0],N=E[1][0]),lt&&(M=E[0][1],L=E[1][1]),(E[0][0]!==T||E[0][1]!==M||E[1][0]!==N||E[1][1]!==L)&&(S.selection=[[T,M],[N,L]],c.call(y),ut.brush(ht,w.name))}function yt(ht){if(Myt(ht),ht.touches){if(ht.touches.length)return;a&&clearTimeout(a),a=setTimeout(function(){a=null},500)}else Bmt(ht.view,G),dt.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);V.attr("pointer-events","all"),rt.attr("cursor",Ta.overlay),S.selection&&(E=S.selection),Ryt(E)&&(S.selection=null,c.call(y)),ut.end(ht,w.name)}function Wt(ht){switch(ht.keyCode){case 16:{ct=v&&x;break}case 18:{w===Id&&(v&&(I=N-P*v,$=T+P*v),x&&(D=L-B*x,F=M+B*x),w=Fd,Ot(ht));break}case 32:{(w===Id||w===Fd)&&(v<0?I=N-P:v>0&&($=T-P),x<0?D=L-B:x>0&&(F=M-B),w=JE,rt.attr("cursor",Ta.selection),Ot(ht));break}default:return}QE(ht)}function qt(ht){switch(ht.keyCode){case 16:{ct&&(Z=lt=ct=!1,Ot(ht));break}case 18:{w===Fd&&(v<0?I=N:v>0&&($=T),x<0?D=L:x>0&&(F=M),w=Id,Ot(ht));break}case 32:{w===JE&&(ht.altKey?(v&&(I=N-P*v,$=T+P*v),x&&(D=L-B*x,F=M+B*x),w=Fd):(v<0?I=N:v>0&&($=T),x<0?D=L:x>0&&(F=M),w=Id),rt.attr("cursor",Ta[b]),Ot(ht));break}default:return}QE(ht)}}function h(m){l(this,arguments).moved(m)}function p(m){l(this,arguments).ended(m)}function g(){var m=this.__brush||{selection:null};return m.extent=F5(e.apply(this,arguments)),m.dim=t,m}return u.extent=function(m){return arguments.length?(e=typeof m=="function"?m:KE(F5(m)),u):e},u.filter=function(m){return arguments.length?(n=typeof m=="function"?m:KE(!!m),u):n},u.touchable=function(m){return arguments.length?(r=typeof m=="function"?m:KE(!!m),u):r},u.handleSize=function(m){return arguments.length?(o=+m,u):o},u.keyModifiers=function(m){return arguments.length?(i=!!m,u):i},u.on=function(){var m=s.on.apply(s,arguments);return m===s?u:m},u}const G3=Math.PI,Y3=2*G3,jl=1e-6,Byt=Y3-jl;function eW(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function Pyt(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return eW;const n=10**e;return function(r){this._+=r[0];for(let i=1,s=r.length;i<s;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}let V2=class{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?eW:Pyt(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,i){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,n,r,i,s,o){this._append`C${+e},${+n},${+r},${+i},${this._x1=+s},${this._y1=+o}`}arcTo(e,n,r,i,s){if(e=+e,n=+n,r=+r,i=+i,s=+s,s<0)throw new Error(`negative radius: ${s}`);let o=this._x1,a=this._y1,u=r-e,c=i-n,l=o-e,f=a-n,d=l*l+f*f;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(d>jl)if(!(Math.abs(f*u-c*l)>jl)||!s)this._append`L${this._x1=e},${this._y1=n}`;else{let h=r-o,p=i-a,g=u*u+c*c,m=h*h+p*p,y=Math.sqrt(g),b=Math.sqrt(d),w=s*Math.tan((G3-Math.acos((g+d-m)/(2*y*b)))/2),v=w/b,x=w/y;Math.abs(v-1)>jl&&this._append`L${e+v*l},${n+v*f}`,this._append`A${s},${s},0,0,${+(f*h>l*p)},${this._x1=e+x*u},${this._y1=n+x*c}`}}arc(e,n,r,i,s,o){if(e=+e,n=+n,r=+r,o=!!o,r<0)throw new Error(`negative radius: ${r}`);let a=r*Math.cos(i),u=r*Math.sin(i),c=e+a,l=n+u,f=1^o,d=o?i-s:s-i;this._x1===null?this._append`M${c},${l}`:(Math.abs(this._x1-c)>jl||Math.abs(this._y1-l)>jl)&&this._append`L${c},${l}`,r&&(d<0&&(d=d%Y3+Y3),d>Byt?this._append`A${r},${r},0,1,${f},${e-a},${n-u}A${r},${r},0,1,${f},${this._x1=c},${this._y1=l}`:d>jl&&this._append`A${r},${r},0,${+(d>=G3)},${f},${this._x1=e+r*Math.cos(s)},${this._y1=n+r*Math.sin(s)}`)}rect(e,n,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}};function G2(){return new V2}G2.prototype=V2.prototype;function Qa(t=3){return new V2(+t)}var zyt=Array.prototype,nW=zyt.slice;function Uyt(t,e){return t-e}function jyt(t){for(var e=0,n=t.length,r=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)r+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return r}const tc=t=>()=>t;function qyt(t,e){for(var n=-1,r=e.length,i;++n<r;)if(i=Wyt(t,e[n]))return i;return 0}function Wyt(t,e){for(var n=e[0],r=e[1],i=-1,s=0,o=t.length,a=o-1;s<o;a=s++){var u=t[s],c=u[0],l=u[1],f=t[a],d=f[0],h=f[1];if(Vyt(u,f,e))return 0;l>r!=h>r&&n<(d-c)*(r-l)/(h-l)+c&&(i=-i)}return i}function Vyt(t,e,n){var r;return Gyt(t,e,n)&&Yyt(t[r=+(t[0]===e[0])],n[r],e[r])}function Gyt(t,e,n){return(e[0]-t[0])*(n[1]-t[1])===(n[0]-t[0])*(e[1]-t[1])}function Yyt(t,e,n){return t<=e&&e<=n||n<=e&&e<=t}function Hyt(){}var ka=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function H3(){var t=1,e=1,n=SC,r=u;function i(c){var l=n(c);if(Array.isArray(l))l=l.slice().sort(Uyt);else{const f=pn(c,Xyt);for(l=Lc(...Zj(f[0],f[1],l),l);l[l.length-1]>=f[1];)l.pop();for(;l[1]<f[0];)l.shift()}return l.map(f=>s(c,f))}function s(c,l){const f=l==null?NaN:+l;if(isNaN(f))throw new Error(`invalid value: ${l}`);var d=[],h=[];return o(c,f,function(p){r(p,c,f),jyt(p)>0?d.push([p]):h.push(p)}),h.forEach(function(p){for(var g=0,m=d.length,y;g<m;++g)if(qyt((y=d[g])[0],p)!==-1){y.push(p);return}}),{type:"MultiPolygon",value:l,coordinates:d}}function o(c,l,f){var d=new Array,h=new Array,p,g,m,y,b,w;for(p=g=-1,y=Tl(c[0],l),ka[y<<1].forEach(v);++p<t-1;)m=y,y=Tl(c[p+1],l),ka[m|y<<1].forEach(v);for(ka[y<<0].forEach(v);++g<e-1;){for(p=-1,y=Tl(c[g*t+t],l),b=Tl(c[g*t],l),ka[y<<1|b<<2].forEach(v);++p<t-1;)m=y,y=Tl(c[g*t+t+p+1],l),w=b,b=Tl(c[g*t+p+1],l),ka[m|y<<1|b<<2|w<<3].forEach(v);ka[y|b<<3].forEach(v)}for(p=-1,b=c[g*t]>=l,ka[b<<2].forEach(v);++p<t-1;)w=b,b=Tl(c[g*t+p+1],l),ka[b<<2|w<<3].forEach(v);ka[b<<3].forEach(v);function v(x){var S=[x[0][0]+p,x[0][1]+g],_=[x[1][0]+p,x[1][1]+g],E=a(S),A=a(_),$,T;($=h[E])?(T=d[A])?(delete h[$.end],delete d[T.start],$===T?($.ring.push(_),f($.ring)):d[$.start]=h[T.end]={start:$.start,end:T.end,ring:$.ring.concat(T.ring)}):(delete h[$.end],$.ring.push(_),h[$.end=A]=$):($=d[A])?(T=h[E])?(delete d[$.start],delete h[T.end],$===T?($.ring.push(_),f($.ring)):d[T.start]=h[$.end]={start:T.start,end:$.end,ring:T.ring.concat($.ring)}):(delete d[$.start],$.ring.unshift(S),d[$.start=E]=$):d[E]=h[A]={start:E,end:A,ring:[S,_]}}}function a(c){return c[0]*2+c[1]*(t+1)*4}function u(c,l,f){c.forEach(function(d){var h=d[0],p=d[1],g=h|0,m=p|0,y=tA(l[m*t+g]);h>0&&h<t&&g===h&&(d[0]=R5(h,tA(l[m*t+g-1]),y,f)),p>0&&p<e&&m===p&&(d[1]=R5(p,tA(l[(m-1)*t+g]),y,f))})}return i.contour=s,i.size=function(c){if(!arguments.length)return[t,e];var l=Math.floor(c[0]),f=Math.floor(c[1]);if(!(l>=0&&f>=0))throw new Error("invalid size");return t=l,e=f,i},i.thresholds=function(c){return arguments.length?(n=typeof c=="function"?c:Array.isArray(c)?tc(nW.call(c)):tc(c),i):n},i.smooth=function(c){return arguments.length?(r=c?u:Hyt,i):r===u},i}function Xyt(t){return isFinite(t)?t:NaN}function Tl(t,e){return t==null?!1:+t>=e}function tA(t){return t==null||isNaN(t=+t)?-1/0:t}function R5(t,e,n,r){const i=r-e,s=n-e,o=isFinite(i)||isFinite(s)?i/s:Math.sign(i)/Math.sign(s);return isNaN(o)?t:t+o-.5}function Kyt(t){return t[0]}function Qyt(t){return t[1]}function Jyt(){return 1}function Zyt(){var t=Kyt,e=Qyt,n=Jyt,r=960,i=500,s=20,o=2,a=s*3,u=r+a*2>>o,c=i+a*2>>o,l=tc(20);function f(b){var w=new Float32Array(u*c),v=Math.pow(2,-o),x=-1;for(const F of b){var S=(t(F,++x,b)+a)*v,_=(e(F,x,b)+a)*v,E=+n(F,x,b);if(E&&S>=0&&S<u&&_>=0&&_<c){var A=Math.floor(S),$=Math.floor(_),T=S-A-.5,C=_-$-.5;w[A+$*u]+=(1-T)*(1-C)*E,w[A+1+$*u]+=T*(1-C)*E,w[A+1+($+1)*u]+=T*C*E,w[A+($+1)*u]+=(1-T)*C*E}}return Gj({data:w,width:u,height:c},s*v),w}function d(b){var w=f(b),v=l(w),x=Math.pow(2,2*o);return Array.isArray(v)||(v=Lc(Number.MIN_VALUE,Be(w)/x,v)),H3().size([u,c]).thresholds(v.map(S=>S*x))(w).map((S,_)=>(S.value=+v[_],h(S)))}d.contours=function(b){var w=f(b),v=H3().size([u,c]),x=Math.pow(2,2*o),S=_=>{_=+_;var E=h(v.contour(w,_*x));return E.value=_,E};return Object.defineProperty(S,"max",{get:()=>Be(w)/x}),S};function h(b){return b.coordinates.forEach(p),b}function p(b){b.forEach(g)}function g(b){b.forEach(m)}function m(b){b[0]=b[0]*Math.pow(2,o)-a,b[1]=b[1]*Math.pow(2,o)-a}function y(){return a=s*3,u=r+a*2>>o,c=i+a*2>>o,d}return d.x=function(b){return arguments.length?(t=typeof b=="function"?b:tc(+b),d):t},d.y=function(b){return arguments.length?(e=typeof b=="function"?b:tc(+b),d):e},d.weight=function(b){return arguments.length?(n=typeof b=="function"?b:tc(+b),d):n},d.size=function(b){if(!arguments.length)return[r,i];var w=+b[0],v=+b[1];if(!(w>=0&&v>=0))throw new Error("invalid size");return r=w,i=v,y()},d.cellSize=function(b){if(!arguments.length)return 1<<o;if(!((b=+b)>=1))throw new Error("invalid cell size");return o=Math.floor(Math.log(b)/Math.LN2),y()},d.thresholds=function(b){return arguments.length?(l=typeof b=="function"?b:Array.isArray(b)?tc(nW.call(b)):tc(b),d):l},d.bandwidth=function(b){if(!arguments.length)return Math.sqrt(s*(s+1));if(!((b=+b)>=0))throw new Error("invalid bandwidth");return s=(Math.sqrt(4*b*b+1)-1)/2,y()},d}const ru=11102230246251565e-32,or=134217729,t1t=(3+8*ru)*ru;function eA(t,e,n,r,i){let s,o,a,u,c=e[0],l=r[0],f=0,d=0;l>c==l>-c?(s=c,c=e[++f]):(s=l,l=r[++d]);let h=0;if(f<t&&d<n)for(l>c==l>-c?(o=c+s,a=s-(o-c),c=e[++f]):(o=l+s,a=s-(o-l),l=r[++d]),s=o,a!==0&&(i[h++]=a);f<t&&d<n;)l>c==l>-c?(o=s+c,u=o-s,a=s-(o-u)+(c-u),c=e[++f]):(o=s+l,u=o-s,a=s-(o-u)+(l-u),l=r[++d]),s=o,a!==0&&(i[h++]=a);for(;f<t;)o=s+c,u=o-s,a=s-(o-u)+(c-u),c=e[++f],s=o,a!==0&&(i[h++]=a);for(;d<n;)o=s+l,u=o-s,a=s-(o-u)+(l-u),l=r[++d],s=o,a!==0&&(i[h++]=a);return(s!==0||h===0)&&(i[h++]=s),h}function e1t(t,e){let n=e[0];for(let r=1;r<t;r++)n+=e[r];return n}function Sy(t){return new Float64Array(t)}const n1t=(3+16*ru)*ru,r1t=(2+12*ru)*ru,i1t=(9+64*ru)*ru*ru,Nd=Sy(4),D5=Sy(8),L5=Sy(12),B5=Sy(16),$r=Sy(4);function s1t(t,e,n,r,i,s,o){let a,u,c,l,f,d,h,p,g,m,y,b,w,v,x,S,_,E;const A=t-i,$=n-i,T=e-s,C=r-s;v=A*C,d=or*A,h=d-(d-A),p=A-h,d=or*C,g=d-(d-C),m=C-g,x=p*m-(v-h*g-p*g-h*m),S=T*$,d=or*T,h=d-(d-T),p=T-h,d=or*$,g=d-(d-$),m=$-g,_=p*m-(S-h*g-p*g-h*m),y=x-_,f=x-y,Nd[0]=x-(y+f)+(f-_),b=v+y,f=b-v,w=v-(b-f)+(y-f),y=w-S,f=w-y,Nd[1]=w-(y+f)+(f-S),E=b+y,f=E-b,Nd[2]=b-(E-f)+(y-f),Nd[3]=E;let F=e1t(4,Nd),M=r1t*o;if(F>=M||-F>=M||(f=t-A,a=t-(A+f)+(f-i),f=n-$,c=n-($+f)+(f-i),f=e-T,u=e-(T+f)+(f-s),f=r-C,l=r-(C+f)+(f-s),a===0&&u===0&&c===0&&l===0)||(M=i1t*o+t1t*Math.abs(F),F+=A*l+C*a-(T*c+$*u),F>=M||-F>=M))return F;v=a*C,d=or*a,h=d-(d-a),p=a-h,d=or*C,g=d-(d-C),m=C-g,x=p*m-(v-h*g-p*g-h*m),S=u*$,d=or*u,h=d-(d-u),p=u-h,d=or*$,g=d-(d-$),m=$-g,_=p*m-(S-h*g-p*g-h*m),y=x-_,f=x-y,$r[0]=x-(y+f)+(f-_),b=v+y,f=b-v,w=v-(b-f)+(y-f),y=w-S,f=w-y,$r[1]=w-(y+f)+(f-S),E=b+y,f=E-b,$r[2]=b-(E-f)+(y-f),$r[3]=E;const k=eA(4,Nd,4,$r,D5);v=A*l,d=or*A,h=d-(d-A),p=A-h,d=or*l,g=d-(d-l),m=l-g,x=p*m-(v-h*g-p*g-h*m),S=T*c,d=or*T,h=d-(d-T),p=T-h,d=or*c,g=d-(d-c),m=c-g,_=p*m-(S-h*g-p*g-h*m),y=x-_,f=x-y,$r[0]=x-(y+f)+(f-_),b=v+y,f=b-v,w=v-(b-f)+(y-f),y=w-S,f=w-y,$r[1]=w-(y+f)+(f-S),E=b+y,f=E-b,$r[2]=b-(E-f)+(y-f),$r[3]=E;const I=eA(k,D5,4,$r,L5);v=a*l,d=or*a,h=d-(d-a),p=a-h,d=or*l,g=d-(d-l),m=l-g,x=p*m-(v-h*g-p*g-h*m),S=u*c,d=or*u,h=d-(d-u),p=u-h,d=or*c,g=d-(d-c),m=c-g,_=p*m-(S-h*g-p*g-h*m),y=x-_,f=x-y,$r[0]=x-(y+f)+(f-_),b=v+y,f=b-v,w=v-(b-f)+(y-f),y=w-S,f=w-y,$r[1]=w-(y+f)+(f-S),E=b+y,f=E-b,$r[2]=b-(E-f)+(y-f),$r[3]=E;const N=eA(I,L5,4,$r,B5);return B5[N-1]}function U1(t,e,n,r,i,s){const o=(e-s)*(n-i),a=(t-i)*(r-s),u=o-a,c=Math.abs(o+a);return Math.abs(u)>=n1t*c?u:-s1t(t,e,n,r,i,s,c)}const P5=Math.pow(2,-52),j1=new Uint32Array(512);class Fw{static from(e,n=l1t,r=f1t){const i=e.length,s=new Float64Array(i*2);for(let o=0;o<i;o++){const a=e[o];s[2*o]=n(a),s[2*o+1]=r(a)}return new Fw(s)}constructor(e){const n=e.length>>1;if(n>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const r=Math.max(2*n-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:e,_hullPrev:n,_hullNext:r,_hullTri:i,_hullHash:s}=this,o=e.length>>1;let a=1/0,u=1/0,c=-1/0,l=-1/0;for(let A=0;A<o;A++){const $=e[2*A],T=e[2*A+1];$<a&&(a=$),T<u&&(u=T),$>c&&(c=$),T>l&&(l=T),this._ids[A]=A}const f=(a+c)/2,d=(u+l)/2;let h,p,g;for(let A=0,$=1/0;A<o;A++){const T=nA(f,d,e[2*A],e[2*A+1]);T<$&&(h=A,$=T)}const m=e[2*h],y=e[2*h+1];for(let A=0,$=1/0;A<o;A++){if(A===h)continue;const T=nA(m,y,e[2*A],e[2*A+1]);T<$&&T>0&&(p=A,$=T)}let b=e[2*p],w=e[2*p+1],v=1/0;for(let A=0;A<o;A++){if(A===h||A===p)continue;const $=u1t(m,y,b,w,e[2*A],e[2*A+1]);$<v&&(g=A,v=$)}let x=e[2*g],S=e[2*g+1];if(v===1/0){for(let T=0;T<o;T++)this._dists[T]=e[2*T]-e[0]||e[2*T+1]-e[1];fh(this._ids,this._dists,0,o-1);const A=new Uint32Array(o);let $=0;for(let T=0,C=-1/0;T<o;T++){const F=this._ids[T],M=this._dists[F];M>C&&(A[$++]=F,C=M)}this.hull=A.subarray(0,$),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(U1(m,y,b,w,x,S)<0){const A=p,$=b,T=w;p=g,b=x,w=S,g=A,x=$,S=T}const _=c1t(m,y,b,w,x,S);this._cx=_.x,this._cy=_.y;for(let A=0;A<o;A++)this._dists[A]=nA(e[2*A],e[2*A+1],_.x,_.y);fh(this._ids,this._dists,0,o-1),this._hullStart=h;let E=3;r[h]=n[g]=p,r[p]=n[h]=g,r[g]=n[p]=h,i[h]=0,i[p]=1,i[g]=2,s.fill(-1),s[this._hashKey(m,y)]=h,s[this._hashKey(b,w)]=p,s[this._hashKey(x,S)]=g,this.trianglesLen=0,this._addTriangle(h,p,g,-1,-1,-1);for(let A=0,$,T;A<this._ids.length;A++){const C=this._ids[A],F=e[2*C],M=e[2*C+1];if(A>0&&Math.abs(F-$)<=P5&&Math.abs(M-T)<=P5||($=F,T=M,C===h||C===p||C===g))continue;let k=0;for(let L=0,P=this._hashKey(F,M);L<this._hashSize&&(k=s[(P+L)%this._hashSize],!(k!==-1&&k!==r[k]));L++);k=n[k];let I=k,N;for(;N=r[I],U1(F,M,e[2*I],e[2*I+1],e[2*N],e[2*N+1])>=0;)if(I=N,I===k){I=-1;break}if(I===-1)continue;let R=this._addTriangle(I,C,r[I],-1,-1,i[I]);i[C]=this._legalize(R+2),i[I]=R,E++;let D=r[I];for(;N=r[D],U1(F,M,e[2*D],e[2*D+1],e[2*N],e[2*N+1])<0;)R=this._addTriangle(D,C,N,i[C],-1,i[D]),i[C]=this._legalize(R+2),r[D]=D,E--,D=N;if(I===k)for(;N=n[I],U1(F,M,e[2*N],e[2*N+1],e[2*I],e[2*I+1])<0;)R=this._addTriangle(N,C,I,-1,i[I],i[N]),this._legalize(R+2),i[N]=R,r[I]=I,E--,I=N;this._hullStart=n[C]=I,r[I]=n[D]=C,r[C]=D,s[this._hashKey(F,M)]=C,s[this._hashKey(e[2*I],e[2*I+1])]=I}this.hull=new Uint32Array(E);for(let A=0,$=this._hullStart;A<E;A++)this.hull[A]=$,$=r[$];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,n){return Math.floor(o1t(e-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:n,_halfedges:r,coords:i}=this;let s=0,o=0;for(;;){const a=r[e],u=e-e%3;if(o=u+(e+2)%3,a===-1){if(s===0)break;e=j1[--s];continue}const c=a-a%3,l=u+(e+1)%3,f=c+(a+2)%3,d=n[o],h=n[e],p=n[l],g=n[f];if(a1t(i[2*d],i[2*d+1],i[2*h],i[2*h+1],i[2*p],i[2*p+1],i[2*g],i[2*g+1])){n[e]=g,n[a]=d;const y=r[f];if(y===-1){let w=this._hullStart;do{if(this._hullTri[w]===f){this._hullTri[w]=e;break}w=this._hullPrev[w]}while(w!==this._hullStart)}this._link(e,y),this._link(a,r[o]),this._link(o,f);const b=c+(a+1)%3;s<j1.length&&(j1[s++]=b)}else{if(s===0)break;e=j1[--s]}}return o}_link(e,n){this._halfedges[e]=n,n!==-1&&(this._halfedges[n]=e)}_addTriangle(e,n,r,i,s,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=n,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function o1t(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}function nA(t,e,n,r){const i=t-n,s=e-r;return i*i+s*s}function a1t(t,e,n,r,i,s,o,a){const u=t-o,c=e-a,l=n-o,f=r-a,d=i-o,h=s-a,p=u*u+c*c,g=l*l+f*f,m=d*d+h*h;return u*(f*m-g*h)-c*(l*m-g*d)+p*(l*h-f*d)<0}function u1t(t,e,n,r,i,s){const o=n-t,a=r-e,u=i-t,c=s-e,l=o*o+a*a,f=u*u+c*c,d=.5/(o*c-a*u),h=(c*l-a*f)*d,p=(o*f-u*l)*d;return h*h+p*p}function c1t(t,e,n,r,i,s){const o=n-t,a=r-e,u=i-t,c=s-e,l=o*o+a*a,f=u*u+c*c,d=.5/(o*c-a*u),h=t+(c*l-a*f)*d,p=e+(o*f-u*l)*d;return{x:h,y:p}}function fh(t,e,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const s=t[i],o=e[s];let a=i-1;for(;a>=n&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=s}else{const i=n+r>>1;let s=n+1,o=r;Dg(t,i,s),e[t[n]]>e[t[r]]&&Dg(t,n,r),e[t[s]]>e[t[r]]&&Dg(t,s,r),e[t[n]]>e[t[s]]&&Dg(t,n,s);const a=t[s],u=e[a];for(;;){do s++;while(e[t[s]]<u);do o--;while(e[t[o]]>u);if(o<s)break;Dg(t,s,o)}t[n+1]=t[o],t[o]=a,r-s+1>=o-n?(fh(t,e,s,r),fh(t,e,n,o-1)):(fh(t,e,n,o-1),fh(t,e,s,r))}}function Dg(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function l1t(t){return t[0]}function f1t(t){return t[1]}const z5=1e-6;class nf{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,n){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,n){this._+=`L${this._x1=+e},${this._y1=+n}`}arc(e,n,r){e=+e,n=+n,r=+r;const i=e+r,s=n;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>z5||Math.abs(this._y1-s)>z5)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${e-r},${n}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(e,n,r,i){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class X3{constructor(){this._=[]}moveTo(e,n){this._.push([e,n])}closePath(){this._.push(this._[0].slice())}lineTo(e,n){this._.push([e,n])}value(){return this._.length?this._:null}}let d1t=class{constructor(e,[n,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(n=+n))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=i,this.xmin=n,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:n,triangles:r},vectors:i}=this;let s,o;const a=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let g=0,m=0,y=r.length,b,w;g<y;g+=3,m+=2){const v=r[g]*2,x=r[g+1]*2,S=r[g+2]*2,_=e[v],E=e[v+1],A=e[x],$=e[x+1],T=e[S],C=e[S+1],F=A-_,M=$-E,k=T-_,I=C-E,N=(F*I-M*k)*2;if(Math.abs(N)<1e-9){if(s===void 0){s=o=0;for(const D of n)s+=e[D*2],o+=e[D*2+1];s/=n.length,o/=n.length}const R=1e9*Math.sign((s-_)*I-(o-E)*k);b=(_+T)/2-R*I,w=(E+C)/2+R*k}else{const R=1/N,D=F*F+M*M,L=k*k+I*I;b=_+(I*D-M*L)*R,w=E+(F*L-k*D)*R}a[m]=b,a[m+1]=w}let u=n[n.length-1],c,l=u*4,f,d=e[2*u],h,p=e[2*u+1];i.fill(0);for(let g=0;g<n.length;++g)u=n[g],c=l,f=d,h=p,l=u*4,d=e[2*u],p=e[2*u+1],i[c+2]=i[l]=h-p,i[c+3]=i[l+1]=d-f}render(e){const n=e==null?e=new nf:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let l=0,f=r.length;l<f;++l){const d=r[l];if(d<l)continue;const h=Math.floor(l/3)*2,p=Math.floor(d/3)*2,g=o[h],m=o[h+1],y=o[p],b=o[p+1];this._renderSegment(g,m,y,b,e)}let u,c=s[s.length-1];for(let l=0;l<s.length;++l){u=c,c=s[l];const f=Math.floor(i[c]/3)*2,d=o[f],h=o[f+1],p=u*4,g=this._project(d,h,a[p+2],a[p+3]);g&&this._renderSegment(d,h,g[0],g[1],e)}return n&&n.value()}renderBounds(e){const n=e==null?e=new nf:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(e,n){const r=n==null?n=new nf:void 0,i=this._clip(e);if(i===null||!i.length)return;n.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(i[o]!==i[o-2]||i[o+1]!==i[o-1])&&n.lineTo(i[o],i[o+1]);return n.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let n=0,r=e.length/2;n<r;++n){const i=this.cellPolygon(n);i&&(i.index=n,yield i)}}cellPolygon(e){const n=new X3;return this.renderCell(e,n),n.value()}_renderSegment(e,n,r,i,s){let o;const a=this._regioncode(e,n),u=this._regioncode(r,i);a===0&&u===0?(s.moveTo(e,n),s.lineTo(r,i)):(o=this._clipSegment(e,n,r,i,a,u))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(e,n,r){return n=+n,n!==n||(r=+r,r!==r)?!1:this.delaunay._step(e,n,r)===e}*neighbors(e){const n=this._clip(e);if(n)for(const r of this.delaunay.neighbors(e)){const i=this._clip(r);if(i){t:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,u=i.length;a<u;a+=2)if(n[s]===i[a]&&n[s+1]===i[a+1]&&n[(s+2)%o]===i[(a+u-2)%u]&&n[(s+3)%o]===i[(a+u-1)%u]){yield r;break t}}}}_cell(e){const{circumcenters:n,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,o=r[e];if(o===-1)return null;const a=[];let u=o;do{const c=Math.floor(u/3);if(a.push(n[c*2],n[c*2+1]),u=u%3===2?u-2:u+1,s[u]!==e)break;u=i[u]}while(u!==o&&u!==-1);return a}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(e);if(n===null)return null;const{vectors:r}=this,i=e*4;return this._simplify(r[i]||r[i+1]?this._clipInfinite(e,n,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(e,n))}_clipFinite(e,n){const r=n.length;let i=null,s,o,a=n[r-2],u=n[r-1],c,l=this._regioncode(a,u),f,d=0;for(let h=0;h<r;h+=2)if(s=a,o=u,a=n[h],u=n[h+1],c=l,l=this._regioncode(a,u),c===0&&l===0)f=d,d=0,i?i.push(a,u):i=[a,u];else{let p,g,m,y,b;if(c===0){if((p=this._clipSegment(s,o,a,u,c,l))===null)continue;[g,m,y,b]=p}else{if((p=this._clipSegment(a,u,s,o,l,c))===null)continue;[y,b,g,m]=p,f=d,d=this._edgecode(g,m),f&&d&&this._edge(e,f,d,i,i.length),i?i.push(g,m):i=[g,m]}f=d,d=this._edgecode(y,b),f&&d&&this._edge(e,f,d,i,i.length),i?i.push(y,b):i=[y,b]}if(i)f=d,d=this._edgecode(i[0],i[1]),f&&d&&this._edge(e,f,d,i,i.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(e,n,r,i,s,o){const a=s<o;for(a&&([e,n,r,i,s,o]=[r,i,e,n,o,s]);;){if(s===0&&o===0)return a?[r,i,e,n]:[e,n,r,i];if(s&o)return null;let u,c,l=s||o;l&8?(u=e+(r-e)*(this.ymax-n)/(i-n),c=this.ymax):l&4?(u=e+(r-e)*(this.ymin-n)/(i-n),c=this.ymin):l&2?(c=n+(i-n)*(this.xmax-e)/(r-e),u=this.xmax):(c=n+(i-n)*(this.xmin-e)/(r-e),u=this.xmin),s?(e=u,n=c,s=this._regioncode(e,n)):(r=u,i=c,o=this._regioncode(r,i))}}_clipInfinite(e,n,r,i,s,o){let a=Array.from(n),u;if((u=this._project(a[0],a[1],r,i))&&a.unshift(u[0],u[1]),(u=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(u[0],u[1]),a=this._clipFinite(e,a))for(let c=0,l=a.length,f,d=this._edgecode(a[l-2],a[l-1]);c<l;c+=2)f=d,d=this._edgecode(a[c],a[c+1]),f&&d&&(c=this._edge(e,f,d,a,c),l=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,n,r,i,s){for(;n!==r;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(i[s]!==o||i[s+1]!==a)&&this.contains(e,o,a)&&(i.splice(s,0,o,a),s+=2)}return s}_project(e,n,r,i){let s=1/0,o,a,u;if(i<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/i)<s&&(u=this.ymin,a=e+(s=o)*r)}else if(i>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/i)<s&&(u=this.ymax,a=e+(s=o)*r)}if(r>0){if(e>=this.xmax)return null;(o=(this.xmax-e)/r)<s&&(a=this.xmax,u=n+(s=o)*i)}else if(r<0){if(e<=this.xmin)return null;(o=(this.xmin-e)/r)<s&&(a=this.xmin,u=n+(s=o)*i)}return[a,u]}_edgecode(e,n){return(e===this.xmin?1:e===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(e,n){return(e<this.xmin?1:e>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let n=0;n<e.length;n+=2){const r=(n+2)%e.length,i=(n+4)%e.length;(e[n]===e[r]&&e[r]===e[i]||e[n+1]===e[r+1]&&e[r+1]===e[i+1])&&(e.splice(r,2),n-=2)}e.length||(e=null)}return e}};const h1t=2*Math.PI,Od=Math.pow;function p1t(t){return t[0]}function g1t(t){return t[1]}function m1t(t){const{triangles:e,coords:n}=t;for(let r=0;r<e.length;r+=3){const i=2*e[r],s=2*e[r+1],o=2*e[r+2];if((n[o]-n[i])*(n[s+1]-n[i+1])-(n[s]-n[i])*(n[o+1]-n[i+1])>1e-10)return!1}return!0}function y1t(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class Mu{static from(e,n=p1t,r=g1t,i){return new Mu("length"in e?b1t(e,n,r,i):Float64Array.from(v1t(e,n,r,i)))}constructor(e){this._delaunator=new Fw(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,n=this.points;if(e.hull&&e.hull.length>2&&m1t(e)){this.collinear=Int32Array.from({length:n.length/2},(d,h)=>h).sort((d,h)=>n[2*d]-n[2*h]||n[2*d+1]-n[2*h+1]);const u=this.collinear[0],c=this.collinear[this.collinear.length-1],l=[n[2*u],n[2*u+1],n[2*c],n[2*c+1]],f=1e-8*Math.hypot(l[3]-l[1],l[2]-l[0]);for(let d=0,h=n.length/2;d<h;++d){const p=y1t(n[2*d],n[2*d+1],f);n[2*d]=p[0],n[2*d+1]=p[1]}this._delaunator=new Fw(n)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let u=0,c=r.length;u<c;++u){const l=s[u%3===2?u-2:u+1];(r[u]===-1||o[l]===-1)&&(o[l]=u)}for(let u=0,c=i.length;u<c;++u)a[i[u]]=u;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],o[i[0]]=1,i.length===2&&(o[i[1]]=0,this.triangles[1]=i[1],this.triangles[2]=i[1]))}voronoi(e){return new d1t(this,e)}*neighbors(e){const{inedges:n,hull:r,_hullIndex:i,halfedges:s,triangles:o,collinear:a}=this;if(a){const f=a.indexOf(e);f>0&&(yield a[f-1]),f<a.length-1&&(yield a[f+1]);return}const u=n[e];if(u===-1)return;let c=u,l=-1;do{if(yield l=o[c],c=c%3===2?c-2:c+1,o[c]!==e)return;if(c=s[c],c===-1){const f=r[(i[e]+1)%r.length];f!==l&&(yield f);return}}while(c!==u)}find(e,n,r=0){if(e=+e,e!==e||(n=+n,n!==n))return-1;const i=r;let s;for(;(s=this._step(r,e,n))>=0&&s!==r&&s!==i;)r=s;return s}_step(e,n,r){const{inedges:i,hull:s,_hullIndex:o,halfedges:a,triangles:u,points:c}=this;if(i[e]===-1||!c.length)return(e+1)%(c.length>>1);let l=e,f=Od(n-c[e*2],2)+Od(r-c[e*2+1],2);const d=i[e];let h=d;do{let p=u[h];const g=Od(n-c[p*2],2)+Od(r-c[p*2+1],2);if(g<f&&(f=g,l=p),h=h%3===2?h-2:h+1,u[h]!==e)break;if(h=a[h],h===-1){if(h=s[(o[e]+1)%s.length],h!==p&&Od(n-c[h*2],2)+Od(r-c[h*2+1],2)<f)return h;break}}while(h!==d);return l}render(e){const n=e==null?e=new nf:void 0,{points:r,halfedges:i,triangles:s}=this;for(let o=0,a=i.length;o<a;++o){const u=i[o];if(u<o)continue;const c=s[o]*2,l=s[u]*2;e.moveTo(r[c],r[c+1]),e.lineTo(r[l],r[l+1])}return this.renderHull(e),n&&n.value()}renderPoints(e,n){n===void 0&&(!e||typeof e.moveTo!="function")&&(n=e,e=null),n=n==null?2:+n;const r=e==null?e=new nf:void 0,{points:i}=this;for(let s=0,o=i.length;s<o;s+=2){const a=i[s],u=i[s+1];e.moveTo(a+n,u),e.arc(a,u,n,0,h1t)}return r&&r.value()}renderHull(e){const n=e==null?e=new nf:void 0,{hull:r,points:i}=this,s=r[0]*2,o=r.length;e.moveTo(i[s],i[s+1]);for(let a=1;a<o;++a){const u=2*r[a];e.lineTo(i[u],i[u+1])}return e.closePath(),n&&n.value()}hullPolygon(){const e=new X3;return this.renderHull(e),e.value()}renderTriangle(e,n){const r=n==null?n=new nf:void 0,{points:i,triangles:s}=this,o=s[e*=3]*2,a=s[e+1]*2,u=s[e+2]*2;return n.moveTo(i[o],i[o+1]),n.lineTo(i[a],i[a+1]),n.lineTo(i[u],i[u+1]),n.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:e}=this;for(let n=0,r=e.length/3;n<r;++n)yield this.trianglePolygon(n)}trianglePolygon(e){const n=new X3;return this.renderTriangle(e,n),n.value()}}function b1t(t,e,n,r){const i=t.length,s=new Float64Array(i*2);for(let o=0;o<i;++o){const a=t[o];s[o*2]=e.call(r,a,o,t),s[o*2+1]=n.call(r,a,o,t)}return s}function*v1t(t,e,n,r){let i=0;for(const s of t)yield e.call(r,s,i,t),yield n.call(r,s,i,t),++i}var U5={},rA={},iA=34,Lg=10,sA=13;function rW(t){return new Function("d","return {"+t.map(function(e,n){return JSON.stringify(e)+": d["+n+'] || ""'}).join(",")+"}")}function w1t(t,e){var n=rW(t);return function(r,i){return e(n(r),i,t)}}function j5(t){var e=Object.create(null),n=[];return t.forEach(function(r){for(var i in r)i in e||n.push(e[i]=i)}),n}function Kr(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function x1t(t){return t<0?"-"+Kr(-t,6):t>9999?"+"+Kr(t,6):Kr(t,4)}function _1t(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":x1t(t.getUTCFullYear())+"-"+Kr(t.getUTCMonth()+1,2)+"-"+Kr(t.getUTCDate(),2)+(i?"T"+Kr(e,2)+":"+Kr(n,2)+":"+Kr(r,2)+"."+Kr(i,3)+"Z":r?"T"+Kr(e,2)+":"+Kr(n,2)+":"+Kr(r,2)+"Z":n||e?"T"+Kr(e,2)+":"+Kr(n,2)+"Z":"")}function S1t(t){var e=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function r(f,d){var h,p,g=i(f,function(m,y){if(h)return h(m,y-1);p=m,h=d?w1t(m,d):rW(m)});return g.columns=p||[],g}function i(f,d){var h=[],p=f.length,g=0,m=0,y,b=p<=0,w=!1;f.charCodeAt(p-1)===Lg&&--p,f.charCodeAt(p-1)===sA&&--p;function v(){if(b)return rA;if(w)return w=!1,U5;var S,_=g,E;if(f.charCodeAt(_)===iA){for(;g++<p&&f.charCodeAt(g)!==iA||f.charCodeAt(++g)===iA;);return(S=g)>=p?b=!0:(E=f.charCodeAt(g++))===Lg?w=!0:E===sA&&(w=!0,f.charCodeAt(g)===Lg&&++g),f.slice(_+1,S-1).replace(/""/g,'"')}for(;g<p;){if((E=f.charCodeAt(S=g++))===Lg)w=!0;else if(E===sA)w=!0,f.charCodeAt(g)===Lg&&++g;else if(E!==n)continue;return f.slice(_,S)}return b=!0,f.slice(_,p)}for(;(y=v())!==rA;){for(var x=[];y!==U5&&y!==rA;)x.push(y),y=v();d&&(x=d(x,m++))==null||h.push(x)}return h}function s(f,d){return f.map(function(h){return d.map(function(p){return l(h[p])}).join(t)})}function o(f,d){return d==null&&(d=j5(f)),[d.map(l).join(t)].concat(s(f,d)).join(`
`)}function a(f,d){return d==null&&(d=j5(f)),s(f,d).join(`
`)}function u(f){return f.map(c).join(`
`)}function c(f){return f.map(l).join(t)}function l(f){return f==null?"":f instanceof Date?_1t(f):e.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:r,parseRows:i,format:o,formatBody:a,formatRows:u,formatRow:c,formatValue:l}}function E1t(t,e){var n,r=1;t==null&&(t=0),e==null&&(e=0);function i(){var s,o=n.length,a,u=0,c=0;for(s=0;s<o;++s)a=n[s],u+=a.x,c+=a.y;for(u=(u/o-t)*r,c=(c/o-e)*r,s=0;s<o;++s)a=n[s],a.x-=u,a.y-=c}return i.initialize=function(s){n=s},i.x=function(s){return arguments.length?(t=+s,i):t},i.y=function(s){return arguments.length?(e=+s,i):e},i.strength=function(s){return arguments.length?(r=+s,i):r},i}function A1t(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return iW(this.cover(e,n),e,n,t)}function iW(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,s=t._root,o={data:r},a=t._x0,u=t._y0,c=t._x1,l=t._y1,f,d,h,p,g,m,y,b;if(!s)return t._root=o,t;for(;s.length;)if((g=e>=(f=(a+c)/2))?a=f:c=f,(m=n>=(d=(u+l)/2))?u=d:l=d,i=s,!(s=s[y=m<<1|g]))return i[y]=o,t;if(h=+t._x.call(null,s.data),p=+t._y.call(null,s.data),e===h&&n===p)return o.next=s,i?i[y]=o:t._root=o,t;do i=i?i[y]=new Array(4):t._root=new Array(4),(g=e>=(f=(a+c)/2))?a=f:c=f,(m=n>=(d=(u+l)/2))?u=d:l=d;while((y=m<<1|g)===(b=(p>=d)<<1|h>=f));return i[b]=s,i[y]=o,t}function $1t(t){var e,n,r=t.length,i,s,o=new Array(r),a=new Array(r),u=1/0,c=1/0,l=-1/0,f=-1/0;for(n=0;n<r;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=i,a[n]=s,i<u&&(u=i),i>l&&(l=i),s<c&&(c=s),s>f&&(f=s));if(u>l||c>f)return this;for(this.cover(u,c).cover(l,f),n=0;n<r;++n)iW(this,o[n],a[n],t[n]);return this}function T1t(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,s=(r=Math.floor(e))+1;else{for(var o=i-n||1,a=this._root,u,c;n>t||t>=i||r>e||e>=s;)switch(c=(e<r)<<1|t<n,u=new Array(4),u[c]=a,a=u,o*=2,c){case 0:i=n+o,s=r+o;break;case 1:n=i-o,s=r+o;break;case 2:i=n+o,r=s-o;break;case 3:n=i-o,r=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this}function k1t(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function M1t(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Dr(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function C1t(t,e,n){var r,i=this._x0,s=this._y0,o,a,u,c,l=this._x1,f=this._y1,d=[],h=this._root,p,g;for(h&&d.push(new Dr(h,i,s,l,f)),n==null?n=1/0:(i=t-n,s=e-n,l=t+n,f=e+n,n*=n);p=d.pop();)if(!(!(h=p.node)||(o=p.x0)>l||(a=p.y0)>f||(u=p.x1)<i||(c=p.y1)<s))if(h.length){var m=(o+u)/2,y=(a+c)/2;d.push(new Dr(h[3],m,y,u,c),new Dr(h[2],o,y,m,c),new Dr(h[1],m,a,u,y),new Dr(h[0],o,a,m,y)),(g=(e>=y)<<1|t>=m)&&(p=d[d.length-1],d[d.length-1]=d[d.length-1-g],d[d.length-1-g]=p)}else{var b=t-+this._x.call(null,h.data),w=e-+this._y.call(null,h.data),v=b*b+w*w;if(v<n){var x=Math.sqrt(n=v);i=t-x,s=e-x,l=t+x,f=e+x,r=h.data}}return r}function I1t(t){if(isNaN(l=+this._x.call(null,t))||isNaN(f=+this._y.call(null,t)))return this;var e,n=this._root,r,i,s,o=this._x0,a=this._y0,u=this._x1,c=this._y1,l,f,d,h,p,g,m,y;if(!n)return this;if(n.length)for(;;){if((p=l>=(d=(o+u)/2))?o=d:u=d,(g=f>=(h=(a+c)/2))?a=h:c=h,e=n,!(n=n[m=g<<1|p]))return this;if(!n.length)break;(e[m+1&3]||e[m+2&3]||e[m+3&3])&&(r=e,y=m)}for(;n.data!==t;)if(i=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,i?(s?i.next=s:delete i.next,this):e?(s?e[m]=s:delete e[m],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(r?r[y]=n:this._root=n),this):(this._root=s,this)}function F1t(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function N1t(){return this._root}function O1t(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function R1t(t){var e=[],n,r=this._root,i,s,o,a,u;for(r&&e.push(new Dr(r,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(r=n.node,s=n.x0,o=n.y0,a=n.x1,u=n.y1)&&r.length){var c=(s+a)/2,l=(o+u)/2;(i=r[3])&&e.push(new Dr(i,c,l,a,u)),(i=r[2])&&e.push(new Dr(i,s,l,c,u)),(i=r[1])&&e.push(new Dr(i,c,o,a,l)),(i=r[0])&&e.push(new Dr(i,s,o,c,l))}return this}function D1t(t){var e=[],n=[],r;for(this._root&&e.push(new Dr(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,a=r.y0,u=r.x1,c=r.y1,l=(o+u)/2,f=(a+c)/2;(s=i[0])&&e.push(new Dr(s,o,a,l,f)),(s=i[1])&&e.push(new Dr(s,l,a,u,f)),(s=i[2])&&e.push(new Dr(s,o,f,l,c)),(s=i[3])&&e.push(new Dr(s,l,f,u,c))}n.push(r)}for(;r=n.pop();)t(r.node,r.x0,r.y0,r.x1,r.y1);return this}function L1t(t){return t[0]}function B1t(t){return arguments.length?(this._x=t,this):this._x}function P1t(t){return t[1]}function z1t(t){return arguments.length?(this._y=t,this):this._y}function RC(t,e,n){var r=new DC(e??L1t,n??P1t,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function DC(t,e,n,r,i,s){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function q5(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Hr=RC.prototype=DC.prototype;Hr.copy=function(){var t=new DC(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,r;if(!e)return t;if(!e.length)return t._root=q5(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var i=0;i<4;++i)(r=e.source[i])&&(r.length?n.push({source:r,target:e.target[i]=new Array(4)}):e.target[i]=q5(r));return t};Hr.add=A1t;Hr.addAll=$1t;Hr.cover=T1t;Hr.data=k1t;Hr.extent=M1t;Hr.find=C1t;Hr.remove=I1t;Hr.removeAll=F1t;Hr.root=N1t;Hr.size=O1t;Hr.visit=R1t;Hr.visitAfter=D1t;Hr.x=B1t;Hr.y=z1t;function Lr(t){return function(){return t}}function lc(t){return(t()-.5)*1e-6}function U1t(t){return t.x+t.vx}function j1t(t){return t.y+t.vy}function q1t(t){var e,n,r,i=1,s=1;typeof t!="function"&&(t=Lr(t==null?1:+t));function o(){for(var c,l=e.length,f,d,h,p,g,m,y=0;y<s;++y)for(f=RC(e,U1t,j1t).visitAfter(a),c=0;c<l;++c)d=e[c],g=n[d.index],m=g*g,h=d.x+d.vx,p=d.y+d.vy,f.visit(b);function b(w,v,x,S,_){var E=w.data,A=w.r,$=g+A;if(E){if(E.index>d.index){var T=h-E.x-E.vx,C=p-E.y-E.vy,F=T*T+C*C;F<$*$&&(T===0&&(T=lc(r),F+=T*T),C===0&&(C=lc(r),F+=C*C),F=($-(F=Math.sqrt(F)))/F*i,d.vx+=(T*=F)*($=(A*=A)/(m+A)),d.vy+=(C*=F)*$,E.vx-=T*($=1-$),E.vy-=C*$)}return}return v>h+$||S<h-$||x>p+$||_<p-$}}function a(c){if(c.data)return c.r=n[c.data.index];for(var l=c.r=0;l<4;++l)c[l]&&c[l].r>c.r&&(c.r=c[l].r)}function u(){if(e){var c,l=e.length,f;for(n=new Array(l),c=0;c<l;++c)f=e[c],n[f.index]=+t(f,c,e)}}return o.initialize=function(c,l){e=c,r=l,u()},o.iterations=function(c){return arguments.length?(s=+c,o):s},o.strength=function(c){return arguments.length?(i=+c,o):i},o.radius=function(c){return arguments.length?(t=typeof c=="function"?c:Lr(+c),u(),o):t},o}function W1t(t){return t.index}function W5(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function V1t(t){var e=W1t,n=f,r,i=Lr(30),s,o,a,u,c,l=1;t==null&&(t=[]);function f(m){return 1/Math.min(a[m.source.index],a[m.target.index])}function d(m){for(var y=0,b=t.length;y<l;++y)for(var w=0,v,x,S,_,E,A,$;w<b;++w)v=t[w],x=v.source,S=v.target,_=S.x+S.vx-x.x-x.vx||lc(c),E=S.y+S.vy-x.y-x.vy||lc(c),A=Math.sqrt(_*_+E*E),A=(A-s[w])/A*m*r[w],_*=A,E*=A,S.vx-=_*($=u[w]),S.vy-=E*$,x.vx+=_*($=1-$),x.vy+=E*$}function h(){if(o){var m,y=o.length,b=t.length,w=new Map(o.map((x,S)=>[e(x,S,o),x])),v;for(m=0,a=new Array(y);m<b;++m)v=t[m],v.index=m,typeof v.source!="object"&&(v.source=W5(w,v.source)),typeof v.target!="object"&&(v.target=W5(w,v.target)),a[v.source.index]=(a[v.source.index]||0)+1,a[v.target.index]=(a[v.target.index]||0)+1;for(m=0,u=new Array(b);m<b;++m)v=t[m],u[m]=a[v.source.index]/(a[v.source.index]+a[v.target.index]);r=new Array(b),p(),s=new Array(b),g()}}function p(){if(o)for(var m=0,y=t.length;m<y;++m)r[m]=+n(t[m],m,t)}function g(){if(o)for(var m=0,y=t.length;m<y;++m)s[m]=+i(t[m],m,t)}return d.initialize=function(m,y){o=m,c=y,h()},d.links=function(m){return arguments.length?(t=m,h(),d):t},d.id=function(m){return arguments.length?(e=m,d):e},d.iterations=function(m){return arguments.length?(l=+m,d):l},d.strength=function(m){return arguments.length?(n=typeof m=="function"?m:Lr(+m),p(),d):n},d.distance=function(m){return arguments.length?(i=typeof m=="function"?m:Lr(+m),g(),d):i},d}const G1t=1664525,Y1t=1013904223,V5=4294967296;function H1t(){let t=1;return()=>(t=(G1t*t+Y1t)%V5)/V5}function X1t(t){return t.x}function K1t(t){return t.y}var Q1t=10,J1t=Math.PI*(3-Math.sqrt(5));function Z1t(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,o=.6,a=new Map,u=FC(f),c=R2("tick","end"),l=H1t();t==null&&(t=[]);function f(){d(),c.call("tick",e),n<r&&(u.stop(),c.call("end",e))}function d(g){var m,y=t.length,b;g===void 0&&(g=1);for(var w=0;w<g;++w)for(n+=(s-n)*i,a.forEach(function(v){v(n)}),m=0;m<y;++m)b=t[m],b.fx==null?b.x+=b.vx*=o:(b.x=b.fx,b.vx=0),b.fy==null?b.y+=b.vy*=o:(b.y=b.fy,b.vy=0);return e}function h(){for(var g=0,m=t.length,y;g<m;++g){if(y=t[g],y.index=g,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var b=Q1t*Math.sqrt(.5+g),w=g*J1t;y.x=b*Math.cos(w),y.y=b*Math.sin(w)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function p(g){return g.initialize&&g.initialize(t,l),g}return h(),e={tick:d,restart:function(){return u.restart(f),e},stop:function(){return u.stop(),e},nodes:function(g){return arguments.length?(t=g,h(),a.forEach(p),e):t},alpha:function(g){return arguments.length?(n=+g,e):n},alphaMin:function(g){return arguments.length?(r=+g,e):r},alphaDecay:function(g){return arguments.length?(i=+g,e):+i},alphaTarget:function(g){return arguments.length?(s=+g,e):s},velocityDecay:function(g){return arguments.length?(o=1-g,e):1-o},randomSource:function(g){return arguments.length?(l=g,a.forEach(p),e):l},force:function(g,m){return arguments.length>1?(m==null?a.delete(g):a.set(g,p(m)),e):a.get(g)},find:function(g,m,y){var b=0,w=t.length,v,x,S,_,E;for(y==null?y=1/0:y*=y,b=0;b<w;++b)_=t[b],v=g-_.x,x=m-_.y,S=v*v+x*x,S<y&&(E=_,y=S);return E},on:function(g,m){return arguments.length>1?(c.on(g,m),e):c.on(g)}}}function tbt(){var t,e,n,r,i=Lr(-30),s,o=1,a=1/0,u=.81;function c(h){var p,g=t.length,m=RC(t,X1t,K1t).visitAfter(f);for(r=h,p=0;p<g;++p)e=t[p],m.visit(d)}function l(){if(t){var h,p=t.length,g;for(s=new Array(p),h=0;h<p;++h)g=t[h],s[g.index]=+i(g,h,t)}}function f(h){var p=0,g,m,y=0,b,w,v;if(h.length){for(b=w=v=0;v<4;++v)(g=h[v])&&(m=Math.abs(g.value))&&(p+=g.value,y+=m,b+=m*g.x,w+=m*g.y);h.x=b/y,h.y=w/y}else{g=h,g.x=g.data.x,g.y=g.data.y;do p+=s[g.data.index];while(g=g.next)}h.value=p}function d(h,p,g,m){if(!h.value)return!0;var y=h.x-e.x,b=h.y-e.y,w=m-p,v=y*y+b*b;if(w*w/u<v)return v<a&&(y===0&&(y=lc(n),v+=y*y),b===0&&(b=lc(n),v+=b*b),v<o&&(v=Math.sqrt(o*v)),e.vx+=y*h.value*r/v,e.vy+=b*h.value*r/v),!0;if(h.length||v>=a)return;(h.data!==e||h.next)&&(y===0&&(y=lc(n),v+=y*y),b===0&&(b=lc(n),v+=b*b),v<o&&(v=Math.sqrt(o*v)));do h.data!==e&&(w=s[h.data.index]*r/v,e.vx+=y*w,e.vy+=b*w);while(h=h.next)}return c.initialize=function(h,p){t=h,n=p,l()},c.strength=function(h){return arguments.length?(i=typeof h=="function"?h:Lr(+h),l(),c):i},c.distanceMin=function(h){return arguments.length?(o=h*h,c):Math.sqrt(o)},c.distanceMax=function(h){return arguments.length?(a=h*h,c):Math.sqrt(a)},c.theta=function(h){return arguments.length?(u=h*h,c):Math.sqrt(u)},c}function ebt(t){var e=Lr(.1),n,r,i;typeof t!="function"&&(t=Lr(t==null?0:+t));function s(a){for(var u=0,c=n.length,l;u<c;++u)l=n[u],l.vx+=(i[u]-l.x)*r[u]*a}function o(){if(n){var a,u=n.length;for(r=new Array(u),i=new Array(u),a=0;a<u;++a)r[a]=isNaN(i[a]=+t(n[a],a,n))?0:+e(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(e=typeof a=="function"?a:Lr(+a),o(),s):e},s.x=function(a){return arguments.length?(t=typeof a=="function"?a:Lr(+a),o(),s):t},s}function nbt(t){var e=Lr(.1),n,r,i;typeof t!="function"&&(t=Lr(t==null?0:+t));function s(a){for(var u=0,c=n.length,l;u<c;++u)l=n[u],l.vy+=(i[u]-l.y)*r[u]*a}function o(){if(n){var a,u=n.length;for(r=new Array(u),i=new Array(u),a=0;a<u;++a)r[a]=isNaN(i[a]=+t(n[a],a,n))?0:+e(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(e=typeof a=="function"?a:Lr(+a),o(),s):e},s.y=function(a){return arguments.length?(t=typeof a=="function"?a:Lr(+a),o(),s):t},s}function rbt(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Nw(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Qh(t){return t=Nw(Math.abs(t)),t?t[1]:NaN}function ibt(t,e){return function(n,r){for(var i=n.length,s=[],o=0,a=t[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=t[o=(o+1)%t.length];return s.reverse().join(e)}}function sbt(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var obt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ff(t){if(!(e=obt.exec(t)))throw new Error("invalid format: "+t);var e;return new LC({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Ff.prototype=LC.prototype;function LC(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}LC.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function abt(t){t:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var sW;function ubt(t,e){var n=Nw(t,e);if(!n)return t+"";var r=n[0],i=n[1],s=i-(sW=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+Nw(t,Math.max(0,e+s-1))[0]}function G5(t,e){var n=Nw(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const Y5={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:rbt,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>G5(t*100,e),r:G5,s:ubt,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function H5(t){return t}var X5=Array.prototype.map,K5=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function oW(t){var e=t.grouping===void 0||t.thousands===void 0?H5:ibt(X5.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?H5:sbt(X5.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"":t.minus+"",u=t.nan===void 0?"NaN":t.nan+"";function c(f){f=Ff(f);var d=f.fill,h=f.align,p=f.sign,g=f.symbol,m=f.zero,y=f.width,b=f.comma,w=f.precision,v=f.trim,x=f.type;x==="n"?(b=!0,x="g"):Y5[x]||(w===void 0&&(w=12),v=!0,x="g"),(m||d==="0"&&h==="=")&&(m=!0,d="0",h="=");var S=g==="$"?n:g==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",_=g==="$"?r:/[%p]/.test(x)?o:"",E=Y5[x],A=/[defgprs%]/.test(x);w=w===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,w)):Math.max(0,Math.min(20,w));function $(T){var C=S,F=_,M,k,I;if(x==="c")F=E(T)+F,T="";else{T=+T;var N=T<0||1/T<0;if(T=isNaN(T)?u:E(Math.abs(T),w),v&&(T=abt(T)),N&&+T==0&&p!=="+"&&(N=!1),C=(N?p==="("?p:a:p==="-"||p==="("?"":p)+C,F=(x==="s"?K5[8+sW/3]:"")+F+(N&&p==="("?")":""),A){for(M=-1,k=T.length;++M<k;)if(I=T.charCodeAt(M),48>I||I>57){F=(I===46?i+T.slice(M+1):T.slice(M))+F,T=T.slice(0,M);break}}}b&&!m&&(T=e(T,1/0));var R=C.length+T.length+F.length,D=R<y?new Array(y-R+1).join(d):"";switch(b&&m&&(T=e(D+T,D.length?y-F.length:1/0),D=""),h){case"<":T=C+T+F+D;break;case"=":T=C+D+T+F;break;case"^":T=D.slice(0,R=D.length>>1)+C+T+F+D.slice(R);break;default:T=D+C+T+F;break}return s(T)}return $.toString=function(){return f+""},$}function l(f,d){var h=c((f=Ff(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(Qh(d)/3)))*3,g=Math.pow(10,-p),m=K5[8+p/3];return function(y){return h(g*y)+m}}return{format:c,formatPrefix:l}}var q1,id,BC;cbt({thousands:",",grouping:[3],currency:["$",""]});function cbt(t){return q1=oW(t),id=q1.format,BC=q1.formatPrefix,q1}function aW(t){return Math.max(0,-Qh(Math.abs(t)))}function uW(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Qh(e)/3)))*3-Qh(Math.abs(t)))}function cW(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Qh(e)-Qh(t))+1}var _t=1e-6,K3=1e-12,Ht=Math.PI,en=Ht/2,Ow=Ht/4,Ur=Ht*2,an=180/Ht,Vt=Ht/180,Zt=Math.abs,Hp=Math.atan,ds=Math.atan2,xt=Math.cos,W1=Math.ceil,lW=Math.exp,Q3=Math.hypot,Rw=Math.log,oA=Math.pow,wt=Math.sin,Ji=Math.sign||function(t){return t>0?1:t<0?-1:0},jr=Math.sqrt,PC=Math.tan;function fW(t){return t>1?0:t<-1?Ht:Math.acos(t)}function fi(t){return t>1?en:t<-1?-en:Math.asin(t)}function Yn(){}function Dw(t,e){t&&J5.hasOwnProperty(t.type)&&J5[t.type](t,e)}var Q5={Feature:function(t,e){Dw(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)Dw(n[r].geometry,e)}},J5={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){J3(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)J3(n[r],e,0)},Polygon:function(t,e){Z5(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Z5(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)Dw(n[r],e)}};function J3(t,e,n){var r=-1,i=t.length-n,s;for(e.lineStart();++r<i;)s=t[r],e.point(s[0],s[1],s[2]);e.lineEnd()}function Z5(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)J3(t[n],e,1);e.polygonEnd()}function Co(t,e){t&&Q5.hasOwnProperty(t.type)?Q5[t.type](t,e):Dw(t,e)}var Lw=new Pr,Bw=new Pr,dW,hW,Z3,tT,eT,Qo={point:Yn,lineStart:Yn,lineEnd:Yn,polygonStart:function(){Lw=new Pr,Qo.lineStart=lbt,Qo.lineEnd=fbt},polygonEnd:function(){var t=+Lw;Bw.add(t<0?Ur+t:t),this.lineStart=this.lineEnd=this.point=Yn},sphere:function(){Bw.add(Ur)}};function lbt(){Qo.point=dbt}function fbt(){pW(dW,hW)}function dbt(t,e){Qo.point=pW,dW=t,hW=e,t*=Vt,e*=Vt,Z3=t,tT=xt(e=e/2+Ow),eT=wt(e)}function pW(t,e){t*=Vt,e*=Vt,e=e/2+Ow;var n=t-Z3,r=n>=0?1:-1,i=r*n,s=xt(e),o=wt(e),a=eT*o,u=tT*s+a*xt(i),c=a*r*wt(i);Lw.add(ds(c,u)),Z3=t,tT=s,eT=o}function hbt(t){return Bw=new Pr,Co(t,Qo),Bw*2}function Pw(t){return[ds(t[1],t[0]),fi(t[2])]}function Nf(t){var e=t[0],n=t[1],r=xt(n);return[r*xt(e),r*wt(e),wt(n)]}function V1(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Jh(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function aA(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function G1(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function zw(t){var e=jr(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var Ve,ni,Ze,Ei,ql,gW,mW,Ih,Ym,ec,yu,Wa={point:nT,lineStart:t8,lineEnd:e8,polygonStart:function(){Wa.point=bW,Wa.lineStart=pbt,Wa.lineEnd=gbt,Ym=new Pr,Qo.polygonStart()},polygonEnd:function(){Qo.polygonEnd(),Wa.point=nT,Wa.lineStart=t8,Wa.lineEnd=e8,Lw<0?(Ve=-(Ze=180),ni=-(Ei=90)):Ym>_t?Ei=90:Ym<-1e-6&&(ni=-90),yu[0]=Ve,yu[1]=Ze},sphere:function(){Ve=-(Ze=180),ni=-(Ei=90)}};function nT(t,e){ec.push(yu=[Ve=t,Ze=t]),e<ni&&(ni=e),e>Ei&&(Ei=e)}function yW(t,e){var n=Nf([t*Vt,e*Vt]);if(Ih){var r=Jh(Ih,n),i=[r[1],-r[0],0],s=Jh(i,r);zw(s),s=Pw(s);var o=t-ql,a=o>0?1:-1,u=s[0]*an*a,c,l=Zt(o)>180;l^(a*ql<u&&u<a*t)?(c=s[1]*an,c>Ei&&(Ei=c)):(u=(u+360)%360-180,l^(a*ql<u&&u<a*t)?(c=-s[1]*an,c<ni&&(ni=c)):(e<ni&&(ni=e),e>Ei&&(Ei=e))),l?t<ql?_i(Ve,t)>_i(Ve,Ze)&&(Ze=t):_i(t,Ze)>_i(Ve,Ze)&&(Ve=t):Ze>=Ve?(t<Ve&&(Ve=t),t>Ze&&(Ze=t)):t>ql?_i(Ve,t)>_i(Ve,Ze)&&(Ze=t):_i(t,Ze)>_i(Ve,Ze)&&(Ve=t)}else ec.push(yu=[Ve=t,Ze=t]);e<ni&&(ni=e),e>Ei&&(Ei=e),Ih=n,ql=t}function t8(){Wa.point=yW}function e8(){yu[0]=Ve,yu[1]=Ze,Wa.point=nT,Ih=null}function bW(t,e){if(Ih){var n=t-ql;Ym.add(Zt(n)>180?n+(n>0?360:-360):n)}else gW=t,mW=e;Qo.point(t,e),yW(t,e)}function pbt(){Qo.lineStart()}function gbt(){bW(gW,mW),Qo.lineEnd(),Zt(Ym)>_t&&(Ve=-(Ze=180)),yu[0]=Ve,yu[1]=Ze,Ih=null}function _i(t,e){return(e-=t)<0?e+360:e}function mbt(t,e){return t[0]-e[0]}function n8(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}function ybt(t){var e,n,r,i,s,o,a;if(Ei=Ze=-(Ve=ni=1/0),ec=[],Co(t,Wa),n=ec.length){for(ec.sort(mbt),e=1,r=ec[0],s=[r];e<n;++e)i=ec[e],n8(r,i[0])||n8(r,i[1])?(_i(r[0],i[1])>_i(r[0],r[1])&&(r[1]=i[1]),_i(i[0],r[1])>_i(r[0],r[1])&&(r[0]=i[0])):s.push(r=i);for(o=-1/0,n=s.length-1,e=0,r=s[n];e<=n;r=i,++e)i=s[e],(a=_i(r[1],i[0]))>o&&(o=a,Ve=i[0],Ze=r[1])}return ec=yu=null,Ve===1/0||ni===1/0?[[NaN,NaN],[NaN,NaN]]:[[Ve,ni],[Ze,Ei]]}var xm,Uw,jw,qw,Ww,Vw,Gw,Yw,rT,iT,sT,vW,wW,Ir,Fr,Nr,Ls={sphere:Yn,point:zC,lineStart:r8,lineEnd:i8,polygonStart:function(){Ls.lineStart=wbt,Ls.lineEnd=xbt},polygonEnd:function(){Ls.lineStart=r8,Ls.lineEnd=i8}};function zC(t,e){t*=Vt,e*=Vt;var n=xt(e);Ey(n*xt(t),n*wt(t),wt(e))}function Ey(t,e,n){++xm,jw+=(t-jw)/xm,qw+=(e-qw)/xm,Ww+=(n-Ww)/xm}function r8(){Ls.point=bbt}function bbt(t,e){t*=Vt,e*=Vt;var n=xt(e);Ir=n*xt(t),Fr=n*wt(t),Nr=wt(e),Ls.point=vbt,Ey(Ir,Fr,Nr)}function vbt(t,e){t*=Vt,e*=Vt;var n=xt(e),r=n*xt(t),i=n*wt(t),s=wt(e),o=ds(jr((o=Fr*s-Nr*i)*o+(o=Nr*r-Ir*s)*o+(o=Ir*i-Fr*r)*o),Ir*r+Fr*i+Nr*s);Uw+=o,Vw+=o*(Ir+(Ir=r)),Gw+=o*(Fr+(Fr=i)),Yw+=o*(Nr+(Nr=s)),Ey(Ir,Fr,Nr)}function i8(){Ls.point=zC}function wbt(){Ls.point=_bt}function xbt(){xW(vW,wW),Ls.point=zC}function _bt(t,e){vW=t,wW=e,t*=Vt,e*=Vt,Ls.point=xW;var n=xt(e);Ir=n*xt(t),Fr=n*wt(t),Nr=wt(e),Ey(Ir,Fr,Nr)}function xW(t,e){t*=Vt,e*=Vt;var n=xt(e),r=n*xt(t),i=n*wt(t),s=wt(e),o=Fr*s-Nr*i,a=Nr*r-Ir*s,u=Ir*i-Fr*r,c=Q3(o,a,u),l=fi(c),f=c&&-l/c;rT.add(f*o),iT.add(f*a),sT.add(f*u),Uw+=l,Vw+=l*(Ir+(Ir=r)),Gw+=l*(Fr+(Fr=i)),Yw+=l*(Nr+(Nr=s)),Ey(Ir,Fr,Nr)}function _W(t){xm=Uw=jw=qw=Ww=Vw=Gw=Yw=0,rT=new Pr,iT=new Pr,sT=new Pr,Co(t,Ls);var e=+rT,n=+iT,r=+sT,i=Q3(e,n,r);return i<K3&&(e=Vw,n=Gw,r=Yw,Uw<_t&&(e=jw,n=qw,r=Ww),i=Q3(e,n,r),i<K3)?[NaN,NaN]:[ds(n,e)*an,fi(r/i)*an]}function oT(t,e){function n(r,i){return r=t(r,i),e(r[0],r[1])}return t.invert&&e.invert&&(n.invert=function(r,i){return r=e.invert(r,i),r&&t.invert(r[0],r[1])}),n}function aT(t,e){return Zt(t)>Ht&&(t-=Math.round(t/Ur)*Ur),[t,e]}aT.invert=aT;function SW(t,e,n){return(t%=Ur)?e||n?oT(o8(t),a8(e,n)):o8(t):e||n?a8(e,n):aT}function s8(t){return function(e,n){return e+=t,Zt(e)>Ht&&(e-=Math.round(e/Ur)*Ur),[e,n]}}function o8(t){var e=s8(t);return e.invert=s8(-t),e}function a8(t,e){var n=xt(t),r=wt(t),i=xt(e),s=wt(e);function o(a,u){var c=xt(u),l=xt(a)*c,f=wt(a)*c,d=wt(u),h=d*n+l*r;return[ds(f*i-h*s,l*n-d*r),fi(h*i+f*s)]}return o.invert=function(a,u){var c=xt(u),l=xt(a)*c,f=wt(a)*c,d=wt(u),h=d*i-f*s;return[ds(f*i+d*s,l*n+h*r),fi(h*n-l*r)]},o}function Sbt(t){t=SW(t[0]*Vt,t[1]*Vt,t.length>2?t[2]*Vt:0);function e(n){return n=t(n[0]*Vt,n[1]*Vt),n[0]*=an,n[1]*=an,n}return e.invert=function(n){return n=t.invert(n[0]*Vt,n[1]*Vt),n[0]*=an,n[1]*=an,n},e}function Ebt(t,e,n,r,i,s){if(n){var o=xt(e),a=wt(e),u=r*n;i==null?(i=e+r*Ur,s=e-u/2):(i=u8(o,i),s=u8(o,s),(r>0?i<s:i>s)&&(i+=r*Ur));for(var c,l=i;r>0?l>s:l<s;l-=u)c=Pw([o,-a*xt(l),-a*wt(l)]),t.point(c[0],c[1])}}function u8(t,e){e=Nf(e),e[0]-=t,zw(e);var n=fW(-e[1]);return((-e[2]<0?-n:n)+Ur-_t)%Ur}function EW(){var t=[],e;return{point:function(n,r,i){e.push([n,r,i])},lineStart:function(){t.push(e=[])},lineEnd:Yn,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function cv(t,e){return Zt(t[0]-e[0])<_t&&Zt(t[1]-e[1])<_t}function Y1(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function AW(t,e,n,r,i){var s=[],o=[],a,u;if(t.forEach(function(p){if(!((g=p.length-1)<=0)){var g,m=p[0],y=p[g],b;if(cv(m,y)){if(!m[2]&&!y[2]){for(i.lineStart(),a=0;a<g;++a)i.point((m=p[a])[0],m[1]);i.lineEnd();return}y[0]+=2*_t}s.push(b=new Y1(m,p,null,!0)),o.push(b.o=new Y1(m,null,b,!1)),s.push(b=new Y1(y,p,null,!1)),o.push(b.o=new Y1(y,null,b,!0))}}),!!s.length){for(o.sort(e),c8(s),c8(o),a=0,u=o.length;a<u;++a)o[a].e=n=!n;for(var c=s[0],l,f;;){for(var d=c,h=!0;d.v;)if((d=d.n)===c)return;l=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(a=0,u=l.length;a<u;++a)i.point((f=l[a])[0],f[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(h)for(l=d.p.z,a=l.length-1;a>=0;--a)i.point((f=l[a])[0],f[1]);else r(d.x,d.p.x,-1,i);d=d.p}d=d.o,l=d.z,h=!h}while(!d.v);i.lineEnd()}}}function c8(t){if(e=t.length){for(var e,n=0,r=t[0],i;++n<e;)r.n=i=t[n],i.p=r,r=i;r.n=i=t[0],i.p=r}}function uA(t){return Zt(t[0])<=Ht?t[0]:Ji(t[0])*((Zt(t[0])+Ht)%Ur-Ht)}function Abt(t,e){var n=uA(e),r=e[1],i=wt(r),s=[wt(n),-xt(n),0],o=0,a=0,u=new Pr;i===1?r=en+_t:i===-1&&(r=-en-_t);for(var c=0,l=t.length;c<l;++c)if(d=(f=t[c]).length)for(var f,d,h=f[d-1],p=uA(h),g=h[1]/2+Ow,m=wt(g),y=xt(g),b=0;b<d;++b,p=v,m=S,y=_,h=w){var w=f[b],v=uA(w),x=w[1]/2+Ow,S=wt(x),_=xt(x),E=v-p,A=E>=0?1:-1,$=A*E,T=$>Ht,C=m*S;if(u.add(ds(C*A*wt($),y*_+C*xt($))),o+=T?E+A*Ur:E,T^p>=n^v>=n){var F=Jh(Nf(h),Nf(w));zw(F);var M=Jh(s,F);zw(M);var k=(T^E>=0?-1:1)*fi(M[2]);(r>k||r===k&&(F[0]||F[1]))&&(a+=T^E>=0?1:-1)}}return(o<-1e-6||o<_t&&u<-1e-12)^a&1}function $W(t,e,n,r){return function(i){var s=e(i),o=EW(),a=e(o),u=!1,c,l,f,d={point:h,lineStart:g,lineEnd:m,polygonStart:function(){d.point=y,d.lineStart=b,d.lineEnd=w,l=[],c=[]},polygonEnd:function(){d.point=h,d.lineStart=g,d.lineEnd=m,l=rq(l);var v=Abt(c,r);l.length?(u||(i.polygonStart(),u=!0),AW(l,Tbt,v,n,i)):v&&(u||(i.polygonStart(),u=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),u&&(i.polygonEnd(),u=!1),l=c=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function h(v,x){t(v,x)&&i.point(v,x)}function p(v,x){s.point(v,x)}function g(){d.point=p,s.lineStart()}function m(){d.point=h,s.lineEnd()}function y(v,x){f.push([v,x]),a.point(v,x)}function b(){a.lineStart(),f=[]}function w(){y(f[0][0],f[0][1]),a.lineEnd();var v=a.clean(),x=o.result(),S,_=x.length,E,A,$;if(f.pop(),c.push(f),f=null,!!_){if(v&1){if(A=x[0],(E=A.length-1)>0){for(u||(i.polygonStart(),u=!0),i.lineStart(),S=0;S<E;++S)i.point(($=A[S])[0],$[1]);i.lineEnd()}return}_>1&&v&2&&x.push(x.pop().concat(x.shift())),l.push(x.filter($bt))}}return d}}function $bt(t){return t.length>1}function Tbt(t,e){return((t=t.x)[0]<0?t[1]-en-_t:en-t[1])-((e=e.x)[0]<0?e[1]-en-_t:en-e[1])}const l8=$W(function(){return!0},kbt,Cbt,[-Ht,-en]);function kbt(t){var e=NaN,n=NaN,r=NaN,i;return{lineStart:function(){t.lineStart(),i=1},point:function(s,o){var a=s>0?Ht:-Ht,u=Zt(s-e);Zt(u-Ht)<_t?(t.point(e,n=(n+o)/2>0?en:-en),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(a,n),t.point(s,n),i=0):r!==a&&u>=Ht&&(Zt(e-r)<_t&&(e-=r*_t),Zt(s-a)<_t&&(s-=a*_t),n=Mbt(e,n,s,o),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(a,n),i=0),t.point(e=s,n=o),r=a},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-i}}}function Mbt(t,e,n,r){var i,s,o=wt(t-n);return Zt(o)>_t?Hp((wt(e)*(s=xt(r))*wt(n)-wt(r)*(i=xt(e))*wt(t))/(i*s*o)):(e+r)/2}function Cbt(t,e,n,r){var i;if(t==null)i=n*en,r.point(-Ht,i),r.point(0,i),r.point(Ht,i),r.point(Ht,0),r.point(Ht,-i),r.point(0,-i),r.point(-Ht,-i),r.point(-Ht,0),r.point(-Ht,i);else if(Zt(t[0]-e[0])>_t){var s=t[0]<e[0]?Ht:-Ht;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(e[0],e[1])}function Ibt(t){var e=xt(t),n=2*Vt,r=e>0,i=Zt(e)>_t;function s(l,f,d,h){Ebt(h,t,n,d,l,f)}function o(l,f){return xt(l)*xt(f)>e}function a(l){var f,d,h,p,g;return{lineStart:function(){p=h=!1,g=1},point:function(m,y){var b=[m,y],w,v=o(m,y),x=r?v?0:c(m,y):v?c(m+(m<0?Ht:-Ht),y):0;if(!f&&(p=h=v)&&l.lineStart(),v!==h&&(w=u(f,b),(!w||cv(f,w)||cv(b,w))&&(b[2]=1)),v!==h)g=0,v?(l.lineStart(),w=u(b,f),l.point(w[0],w[1])):(w=u(f,b),l.point(w[0],w[1],2),l.lineEnd()),f=w;else if(i&&f&&r^v){var S;!(x&d)&&(S=u(b,f,!0))&&(g=0,r?(l.lineStart(),l.point(S[0][0],S[0][1]),l.point(S[1][0],S[1][1]),l.lineEnd()):(l.point(S[1][0],S[1][1]),l.lineEnd(),l.lineStart(),l.point(S[0][0],S[0][1],3)))}v&&(!f||!cv(f,b))&&l.point(b[0],b[1]),f=b,h=v,d=x},lineEnd:function(){h&&l.lineEnd(),f=null},clean:function(){return g|(p&&h)<<1}}}function u(l,f,d){var h=Nf(l),p=Nf(f),g=[1,0,0],m=Jh(h,p),y=V1(m,m),b=m[0],w=y-b*b;if(!w)return!d&&l;var v=e*y/w,x=-e*b/w,S=Jh(g,m),_=G1(g,v),E=G1(m,x);aA(_,E);var A=S,$=V1(_,A),T=V1(A,A),C=$*$-T*(V1(_,_)-1);if(!(C<0)){var F=jr(C),M=G1(A,(-$-F)/T);if(aA(M,_),M=Pw(M),!d)return M;var k=l[0],I=f[0],N=l[1],R=f[1],D;I<k&&(D=k,k=I,I=D);var L=I-k,P=Zt(L-Ht)<_t,B=P||L<_t;if(!P&&R<N&&(D=N,N=R,R=D),B?P?N+R>0^M[1]<(Zt(M[0]-k)<_t?N:R):N<=M[1]&&M[1]<=R:L>Ht^(k<=M[0]&&M[0]<=I)){var G=G1(A,(-$+F)/T);return aA(G,_),[M,Pw(G)]}}}function c(l,f){var d=r?t:Ht-t,h=0;return l<-d?h|=1:l>d&&(h|=2),f<-d?h|=4:f>d&&(h|=8),h}return $W(o,a,s,r?[0,-t]:[-Ht,t-Ht])}function Fbt(t,e,n,r,i,s){var o=t[0],a=t[1],u=e[0],c=e[1],l=0,f=1,d=u-o,h=c-a,p;if(p=n-o,!(!d&&p>0)){if(p/=d,d<0){if(p<l)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>l&&(l=p)}if(p=i-o,!(!d&&p<0)){if(p/=d,d<0){if(p>f)return;p>l&&(l=p)}else if(d>0){if(p<l)return;p<f&&(f=p)}if(p=r-a,!(!h&&p>0)){if(p/=h,h<0){if(p<l)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>l&&(l=p)}if(p=s-a,!(!h&&p<0)){if(p/=h,h<0){if(p>f)return;p>l&&(l=p)}else if(h>0){if(p<l)return;p<f&&(f=p)}return l>0&&(t[0]=o+l*d,t[1]=a+l*h),f<1&&(e[0]=o+f*d,e[1]=a+f*h),!0}}}}}var H1=1e9,X1=-1e9;function UC(t,e,n,r){function i(c,l){return t<=c&&c<=n&&e<=l&&l<=r}function s(c,l,f,d){var h=0,p=0;if(c==null||(h=o(c,f))!==(p=o(l,f))||u(c,l)<0^f>0)do d.point(h===0||h===3?t:n,h>1?r:e);while((h=(h+f+4)%4)!==p);else d.point(l[0],l[1])}function o(c,l){return Zt(c[0]-t)<_t?l>0?0:3:Zt(c[0]-n)<_t?l>0?2:1:Zt(c[1]-e)<_t?l>0?1:0:l>0?3:2}function a(c,l){return u(c.x,l.x)}function u(c,l){var f=o(c,1),d=o(l,1);return f!==d?f-d:f===0?l[1]-c[1]:f===1?c[0]-l[0]:f===2?c[1]-l[1]:l[0]-c[0]}return function(c){var l=c,f=EW(),d,h,p,g,m,y,b,w,v,x,S,_={point:E,lineStart:C,lineEnd:F,polygonStart:$,polygonEnd:T};function E(k,I){i(k,I)&&l.point(k,I)}function A(){for(var k=0,I=0,N=h.length;I<N;++I)for(var R=h[I],D=1,L=R.length,P=R[0],B,G,ct=P[0],Z=P[1];D<L;++D)B=ct,G=Z,P=R[D],ct=P[0],Z=P[1],G<=r?Z>r&&(ct-B)*(r-G)>(Z-G)*(t-B)&&++k:Z<=r&&(ct-B)*(r-G)<(Z-G)*(t-B)&&--k;return k}function $(){l=f,d=[],h=[],S=!0}function T(){var k=A(),I=S&&k,N=(d=rq(d)).length;(I||N)&&(c.polygonStart(),I&&(c.lineStart(),s(null,null,1,c),c.lineEnd()),N&&AW(d,a,k,s,c),c.polygonEnd()),l=c,d=h=p=null}function C(){_.point=M,h&&h.push(p=[]),x=!0,v=!1,b=w=NaN}function F(){d&&(M(g,m),y&&v&&f.rejoin(),d.push(f.result())),_.point=E,v&&l.lineEnd()}function M(k,I){var N=i(k,I);if(h&&p.push([k,I]),x)g=k,m=I,y=N,x=!1,N&&(l.lineStart(),l.point(k,I));else if(N&&v)l.point(k,I);else{var R=[b=Math.max(X1,Math.min(H1,b)),w=Math.max(X1,Math.min(H1,w))],D=[k=Math.max(X1,Math.min(H1,k)),I=Math.max(X1,Math.min(H1,I))];Fbt(R,D,t,e,n,r)?(v||(l.lineStart(),l.point(R[0],R[1])),l.point(D[0],D[1]),N||l.lineEnd(),S=!1):N&&(l.lineStart(),l.point(k,I),S=!1)}b=k,w=I,v=N}return _}}function f8(t,e,n){var r=xn(t,e-_t,n).concat(e);return function(i){return r.map(function(s){return[i,s]})}}function d8(t,e,n){var r=xn(t,e-_t,n).concat(e);return function(i){return r.map(function(s){return[s,i]})}}function TW(){var t,e,n,r,i,s,o,a,u=10,c=u,l=90,f=360,d,h,p,g,m=2.5;function y(){return{type:"MultiLineString",coordinates:b()}}function b(){return xn(W1(r/l)*l,n,l).map(p).concat(xn(W1(a/f)*f,o,f).map(g)).concat(xn(W1(e/u)*u,t,u).filter(function(w){return Zt(w%l)>_t}).map(d)).concat(xn(W1(s/c)*c,i,c).filter(function(w){return Zt(w%f)>_t}).map(h))}return y.lines=function(){return b().map(function(w){return{type:"LineString",coordinates:w}})},y.outline=function(){return{type:"Polygon",coordinates:[p(r).concat(g(o).slice(1),p(n).reverse().slice(1),g(a).reverse().slice(1))]}},y.extent=function(w){return arguments.length?y.extentMajor(w).extentMinor(w):y.extentMinor()},y.extentMajor=function(w){return arguments.length?(r=+w[0][0],n=+w[1][0],a=+w[0][1],o=+w[1][1],r>n&&(w=r,r=n,n=w),a>o&&(w=a,a=o,o=w),y.precision(m)):[[r,a],[n,o]]},y.extentMinor=function(w){return arguments.length?(e=+w[0][0],t=+w[1][0],s=+w[0][1],i=+w[1][1],e>t&&(w=e,e=t,t=w),s>i&&(w=s,s=i,i=w),y.precision(m)):[[e,s],[t,i]]},y.step=function(w){return arguments.length?y.stepMajor(w).stepMinor(w):y.stepMinor()},y.stepMajor=function(w){return arguments.length?(l=+w[0],f=+w[1],y):[l,f]},y.stepMinor=function(w){return arguments.length?(u=+w[0],c=+w[1],y):[u,c]},y.precision=function(w){return arguments.length?(m=+w,d=f8(s,i,90),h=d8(e,t,m),p=f8(a,o,90),g=d8(r,n,m),y):m},y.extentMajor([[-180,-90+_t],[180,90-_t]]).extentMinor([[-180,-80-_t],[180,80+_t]])}function Nbt(){return TW()()}const $0=t=>t;var cA=new Pr,uT=new Pr,kW,MW,cT,lT,Xa={point:Yn,lineStart:Yn,lineEnd:Yn,polygonStart:function(){Xa.lineStart=Obt,Xa.lineEnd=Dbt},polygonEnd:function(){Xa.lineStart=Xa.lineEnd=Xa.point=Yn,cA.add(Zt(uT)),uT=new Pr},result:function(){var t=cA/2;return cA=new Pr,t}};function Obt(){Xa.point=Rbt}function Rbt(t,e){Xa.point=CW,kW=cT=t,MW=lT=e}function CW(t,e){uT.add(lT*t-cT*e),cT=t,lT=e}function Dbt(){CW(kW,MW)}var Zh=1/0,Hw=Zh,T0=-Zh,Xw=T0,Kw={point:Lbt,lineStart:Yn,lineEnd:Yn,polygonStart:Yn,polygonEnd:Yn,result:function(){var t=[[Zh,Hw],[T0,Xw]];return T0=Xw=-(Hw=Zh=1/0),t}};function Lbt(t,e){t<Zh&&(Zh=t),t>T0&&(T0=t),e<Hw&&(Hw=e),e>Xw&&(Xw=e)}var fT=0,dT=0,_m=0,Qw=0,Jw=0,dh=0,hT=0,pT=0,Sm=0,IW,FW,Io,Fo,Qi={point:Of,lineStart:h8,lineEnd:p8,polygonStart:function(){Qi.lineStart=zbt,Qi.lineEnd=Ubt},polygonEnd:function(){Qi.point=Of,Qi.lineStart=h8,Qi.lineEnd=p8},result:function(){var t=Sm?[hT/Sm,pT/Sm]:dh?[Qw/dh,Jw/dh]:_m?[fT/_m,dT/_m]:[NaN,NaN];return fT=dT=_m=Qw=Jw=dh=hT=pT=Sm=0,t}};function Of(t,e){fT+=t,dT+=e,++_m}function h8(){Qi.point=Bbt}function Bbt(t,e){Qi.point=Pbt,Of(Io=t,Fo=e)}function Pbt(t,e){var n=t-Io,r=e-Fo,i=jr(n*n+r*r);Qw+=i*(Io+t)/2,Jw+=i*(Fo+e)/2,dh+=i,Of(Io=t,Fo=e)}function p8(){Qi.point=Of}function zbt(){Qi.point=jbt}function Ubt(){NW(IW,FW)}function jbt(t,e){Qi.point=NW,Of(IW=Io=t,FW=Fo=e)}function NW(t,e){var n=t-Io,r=e-Fo,i=jr(n*n+r*r);Qw+=i*(Io+t)/2,Jw+=i*(Fo+e)/2,dh+=i,i=Fo*t-Io*e,hT+=i*(Io+t),pT+=i*(Fo+e),Sm+=i*3,Of(Io=t,Fo=e)}function OW(t){this._context=t}OW.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:{this._context.moveTo(t,e),this._point=1;break}case 1:{this._context.lineTo(t,e);break}default:{this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,Ur);break}}},result:Yn};var gT=new Pr,lA,RW,DW,Em,Am,k0={point:Yn,lineStart:function(){k0.point=qbt},lineEnd:function(){lA&&LW(RW,DW),k0.point=Yn},polygonStart:function(){lA=!0},polygonEnd:function(){lA=null},result:function(){var t=+gT;return gT=new Pr,t}};function qbt(t,e){k0.point=LW,RW=Em=t,DW=Am=e}function LW(t,e){Em-=t,Am-=e,gT.add(jr(Em*Em+Am*Am)),Em=t,Am=e}let g8,Zw,m8,y8;class b8{constructor(e){this._append=e==null?BW:Wbt(e),this._radius=4.5,this._=""}pointRadius(e){return this._radius=+e,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(e,n){switch(this._point){case 0:{this._append`M${e},${n}`,this._point=1;break}case 1:{this._append`L${e},${n}`;break}default:{if(this._append`M${e},${n}`,this._radius!==m8||this._append!==Zw){const r=this._radius,i=this._;this._="",this._append`m0,${r}a${r},${r} 0 1,1 0,${-2*r}a${r},${r} 0 1,1 0,${2*r}z`,m8=r,Zw=this._append,y8=this._,this._=i}this._+=y8;break}}}result(){const e=this._;return this._="",e.length?e:null}}function BW(t){let e=1;this._+=t[0];for(const n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function Wbt(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return BW;if(e!==g8){const n=10**e;g8=e,Zw=function(i){let s=1;this._+=i[0];for(const o=i.length;s<o;++s)this._+=Math.round(arguments[s]*n)/n+i[s]}}return Zw}function eo(t,e){let n=3,r=4.5,i,s;function o(a){return a&&(typeof r=="function"&&s.pointRadius(+r.apply(this,arguments)),Co(a,i(s))),s.result()}return o.area=function(a){return Co(a,i(Xa)),Xa.result()},o.measure=function(a){return Co(a,i(k0)),k0.result()},o.bounds=function(a){return Co(a,i(Kw)),Kw.result()},o.centroid=function(a){return Co(a,i(Qi)),Qi.result()},o.projection=function(a){return arguments.length?(i=a==null?(t=null,$0):(t=a).stream,o):t},o.context=function(a){return arguments.length?(s=a==null?(e=null,new b8(n)):new OW(e=a),typeof r!="function"&&s.pointRadius(r),o):e},o.pointRadius=function(a){return arguments.length?(r=typeof a=="function"?a:(s.pointRadius(+a),+a),o):r},o.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const u=Math.floor(a);if(!(u>=0))throw new RangeError(`invalid digits: ${a}`);n=u}return e===null&&(s=new b8(n)),o},o.projection(t).digits(n).context(e)}function tx(t){return{stream:Ay(t)}}function Ay(t){return function(e){var n=new mT;for(var r in t)n[r]=t[r];return n.stream=e,n}}function mT(){}mT.prototype={constructor:mT,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function jC(t,e,n){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),r!=null&&t.clipExtent(null),Co(n,t.stream(Kw)),e(Kw.result()),r!=null&&t.clipExtent(r),t}function Y2(t,e,n){return jC(t,function(r){var i=e[1][0]-e[0][0],s=e[1][1]-e[0][1],o=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),a=+e[0][0]+(i-o*(r[1][0]+r[0][0]))/2,u=+e[0][1]+(s-o*(r[1][1]+r[0][1]))/2;t.scale(150*o).translate([a,u])},n)}function qC(t,e,n){return Y2(t,[[0,0],e],n)}function WC(t,e,n){return jC(t,function(r){var i=+e,s=i/(r[1][0]-r[0][0]),o=(i-s*(r[1][0]+r[0][0]))/2,a=-s*r[0][1];t.scale(150*s).translate([o,a])},n)}function VC(t,e,n){return jC(t,function(r){var i=+e,s=i/(r[1][1]-r[0][1]),o=-s*r[0][0],a=(i-s*(r[1][1]+r[0][1]))/2;t.scale(150*s).translate([o,a])},n)}var v8=16,Vbt=xt(30*Vt);function w8(t,e){return+e?Ybt(t,e):Gbt(t)}function Gbt(t){return Ay({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function Ybt(t,e){function n(r,i,s,o,a,u,c,l,f,d,h,p,g,m){var y=c-r,b=l-i,w=y*y+b*b;if(w>4*e&&g--){var v=o+d,x=a+h,S=u+p,_=jr(v*v+x*x+S*S),E=fi(S/=_),A=Zt(Zt(S)-1)<_t||Zt(s-f)<_t?(s+f)/2:ds(x,v),$=t(A,E),T=$[0],C=$[1],F=T-r,M=C-i,k=b*F-y*M;(k*k/w>e||Zt((y*F+b*M)/w-.5)>.3||o*d+a*h+u*p<Vbt)&&(n(r,i,s,o,a,u,T,C,A,v/=_,x/=_,S,g,m),m.point(T,C),n(T,C,A,v,x,S,c,l,f,d,h,p,g,m))}}return function(r){var i,s,o,a,u,c,l,f,d,h,p,g,m={point:y,lineStart:b,lineEnd:v,polygonStart:function(){r.polygonStart(),m.lineStart=x},polygonEnd:function(){r.polygonEnd(),m.lineStart=b}};function y(E,A){E=t(E,A),r.point(E[0],E[1])}function b(){f=NaN,m.point=w,r.lineStart()}function w(E,A){var $=Nf([E,A]),T=t(E,A);n(f,d,l,h,p,g,f=T[0],d=T[1],l=E,h=$[0],p=$[1],g=$[2],v8,r),r.point(f,d)}function v(){m.point=y,r.lineEnd()}function x(){b(),m.point=S,m.lineEnd=_}function S(E,A){w(i=E,A),s=f,o=d,a=h,u=p,c=g,m.point=w}function _(){n(f,d,l,h,p,g,s,o,i,a,u,c,v8,r),m.lineEnd=v,v()}return m}}var Hbt=Ay({point:function(t,e){this.stream.point(t*Vt,e*Vt)}});function Xbt(t){return Ay({point:function(e,n){var r=t(e,n);return this.stream.point(r[0],r[1])}})}function Kbt(t,e,n,r,i){function s(o,a){return o*=r,a*=i,[e+t*o,n-t*a]}return s.invert=function(o,a){return[(o-e)/t*r,(n-a)/t*i]},s}function x8(t,e,n,r,i,s){if(!s)return Kbt(t,e,n,r,i);var o=xt(s),a=wt(s),u=o*t,c=a*t,l=o/t,f=a/t,d=(a*n-o*e)/t,h=(a*e+o*n)/t;function p(g,m){return g*=r,m*=i,[u*g-c*m+e,n-c*g-u*m]}return p.invert=function(g,m){return[r*(l*g-f*m+d),i*(h-f*g-l*m)]},p}function da(t){return PW(function(){return t})()}function PW(t){var e,n=150,r=480,i=250,s=0,o=0,a=0,u=0,c=0,l,f=0,d=1,h=1,p=null,g=l8,m=null,y,b,w,v=$0,x=.5,S,_,E,A,$;function T(k){return E(k[0]*Vt,k[1]*Vt)}function C(k){return k=E.invert(k[0],k[1]),k&&[k[0]*an,k[1]*an]}T.stream=function(k){return A&&$===k?A:A=Hbt(Xbt(l)(g(S(v($=k)))))},T.preclip=function(k){return arguments.length?(g=k,p=void 0,M()):g},T.postclip=function(k){return arguments.length?(v=k,m=y=b=w=null,M()):v},T.clipAngle=function(k){return arguments.length?(g=+k?Ibt(p=k*Vt):(p=null,l8),M()):p*an},T.clipExtent=function(k){return arguments.length?(v=k==null?(m=y=b=w=null,$0):UC(m=+k[0][0],y=+k[0][1],b=+k[1][0],w=+k[1][1]),M()):m==null?null:[[m,y],[b,w]]},T.scale=function(k){return arguments.length?(n=+k,F()):n},T.translate=function(k){return arguments.length?(r=+k[0],i=+k[1],F()):[r,i]},T.center=function(k){return arguments.length?(s=k[0]%360*Vt,o=k[1]%360*Vt,F()):[s*an,o*an]},T.rotate=function(k){return arguments.length?(a=k[0]%360*Vt,u=k[1]%360*Vt,c=k.length>2?k[2]%360*Vt:0,F()):[a*an,u*an,c*an]},T.angle=function(k){return arguments.length?(f=k%360*Vt,F()):f*an},T.reflectX=function(k){return arguments.length?(d=k?-1:1,F()):d<0},T.reflectY=function(k){return arguments.length?(h=k?-1:1,F()):h<0},T.precision=function(k){return arguments.length?(S=w8(_,x=k*k),M()):jr(x)},T.fitExtent=function(k,I){return Y2(T,k,I)},T.fitSize=function(k,I){return qC(T,k,I)},T.fitWidth=function(k,I){return WC(T,k,I)},T.fitHeight=function(k,I){return VC(T,k,I)};function F(){var k=x8(n,0,0,d,h,f).apply(null,e(s,o)),I=x8(n,r-k[0],i-k[1],d,h,f);return l=SW(a,u,c),_=oT(e,I),E=oT(l,_),S=w8(_,x),M()}function M(){return A=$=null,T}return function(){return e=t.apply(this,arguments),T.invert=e.invert&&C,F()}}function GC(t){var e=0,n=Ht/3,r=PW(t),i=r(e,n);return i.parallels=function(s){return arguments.length?r(e=s[0]*Vt,n=s[1]*Vt):[e*an,n*an]},i}function Qbt(t){var e=xt(t);function n(r,i){return[r*e,wt(i)/e]}return n.invert=function(r,i){return[r/e,fi(i*e)]},n}function Jbt(t,e){var n=wt(t),r=(n+wt(e))/2;if(Zt(r)<_t)return Qbt(t);var i=1+n*(2*r-n),s=jr(i)/r;function o(a,u){var c=jr(i-2*r*wt(u))/r;return[c*wt(a*=r),s-c*xt(a)]}return o.invert=function(a,u){var c=s-u,l=ds(a,Zt(c))*Ji(c);return c*r<0&&(l-=Ht*Ji(a)*Ji(c)),[l/r,fi((i-(a*a+c*c)*r*r)/(2*r))]},o}function M0(){return GC(Jbt).scale(155.424).center([0,33.6442])}function YC(){return M0().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Zbt(t){var e=t.length;return{point:function(n,r){for(var i=-1;++i<e;)t[i].point(n,r)},sphere:function(){for(var n=-1;++n<e;)t[n].sphere()},lineStart:function(){for(var n=-1;++n<e;)t[n].lineStart()},lineEnd:function(){for(var n=-1;++n<e;)t[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<e;)t[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<e;)t[n].polygonEnd()}}}function zW(){var t,e,n=YC(),r,i=M0().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s,o=M0().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,u,c={point:function(d,h){u=[d,h]}};function l(d){var h=d[0],p=d[1];return u=null,r.point(h,p),u||(s.point(h,p),u)||(a.point(h,p),u)}l.invert=function(d){var h=n.scale(),p=n.translate(),g=(d[0]-p[0])/h,m=(d[1]-p[1])/h;return(m>=.12&&m<.234&&g>=-.425&&g<-.214?i:m>=.166&&m<.234&&g>=-.214&&g<-.115?o:n).invert(d)},l.stream=function(d){return t&&e===d?t:t=Zbt([n.stream(e=d),i.stream(d),o.stream(d)])},l.precision=function(d){return arguments.length?(n.precision(d),i.precision(d),o.precision(d),f()):n.precision()},l.scale=function(d){return arguments.length?(n.scale(d),i.scale(d*.35),o.scale(d),l.translate(n.translate())):n.scale()},l.translate=function(d){if(!arguments.length)return n.translate();var h=n.scale(),p=+d[0],g=+d[1];return r=n.translate(d).clipExtent([[p-.455*h,g-.238*h],[p+.455*h,g+.238*h]]).stream(c),s=i.translate([p-.307*h,g+.201*h]).clipExtent([[p-.425*h+_t,g+.12*h+_t],[p-.214*h-_t,g+.234*h-_t]]).stream(c),a=o.translate([p-.205*h,g+.212*h]).clipExtent([[p-.214*h+_t,g+.166*h+_t],[p-.115*h-_t,g+.234*h-_t]]).stream(c),f()},l.fitExtent=function(d,h){return Y2(l,d,h)},l.fitSize=function(d,h){return qC(l,d,h)},l.fitWidth=function(d,h){return WC(l,d,h)},l.fitHeight=function(d,h){return VC(l,d,h)};function f(){return t=e=null,l}return l.scale(1070)}function UW(t){return function(e,n){var r=xt(e),i=xt(n),s=t(r*i);return s===1/0?[2,0]:[s*i*wt(e),s*wt(n)]}}function $y(t){return function(e,n){var r=jr(e*e+n*n),i=t(r),s=wt(i),o=xt(i);return[ds(e*s,r*o),fi(r&&n*s/r)]}}var jW=UW(function(t){return jr(2/(1+t))});jW.invert=$y(function(t){return 2*fi(t/2)});function qW(){return da(jW).scale(124.75).clipAngle(180-.001)}var WW=UW(function(t){return(t=fW(t))&&t/wt(t)});WW.invert=$y(function(t){return t});function VW(){return da(WW).scale(79.4188).clipAngle(180-.001)}function H2(t,e){return[t,Rw(PC((en+e)/2))]}H2.invert=function(t,e){return[t,2*Hp(lW(e))-en]};function GW(){return YW(H2).scale(961/Ur)}function YW(t){var e=da(t),n=e.center,r=e.scale,i=e.translate,s=e.clipExtent,o=null,a,u,c;e.scale=function(f){return arguments.length?(r(f),l()):r()},e.translate=function(f){return arguments.length?(i(f),l()):i()},e.center=function(f){return arguments.length?(n(f),l()):n()},e.clipExtent=function(f){return arguments.length?(f==null?o=a=u=c=null:(o=+f[0][0],a=+f[0][1],u=+f[1][0],c=+f[1][1]),l()):o==null?null:[[o,a],[u,c]]};function l(){var f=Ht*r(),d=e(Sbt(e.rotate()).invert([0,0]));return s(o==null?[[d[0]-f,d[1]-f],[d[0]+f,d[1]+f]]:t===H2?[[Math.max(d[0]-f,o),a],[Math.min(d[0]+f,u),c]]:[[o,Math.max(d[1]-f,a)],[u,Math.min(d[1]+f,c)]])}return l()}function K1(t){return PC((en+t)/2)}function tvt(t,e){var n=xt(t),r=t===e?wt(t):Rw(n/xt(e))/Rw(K1(e)/K1(t)),i=n*oA(K1(t),r)/r;if(!r)return H2;function s(o,a){i>0?a<-en+_t&&(a=-en+_t):a>en-_t&&(a=en-_t);var u=i/oA(K1(a),r);return[u*wt(r*o),i-u*xt(r*o)]}return s.invert=function(o,a){var u=i-a,c=Ji(r)*jr(o*o+u*u),l=ds(o,Zt(u))*Ji(u);return u*r<0&&(l-=Ht*Ji(o)*Ji(u)),[l/r,2*Hp(oA(i/c,1/r))-en]},s}function HW(){return GC(tvt).scale(109.5).parallels([30,30])}function ex(t,e){return[t,e]}ex.invert=ex;function XW(){return da(ex).scale(152.63)}function evt(t,e){var n=xt(t),r=t===e?wt(t):(n-xt(e))/(e-t),i=n/r+t;if(Zt(r)<_t)return ex;function s(o,a){var u=i-a,c=r*o;return[u*wt(c),i-u*xt(c)]}return s.invert=function(o,a){var u=i-a,c=ds(o,Zt(u))*Ji(u);return u*r<0&&(c-=Ht*Ji(o)*Ji(u)),[c/r,i-Ji(r)*jr(o*o+u*u)]},s}function KW(){return GC(evt).scale(131.154).center([0,13.9389])}var Hm=1.340264,Xm=-.081106,Km=893e-6,Qm=.003796,nx=jr(3)/2,nvt=12;function QW(t,e){var n=fi(nx*wt(e)),r=n*n,i=r*r*r;return[t*xt(n)/(nx*(Hm+3*Xm*r+i*(7*Km+9*Qm*r))),n*(Hm+Xm*r+i*(Km+Qm*r))]}QW.invert=function(t,e){for(var n=e,r=n*n,i=r*r*r,s=0,o,a,u;s<nvt&&(a=n*(Hm+Xm*r+i*(Km+Qm*r))-e,u=Hm+3*Xm*r+i*(7*Km+9*Qm*r),n-=o=a/u,r=n*n,i=r*r*r,!(Zt(o)<K3));++s);return[nx*t*(Hm+3*Xm*r+i*(7*Km+9*Qm*r))/xt(n),fi(wt(n)/nx)]};function JW(){return da(QW).scale(177.158)}function ZW(t,e){var n=xt(e),r=xt(t)*n;return[n*wt(t)/r,wt(e)/r]}ZW.invert=$y(Hp);function tV(){return da(ZW).scale(144.049).clipAngle(60)}function rvt(){var t=1,e=0,n=0,r=1,i=1,s=0,o,a,u=null,c,l,f,d=1,h=1,p=Ay({point:function(v,x){var S=w([v,x]);this.stream.point(S[0],S[1])}}),g=$0,m,y;function b(){return d=t*r,h=t*i,m=y=null,w}function w(v){var x=v[0]*d,S=v[1]*h;if(s){var _=S*o-x*a;x=x*o+S*a,S=_}return[x+e,S+n]}return w.invert=function(v){var x=v[0]-e,S=v[1]-n;if(s){var _=S*o+x*a;x=x*o-S*a,S=_}return[x/d,S/h]},w.stream=function(v){return m&&y===v?m:m=p(g(y=v))},w.postclip=function(v){return arguments.length?(g=v,u=c=l=f=null,b()):g},w.clipExtent=function(v){return arguments.length?(g=v==null?(u=c=l=f=null,$0):UC(u=+v[0][0],c=+v[0][1],l=+v[1][0],f=+v[1][1]),b()):u==null?null:[[u,c],[l,f]]},w.scale=function(v){return arguments.length?(t=+v,b()):t},w.translate=function(v){return arguments.length?(e=+v[0],n=+v[1],b()):[e,n]},w.angle=function(v){return arguments.length?(s=v%360*Vt,a=wt(s),o=xt(s),b()):s*an},w.reflectX=function(v){return arguments.length?(r=v?-1:1,b()):r<0},w.reflectY=function(v){return arguments.length?(i=v?-1:1,b()):i<0},w.fitExtent=function(v,x){return Y2(w,v,x)},w.fitSize=function(v,x){return qC(w,v,x)},w.fitWidth=function(v,x){return WC(w,v,x)},w.fitHeight=function(v,x){return VC(w,v,x)},w}function eV(t,e){var n=e*e,r=n*n;return[t*(.8707-.131979*n+r*(-.013791+r*(.003971*n-.001529*r))),e*(1.007226+n*(.015085+r*(-.044475+.028874*n-.005916*r)))]}eV.invert=function(t,e){var n=e,r=25,i;do{var s=n*n,o=s*s;n-=i=(n*(1.007226+s*(.015085+o*(-.044475+.028874*s-.005916*o)))-e)/(1.007226+s*(.015085*3+o*(-.044475*7+.028874*9*s-.005916*11*o)))}while(Zt(i)>_t&&--r>0);return[t/(.8707+(s=n*n)*(-.131979+s*(-.013791+s*s*s*(.003971-.001529*s)))),n]};function ivt(){return da(eV).scale(175.295)}function nV(t,e){return[xt(e)*wt(t),wt(e)]}nV.invert=$y(fi);function rV(){return da(nV).scale(249.5).clipAngle(90+_t)}function iV(t,e){var n=xt(e),r=1+xt(t)*n;return[n*wt(t)/r,wt(e)/r]}iV.invert=$y(function(t){return 2*Hp(t)});function sV(){return da(iV).scale(250).clipAngle(142)}function oV(t,e){return[Rw(PC((en+e)/2)),-t]}oV.invert=function(t,e){return[-e,2*Hp(lW(t))-en]};function aV(){var t=YW(oV),e=t.center,n=t.rotate;return t.center=function(r){return arguments.length?e([-r[1],r[0]]):(r=e(),[r[1],-r[0]])},t.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):(r=n(),[r[0],r[1],r[2]-90])},n([0,0,90]).scale(159.155)}function svt(t,e){return t.parent===e.parent?1:2}function ovt(t){return t.reduce(avt,0)/t.length}function avt(t,e){return t+e.x}function uvt(t){return 1+t.reduce(cvt,0)}function cvt(t,e){return Math.max(t,e.y)}function lvt(t){for(var e;e=t.children;)t=e[0];return t}function fvt(t){for(var e;e=t.children;)t=e[e.length-1];return t}function HC(){var t=svt,e=1,n=1,r=!1;function i(s){var o,a=0;s.eachAfter(function(d){var h=d.children;h?(d.x=ovt(h),d.y=uvt(h)):(d.x=o?a+=t(d,o):0,d.y=0,o=d)});var u=lvt(s),c=fvt(s),l=u.x-t(u,c)/2,f=c.x+t(c,u)/2;return s.eachAfter(r?function(d){d.x=(d.x-s.x)*e,d.y=(s.y-d.y)*n}:function(d){d.x=(d.x-l)/(f-l)*e,d.y=(1-(s.y?d.y/s.y:1))*n})}return i.separation=function(s){return arguments.length?(t=s,i):t},i.size=function(s){return arguments.length?(r=!1,e=+s[0],n=+s[1],i):r?null:[e,n]},i.nodeSize=function(s){return arguments.length?(r=!0,e=+s[0],n=+s[1],i):r?[e,n]:null},i}function dvt(t){var e=0,n=t.children,r=n&&n.length;if(!r)e=1;else for(;--r>=0;)e+=n[r].value;t.value=e}function hvt(){return this.eachAfter(dvt)}function pvt(t,e){let n=-1;for(const r of this)t.call(e,r,++n,this);return this}function gvt(t,e){for(var n=this,r=[n],i,s,o=-1;n=r.pop();)if(t.call(e,n,++o,this),i=n.children)for(s=i.length-1;s>=0;--s)r.push(i[s]);return this}function mvt(t,e){for(var n=this,r=[n],i=[],s,o,a,u=-1;n=r.pop();)if(i.push(n),s=n.children)for(o=0,a=s.length;o<a;++o)r.push(s[o]);for(;n=i.pop();)t.call(e,n,++u,this);return this}function yvt(t,e){let n=-1;for(const r of this)if(t.call(e,r,++n,this))return r}function bvt(t){return this.eachAfter(function(e){for(var n=+t(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)n+=r[i].value;e.value=n})}function vvt(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})}function wvt(t){for(var e=this,n=xvt(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var i=r.length;t!==n;)r.splice(i,0,t),t=t.parent;return r}function xvt(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),i=null;for(t=n.pop(),e=r.pop();t===e;)i=t,t=n.pop(),e=r.pop();return i}function _vt(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e}function Svt(){return Array.from(this)}function Evt(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t}function Avt(){var t=this,e=[];return t.each(function(n){n!==t&&e.push({source:n.parent,target:n})}),e}function*$vt(){var t=this,e,n=[t],r,i,s;do for(e=n.reverse(),n=[];t=e.pop();)if(yield t,r=t.children)for(i=0,s=r.length;i<s;++i)n.push(r[i]);while(n.length)}function XC(t,e){t instanceof Map?(t=[void 0,t],e===void 0&&(e=Mvt)):e===void 0&&(e=kvt);for(var n=new tp(t),r,i=[n],s,o,a,u;r=i.pop();)if((o=e(r.data))&&(u=(o=Array.from(o)).length))for(r.children=o,a=u-1;a>=0;--a)i.push(s=o[a]=new tp(o[a])),s.parent=r,s.depth=r.depth+1;return n.eachBefore(uV)}function Tvt(){return XC(this).eachBefore(Cvt)}function kvt(t){return t.children}function Mvt(t){return Array.isArray(t)?t[1]:null}function Cvt(t){t.data.value!==void 0&&(t.value=t.data.value),t.data=t.data.data}function uV(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function tp(t){this.data=t,this.depth=this.height=0,this.parent=null}tp.prototype=XC.prototype={constructor:tp,count:hvt,each:pvt,eachAfter:mvt,eachBefore:gvt,find:yvt,sum:bvt,sort:vvt,path:wvt,ancestors:_vt,descendants:Svt,leaves:Evt,links:Avt,copy:Tvt,[Symbol.iterator]:$vt};function lv(t){return t==null?null:cV(t)}function cV(t){if(typeof t!="function")throw new Error;return t}function Gl(){return 0}function sh(t){return function(){return t}}const Ivt=1664525,Fvt=1013904223,_8=4294967296;function Nvt(){let t=1;return()=>(t=(Ivt*t+Fvt)%_8)/_8}function Ovt(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Rvt(t,e){let n=t.length,r,i;for(;n;)i=e()*n--|0,r=t[n],t[n]=t[i],t[i]=r;return t}function Dvt(t,e){for(var n=0,r=(t=Rvt(Array.from(t),e)).length,i=[],s,o;n<r;)s=t[n],o&&lV(o,s)?++n:(o=Bvt(i=Lvt(i,s)),n=0);return o}function Lvt(t,e){var n,r;if(fA(e,t))return[e];for(n=0;n<t.length;++n)if(Q1(e,t[n])&&fA($m(t[n],e),t))return[t[n],e];for(n=0;n<t.length-1;++n)for(r=n+1;r<t.length;++r)if(Q1($m(t[n],t[r]),e)&&Q1($m(t[n],e),t[r])&&Q1($m(t[r],e),t[n])&&fA(fV(t[n],t[r],e),t))return[t[n],t[r],e];throw new Error}function Q1(t,e){var n=t.r-e.r,r=e.x-t.x,i=e.y-t.y;return n<0||n*n<r*r+i*i}function lV(t,e){var n=t.r-e.r+Math.max(t.r,e.r,1)*1e-9,r=e.x-t.x,i=e.y-t.y;return n>0&&n*n>r*r+i*i}function fA(t,e){for(var n=0;n<e.length;++n)if(!lV(t,e[n]))return!1;return!0}function Bvt(t){switch(t.length){case 1:return Pvt(t[0]);case 2:return $m(t[0],t[1]);case 3:return fV(t[0],t[1],t[2])}}function Pvt(t){return{x:t.x,y:t.y,r:t.r}}function $m(t,e){var n=t.x,r=t.y,i=t.r,s=e.x,o=e.y,a=e.r,u=s-n,c=o-r,l=a-i,f=Math.sqrt(u*u+c*c);return{x:(n+s+u/f*l)/2,y:(r+o+c/f*l)/2,r:(f+i+a)/2}}function fV(t,e,n){var r=t.x,i=t.y,s=t.r,o=e.x,a=e.y,u=e.r,c=n.x,l=n.y,f=n.r,d=r-o,h=r-c,p=i-a,g=i-l,m=u-s,y=f-s,b=r*r+i*i-s*s,w=b-o*o-a*a+u*u,v=b-c*c-l*l+f*f,x=h*p-d*g,S=(p*v-g*w)/(x*2)-r,_=(g*m-p*y)/x,E=(h*w-d*v)/(x*2)-i,A=(d*y-h*m)/x,$=_*_+A*A-1,T=2*(s+S*_+E*A),C=S*S+E*E-s*s,F=-(Math.abs($)>1e-6?(T+Math.sqrt(T*T-4*$*C))/(2*$):C/T);return{x:r+S+_*F,y:i+E+A*F,r:F}}function S8(t,e,n){var r=t.x-e.x,i,s,o=t.y-e.y,a,u,c=r*r+o*o;c?(s=e.r+n.r,s*=s,u=t.r+n.r,u*=u,s>u?(i=(c+u-s)/(2*c),a=Math.sqrt(Math.max(0,u/c-i*i)),n.x=t.x-i*r-a*o,n.y=t.y-i*o+a*r):(i=(c+s-u)/(2*c),a=Math.sqrt(Math.max(0,s/c-i*i)),n.x=e.x+i*r-a*o,n.y=e.y+i*o+a*r)):(n.x=e.x+n.r,n.y=e.y)}function E8(t,e){var n=t.r+e.r-1e-6,r=e.x-t.x,i=e.y-t.y;return n>0&&n*n>r*r+i*i}function A8(t){var e=t._,n=t.next._,r=e.r+n.r,i=(e.x*n.r+n.x*e.r)/r,s=(e.y*n.r+n.y*e.r)/r;return i*i+s*s}function J1(t){this._=t,this.next=null,this.previous=null}function zvt(t,e){if(!(s=(t=Ovt(t)).length))return 0;var n,r,i,s,o,a,u,c,l,f,d;if(n=t[0],n.x=0,n.y=0,!(s>1))return n.r;if(r=t[1],n.x=-r.r,r.x=n.r,r.y=0,!(s>2))return n.r+r.r;S8(r,n,i=t[2]),n=new J1(n),r=new J1(r),i=new J1(i),n.next=i.previous=r,r.next=n.previous=i,i.next=r.previous=n;t:for(u=3;u<s;++u){S8(n._,r._,i=t[u]),i=new J1(i),c=r.next,l=n.previous,f=r._.r,d=n._.r;do if(f<=d){if(E8(c._,i._)){r=c,n.next=r,r.previous=n,--u;continue t}f+=c._.r,c=c.next}else{if(E8(l._,i._)){n=l,n.next=r,r.previous=n,--u;continue t}d+=l._.r,l=l.previous}while(c!==l.next);for(i.previous=n,i.next=r,n.next=r.previous=r=i,o=A8(n);(i=i.next)!==r;)(a=A8(i))<o&&(n=i,o=a);r=n.next}for(n=[r._],i=r;(i=i.next)!==r;)n.push(i._);for(i=Dvt(n,e),u=0;u<s;++u)n=t[u],n.x-=i.x,n.y-=i.y;return i.r}function Uvt(t){return Math.sqrt(t.value)}function jvt(){var t=null,e=1,n=1,r=Gl;function i(s){const o=Nvt();return s.x=e/2,s.y=n/2,t?s.eachBefore($8(t)).eachAfter(dA(r,.5,o)).eachBefore(T8(1)):s.eachBefore($8(Uvt)).eachAfter(dA(Gl,1,o)).eachAfter(dA(r,s.r/Math.min(e,n),o)).eachBefore(T8(Math.min(e,n)/(2*s.r))),s}return i.radius=function(s){return arguments.length?(t=lv(s),i):t},i.size=function(s){return arguments.length?(e=+s[0],n=+s[1],i):[e,n]},i.padding=function(s){return arguments.length?(r=typeof s=="function"?s:sh(+s),i):r},i}function $8(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function dA(t,e,n){return function(r){if(i=r.children){var i,s,o=i.length,a=t(r)*e||0,u;if(a)for(s=0;s<o;++s)i[s].r+=a;if(u=zvt(i,n),a)for(s=0;s<o;++s)i[s].r-=a;r.r=u+a}}}function T8(t){return function(e){var n=e.parent;e.r*=t,n&&(e.x=n.x+t*e.x,e.y=n.y+t*e.y)}}function dV(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function Ty(t,e,n,r,i){for(var s=t.children,o,a=-1,u=s.length,c=t.value&&(r-e)/t.value;++a<u;)o=s[a],o.y0=n,o.y1=i,o.x0=e,o.x1=e+=o.value*c}function qvt(){var t=1,e=1,n=0,r=!1;function i(o){var a=o.height+1;return o.x0=o.y0=n,o.x1=t,o.y1=e/a,o.eachBefore(s(e,a)),r&&o.eachBefore(dV),o}function s(o,a){return function(u){u.children&&Ty(u,u.x0,o*(u.depth+1)/a,u.x1,o*(u.depth+2)/a);var c=u.x0,l=u.y0,f=u.x1-n,d=u.y1-n;f<c&&(c=f=(c+f)/2),d<l&&(l=d=(l+d)/2),u.x0=c,u.y0=l,u.x1=f,u.y1=d}}return i.round=function(o){return arguments.length?(r=!!o,i):r},i.size=function(o){return arguments.length?(t=+o[0],e=+o[1],i):[t,e]},i.padding=function(o){return arguments.length?(n=+o,i):n},i}var Wvt={depth:-1},k8={},hA={};function Vvt(t){return t.id}function Gvt(t){return t.parentId}function rx(){var t=Vvt,e=Gvt,n;function r(i){var s=Array.from(i),o=t,a=e,u,c,l,f,d,h,p,g,m=new Map;if(n!=null){const y=s.map((v,x)=>Yvt(n(v,x,i))),b=y.map(M8),w=new Set(y).add("");for(const v of b)w.has(v)||(w.add(v),y.push(v),b.push(M8(v)),s.push(hA));o=(v,x)=>y[x],a=(v,x)=>b[x]}for(l=0,u=s.length;l<u;++l)c=s[l],h=s[l]=new tp(c),(p=o(c,l,i))!=null&&(p+="")&&(g=h.id=p,m.set(g,m.has(g)?k8:h)),(p=a(c,l,i))!=null&&(p+="")&&(h.parent=p);for(l=0;l<u;++l)if(h=s[l],p=h.parent){if(d=m.get(p),!d)throw new Error("missing: "+p);if(d===k8)throw new Error("ambiguous: "+p);d.children?d.children.push(h):d.children=[h],h.parent=d}else{if(f)throw new Error("multiple roots");f=h}if(!f)throw new Error("no root");if(n!=null){for(;f.data===hA&&f.children.length===1;)f=f.children[0],--u;for(let y=s.length-1;y>=0&&(h=s[y],h.data===hA);--y)h.data=null}if(f.parent=Wvt,f.eachBefore(function(y){y.depth=y.parent.depth+1,--u}).eachBefore(uV),f.parent=null,u>0)throw new Error("cycle");return f}return r.id=function(i){return arguments.length?(t=lv(i),r):t},r.parentId=function(i){return arguments.length?(e=lv(i),r):e},r.path=function(i){return arguments.length?(n=lv(i),r):n},r}function Yvt(t){t=`${t}`;let e=t.length;return yT(t,e-1)&&!yT(t,e-2)&&(t=t.slice(0,-1)),t[0]==="/"?t:`/${t}`}function M8(t){let e=t.length;if(e<2)return"";for(;--e>1&&!yT(t,e););return t.slice(0,e)}function yT(t,e){if(t[e]==="/"){let n=0;for(;e>0&&t[--e]==="\\";)++n;if(!(n&1))return!0}return!1}function Hvt(t,e){return t.parent===e.parent?1:2}function pA(t){var e=t.children;return e?e[0]:t.t}function gA(t){var e=t.children;return e?e[e.length-1]:t.t}function Xvt(t,e,n){var r=n/(e.i-t.i);e.c-=r,e.s+=n,t.c+=r,e.z+=n,e.m+=n}function Kvt(t){for(var e=0,n=0,r=t.children,i=r.length,s;--i>=0;)s=r[i],s.z+=e,s.m+=e,e+=s.s+(n+=s.c)}function Qvt(t,e,n){return t.a.parent===e.parent?t.a:n}function fv(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}fv.prototype=Object.create(tp.prototype);function Jvt(t){for(var e=new fv(t,0),n,r=[e],i,s,o,a;n=r.pop();)if(s=n._.children)for(n.children=new Array(a=s.length),o=a-1;o>=0;--o)r.push(i=n.children[o]=new fv(s[o],o)),i.parent=n;return(e.parent=new fv(null,0)).children=[e],e}function C0(){var t=Hvt,e=1,n=1,r=null;function i(c){var l=Jvt(c);if(l.eachAfter(s),l.parent.m=-l.z,l.eachBefore(o),r)c.eachBefore(u);else{var f=c,d=c,h=c;c.eachBefore(function(b){b.x<f.x&&(f=b),b.x>d.x&&(d=b),b.depth>h.depth&&(h=b)});var p=f===d?1:t(f,d)/2,g=p-f.x,m=e/(d.x+p+g),y=n/(h.depth||1);c.eachBefore(function(b){b.x=(b.x+g)*m,b.y=b.depth*y})}return c}function s(c){var l=c.children,f=c.parent.children,d=c.i?f[c.i-1]:null;if(l){Kvt(c);var h=(l[0].z+l[l.length-1].z)/2;d?(c.z=d.z+t(c._,d._),c.m=c.z-h):c.z=h}else d&&(c.z=d.z+t(c._,d._));c.parent.A=a(c,d,c.parent.A||f[0])}function o(c){c._.x=c.z+c.parent.m,c.m+=c.parent.m}function a(c,l,f){if(l){for(var d=c,h=c,p=l,g=d.parent.children[0],m=d.m,y=h.m,b=p.m,w=g.m,v;p=gA(p),d=pA(d),p&&d;)g=pA(g),h=gA(h),h.a=c,v=p.z+b-d.z-m+t(p._,d._),v>0&&(Xvt(Qvt(p,c,f),c,v),m+=v,y+=v),b+=p.m,m+=d.m,w+=g.m,y+=h.m;p&&!gA(h)&&(h.t=p,h.m+=b-y),d&&!pA(g)&&(g.t=d,g.m+=m-w,f=c)}return f}function u(c){c.x*=e,c.y=c.depth*n}return i.separation=function(c){return arguments.length?(t=c,i):t},i.size=function(c){return arguments.length?(r=!1,e=+c[0],n=+c[1],i):r?null:[e,n]},i.nodeSize=function(c){return arguments.length?(r=!0,e=+c[0],n=+c[1],i):r?[e,n]:null},i}function X2(t,e,n,r,i){for(var s=t.children,o,a=-1,u=s.length,c=t.value&&(i-n)/t.value;++a<u;)o=s[a],o.x0=e,o.x1=r,o.y0=n,o.y1=n+=o.value*c}var hV=(1+Math.sqrt(5))/2;function pV(t,e,n,r,i,s){for(var o=[],a=e.children,u,c,l=0,f=0,d=a.length,h,p,g=e.value,m,y,b,w,v,x,S;l<d;){h=i-n,p=s-r;do m=a[f++].value;while(!m&&f<d);for(y=b=m,x=Math.max(p/h,h/p)/(g*t),S=m*m*x,v=Math.max(b/S,S/y);f<d;++f){if(m+=c=a[f].value,c<y&&(y=c),c>b&&(b=c),S=m*m*x,w=Math.max(b/S,S/y),w>v){m-=c;break}v=w}o.push(u={value:m,dice:h<p,children:a.slice(l,f)}),u.dice?Ty(u,n,r,i,g?r+=p*m/g:s):X2(u,n,r,g?n+=h*m/g:i,s),g-=m,l=f}return o}const gV=function t(e){function n(r,i,s,o,a){pV(e,r,i,s,o,a)}return n.ratio=function(r){return t((r=+r)>1?r:1)},n}(hV);function Zvt(){var t=gV,e=!1,n=1,r=1,i=[0],s=Gl,o=Gl,a=Gl,u=Gl,c=Gl;function l(d){return d.x0=d.y0=0,d.x1=n,d.y1=r,d.eachBefore(f),i=[0],e&&d.eachBefore(dV),d}function f(d){var h=i[d.depth],p=d.x0+h,g=d.y0+h,m=d.x1-h,y=d.y1-h;m<p&&(p=m=(p+m)/2),y<g&&(g=y=(g+y)/2),d.x0=p,d.y0=g,d.x1=m,d.y1=y,d.children&&(h=i[d.depth+1]=s(d)/2,p+=c(d)-h,g+=o(d)-h,m-=a(d)-h,y-=u(d)-h,m<p&&(p=m=(p+m)/2),y<g&&(g=y=(g+y)/2),t(d,p,g,m,y))}return l.round=function(d){return arguments.length?(e=!!d,l):e},l.size=function(d){return arguments.length?(n=+d[0],r=+d[1],l):[n,r]},l.tile=function(d){return arguments.length?(t=cV(d),l):t},l.padding=function(d){return arguments.length?l.paddingInner(d).paddingOuter(d):l.paddingInner()},l.paddingInner=function(d){return arguments.length?(s=typeof d=="function"?d:sh(+d),l):s},l.paddingOuter=function(d){return arguments.length?l.paddingTop(d).paddingRight(d).paddingBottom(d).paddingLeft(d):l.paddingTop()},l.paddingTop=function(d){return arguments.length?(o=typeof d=="function"?d:sh(+d),l):o},l.paddingRight=function(d){return arguments.length?(a=typeof d=="function"?d:sh(+d),l):a},l.paddingBottom=function(d){return arguments.length?(u=typeof d=="function"?d:sh(+d),l):u},l.paddingLeft=function(d){return arguments.length?(c=typeof d=="function"?d:sh(+d),l):c},l}function twt(t,e,n,r,i){var s=t.children,o,a=s.length,u,c=new Array(a+1);for(c[0]=u=o=0;o<a;++o)c[o+1]=u+=s[o].value;l(0,a,t.value,e,n,r,i);function l(f,d,h,p,g,m,y){if(f>=d-1){var b=s[f];b.x0=p,b.y0=g,b.x1=m,b.y1=y;return}for(var w=c[f],v=h/2+w,x=f+1,S=d-1;x<S;){var _=x+S>>>1;c[_]<v?x=_+1:S=_}v-c[x-1]<c[x]-v&&f+1<x&&--x;var E=c[x]-w,A=h-E;if(m-p>y-g){var $=h?(p*A+m*E)/h:m;l(f,x,E,p,g,$,y),l(x,d,A,$,g,m,y)}else{var T=h?(g*A+y*E)/h:y;l(f,x,E,p,g,m,T),l(x,d,A,p,T,m,y)}}}function ewt(t,e,n,r,i){(t.depth&1?X2:Ty)(t,e,n,r,i)}const nwt=function t(e){function n(r,i,s,o,a){if((u=r._squarify)&&u.ratio===e)for(var u,c,l,f,d=-1,h,p=u.length,g=r.value;++d<p;){for(c=u[d],l=c.children,f=c.value=0,h=l.length;f<h;++f)c.value+=l[f].value;c.dice?Ty(c,i,s,o,g?s+=(a-s)*c.value/g:a):X2(c,i,s,g?i+=(o-i)*c.value/g:o,a),g-=c.value}else r._squarify=u=pV(e,r,i,s,o,a),u.ratio=e}return n.ratio=function(r){return t((r=+r)>1?r:1)},n}(hV),rwt=1664525,iwt=1013904223,C8=1/4294967296;function KC(t=Math.random()){let e=(0<=t&&t<1?t/C8:Math.abs(t))|0;return()=>(e=rwt*e+iwt|0,C8*(e>>>0))}function no(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function cl(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const ix=Symbol("implicit");function ky(){var t=new kf,e=[],n=[],r=ix;function i(s){let o=t.get(s);if(o===void 0){if(r!==ix)return r;t.set(s,o=e.push(s)-1)}return n[o%n.length]}return i.domain=function(s){if(!arguments.length)return e.slice();e=[],t=new kf;for(const o of s)t.has(o)||t.set(o,e.push(o)-1);return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return ky(e,n).unknown(r)},no.apply(i,arguments),i}function K2(){var t=ky().unknown(void 0),e=t.domain,n=t.range,r=0,i=1,s,o,a=!1,u=0,c=0,l=.5;delete t.unknown;function f(){var d=e().length,h=i<r,p=h?i:r,g=h?r:i;s=(g-p)/Math.max(1,d-u+c*2),a&&(s=Math.floor(s)),p+=(g-p-s*(d-u))*l,o=s*(1-u),a&&(p=Math.round(p),o=Math.round(o));var m=xn(d).map(function(y){return p+s*y});return n(h?m.reverse():m)}return t.domain=function(d){return arguments.length?(e(d),f()):e()},t.range=function(d){return arguments.length?([r,i]=d,r=+r,i=+i,f()):[r,i]},t.rangeRound=function(d){return[r,i]=d,r=+r,i=+i,a=!0,f()},t.bandwidth=function(){return o},t.step=function(){return s},t.round=function(d){return arguments.length?(a=!!d,f()):a},t.padding=function(d){return arguments.length?(u=Math.min(1,c=+d),f()):u},t.paddingInner=function(d){return arguments.length?(u=Math.min(1,d),f()):u},t.paddingOuter=function(d){return arguments.length?(c=+d,f()):c},t.align=function(d){return arguments.length?(l=Math.max(0,Math.min(1,d)),f()):l},t.copy=function(){return K2(e(),[r,i]).round(a).paddingInner(u).paddingOuter(c).align(l)},no.apply(f(),arguments)}function mV(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return mV(e())},t}function swt(){return mV(K2.apply(null,arguments).paddingInner(1))}function owt(t){return function(){return t}}function bT(t){return+t}var I8=[0,1];function ii(t){return t}function vT(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:owt(isNaN(e)?NaN:.5)}function awt(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function uwt(t,e,n){var r=t[0],i=t[1],s=e[0],o=e[1];return i<r?(r=vT(i,r),s=n(o,s)):(r=vT(r,i),s=n(s,o)),function(a){return s(r(a))}}function cwt(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),s=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=vT(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(a){var u=hu(t,a,1,r)-1;return s[u](i[u](a))}}function My(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Q2(){var t=I8,e=I8,n=ku,r,i,s,o=ii,a,u,c;function l(){var d=Math.min(t.length,e.length);return o!==ii&&(o=awt(t[0],t[d-1])),a=d>2?cwt:uwt,u=c=null,f}function f(d){return d==null||isNaN(d=+d)?s:(u||(u=a(t.map(r),e,n)))(r(o(d)))}return f.invert=function(d){return o(i((c||(c=a(e,t.map(r),qn)))(d)))},f.domain=function(d){return arguments.length?(t=Array.from(d,bT),l()):t.slice()},f.range=function(d){return arguments.length?(e=Array.from(d),l()):e.slice()},f.rangeRound=function(d){return e=Array.from(d),n=Gp,l()},f.clamp=function(d){return arguments.length?(o=d?!0:ii,l()):o!==ii},f.interpolate=function(d){return arguments.length?(n=d,l()):n},f.unknown=function(d){return arguments.length?(s=d,f):s},function(d,h){return r=d,i=h,l()}}function yV(){return Q2()(ii,ii)}function bV(t,e,n,r){var i=Bc(t,e,n),s;switch(r=Ff(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(s=uW(i,o))&&(r.precision=s),BC(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=cW(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=aW(i))&&(r.precision=s-(r.type==="%")*2);break}}return id(r)}function sd(t){var e=t.domain;return t.ticks=function(n){var r=e();return Lc(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return bV(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,s=r.length-1,o=r[i],a=r[s],u,c,l=10;for(a<o&&(c=o,o=a,a=c,c=i,i=s,s=c);l-- >0;){if(c=x0(o,a,n),c===u)return r[i]=o,r[s]=a,e(r);if(c>0)o=Math.floor(o/c)*c,a=Math.ceil(a/c)*c;else if(c<0)o=Math.ceil(o*c)/c,a=Math.floor(a*c)/c;else break;u=c}return t},t}function J2(){var t=yV();return t.copy=function(){return My(t,J2())},no.apply(t,arguments),sd(t)}function QC(t){var e;function n(r){return r==null||isNaN(r=+r)?e:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(t=Array.from(r,bT),n):t.slice()},n.unknown=function(r){return arguments.length?(e=r,n):e},n.copy=function(){return QC(t).unknown(e)},t=arguments.length?Array.from(t,bT):[0,1],sd(n)}function vV(t,e){t=t.slice();var n=0,r=t.length-1,i=t[n],s=t[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),t[n]=e.floor(i),t[r]=e.ceil(s),t}function F8(t){return Math.log(t)}function N8(t){return Math.exp(t)}function lwt(t){return-Math.log(-t)}function fwt(t){return-Math.exp(-t)}function dwt(t){return isFinite(t)?+("1e"+t):t<0?0:t}function hwt(t){return t===10?dwt:t===Math.E?Math.exp:e=>Math.pow(t,e)}function pwt(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function O8(t){return(e,n)=>-t(-e,n)}function JC(t){const e=t(F8,N8),n=e.domain;let r=10,i,s;function o(){return i=pwt(r),s=hwt(r),n()[0]<0?(i=O8(i),s=O8(s),t(lwt,fwt)):t(F8,N8),e}return e.base=function(a){return arguments.length?(r=+a,o()):r},e.domain=function(a){return arguments.length?(n(a),o()):n()},e.ticks=a=>{const u=n();let c=u[0],l=u[u.length-1];const f=l<c;f&&([c,l]=[l,c]);let d=i(c),h=i(l),p,g;const m=a==null?10:+a;let y=[];if(!(r%1)&&h-d<m){if(d=Math.floor(d),h=Math.ceil(h),c>0){for(;d<=h;++d)for(p=1;p<r;++p)if(g=d<0?p/s(-d):p*s(d),!(g<c)){if(g>l)break;y.push(g)}}else for(;d<=h;++d)for(p=r-1;p>=1;--p)if(g=d>0?p/s(-d):p*s(d),!(g<c)){if(g>l)break;y.push(g)}y.length*2<m&&(y=Lc(c,l,m))}else y=Lc(d,h,Math.min(h-d,m)).map(s);return f?y.reverse():y},e.tickFormat=(a,u)=>{if(a==null&&(a=10),u==null&&(u=r===10?"s":","),typeof u!="function"&&(!(r%1)&&(u=Ff(u)).precision==null&&(u.trim=!0),u=id(u)),a===1/0)return u;const c=Math.max(1,r*a/e.ticks().length);return l=>{let f=l/s(Math.round(i(l)));return f*r<r-.5&&(f*=r),f<=c?u(l):""}},e.nice=()=>n(vV(n(),{floor:a=>s(Math.floor(i(a))),ceil:a=>s(Math.ceil(i(a)))})),e}function ZC(){const t=JC(Q2()).domain([1,10]);return t.copy=()=>My(t,ZC()).base(t.base()),no.apply(t,arguments),t}function R8(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function D8(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function tI(t){var e=1,n=t(R8(e),D8(e));return n.constant=function(r){return arguments.length?t(R8(e=+r),D8(e)):e},sd(n)}function eI(){var t=tI(Q2());return t.copy=function(){return My(t,eI()).constant(t.constant())},no.apply(t,arguments)}function L8(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function gwt(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function mwt(t){return t<0?-t*t:t*t}function nI(t){var e=t(ii,ii),n=1;function r(){return n===1?t(ii,ii):n===.5?t(gwt,mwt):t(L8(n),L8(1/n))}return e.exponent=function(i){return arguments.length?(n=+i,r()):n},sd(e)}function Z2(){var t=nI(Q2());return t.copy=function(){return My(t,Z2()).exponent(t.exponent())},no.apply(t,arguments),t}function ywt(){return Z2.apply(null,arguments).exponent(.5)}function rI(){var t=[],e=[],n=[],r;function i(){var o=0,a=Math.max(1,e.length);for(n=new Array(a-1);++o<a;)n[o-1]=eq(t,o/a);return s}function s(o){return o==null||isNaN(o=+o)?r:e[hu(n,o)]}return s.invertExtent=function(o){var a=e.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:t[0],a<n.length?n[a]:t[t.length-1]]},s.domain=function(o){if(!arguments.length)return t.slice();t=[];for(let a of o)a!=null&&!isNaN(a=+a)&&t.push(a);return t.sort(Fe),i()},s.range=function(o){return arguments.length?(e=Array.from(o),i()):e.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.quantiles=function(){return n.slice()},s.copy=function(){return rI().domain(t).range(e).unknown(r)},no.apply(s,arguments)}function wV(){var t=0,e=1,n=1,r=[.5],i=[0,1],s;function o(u){return u!=null&&u<=u?i[hu(r,u,0,n)]:s}function a(){var u=-1;for(r=new Array(n);++u<n;)r[u]=((u+1)*e-(u-n)*t)/(n+1);return o}return o.domain=function(u){return arguments.length?([t,e]=u,t=+t,e=+e,a()):[t,e]},o.range=function(u){return arguments.length?(n=(i=Array.from(u)).length-1,a()):i.slice()},o.invertExtent=function(u){var c=i.indexOf(u);return c<0?[NaN,NaN]:c<1?[t,r[0]]:c>=n?[r[n-1],e]:[r[c-1],r[c]]},o.unknown=function(u){return arguments.length&&(s=u),o},o.thresholds=function(){return r.slice()},o.copy=function(){return wV().domain([t,e]).range(i).unknown(s)},no.apply(sd(o),arguments)}function iI(){var t=[.5],e=[0,1],n,r=1;function i(s){return s!=null&&s<=s?e[hu(t,s,0,r)]:n}return i.domain=function(s){return arguments.length?(t=Array.from(s),r=Math.min(t.length,e.length-1),i):t.slice()},i.range=function(s){return arguments.length?(e=Array.from(s),r=Math.min(t.length,e.length-1),i):e.slice()},i.invertExtent=function(s){var o=e.indexOf(s);return[t[o-1],t[o]]},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return iI().domain(t).range(e).unknown(n)},no.apply(i,arguments)}const mA=new Date,yA=new Date;function An(t,e,n,r){function i(s){return t(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=s=>(t(s=new Date(+s)),s),i.ceil=s=>(t(s=new Date(s-1)),e(s,1),t(s),s),i.round=s=>{const o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=(s,o)=>(e(s=new Date(+s),o==null?1:Math.floor(o)),s),i.range=(s,o,a)=>{const u=[];if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;let c;do u.push(c=new Date(+s)),e(s,a),t(s);while(c<s&&s<o);return u},i.filter=s=>An(o=>{if(o>=o)for(;t(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;e(o,-1),!s(o););else for(;--a>=0;)for(;e(o,1),!s(o););}),n&&(i.count=(s,o)=>(mA.setTime(+s),yA.setTime(+o),t(mA),t(yA),Math.floor(n(mA,yA))),i.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?o=>r(o)%s===0:o=>i.count(0,o)%s===0):i)),i}const ep=An(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);ep.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?An(e=>{e.setTime(Math.floor(e/t)*t)},(e,n)=>{e.setTime(+e+n*t)},(e,n)=>(n-e)/t):ep);ep.range;const Ja=1e3,Zi=Ja*60,Za=Zi*60,bu=Za*24,sI=bu*7,B8=bu*30,bA=bu*365,$i=An(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*Ja)},(t,e)=>(e-t)/Ja,t=>t.getUTCSeconds());$i.range;const Xp=An(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Ja)},(t,e)=>{t.setTime(+t+e*Zi)},(t,e)=>(e-t)/Zi,t=>t.getMinutes());Xp.range;const Kp=An(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*Zi)},(t,e)=>(e-t)/Zi,t=>t.getUTCMinutes());Kp.range;const Qp=An(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Ja-t.getMinutes()*Zi)},(t,e)=>{t.setTime(+t+e*Za)},(t,e)=>(e-t)/Za,t=>t.getHours());Qp.range;const Jp=An(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*Za)},(t,e)=>(e-t)/Za,t=>t.getUTCHours());Jp.range;const js=An(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Zi)/bu,t=>t.getDate()-1);js.range;const Sc=An(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/bu,t=>t.getUTCDate()-1);Sc.range;const t_=An(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/bu,t=>Math.floor(t/bu));t_.range;function od(t){return An(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,n)=>{e.setDate(e.getDate()+n*7)},(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*Zi)/sI)}const Uc=od(0),I0=od(1),xV=od(2),_V=od(3),Rf=od(4),SV=od(5),EV=od(6);Uc.range;I0.range;xV.range;_V.range;Rf.range;SV.range;EV.range;function ad(t){return An(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n*7)},(e,n)=>(n-e)/sI)}const jc=ad(0),F0=ad(1),AV=ad(2),$V=ad(3),Df=ad(4),TV=ad(5),kV=ad(6);jc.range;F0.range;AV.range;$V.range;Df.range;TV.range;kV.range;const Lf=An(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());Lf.range;const Bf=An(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());Bf.range;const hs=An(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());hs.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:An(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n*t)});hs.range;const ps=An(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());ps.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:An(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)});ps.range;function MV(t,e,n,r,i,s){const o=[[$i,1,Ja],[$i,5,5*Ja],[$i,15,15*Ja],[$i,30,30*Ja],[s,1,Zi],[s,5,5*Zi],[s,15,15*Zi],[s,30,30*Zi],[i,1,Za],[i,3,3*Za],[i,6,6*Za],[i,12,12*Za],[r,1,bu],[r,2,2*bu],[n,1,sI],[e,1,B8],[e,3,3*B8],[t,1,bA]];function a(c,l,f){const d=l<c;d&&([c,l]=[l,c]);const h=f&&typeof f.range=="function"?f:u(c,l,f),p=h?h.range(c,+l+1):[];return d?p.reverse():p}function u(c,l,f){const d=Math.abs(l-c)/f,h=rd(([,,m])=>m).right(o,d);if(h===o.length)return t.every(Bc(c/bA,l/bA,f));if(h===0)return ep.every(Math.max(Bc(c,l,f),1));const[p,g]=o[d/o[h-1][2]<o[h][2]/d?h-1:h];return p.every(g)}return[a,u]}const[bwt,CV]=MV(ps,Bf,jc,t_,Jp,Kp),[vwt,wwt]=MV(hs,Lf,Uc,js,Qp,Xp);function vA(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function wA(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function Bg(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function IV(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,s=t.days,o=t.shortDays,a=t.months,u=t.shortMonths,c=Pg(i),l=zg(i),f=Pg(s),d=zg(s),h=Pg(o),p=zg(o),g=Pg(a),m=zg(a),y=Pg(u),b=zg(u),w={a:N,A:R,b:D,B:L,c:null,d:W8,e:W8,f:qwt,g:Zwt,G:ext,H:zwt,I:Uwt,j:jwt,L:FV,m:Wwt,M:Vwt,p:P,q:B,Q:Y8,s:H8,S:Gwt,u:Ywt,U:Hwt,V:Xwt,w:Kwt,W:Qwt,x:null,X:null,y:Jwt,Y:txt,Z:nxt,"%":G8},v={a:G,A:ct,b:Z,B:lt,c:null,d:V8,e:V8,f:oxt,g:mxt,G:bxt,H:rxt,I:ixt,j:sxt,L:OV,m:axt,M:uxt,p:et,q:ut,Q:Y8,s:H8,S:cxt,u:lxt,U:fxt,V:dxt,w:hxt,W:pxt,x:null,X:null,y:gxt,Y:yxt,Z:vxt,"%":G8},x={a:$,A:T,b:C,B:F,c:M,d:j8,e:j8,f:Dwt,g:U8,G:z8,H:q8,I:q8,j:Fwt,L:Rwt,m:Iwt,M:Nwt,p:A,q:Cwt,Q:Bwt,s:Pwt,S:Owt,u:Awt,U:$wt,V:Twt,w:Ewt,W:kwt,x:k,X:I,y:U8,Y:z8,Z:Mwt,"%":Lwt};w.x=S(n,w),w.X=S(r,w),w.c=S(e,w),v.x=S(n,v),v.X=S(r,v),v.c=S(e,v);function S(V,rt){return function(dt){var q=[],Ot=-1,yt=0,Wt=V.length,qt,ht,ie;for(dt instanceof Date||(dt=new Date(+dt));++Ot<Wt;)V.charCodeAt(Ot)===37&&(q.push(V.slice(yt,Ot)),(ht=P8[qt=V.charAt(++Ot)])!=null?qt=V.charAt(++Ot):ht=qt==="e"?" ":"0",(ie=rt[qt])&&(qt=ie(dt,ht)),q.push(qt),yt=Ot+1);return q.push(V.slice(yt,Ot)),q.join("")}}function _(V,rt){return function(dt){var q=Bg(1900,void 0,1),Ot=E(q,V,dt+="",0),yt,Wt;if(Ot!=dt.length)return null;if("Q"in q)return new Date(q.Q);if("s"in q)return new Date(q.s*1e3+("L"in q?q.L:0));if(rt&&!("Z"in q)&&(q.Z=0),"p"in q&&(q.H=q.H%12+q.p*12),q.m===void 0&&(q.m="q"in q?q.q:0),"V"in q){if(q.V<1||q.V>53)return null;"w"in q||(q.w=1),"Z"in q?(yt=wA(Bg(q.y,0,1)),Wt=yt.getUTCDay(),yt=Wt>4||Wt===0?F0.ceil(yt):F0(yt),yt=Sc.offset(yt,(q.V-1)*7),q.y=yt.getUTCFullYear(),q.m=yt.getUTCMonth(),q.d=yt.getUTCDate()+(q.w+6)%7):(yt=vA(Bg(q.y,0,1)),Wt=yt.getDay(),yt=Wt>4||Wt===0?I0.ceil(yt):I0(yt),yt=js.offset(yt,(q.V-1)*7),q.y=yt.getFullYear(),q.m=yt.getMonth(),q.d=yt.getDate()+(q.w+6)%7)}else("W"in q||"U"in q)&&("w"in q||(q.w="u"in q?q.u%7:"W"in q?1:0),Wt="Z"in q?wA(Bg(q.y,0,1)).getUTCDay():vA(Bg(q.y,0,1)).getDay(),q.m=0,q.d="W"in q?(q.w+6)%7+q.W*7-(Wt+5)%7:q.w+q.U*7-(Wt+6)%7);return"Z"in q?(q.H+=q.Z/100|0,q.M+=q.Z%100,wA(q)):vA(q)}}function E(V,rt,dt,q){for(var Ot=0,yt=rt.length,Wt=dt.length,qt,ht;Ot<yt;){if(q>=Wt)return-1;if(qt=rt.charCodeAt(Ot++),qt===37){if(qt=rt.charAt(Ot++),ht=x[qt in P8?rt.charAt(Ot++):qt],!ht||(q=ht(V,dt,q))<0)return-1}else if(qt!=dt.charCodeAt(q++))return-1}return q}function A(V,rt,dt){var q=c.exec(rt.slice(dt));return q?(V.p=l.get(q[0].toLowerCase()),dt+q[0].length):-1}function $(V,rt,dt){var q=h.exec(rt.slice(dt));return q?(V.w=p.get(q[0].toLowerCase()),dt+q[0].length):-1}function T(V,rt,dt){var q=f.exec(rt.slice(dt));return q?(V.w=d.get(q[0].toLowerCase()),dt+q[0].length):-1}function C(V,rt,dt){var q=y.exec(rt.slice(dt));return q?(V.m=b.get(q[0].toLowerCase()),dt+q[0].length):-1}function F(V,rt,dt){var q=g.exec(rt.slice(dt));return q?(V.m=m.get(q[0].toLowerCase()),dt+q[0].length):-1}function M(V,rt,dt){return E(V,e,rt,dt)}function k(V,rt,dt){return E(V,n,rt,dt)}function I(V,rt,dt){return E(V,r,rt,dt)}function N(V){return o[V.getDay()]}function R(V){return s[V.getDay()]}function D(V){return u[V.getMonth()]}function L(V){return a[V.getMonth()]}function P(V){return i[+(V.getHours()>=12)]}function B(V){return 1+~~(V.getMonth()/3)}function G(V){return o[V.getUTCDay()]}function ct(V){return s[V.getUTCDay()]}function Z(V){return u[V.getUTCMonth()]}function lt(V){return a[V.getUTCMonth()]}function et(V){return i[+(V.getUTCHours()>=12)]}function ut(V){return 1+~~(V.getUTCMonth()/3)}return{format:function(V){var rt=S(V+="",w);return rt.toString=function(){return V},rt},parse:function(V){var rt=_(V+="",!1);return rt.toString=function(){return V},rt},utcFormat:function(V){var rt=S(V+="",v);return rt.toString=function(){return V},rt},utcParse:function(V){var rt=_(V+="",!0);return rt.toString=function(){return V},rt}}}var P8={"-":"",_:" ",0:"0"},Pn=/^\s*\d+/,xwt=/^%/,_wt=/[\\^$*+?|[\]().{}]/g;function ae(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(e)+i:i)}function Swt(t){return t.replace(_wt,"\\$&")}function Pg(t){return new RegExp("^(?:"+t.map(Swt).join("|")+")","i")}function zg(t){return new Map(t.map((e,n)=>[e.toLowerCase(),n]))}function Ewt(t,e,n){var r=Pn.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function Awt(t,e,n){var r=Pn.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function $wt(t,e,n){var r=Pn.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function Twt(t,e,n){var r=Pn.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function kwt(t,e,n){var r=Pn.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function z8(t,e,n){var r=Pn.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function U8(t,e,n){var r=Pn.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Mwt(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Cwt(t,e,n){var r=Pn.exec(e.slice(n,n+1));return r?(t.q=r[0]*3-3,n+r[0].length):-1}function Iwt(t,e,n){var r=Pn.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function j8(t,e,n){var r=Pn.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function Fwt(t,e,n){var r=Pn.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function q8(t,e,n){var r=Pn.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Nwt(t,e,n){var r=Pn.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function Owt(t,e,n){var r=Pn.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function Rwt(t,e,n){var r=Pn.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function Dwt(t,e,n){var r=Pn.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Lwt(t,e,n){var r=xwt.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function Bwt(t,e,n){var r=Pn.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function Pwt(t,e,n){var r=Pn.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function W8(t,e){return ae(t.getDate(),e,2)}function zwt(t,e){return ae(t.getHours(),e,2)}function Uwt(t,e){return ae(t.getHours()%12||12,e,2)}function jwt(t,e){return ae(1+js.count(hs(t),t),e,3)}function FV(t,e){return ae(t.getMilliseconds(),e,3)}function qwt(t,e){return FV(t,e)+"000"}function Wwt(t,e){return ae(t.getMonth()+1,e,2)}function Vwt(t,e){return ae(t.getMinutes(),e,2)}function Gwt(t,e){return ae(t.getSeconds(),e,2)}function Ywt(t){var e=t.getDay();return e===0?7:e}function Hwt(t,e){return ae(Uc.count(hs(t)-1,t),e,2)}function NV(t){var e=t.getDay();return e>=4||e===0?Rf(t):Rf.ceil(t)}function Xwt(t,e){return t=NV(t),ae(Rf.count(hs(t),t)+(hs(t).getDay()===4),e,2)}function Kwt(t){return t.getDay()}function Qwt(t,e){return ae(I0.count(hs(t)-1,t),e,2)}function Jwt(t,e){return ae(t.getFullYear()%100,e,2)}function Zwt(t,e){return t=NV(t),ae(t.getFullYear()%100,e,2)}function txt(t,e){return ae(t.getFullYear()%1e4,e,4)}function ext(t,e){var n=t.getDay();return t=n>=4||n===0?Rf(t):Rf.ceil(t),ae(t.getFullYear()%1e4,e,4)}function nxt(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+ae(e/60|0,"0",2)+ae(e%60,"0",2)}function V8(t,e){return ae(t.getUTCDate(),e,2)}function rxt(t,e){return ae(t.getUTCHours(),e,2)}function ixt(t,e){return ae(t.getUTCHours()%12||12,e,2)}function sxt(t,e){return ae(1+Sc.count(ps(t),t),e,3)}function OV(t,e){return ae(t.getUTCMilliseconds(),e,3)}function oxt(t,e){return OV(t,e)+"000"}function axt(t,e){return ae(t.getUTCMonth()+1,e,2)}function uxt(t,e){return ae(t.getUTCMinutes(),e,2)}function cxt(t,e){return ae(t.getUTCSeconds(),e,2)}function lxt(t){var e=t.getUTCDay();return e===0?7:e}function fxt(t,e){return ae(jc.count(ps(t)-1,t),e,2)}function RV(t){var e=t.getUTCDay();return e>=4||e===0?Df(t):Df.ceil(t)}function dxt(t,e){return t=RV(t),ae(Df.count(ps(t),t)+(ps(t).getUTCDay()===4),e,2)}function hxt(t){return t.getUTCDay()}function pxt(t,e){return ae(F0.count(ps(t)-1,t),e,2)}function gxt(t,e){return ae(t.getUTCFullYear()%100,e,2)}function mxt(t,e){return t=RV(t),ae(t.getUTCFullYear()%100,e,2)}function yxt(t,e){return ae(t.getUTCFullYear()%1e4,e,4)}function bxt(t,e){var n=t.getUTCDay();return t=n>=4||n===0?Df(t):Df.ceil(t),ae(t.getUTCFullYear()%1e4,e,4)}function vxt(){return"+0000"}function G8(){return"%"}function Y8(t){return+t}function H8(t){return Math.floor(+t/1e3)}var Rd,e_,DV,Zp,LV;wxt({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function wxt(t){return Rd=IV(t),e_=Rd.format,DV=Rd.parse,Zp=Rd.utcFormat,LV=Rd.utcParse,Rd}function xxt(t){return new Date(t)}function _xt(t){return t instanceof Date?+t:+new Date(+t)}function oI(t,e,n,r,i,s,o,a,u,c){var l=yV(),f=l.invert,d=l.domain,h=c(".%L"),p=c(":%S"),g=c("%I:%M"),m=c("%I %p"),y=c("%a %d"),b=c("%b %d"),w=c("%B"),v=c("%Y");function x(S){return(u(S)<S?h:a(S)<S?p:o(S)<S?g:s(S)<S?m:r(S)<S?i(S)<S?y:b:n(S)<S?w:v)(S)}return l.invert=function(S){return new Date(f(S))},l.domain=function(S){return arguments.length?d(Array.from(S,_xt)):d().map(xxt)},l.ticks=function(S){var _=d();return t(_[0],_[_.length-1],S??10)},l.tickFormat=function(S,_){return _==null?x:c(_)},l.nice=function(S){var _=d();return(!S||typeof S.range!="function")&&(S=e(_[0],_[_.length-1],S??10)),S?d(vV(_,S)):l},l.copy=function(){return My(l,oI(t,e,n,r,i,s,o,a,u,c))},l}function BV(){return no.apply(oI(vwt,wwt,hs,Lf,Uc,js,Qp,Xp,$i,e_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function PV(){return no.apply(oI(bwt,CV,ps,Bf,jc,Sc,Jp,Kp,$i,Zp).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function n_(){var t=0,e=1,n,r,i,s,o=ii,a=!1,u;function c(f){return f==null||isNaN(f=+f)?u:o(i===0?.5:(f=(s(f)-n)*i,a?Math.max(0,Math.min(1,f)):f))}c.domain=function(f){return arguments.length?([t,e]=f,n=s(t=+t),r=s(e=+e),i=n===r?0:1/(r-n),c):[t,e]},c.clamp=function(f){return arguments.length?(a=!!f,c):a},c.interpolator=function(f){return arguments.length?(o=f,c):o};function l(f){return function(d){var h,p;return arguments.length?([h,p]=d,o=f(h,p),c):[o(0),o(1)]}}return c.range=l(ku),c.rangeRound=l(Gp),c.unknown=function(f){return arguments.length?(u=f,c):u},function(f){return s=f,n=f(t),r=f(e),i=n===r?0:1/(r-n),c}}function ll(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function aI(){var t=sd(n_()(ii));return t.copy=function(){return ll(t,aI())},cl.apply(t,arguments)}function zV(){var t=JC(n_()).domain([1,10]);return t.copy=function(){return ll(t,zV()).base(t.base())},cl.apply(t,arguments)}function UV(){var t=tI(n_());return t.copy=function(){return ll(t,UV()).constant(t.constant())},cl.apply(t,arguments)}function uI(){var t=nI(n_());return t.copy=function(){return ll(t,uI()).exponent(t.exponent())},cl.apply(t,arguments)}function Sxt(){return uI.apply(null,arguments).exponent(.5)}function r_(){var t=0,e=.5,n=1,r=1,i,s,o,a,u,c=ii,l,f=!1,d;function h(g){return isNaN(g=+g)?d:(g=.5+((g=+l(g))-s)*(r*g<r*s?a:u),c(f?Math.max(0,Math.min(1,g)):g))}h.domain=function(g){return arguments.length?([t,e,n]=g,i=l(t=+t),s=l(e=+e),o=l(n=+n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,h):[t,e,n]},h.clamp=function(g){return arguments.length?(f=!!g,h):f},h.interpolator=function(g){return arguments.length?(c=g,h):c};function p(g){return function(m){var y,b,w;return arguments.length?([y,b,w]=m,c=Yp(g,[y,b,w]),h):[c(0),c(.5),c(1)]}}return h.range=p(ku),h.rangeRound=p(Gp),h.unknown=function(g){return arguments.length?(d=g,h):d},function(g){return l=g,i=g(t),s=g(e),o=g(n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,h}}function cI(){var t=sd(r_()(ii));return t.copy=function(){return ll(t,cI())},cl.apply(t,arguments)}function lI(){var t=JC(r_()).domain([.1,1,10]);return t.copy=function(){return ll(t,lI()).base(t.base())},cl.apply(t,arguments)}function fI(){var t=tI(r_());return t.copy=function(){return ll(t,fI()).constant(t.constant())},cl.apply(t,arguments)}function i_(){var t=nI(r_());return t.copy=function(){return ll(t,i_()).exponent(t.exponent())},cl.apply(t,arguments)}function Ext(){return i_.apply(null,arguments).exponent(.5)}function zt(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(r*6,++r*6);return n}const jV=zt("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),qV=zt("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),WV=zt("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),VV=zt("4269d0efb118ff725c6cc5b03ca951ff8ab7a463f297bbf59c6b4e9498a0"),GV=zt("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),YV=zt("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),HV=zt("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),XV=zt("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),KV=zt("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),QV=zt("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),Axt=zt("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),ke=t=>Nq(t[t.length-1]);var JV=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(zt);const ZV=ke(JV);var tG=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(zt);const eG=ke(tG);var nG=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(zt);const rG=ke(nG);var iG=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(zt);const sG=ke(iG);var wT=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(zt);const sx=ke(wT);var oG=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(zt);const aG=ke(oG);var xT=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(zt);const ox=ke(xT);var uG=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(zt);const cG=ke(uG);var lG=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(zt);const fG=ke(lG);var dG=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(zt);const hG=ke(dG);var pG=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(zt);const gG=ke(pG);var mG=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(zt);const yG=ke(mG);var bG=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(zt);const vG=ke(bG);var wG=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(zt);const xG=ke(wG);var _G=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(zt);const SG=ke(_G);var EG=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(zt);const AG=ke(EG);var $G=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(zt);const TG=ke($G);var kG=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(zt);const MG=ke(kG);var CG=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(zt);const IG=ke(CG);var FG=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(zt);const NG=ke(FG);var OG=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(zt);const RG=ke(OG);var DG=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(zt);const LG=ke(DG);var BG=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(zt);const PG=ke(BG);var zG=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(zt);const UG=ke(zG);var jG=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(zt);const qG=ke(jG);var WG=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(zt);const VG=ke(WG);var GG=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(zt);const YG=ke(GG);function HG(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-t*(35.34-t*(2381.73-t*(6402.7-t*(7024.72-t*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+t*(170.73+t*(52.82-t*(131.46-t*(176.58-t*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+t*(442.36-t*(2482.43-t*(6167.24-t*(6614.94-t*2475.67)))))))+")"}const XG=U2(Ko(300,.5,0),Ko(-240,.5,1));var KG=U2(Ko(-100,.75,.35),Ko(80,1.5,.8)),QG=U2(Ko(260,.75,.35),Ko(80,1.5,.8)),Z1=Ko();function JG(t){(t<0||t>1)&&(t-=Math.floor(t));var e=Math.abs(t-.5);return Z1.h=360*t-100,Z1.s=1.5-1.5*e,Z1.l=.8-.9*e,Z1+""}var tb=li(),$xt=Math.PI/3,Txt=Math.PI*2/3;function ZG(t){var e;return t=(.5-t)*Math.PI,tb.r=255*(e=Math.sin(t))*e,tb.g=255*(e=Math.sin(t+$xt))*e,tb.b=255*(e=Math.sin(t+Txt))*e,tb+""}function tY(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+t*(1172.33-t*(10793.56-t*(33300.12-t*(38394.49-t*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+t*(557.33+t*(1225.33-t*(3574.96-t*(1073.77+t*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+t*(3211.1-t*(15327.97-t*(27814-t*(22569.18-t*6838.66)))))))+")"}function s_(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}const eY=s_(zt("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var nY=s_(zt("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),rY=s_(zt("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),iY=s_(zt("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function fe(t){return function(){return t}}const X8=Math.abs,ar=Math.atan2,Ua=Math.cos,kxt=Math.max,Fh=Math.min,Qr=Math.sin,De=Math.sqrt,ur=1e-12,qc=Math.PI,ax=qc/2,Cy=2*qc;function Mxt(t){return t>1?0:t<-1?qc:Math.acos(t)}function K8(t){return t>=1?ax:t<=-1?-ax:Math.asin(t)}function o_(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);e=r}return t},()=>new V2(e)}function Cxt(t){return t.innerRadius}function Ixt(t){return t.outerRadius}function Fxt(t){return t.startAngle}function Nxt(t){return t.endAngle}function Oxt(t){return t&&t.padAngle}function Rxt(t,e,n,r,i,s,o,a){var u=n-t,c=r-e,l=o-i,f=a-s,d=f*u-l*c;if(!(d*d<ur))return d=(l*(e-s)-f*(t-i))/d,[t+d*u,e+d*c]}function eb(t,e,n,r,i,s,o){var a=t-n,u=e-r,c=(o?s:-s)/De(a*a+u*u),l=c*u,f=-c*a,d=t+l,h=e+f,p=n+l,g=r+f,m=(d+p)/2,y=(h+g)/2,b=p-d,w=g-h,v=b*b+w*w,x=i-s,S=d*g-p*h,_=(w<0?-1:1)*De(kxt(0,x*x*v-S*S)),E=(S*w-b*_)/v,A=(-S*b-w*_)/v,$=(S*w+b*_)/v,T=(-S*b+w*_)/v,C=E-m,F=A-y,M=$-m,k=T-y;return C*C+F*F>M*M+k*k&&(E=$,A=T),{cx:E,cy:A,x01:-l,y01:-f,x11:E*(i/x-1),y11:A*(i/x-1)}}function Dxt(){var t=Cxt,e=Ixt,n=fe(0),r=null,i=Fxt,s=Nxt,o=Oxt,a=null,u=o_(c);function c(){var l,f,d=+t.apply(this,arguments),h=+e.apply(this,arguments),p=i.apply(this,arguments)-ax,g=s.apply(this,arguments)-ax,m=X8(g-p),y=g>p;if(a||(a=l=u()),h<d&&(f=h,h=d,d=f),!(h>ur))a.moveTo(0,0);else if(m>Cy-ur)a.moveTo(h*Ua(p),h*Qr(p)),a.arc(0,0,h,p,g,!y),d>ur&&(a.moveTo(d*Ua(g),d*Qr(g)),a.arc(0,0,d,g,p,y));else{var b=p,w=g,v=p,x=g,S=m,_=m,E=o.apply(this,arguments)/2,A=E>ur&&(r?+r.apply(this,arguments):De(d*d+h*h)),$=Fh(X8(h-d)/2,+n.apply(this,arguments)),T=$,C=$,F,M;if(A>ur){var k=K8(A/d*Qr(E)),I=K8(A/h*Qr(E));(S-=k*2)>ur?(k*=y?1:-1,v+=k,x-=k):(S=0,v=x=(p+g)/2),(_-=I*2)>ur?(I*=y?1:-1,b+=I,w-=I):(_=0,b=w=(p+g)/2)}var N=h*Ua(b),R=h*Qr(b),D=d*Ua(x),L=d*Qr(x);if($>ur){var P=h*Ua(w),B=h*Qr(w),G=d*Ua(v),ct=d*Qr(v),Z;if(m<qc)if(Z=Rxt(N,R,G,ct,P,B,D,L)){var lt=N-Z[0],et=R-Z[1],ut=P-Z[0],V=B-Z[1],rt=1/Qr(Mxt((lt*ut+et*V)/(De(lt*lt+et*et)*De(ut*ut+V*V)))/2),dt=De(Z[0]*Z[0]+Z[1]*Z[1]);T=Fh($,(d-dt)/(rt-1)),C=Fh($,(h-dt)/(rt+1))}else T=C=0}_>ur?C>ur?(F=eb(G,ct,N,R,h,C,y),M=eb(P,B,D,L,h,C,y),a.moveTo(F.cx+F.x01,F.cy+F.y01),C<$?a.arc(F.cx,F.cy,C,ar(F.y01,F.x01),ar(M.y01,M.x01),!y):(a.arc(F.cx,F.cy,C,ar(F.y01,F.x01),ar(F.y11,F.x11),!y),a.arc(0,0,h,ar(F.cy+F.y11,F.cx+F.x11),ar(M.cy+M.y11,M.cx+M.x11),!y),a.arc(M.cx,M.cy,C,ar(M.y11,M.x11),ar(M.y01,M.x01),!y))):(a.moveTo(N,R),a.arc(0,0,h,b,w,!y)):a.moveTo(N,R),!(d>ur)||!(S>ur)?a.lineTo(D,L):T>ur?(F=eb(D,L,P,B,d,-T,y),M=eb(N,R,G,ct,d,-T,y),a.lineTo(F.cx+F.x01,F.cy+F.y01),T<$?a.arc(F.cx,F.cy,T,ar(F.y01,F.x01),ar(M.y01,M.x01),!y):(a.arc(F.cx,F.cy,T,ar(F.y01,F.x01),ar(F.y11,F.x11),!y),a.arc(0,0,d,ar(F.cy+F.y11,F.cx+F.x11),ar(M.cy+M.y11,M.cx+M.x11),y),a.arc(M.cx,M.cy,T,ar(M.y11,M.x11),ar(M.y01,M.x01),!y))):a.arc(0,0,d,x,v,y)}if(a.closePath(),l)return a=null,l+""||null}return c.centroid=function(){var l=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,f=(+i.apply(this,arguments)+ +s.apply(this,arguments))/2-qc/2;return[Ua(f)*l,Qr(f)*l]},c.innerRadius=function(l){return arguments.length?(t=typeof l=="function"?l:fe(+l),c):t},c.outerRadius=function(l){return arguments.length?(e=typeof l=="function"?l:fe(+l),c):e},c.cornerRadius=function(l){return arguments.length?(n=typeof l=="function"?l:fe(+l),c):n},c.padRadius=function(l){return arguments.length?(r=l==null?null:typeof l=="function"?l:fe(+l),c):r},c.startAngle=function(l){return arguments.length?(i=typeof l=="function"?l:fe(+l),c):i},c.endAngle=function(l){return arguments.length?(s=typeof l=="function"?l:fe(+l),c):s},c.padAngle=function(l){return arguments.length?(o=typeof l=="function"?l:fe(+l),c):o},c.context=function(l){return arguments.length?(a=l??null,c):a},c}function sY(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function oY(t){this._context=t}oY.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function tg(t){return new oY(t)}function aY(t){return t[0]}function uY(t){return t[1]}function dI(t,e){var n=fe(!0),r=null,i=tg,s=null,o=o_(a);t=typeof t=="function"?t:t===void 0?aY:fe(t),e=typeof e=="function"?e:e===void 0?uY:fe(e);function a(u){var c,l=(u=sY(u)).length,f,d=!1,h;for(r==null&&(s=i(h=o())),c=0;c<=l;++c)!(c<l&&n(f=u[c],c,u))===d&&((d=!d)?s.lineStart():s.lineEnd()),d&&s.point(+t(f,c,u),+e(f,c,u));if(h)return s=null,h+""||null}return a.x=function(u){return arguments.length?(t=typeof u=="function"?u:fe(+u),a):t},a.y=function(u){return arguments.length?(e=typeof u=="function"?u:fe(+u),a):e},a.defined=function(u){return arguments.length?(n=typeof u=="function"?u:fe(!!u),a):n},a.curve=function(u){return arguments.length?(i=u,r!=null&&(s=i(r)),a):i},a.context=function(u){return arguments.length?(u==null?r=s=null:s=i(r=u),a):r},a}function Iy(t,e,n){var r=null,i=fe(!0),s=null,o=tg,a=null,u=o_(c);t=typeof t=="function"?t:t===void 0?aY:fe(+t),e=typeof e=="function"?e:fe(e===void 0?0:+e),n=typeof n=="function"?n:n===void 0?uY:fe(+n);function c(f){var d,h,p,g=(f=sY(f)).length,m,y=!1,b,w=new Array(g),v=new Array(g);for(s==null&&(a=o(b=u())),d=0;d<=g;++d){if(!(d<g&&i(m=f[d],d,f))===y)if(y=!y)h=d,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),p=d-1;p>=h;--p)a.point(w[p],v[p]);a.lineEnd(),a.areaEnd()}y&&(w[d]=+t(m,d,f),v[d]=+e(m,d,f),a.point(r?+r(m,d,f):w[d],n?+n(m,d,f):v[d]))}if(b)return a=null,b+""||null}function l(){return dI().defined(i).curve(o).context(s)}return c.x=function(f){return arguments.length?(t=typeof f=="function"?f:fe(+f),r=null,c):t},c.x0=function(f){return arguments.length?(t=typeof f=="function"?f:fe(+f),c):t},c.x1=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:fe(+f),c):r},c.y=function(f){return arguments.length?(e=typeof f=="function"?f:fe(+f),n=null,c):e},c.y0=function(f){return arguments.length?(e=typeof f=="function"?f:fe(+f),c):e},c.y1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:fe(+f),c):n},c.lineX0=c.lineY0=function(){return l().x(t).y(e)},c.lineY1=function(){return l().x(t).y(n)},c.lineX1=function(){return l().x(r).y(e)},c.defined=function(f){return arguments.length?(i=typeof f=="function"?f:fe(!!f),c):i},c.curve=function(f){return arguments.length?(o=f,s!=null&&(a=o(s)),c):o},c.context=function(f){return arguments.length?(f==null?s=a=null:a=o(s=f),c):s},c}class cY{constructor(e,n){this._context=e,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,n){switch(e=+e,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,n,e,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,e,this._y0,e,n);break}}this._x0=e,this._y0=n}}function Lxt(t){return new cY(t,!0)}function Bxt(t){return new cY(t,!1)}const Pxt=De(3),lY={draw(t,e){const n=De(e+Fh(e/28,.75))*.59436,r=n/2,i=r*Pxt;t.moveTo(0,n),t.lineTo(0,-n),t.moveTo(-i,-r),t.lineTo(i,r),t.moveTo(-i,r),t.lineTo(i,-r)}},np={draw(t,e){const n=De(e/qc);t.moveTo(n,0),t.arc(0,0,n,0,Cy)}},fY={draw(t,e){const n=De(e/5)/2;t.moveTo(-3*n,-n),t.lineTo(-n,-n),t.lineTo(-n,-3*n),t.lineTo(n,-3*n),t.lineTo(n,-n),t.lineTo(3*n,-n),t.lineTo(3*n,n),t.lineTo(n,n),t.lineTo(n,3*n),t.lineTo(-n,3*n),t.lineTo(-n,n),t.lineTo(-3*n,n),t.closePath()}},dY=De(1/3),zxt=dY*2,hY={draw(t,e){const n=De(e/zxt),r=n*dY;t.moveTo(0,-n),t.lineTo(r,0),t.lineTo(0,n),t.lineTo(-r,0),t.closePath()}},pY={draw(t,e){const n=De(e)*.62625;t.moveTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.lineTo(-n,0),t.closePath()}},gY={draw(t,e){const n=De(e-Fh(e/7,2))*.87559;t.moveTo(-n,0),t.lineTo(n,0),t.moveTo(0,n),t.lineTo(0,-n)}},mY={draw(t,e){const n=De(e),r=-n/2;t.rect(r,r,n,n)}},yY={draw(t,e){const n=De(e)*.4431;t.moveTo(n,n),t.lineTo(n,-n),t.lineTo(-n,-n),t.lineTo(-n,n),t.closePath()}},Uxt=.8908130915292852,bY=Qr(qc/10)/Qr(7*qc/10),jxt=Qr(Cy/10)*bY,qxt=-Ua(Cy/10)*bY,vY={draw(t,e){const n=De(e*Uxt),r=jxt*n,i=qxt*n;t.moveTo(0,-n),t.lineTo(r,i);for(let s=1;s<5;++s){const o=Cy*s/5,a=Ua(o),u=Qr(o);t.lineTo(u*n,-a*n),t.lineTo(a*r-u*i,u*r+a*i)}t.closePath()}},xA=De(3),wY={draw(t,e){const n=-De(e/(xA*3));t.moveTo(0,n*2),t.lineTo(-xA*n,-n),t.lineTo(xA*n,-n),t.closePath()}},Wxt=De(3),xY={draw(t,e){const n=De(e)*.6824,r=n/2,i=n*Wxt/2;t.moveTo(0,-n),t.lineTo(i,r),t.lineTo(-i,r),t.closePath()}},Ui=-.5,ji=De(3)/2,_T=1/De(12),Vxt=(_T/2+1)*3,_Y={draw(t,e){const n=De(e/Vxt),r=n/2,i=n*_T,s=r,o=n*_T+n,a=-s,u=o;t.moveTo(r,i),t.lineTo(s,o),t.lineTo(a,u),t.lineTo(Ui*r-ji*i,ji*r+Ui*i),t.lineTo(Ui*s-ji*o,ji*s+Ui*o),t.lineTo(Ui*a-ji*u,ji*a+Ui*u),t.lineTo(Ui*r+ji*i,Ui*i-ji*r),t.lineTo(Ui*s+ji*o,Ui*o-ji*s),t.lineTo(Ui*a+ji*u,Ui*u-ji*a),t.closePath()}},SY={draw(t,e){const n=De(e-Fh(e/6,1.7))*.6189;t.moveTo(-n,-n),t.lineTo(n,n),t.moveTo(-n,n),t.lineTo(n,-n)}},Gxt=[np,fY,hY,mY,vY,wY,_Y],Yxt=[np,gY,SY,xY,lY,yY,pY];function Hxt(t,e){let n=null,r=o_(i);t=typeof t=="function"?t:fe(t||np),e=typeof e=="function"?e:fe(e===void 0?64:+e);function i(){let s;if(n||(n=s=r()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),s)return n=null,s+""||null}return i.type=function(s){return arguments.length?(t=typeof s=="function"?s:fe(s),i):t},i.size=function(s){return arguments.length?(e=typeof s=="function"?s:fe(+s),i):e},i.context=function(s){return arguments.length?(n=s??null,i):n},i}function Wc(){}function ux(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function a_(t){this._context=t}a_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:ux(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:ux(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function EY(t){return new a_(t)}function AY(t){this._context=t}AY.prototype={areaStart:Wc,areaEnd:Wc,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:ux(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function $Y(t){return new AY(t)}function TY(t){this._context=t}TY.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:ux(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function kY(t){return new TY(t)}function MY(t,e){this._basis=new a_(t),this._beta=e}MY.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var r=t[0],i=e[0],s=t[n]-r,o=e[n]-i,a=-1,u;++a<=n;)u=a/n,this._basis.point(this._beta*t[a]+(1-this._beta)*(r+u*s),this._beta*e[a]+(1-this._beta)*(i+u*o));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};const CY=function t(e){function n(r){return e===1?new a_(r):new MY(r,e)}return n.beta=function(r){return t(+r)},n}(.85);function cx(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function hI(t,e){this._context=t,this._k=(1-e)/6}hI.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:cx(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:cx(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const IY=function t(e){function n(r){return new hI(r,e)}return n.tension=function(r){return t(+r)},n}(0);function pI(t,e){this._context=t,this._k=(1-e)/6}pI.prototype={areaStart:Wc,areaEnd:Wc,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:cx(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const FY=function t(e){function n(r){return new pI(r,e)}return n.tension=function(r){return t(+r)},n}(0);function gI(t,e){this._context=t,this._k=(1-e)/6}gI.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:cx(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const NY=function t(e){function n(r){return new gI(r,e)}return n.tension=function(r){return t(+r)},n}(0);function mI(t,e,n){var r=t._x1,i=t._y1,s=t._x2,o=t._y2;if(t._l01_a>ur){var a=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,u=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*a-t._x0*t._l12_2a+t._x2*t._l01_2a)/u,i=(i*a-t._y0*t._l12_2a+t._y2*t._l01_2a)/u}if(t._l23_a>ur){var c=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,l=3*t._l23_a*(t._l23_a+t._l12_a);s=(s*c+t._x1*t._l23_2a-e*t._l12_2a)/l,o=(o*c+t._y1*t._l23_2a-n*t._l12_2a)/l}t._context.bezierCurveTo(r,i,s,o,t._x2,t._y2)}function OY(t,e){this._context=t,this._alpha=e}OY.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:mI(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const RY=function t(e){function n(r){return e?new OY(r,e):new hI(r,0)}return n.alpha=function(r){return t(+r)},n}(.5);function DY(t,e){this._context=t,this._alpha=e}DY.prototype={areaStart:Wc,areaEnd:Wc,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:mI(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const LY=function t(e){function n(r){return e?new DY(r,e):new pI(r,0)}return n.alpha=function(r){return t(+r)},n}(.5);function BY(t,e){this._context=t,this._alpha=e}BY.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:mI(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const PY=function t(e){function n(r){return e?new BY(r,e):new gI(r,0)}return n.alpha=function(r){return t(+r)},n}(.5);function zY(t){this._context=t}zY.prototype={areaStart:Wc,areaEnd:Wc,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function UY(t){return new zY(t)}function Q8(t){return t<0?-1:1}function J8(t,e,n){var r=t._x1-t._x0,i=e-t._x1,s=(t._y1-t._y0)/(r||i<0&&-0),o=(n-t._y1)/(i||r<0&&-0),a=(s*i+o*r)/(r+i);return(Q8(s)+Q8(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function Z8(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function _A(t,e,n){var r=t._x0,i=t._y0,s=t._x1,o=t._y1,a=(s-r)/3;t._context.bezierCurveTo(r+a,i+a*e,s-a,o-a*n,s,o)}function lx(t){this._context=t}lx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:_A(this,this._t0,Z8(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,_A(this,Z8(this,n=J8(this,t,e)),n);break;default:_A(this,this._t0,n=J8(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}};function jY(t){this._context=new qY(t)}(jY.prototype=Object.create(lx.prototype)).point=function(t,e){lx.prototype.point.call(this,e,t)};function qY(t){this._context=t}qY.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,i,s){this._context.bezierCurveTo(e,t,r,n,s,i)}};function WY(t){return new lx(t)}function VY(t){return new jY(t)}function GY(t){this._context=t}GY.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),n===2)this._context.lineTo(t[1],e[1]);else for(var r=t4(t),i=t4(e),s=0,o=1;o<n;++s,++o)this._context.bezierCurveTo(r[0][s],i[0][s],r[1][s],i[1][s],t[o],e[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function t4(t){var e,n=t.length-1,r,i=new Array(n),s=new Array(n),o=new Array(n);for(i[0]=0,s[0]=2,o[0]=t[0]+2*t[1],e=1;e<n-1;++e)i[e]=1,s[e]=4,o[e]=4*t[e]+2*t[e+1];for(i[n-1]=2,s[n-1]=7,o[n-1]=8*t[n-1]+t[n],e=1;e<n;++e)r=i[e]/s[e-1],s[e]-=r,o[e]-=r*o[e-1];for(i[n-1]=o[n-1]/s[n-1],e=n-2;e>=0;--e)i[e]=(o[e]-i[e+1])/s[e];for(s[n-1]=(t[n]+i[n-1])/2,e=0;e<n-1;++e)s[e]=2*t[e+1]-i[e+1];return[i,s]}function YY(t){return new GY(t)}function u_(t,e){this._context=t,this._t=e}u_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}break}}this._x=t,this._y=e}};function HY(t){return new u_(t,.5)}function XY(t){return new u_(t,0)}function KY(t){return new u_(t,1)}function Tm(t,e,n){this.k=t,this.x=e,this.y=n}Tm.prototype={constructor:Tm,scale:function(t){return t===1?this:new Tm(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Tm(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Tm.prototype;function Qn(t){return t!=null&&!Number.isNaN(t)}function gs(t,e){return+Qn(e)-+Qn(t)||Fe(t,e)}function fx(t,e){return+Qn(e)-+Qn(t)||Tf(t,e)}function yI(t){return t!=null&&`${t}`!=""}function dx(t){return isFinite(t)?t:NaN}function iu(t){return t>0&&isFinite(t)?t:NaN}function c_(t){return t<0&&isFinite(t)?t:NaN}function QY(t,e){if(t instanceof Date||(t=new Date(+t)),isNaN(t))return e;const n=t.getUTCHours(),r=t.getUTCMinutes(),i=t.getUTCSeconds(),s=t.getUTCMilliseconds();return`${Xxt(t.getUTCFullYear())}-${Va(t.getUTCMonth()+1,2)}-${Va(t.getUTCDate(),2)}${n||r||i||s?`T${Va(n,2)}:${Va(r,2)}${i||s?`:${Va(i,2)}${s?`.${Va(s,3)}`:""}`:""}Z`:""}`}function Xxt(t){return t<0?`-${Va(-t,6)}`:t>9999?`+${Va(t,6)}`:Va(t,4)}function Va(t,e){return`${t}`.padStart(e,"0")}const Kxt=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function JY(t,e){return Kxt.test(t+="")?new Date(t):e}function rp(t){if(t==null)return;const e=t[0],n=t[t.length-1];return Tf(e,n)}const hh=1e3,fc=hh*60,dc=fc*60,Jo=dc*24,xo=Jo*7,df=Jo*30,Yu=Jo*365,SA=[["millisecond",1],["2 milliseconds",2],["5 milliseconds",5],["10 milliseconds",10],["20 milliseconds",20],["50 milliseconds",50],["100 milliseconds",100],["200 milliseconds",200],["500 milliseconds",500],["second",hh],["5 seconds",5*hh],["15 seconds",15*hh],["30 seconds",30*hh],["minute",fc],["5 minutes",5*fc],["15 minutes",15*fc],["30 minutes",30*fc],["hour",dc],["3 hours",3*dc],["6 hours",6*dc],["12 hours",12*dc],["day",Jo],["2 days",2*Jo],["week",xo],["2 weeks",2*xo],["month",df],["3 months",3*df],["6 months",6*df],["year",Yu],["2 years",2*Yu],["5 years",5*Yu],["10 years",10*Yu],["20 years",20*Yu],["50 years",50*Yu],["100 years",100*Yu]],bI=new Map([["second",hh],["minute",fc],["hour",dc],["day",Jo],["monday",xo],["tuesday",xo],["wednesday",xo],["thursday",xo],["friday",xo],["saturday",xo],["sunday",xo],["week",xo],["month",df],["year",Yu]]),ZY=new Map([["second",$i],["minute",Xp],["hour",Qp],["day",js],["monday",I0],["tuesday",xV],["wednesday",_V],["thursday",Rf],["friday",SV],["saturday",EV],["sunday",Uc],["week",Uc],["month",Lf],["year",hs]]),vI=new Map([["second",$i],["minute",Kp],["hour",Jp],["day",t_],["monday",F0],["tuesday",AV],["wednesday",$V],["thursday",Df],["friday",TV],["saturday",kV],["sunday",jc],["week",jc],["month",Bf],["year",ps]]),Fy=Symbol("intervalDuration"),l_=Symbol("intervalType");for(const[t,e]of ZY)e[Fy]=bI.get(t),e[l_]="time";for(const[t,e]of vI)e[Fy]=bI.get(t),e[l_]="utc";const km=[["year",ps,"utc"],["month",Bf,"utc"],["day",t_,"utc",6*df],["hour",Jp,"utc",3*Jo],["minute",Kp,"utc",6*dc],["second",$i,"utc",30*fc]],dv=[["year",hs,"time"],["month",Lf,"time"],["day",js,"time",6*df],["hour",Qp,"time",3*Jo],["minute",Xp,"time",6*dc],["second",$i,"time",30*fc]],Qxt=[km[0],dv[0],km[1],dv[1],km[2],dv[2],...km.slice(3)];function wI(t){let e=`${t}`.toLowerCase();e.endsWith("s")&&(e=e.slice(0,-1));let n=1;const r=/^(?:(\d+)\s+)/.exec(e);switch(r&&(e=e.slice(r[0].length),n=+r[1]),e){case"quarter":e="month",n*=3;break;case"half":e="month",n*=6;break}let i=vI.get(e);if(!i)throw new Error(`unknown interval: ${t}`);if(n>1&&!i.every)throw new Error(`non-periodic interval: ${e}`);return[e,n]}function xI(t){return tH(wI(t),"time")}function f_(t){return tH(wI(t),"utc")}function tH([t,e],n){let r=(n==="time"?ZY:vI).get(t);return e>1&&(r=r.every(e),r[Fy]=bI.get(t)*e,r[l_]=n),r}function e4(t,e){if(!(e>1))return;const n=t[Fy];if(!SA.some(([,i])=>i===n)||n%Jo===0&&Jo<n&&n<df)return;const[r]=SA[rd(([,i])=>Math.log(i)).center(SA,Math.log(n*e))];return(t[l_]==="time"?xI:f_)(r)}function n4(t,e,n){const r=e==="time"?e_:Zp;if(n==null)return r(t==="year"?"%Y":t==="month"?"%Y-%m":t==="day"?"%Y-%m-%d":t==="hour"||t==="minute"?"%Y-%m-%dT%H:%M":t==="second"?"%Y-%m-%dT%H:%M:%S":"%Y-%m-%dT%H:%M:%S.%L");const i=Jxt(n);switch(t){case"millisecond":return Dd(r(".%L"),r(":%M:%S"),i);case"second":return Dd(r(":%S"),r("%-I:%M"),i);case"minute":return Dd(r("%-I:%M"),r("%p"),i);case"hour":return Dd(r("%-I %p"),r("%b %-d"),i);case"day":return Dd(r("%-d"),r("%b"),i);case"month":return Dd(r("%b"),r("%Y"),i);case"year":return r("%Y")}throw new Error("unable to format time ticks")}function Jxt(t){return t==="left"||t==="right"?(e,n)=>`
${e}
${n}`:t==="top"?(e,n)=>`${n}
${e}`:(e,n)=>`${e}
${n}`}function Zxt(t){return t==="time"?dv:t==="utc"?km:Qxt}function t2t(t,e,n){const r=Be(Upt(e,(i,s)=>Math.abs(s-i)));if(r<1e3)return n4("millisecond","utc",n);for(const[i,s,o,a]of Zxt(t)){if(r>a||i==="hour"&&!r)break;if(e.every(u=>s.floor(u)>=u))return n4(i,o,n)}}function Dd(t,e,n){return(r,i,s)=>{const o=t(r,i),a=e(r,i),u=i-rp(s);return i!==u&&s[u]!==void 0&&a===e(s[u],u)?o:n(o,a)}}const d_=Object.getPrototypeOf(Uint8Array),e2t=Object.prototype.toString;function Cu(t){return t instanceof Array||t instanceof d_}function eH(t){return t instanceof d_&&!n2t(t)}function nH(t){return(t==null?void 0:t.prototype)instanceof d_&&!r2t(t)}function n2t(t){return t instanceof BigInt64Array||t instanceof BigUint64Array}function r2t(t){return t===BigInt64Array||t===BigUint64Array}const rH=Symbol("reindex");function Kt(t,e,n){const r=typeof e;return r==="string"?mH(t)?_I(t.getChild(e),n):r4(t,iH(e),n):r==="function"?r4(t,e,n):r==="number"||e instanceof Date||r==="boolean"?Te(t,Hn(e),n):typeof(e==null?void 0:e.transform)=="function"?ST(e.transform(t),n):i2t(ST(e,n),t==null?void 0:t[rH])}function i2t(t,e){return t!=null&&e?p_(t,e):t}function r4(t,e,n){return Te(t,nH(n)?(r,i)=>AI(e(r,i)):e,n)}function ST(t,e){return e===void 0?vu(t):yH(t)?_I(t,e):t instanceof e?t:e.from(t,nH(e)&&!eH(t)?AI:void 0)}function _I(t,e){return t==null?t:(e===void 0||e===Array)&&b2t(t.type)?sH(t.toArray()):ST(t.toArray(),e)}const Jm=[null],iH=t=>e=>{var r;const n=e[t];return n===void 0&&e.type==="Feature"?(r=e.properties)==null?void 0:r[t]:n},Ln={transform:Iu},St={transform:t=>t},SI=()=>1,s2t=()=>!0,dr=t=>t==null?t:`${t}`,Le=t=>t==null?t:+t,h_=t=>t?t[0]:void 0,N0=t=>t?t[1]:void 0,o2t=t=>t?t[2]:void 0,Hn=t=>()=>t;function EI(t){const e=+`${t}`.slice(1)/100;return(n,r)=>Xo(n,e,r)}function si(t){return eH(t)?t:Te(t,AI,Float64Array)}function AI(t){return t==null?NaN:Number(t)}function sH(t){return Te(t,oH)}function oH(t){return t instanceof Date&&!isNaN(t)?t:typeof t=="string"?JY(t):t==null||isNaN(t=Number(t))?void 0:new Date(t)}function qr(t,e){return t===void 0&&(t=e),t===null?[void 0,"none"]:Ny(t)?[void 0,t]:[t,void 0]}function cn(t,e){return t===void 0&&(t=e),t===null||typeof t=="number"?[void 0,t]:[t,void 0]}function aH(t,e,n){if(t!=null)return zi(t,e,n)}function zi(t,e,n){const r=`${t}`.toLowerCase();if(!n.includes(r))throw new Error(`invalid ${e}: ${t}`);return r}function ip(t){return mH(t)?t:vu(t)}function vu(t){if(t==null||Cu(t))return t;if(yH(t))return _I(t);switch(t.type){case"FeatureCollection":return t.features;case"GeometryCollection":return t.geometries;case"Feature":case"LineString":case"MultiLineString":case"MultiPoint":case"MultiPolygon":case"Point":case"Polygon":case"Sphere":return[t]}return Array.from(t)}function Te(t,e,n=Array){return t==null?t:t instanceof n?t.map(e):n.from(t,e)}function O0(t,e=Array){return t instanceof e?t.slice():e.from(t)}function uH({x:t,x1:e,x2:n}){return t!==void 0||e!==void 0||n!==void 0}function cH({y:t,y1:e,y2:n}){return t!==void 0||e!==void 0||n!==void 0}function eg(t){return uH(t)||cH(t)||t.interval!==void 0}function Ss(t){return(t==null?void 0:t.toString)===e2t}function hf(t){return Ss(t)&&(t.type!==void 0||t.domain!==void 0)}function Ao(t){return Ss(t)&&typeof t.transform!="function"}function Vc(t){return Ao(t)&&t.value===void 0&&t.channel===void 0}function lH(t,e,n,r=St){return e===void 0&&n===void 0?(e=0,n=t===void 0?r:t):e===void 0?e=t===void 0?0:t:n===void 0&&(n=t===void 0?0:t),[e,n]}function ro(t,e){return t===void 0&&e===void 0?[h_,N0]:[t,e]}function fl({z:t,fill:e,stroke:n}={}){return t===void 0&&([t]=qr(e)),t===void 0&&([t]=qr(n)),t}function R0(t){return Cu(t)?t.length:t==null?void 0:t.numRows}function Iu(t){const e=R0(t),n=new Uint32Array(e);for(let r=0;r<e;++r)n[r]=r;return n}function p_(t,e){return Cu(t)?Te(e,n=>t[n],t.constructor):Te(e,n=>t.at(n))}function $I(t){return t.length===1?(e,n)=>t(p_(n,e)):t}function pf(t,e,n){return t.subarray?t.subarray(e,n):t.slice(e,n)}function tu(t){return t!==null&&typeof t=="object"?t.valueOf():t}function fH(t,e){if(e[t]!==void 0)return e[t];switch(t){case"x1":case"x2":t="x";break;case"y1":case"y2":t="y";break}return e[t]}function Ti(t){let e;return[{transform:()=>e,label:ha(t)},n=>e=n]}function Zr(t){return t==null?[t]:Ti(t)}function ha(t,e){return typeof t=="string"?t:t&&t.label!==void 0?t.label:e}function hx(t,e){return{transform(n){const r=t.transform(n),i=e.transform(n);return Wr(r)||Wr(i)?Te(r,(s,o)=>new Date((+r[o]+ +i[o])/2)):Te(r,(s,o)=>(+r[o]+ +i[o])/2,Float64Array)},label:t.label}}function px(t,e){const n=dH(e==null?void 0:e.interval,e==null?void 0:e.type);return n?Te(t,n):t}function dH(t,e){const n=g_(t,e);return n&&(r=>Qn(r)?n.floor(r):r)}function g_(t,e){if(t!=null){if(typeof t=="number")return hH(t);if(typeof t=="string")return(e==="time"?xI:f_)(t);if(typeof t.floor!="function")throw new Error("invalid interval; missing floor method");if(typeof t.offset!="function")throw new Error("invalid interval; missing offset method");return t}}function hH(t){t=+t,0<t&&t<1&&Number.isInteger(1/t)&&(t=-1/t);const e=Math.abs(t);return t<0?{floor:n=>Math.floor(n*e)/e,offset:(n,r=1)=>(n*e+Math.floor(r))/e,range:(n,r)=>xn(Math.ceil(n*e),r*e).map(i=>i/e)}:{floor:n=>Math.floor(n/e)*e,offset:(n,r=1)=>n+e*Math.floor(r),range:(n,r)=>xn(Math.ceil(n/e),r/e).map(i=>i*e)}}function ng(t,e){if(t=g_(t,e),t&&typeof t.range!="function")throw new Error("invalid interval: missing range method");return t}function a2t(t,e){if(t=ng(t,e),t&&typeof t.ceil!="function")throw new Error("invalid interval: missing ceil method");return t}function u2t(t){return ph(t)&&typeof(t==null?void 0:t.floor)=="function"&&t.floor()instanceof Date}function ph(t){return typeof(t==null?void 0:t.range)=="function"}function rg(t){return t===void 0||Ao(t)?t:{value:t}}function c2t(t){return t==null?null:{transform:e=>Kt(e,t,Float64Array),label:ha(t)}}function l2t(t){if(!Fu(t))return!1;for(const e of t)if(e!=null)return typeof e=="object"&&"0"in e&&"1"in e}function Fu(t){return t&&typeof t[Symbol.iterator]=="function"}function pH(t){for(const e of t)if(e!=null)return typeof e!="object"||e instanceof Date}function Je(t){for(const e of t){if(e==null)continue;const n=typeof e;return n==="string"||n==="boolean"}}function Wr(t){for(const e of t)if(e!=null)return e instanceof Date}function f2t(t){for(const e of t)if(e!=null)return typeof e=="string"&&isNaN(e)&&JY(e)}function d2t(t){for(const e of t)if(e!=null){if(typeof e!="string")return!1;if(e.trim())return!isNaN(e)}}function gh(t){for(const e of t)if(e!=null)return typeof e=="number"}function EA(t,e){let n;for(const r of t)if(r!=null){if(!e(r))return!1;n=!0}return n}const h2t=new Set("none,currentcolor,transparent,aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow".split(","));function Ny(t){return typeof t!="string"?!1:(t=t.toLowerCase().trim(),/^#[0-9a-f]{3,8}$/.test(t)||/^(?:url|var|rgb|rgba|hsl|hsla|hwb|lab|lch|oklab|oklch|color|color-mix)\(.*\)$/.test(t)||h2t.has(t))}function p2t(t){return typeof t=="number"&&(0<=t&&t<=1||isNaN(t))}function je(t){return t==null||sp(t)}function sp(t){return/^\s*none\s*$/i.test(t)}function g2t(t){return/^\s*round\s*$/i.test(t)}function ET(t,e){return aH(t,e,["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function Oy(t="middle"){return ET(t,"frameAnchor")}function m2t(t={},...e){let n=t;for(const r of e)for(const i in r)if(n[i]===void 0){const s=r[i];n===t?n={...n,[i]:s}:n[i]=s}return n}function y2t(t){console.warn("named iterables are deprecated; please use an object instead");const e=new Set;return Object.fromEntries(Array.from(t,n=>{const{name:r}=n;if(r==null)throw new Error("missing name");const i=`${r}`;if(i==="__proto__")throw new Error(`illegal name: ${i}`);if(e.has(i))throw new Error(`duplicate name: ${i}`);return e.add(i),[r,n]}))}function TI(t){return Fu(t)?y2t(t):t}function gH(t){return t===!0?t="frame":t===!1?t=null:t!=null&&(t=zi(t,"clip",["frame","sphere"])),t}function mH(t){return t&&typeof t.getChild=="function"&&typeof t.toArray=="function"&&t.schema&&Array.isArray(t.schema.fields)}function yH(t){return t&&typeof t.toArray=="function"&&t.type}function b2t(t){return t&&(t.typeId===8||t.typeId===10)&&t.unit===1}const Lo=Symbol("position"),Nu=Symbol("color"),Ry=Symbol("radius"),Dy=Symbol("length"),Ly=Symbol("opacity"),m_=Symbol("symbol"),bH=Symbol("projection"),Xe=new Map([["x",Lo],["y",Lo],["fx",Lo],["fy",Lo],["r",Ry],["color",Nu],["opacity",Ly],["symbol",m_],["length",Dy],["projection",bH]]);function v2t(t){return t===Lo||t===bH}function w2t(t){return t===Lo||t===Ry||t===Dy||t===Ly}const vH=Math.sqrt(3),wH=2/vH,x2t={draw(t,e){const n=Math.sqrt(e/Math.PI),r=n*wH,i=r/2;t.moveTo(0,r),t.lineTo(n,i),t.lineTo(n,-i),t.lineTo(0,-r),t.lineTo(-n,-i),t.lineTo(-n,i),t.closePath()}},kI=new Map([["asterisk",lY],["circle",np],["cross",fY],["diamond",hY],["diamond2",pY],["hexagon",x2t],["plus",gY],["square",mY],["square2",yY],["star",vY],["times",SY],["triangle",wY],["triangle2",xY],["wye",_Y]]);function MI(t){return t&&typeof t.draw=="function"}function _2t(t){return MI(t)?!0:typeof t!="string"?!1:kI.has(t.toLowerCase())}function CI(t){if(t==null||MI(t))return t;const e=kI.get(`${t}`.toLowerCase());if(e)return e;throw new Error(`invalid symbol: ${t}`)}function S2t(t){if(t==null||MI(t))return[void 0,t];if(typeof t=="string"){const e=kI.get(`${t}`.toLowerCase());if(e)return[void 0,e]}return[t,void 0]}function io({filter:t,sort:e,reverse:n,transform:r,initializer:i,...s}={},o){if(r===void 0&&(t!=null&&(r=II(t)),e!=null&&!Vc(e)&&(r=AA(r,NI(e))),n&&(r=AA(r,FI))),o!=null&&i!=null)throw new Error("transforms cannot be applied after initializers");return{...s,...(e===null||Vc(e))&&{sort:e},transform:AA(r,o)}}function Vr({filter:t,sort:e,reverse:n,initializer:r,...i}={},s){return r===void 0&&(t!=null&&(r=II(t)),e!=null&&!Vc(e)&&(r=$A(r,NI(e))),n&&(r=$A(r,FI))),{...i,...(e===null||Vc(e))&&{sort:e},initializer:$A(r,s)}}function AA(t,e){return t==null?e===null?void 0:e:e==null?t===null?void 0:t:function(n,r,i){return{data:n,facets:r}=t.call(this,n,r,i),e.call(this,ip(n),r,i)}}function $A(t,e){return t==null?e===null?void 0:e:e==null?t===null?void 0:t:function(n,r,i,...s){let o,a,u,c,l,f;return{data:a=n,facets:u=r,channels:o}=t.call(this,n,r,i,...s),{data:l=a,facets:f=u,channels:c}=e.call(this,a,u,{...i,...o},...s),{data:l,facets:f,channels:{...o,...c}}}}function y_(t,e){return(t.initializer!=null?Vr:io)(t,e)}function E2t(t,e){return y_(e,II(t))}function II(t){return(e,n)=>{const r=Kt(e,t);return{data:e,facets:n.map(i=>i.filter(s=>r[s]))}}}function A2t({sort:t,...e}={}){return{...y_(e,FI),sort:Vc(t)?t:null}}function FI(t,e){return{data:t,facets:e.map(n=>n.slice().reverse())}}function $2t({seed:t,sort:e,...n}={}){return{...y_(n,_H(t==null?Math.random:KC(t))),sort:Vc(e)?e:null}}function xH(t,{sort:e,...n}={}){return{...(Ao(t)&&t.channel!==void 0?Vr:y_)(n,NI(t)),sort:Vc(e)?e:null}}function NI(t){return(typeof t=="function"&&t.length!==1?T2t:_H)(t)}function T2t(t){return(e,n)=>{const r=Cu(e)?(i,s)=>t(e[i],e[s]):(i,s)=>t(e.get(i),e.get(s));return{data:e,facets:n.map(i=>i.slice().sort(r))}}}function _H(t){let e,n;({channel:e,value:t,order:n}={...rg(t)});const r=e==null?void 0:e.startsWith("-");if(r&&(e=e.slice(1)),n===void 0&&(n=r?fx:gs),typeof n!="function")switch(`${n}`.toLowerCase()){case"ascending":n=gs;break;case"descending":n=fx;break;default:throw new Error(`invalid order: ${n}`)}return(i,s,o)=>{let a;if(e===void 0)a=Kt(i,t);else{if(o===void 0)throw new Error("channel sort requires an initializer");if(a=o[e],!a)return{};a=a.value}const u=(c,l)=>n(a[c],a[l]);return{data:i,facets:s.map(c=>c.slice().sort(u))}}}function OI(t,e){return b_(null,null,t,e)}function D0(t={y:"count"},e={}){const{x:n=St}=e;if(n==null)throw new Error("missing channel: x");return b_(n,null,t,e)}function L0(t={x:"count"},e={}){const{y:n=St}=e;if(n==null)throw new Error("missing channel: y");return b_(null,n,t,e)}function RI(t={fill:"count"},e={}){let{x:n,y:r}=e;if([n,r]=ro(n,r),n==null)throw new Error("missing channel: x");if(r==null)throw new Error("missing channel: y");return b_(n,r,t,e)}function b_(t,e,{data:n=PI,filter:r,sort:i,reverse:s,...o}={},a={}){o=EH(o,a),n=TH(n,St),i=i==null?void 0:AH("sort",i,a),r=r==null?void 0:$H("filter",r,a);const[u,c]=Zr(t),[l,f]=Zr(e),{z:d,fill:h,stroke:p,x1:g,x2:m,y1:y,y2:b,...w}=a,[v,x]=Zr(d),[S]=qr(h),[_]=qr(p),[E,A]=Zr(S),[$,T]=Zr(_);return{..."z"in a&&{z:v||d},..."fill"in a&&{fill:E||h},..."stroke"in a&&{stroke:$||p},...io(w,(C,F,M)=>{const k=px(Kt(C,t),M==null?void 0:M.x),I=px(Kt(C,e),M==null?void 0:M.y),N=Kt(C,d),R=Kt(C,S),D=Kt(C,_),L=BI(o,{z:N,fill:R,stroke:D}),P=[],B=[],G=k&&c([]),ct=I&&f([]),Z=N&&x([]),lt=R&&A([]),et=D&&T([]);let ut=0;for(const V of o)V.initialize(C);i&&i.initialize(C),r&&r.initialize(C);for(const V of F){const rt=[];for(const dt of o)dt.scope("facet",V);i&&i.scope("facet",V),r&&r.scope("facet",V);for(const[dt,q]of gf(V,L))for(const[Ot,yt]of gf(q,I))for(const[Wt,qt]of gf(yt,k)){const ht={data:C};if(k&&(ht.x=Wt),I&&(ht.y=Ot),L&&(ht.z=dt),!(r&&!r.reduce(qt,ht))){rt.push(ut++),B.push(n.reduceIndex(qt,C,ht)),k&&G.push(Wt),I&&ct.push(Ot),N&&Z.push(L===N?dt:N[qt[0]]),R&&lt.push(L===R?dt:R[qt[0]]),D&&et.push(L===D?dt:D[qt[0]]);for(const ie of o)ie.reduce(qt,ht);i&&i.reduce(qt,ht)}}P.push(rt)}return kH(P,i,s),{data:B,facets:P}}),...!hc(o,"x")&&(u?{x:u}:{x1:g,x2:m}),...!hc(o,"y")&&(l?{y:l}:{y1:y,y2:b}),...Object.fromEntries(o.map(({name:C,output:F})=>[C,F]))}}function hc(t,...e){for(const{name:n}of t)if(e.includes(n))return!0;return!1}function SH(t,e,n=DI){const r=Object.entries(t);return e.title!=null&&t.title===void 0&&r.push(["title",N2t]),e.href!=null&&t.href===void 0&&r.push(["href",zI]),r.filter(([,i])=>i!==void 0).map(([i,s])=>s===null?k2t(i):n(i,s,e))}function DI(t,e,n,r=LI){let i;Ss(e)&&"reduce"in e&&(i=e.scale,e=e.reduce);const s=r(t,e,n),[o,a]=Ti(s.label);let u;return{name:t,output:i===void 0?o:{value:o,scale:i},initialize(c){s.initialize(c),u=a([])},scope(c,l){s.scope(c,l)},reduce(c,l){u.push(s.reduce(c,l))}}}function k2t(t){return{name:t,initialize(){},scope(){},reduce(){}}}function LI(t,e,n,r=v_){const i=fH(t,n),s=r(e,i);let o,a;return{label:ha(s===gx?null:i,s.label),initialize(u){o=i===void 0?u:Kt(u,i),s.scope==="data"&&(a=s.reduceIndex(Iu(u),o))},scope(u,c){s.scope===u&&(a=s.reduceIndex(c,o))},reduce(u,c){return s.scope==null?s.reduceIndex(u,o,c):s.reduceIndex(u,o,a,c)}}}function gf(t,e){return e?al(t,n=>e[n]):[[,t]]}function v_(t,e,n=M2t){if(t==null)return n(t);if(typeof t.reduceIndex=="function")return t;if(typeof t.reduce=="function"&&Ss(t))return I2t(t);if(typeof t=="function")return F2t(t);if(/^p\d{2}$/i.test(t))return La(EI(t));switch(`${t}`.toLowerCase()){case"first":return zI;case"last":return O2t;case"identity":return PI;case"count":return gx;case"distinct":return R2t;case"sum":return e==null?gx:D2t;case"proportion":return s4(e,"data");case"proportion-facet":return s4(e,"facet");case"deviation":return La(Wp);case"min":return La(wn);case"min-index":return La(Bpt);case"max":return La(Be);case"max-index":return La(Lpt);case"mean":return i4(wy);case"median":return i4(Mf);case"variance":return La(vC);case"mode":return La(iq)}return n(t)}function M2t(t){throw new Error(`invalid reduce: ${t}`)}function EH(t,e){return SH(t,e,AH)}function AH(t,e,n){return DI(t,e,n,$H)}function $H(t,e,n){return LI(t,e,n,TH)}function TH(t,e){return v_(t,e,C2t)}function C2t(t){switch(`${t}`.toLowerCase()){case"x":return L2t;case"y":return B2t;case"z":return MH}throw new Error(`invalid group reduce: ${t}`)}function BI(t,e){for(const n in e){const r=e[n];if(r!==void 0&&!t.some(i=>i.name===n))return r}}function kH(t,e,n){if(e){const r=e.output.transform(),i=(s,o)=>gs(r[s],r[o]);t.forEach(s=>s.sort(i))}n&&t.forEach(r=>r.reverse())}function I2t(t){return console.warn("deprecated reduce interface; implement reduceIndex instead."),{...t,reduceIndex:t.reduce.bind(t)}}function F2t(t){return{reduceIndex(e,n,r){return t(p_(n,e),r)}}}function La(t){return{reduceIndex(e,n){return t(e,r=>n[r])}}}function i4(t){return{reduceIndex(e,n){const r=t(e,i=>n[i]);return Wr(n)?new Date(r):r}}}const PI={reduceIndex(t,e){return p_(e,t)}},zI={reduceIndex(t,e){return e[t[0]]}},N2t={reduceIndex(t,e){const r=ww(kh(t,s=>s.length,s=>e[s]),N0),i=r.slice(-5).reverse();if(i.length<r.length){const s=r.slice(0,-4);i[4]=[` ${s.length.toLocaleString("en-US")} more`,ls(s,N0)]}return i.map(([s,o])=>`${s} (${o.toLocaleString("en-US")})`).join(`
`)}},O2t={reduceIndex(t,e){return e[t[t.length-1]]}},gx={label:"Frequency",reduceIndex(t){return t.length}},R2t={label:"Distinct",reduceIndex(t,e){const n=new pu;for(const r of t)n.add(e[r]);return n.size}},D2t=La(ls);function s4(t,e){return t==null?{scope:e,label:"Frequency",reduceIndex:(n,r,i=1)=>n.length/i}:{scope:e,reduceIndex:(n,r,i=1)=>ls(n,s=>r[s])/i}}const L2t={reduceIndex(t,e,{x:n}){return n}},B2t={reduceIndex(t,e,{y:n}){return n}},MH={reduceIndex(t,e,{z:n}){return n}};function P2t(t){if(typeof t!="function")throw new Error(`invalid test function: ${t}`);return{reduceIndex(e,n,{data:r}){return n[e.find(Cu(r)?i=>t(r[i],i,r):i=>t(r.get(i),i,r))]}}}function B0(t,{scale:e,type:n,value:r,filter:i,hint:s,label:o=ha(r)},a){return s===void 0&&typeof(r==null?void 0:r.transform)=="function"&&(s=r.hint),IH(a,{scale:e,type:n,value:Kt(t,r),label:o,filter:i,hint:s})}function CH(t,e){return Object.fromEntries(Object.entries(t).map(([n,r])=>[n,B0(e,r,n)]))}function UI(t,e){const n=Object.fromEntries(Object.entries(t).map(([r,{scale:i,value:s}])=>{const o=i==null?null:e[i];return[r,o==null?s:Te(s,o)]}));return n.channels=t,n}function IH(t,e){const{scale:n,value:r}=e;if(n===!0||n==="auto")switch(t){case"fill":case"stroke":case"color":e.scale=n!==!0&&EA(r,Ny)?null:"color",e.defaultScale="color";break;case"fillOpacity":case"strokeOpacity":case"opacity":e.scale=n!==!0&&EA(r,p2t)?null:"opacity",e.defaultScale="opacity";break;case"symbol":n!==!0&&EA(r,_2t)?(e.scale=null,e.value=Te(r,CI)):e.scale="symbol",e.defaultScale="symbol";break;default:e.scale=Xe.has(t)?t:null;break}else if(n===!1)e.scale=null;else if(n!=null&&!Xe.has(n))throw new Error(`unknown scale: ${n}`);return e}function z2t(t,e,n,r,i){const{order:s,reverse:o,reduce:a=!0,limit:u}=i;for(const c in i){if(!Xe.has(c))continue;let{value:l,order:f=s,reverse:d=o,reduce:h=a,limit:p=u}=rg(i[c]);const g=l==null?void 0:l.startsWith("-");if(g&&(l=l.slice(1)),f=f===void 0?g!==(l==="width"||l==="height")?NH:FH:q2t(f),h==null||h===!1)continue;const m=c==="fx"||c==="fy"?j2t(e,r[c]):U2t(n,c);if(!m)throw new Error(`missing channel for scale: ${c}`);const y=m.value,[b=0,w=1/0]=Fu(p)?p:p<0?[p]:[0,p];if(l==null)m.domain=()=>{let v=Array.from(new pu(y));return d&&(v=v.reverse()),(b!==0||w!==1/0)&&(v=v.slice(b,w)),v};else{const v=l==="data"?t:l==="height"?o4(n,"y1","y2"):l==="width"?o4(n,"x1","x2"):AT(n,l,l==="y"?"y2":l==="x"?"x2":void 0),x=v_(h===!0?"max":h,v);m.domain=()=>{let S=Npt(Iu(y),_=>x.reduceIndex(_,v),_=>y[_]);return f&&S.sort(f),d&&S.reverse(),(b!==0||w!==1/0)&&(S=S.slice(b,w)),S.map(h_)}}}}function U2t(t,e){for(const n in t){const r=t[n];if(r.scale===e)return r}}function j2t(t,e){const n=t.original;if(n===t)return e;const r=e.value,i=e.value=[];for(let s=0;s<n.length;++s){const o=r[n[s][0]];for(const a of t[s])i[a]=o}return e}function o4(t,e,n){const r=AT(t,e),i=AT(t,n);return Te(i,(s,o)=>Math.abs(s-r[o]),Float64Array)}function AT(t,e,n){let r=t[e];if(!r&&n!==void 0&&(r=t[n]),r)return r.value;throw new Error(`missing channel: ${e}`)}function q2t(t){if(t==null||typeof t=="function")return t;switch(`${t}`.toLowerCase()){case"ascending":return FH;case"descending":return NH}throw new Error(`invalid order: ${t}`)}function FH([t,e],[n,r]){return gs(e,r)||gs(t,n)}function NH([t,e],[n,r]){return fx(e,r)||gs(t,n)}function $T(t,e){let n=t[e];if(n){for(;n.source;)n=n.source;return n.source===null?null:n}}const OH=new Map([["accent",qV],["category10",jV],["dark2",WV],["observable10",VV],["paired",GV],["pastel1",YV],["pastel2",HV],["set1",XV],["set2",KV],["set3",QV],["tableau10",Axt]]);function W2t(t){return t!=null&&OH.has(`${t}`.toLowerCase())}const a4=new Map([...OH,["brbg",Ma(JV,ZV)],["prgn",Ma(tG,eG)],["piyg",Ma(nG,rG)],["puor",Ma(iG,sG)],["rdbu",Ma(wT,sx)],["rdgy",Ma(oG,aG)],["rdylbu",Ma(xT,ox)],["rdylgn",Ma(uG,cG)],["spectral",Ma(lG,fG)],["burd",u4(wT,sx)],["buylrd",u4(xT,ox)],["blues",Tn(DG,LG)],["greens",Tn(BG,PG)],["greys",Tn(zG,UG)],["oranges",Tn(GG,YG)],["purples",Tn(jG,qG)],["reds",Tn(WG,VG)],["turbo",Ca(tY)],["viridis",Ca(eY)],["magma",Ca(nY)],["inferno",Ca(rY)],["plasma",Ca(iY)],["cividis",Ca(HG)],["cubehelix",Ca(XG)],["warm",Ca(KG)],["cool",Ca(QG)],["bugn",Tn(dG,hG)],["bupu",Tn(pG,gG)],["gnbu",Tn(mG,yG)],["orrd",Tn(bG,vG)],["pubu",Tn(_G,SG)],["pubugn",Tn(wG,xG)],["purd",Tn(EG,AG)],["rdpu",Tn($G,TG)],["ylgn",Tn(CG,IG)],["ylgnbu",Tn(kG,MG)],["ylorbr",Tn(FG,NG)],["ylorrd",Tn(OG,RG)],["rainbow",c4(JG)],["sinebow",c4(ZG)]]);function Tn(t,e){return({length:n})=>n===1?[t[3][1]]:n===2?[t[3][1],t[3][2]]:(n=Math.max(3,Math.floor(n)),n>9?fs(e,n):t[n])}function Ma(t,e){return({length:n})=>n===2?[t[3][0],t[3][2]]:(n=Math.max(3,Math.floor(n)),n>11?fs(e,n):t[n])}function u4(t,e){return({length:n})=>n===2?[t[3][2],t[3][0]]:(n=Math.max(3,Math.floor(n)),n>11?fs(r=>e(1-r),n):t[n].slice().reverse())}function Ca(t){return({length:e})=>fs(t,Math.max(2,Math.floor(e)))}function c4(t){return({length:e})=>fs(t,Math.floor(e)+1).slice(0,-1)}function RH(t){const e=`${t}`.toLowerCase();if(!a4.has(e))throw new Error(`unknown ordinal scheme: ${e}`);return a4.get(e)}function w_(t,e){const n=RH(t),r=typeof n=="function"?n({length:e}):n;return r.length!==e?r.slice(0,e):r}function V2t(t,e="greys"){const n=new Set,[r,i]=w_(e,2);for(const s of t)if(s!=null)if(s===!0)n.add(i);else if(s===!1)n.add(r);else return;return[...n]}const l4=new Map([["brbg",ZV],["prgn",eG],["piyg",rG],["puor",sG],["rdbu",sx],["rdgy",aG],["rdylbu",ox],["rdylgn",cG],["spectral",fG],["burd",t=>sx(1-t)],["buylrd",t=>ox(1-t)],["blues",LG],["greens",PG],["greys",UG],["purples",qG],["reds",VG],["oranges",YG],["turbo",tY],["viridis",eY],["magma",nY],["inferno",rY],["plasma",iY],["cividis",HG],["cubehelix",XG],["warm",KG],["cool",QG],["bugn",hG],["bupu",gG],["gnbu",yG],["orrd",vG],["pubugn",xG],["pubu",SG],["purd",AG],["rdpu",TG],["ylgnbu",MG],["ylgn",IG],["ylorbr",NG],["ylorrd",RG],["rainbow",JG],["sinebow",ZG]]);function jI(t){const e=`${t}`.toLowerCase();if(!l4.has(e))throw new Error(`unknown quantitative scheme: ${e}`);return l4.get(e)}const G2t=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function Y2t(t){return t!=null&&G2t.has(`${t}`.toLowerCase())}const DH=t=>e=>t(1-e),TA=[0,1],f4=new Map([["number",qn],["rgb",zc],["hsl",qq],["hcl",Gq],["lab",Wq]]);function LH(t){const e=`${t}`.toLowerCase();if(!f4.has(e))throw new Error(`unknown interpolator: ${e}`);return f4.get(e)}function By(t,e,n,{type:r,nice:i,clamp:s,zero:o,domain:a=PH(t,n),unknown:u,round:c,scheme:l,interval:f,range:d=Xe.get(t)===Ry?i_t(n,a):Xe.get(t)===Dy?s_t(n,a):Xe.get(t)===Ly?TA:void 0,interpolate:h=Xe.get(t)===Nu?l==null&&d!==void 0?zc:jI(l!==void 0?l:r==="cyclical"?"rainbow":"turbo"):c?Gp:qn,reverse:p}){if(f=ng(f,r),(r==="cyclical"||r==="sequential")&&(r="linear"),typeof h!="function"&&(h=LH(h)),p=!!p,d!==void 0){const g=(a=vu(a)).length,m=(d=vu(d)).length;if(g!==m){if(h.length===1)throw new Error("invalid piecewise interpolator");h=Yp(h,d),d=void 0}}if(h.length===1?(p&&(h=DH(h),p=!1),d===void 0&&(d=Float64Array.from(a,(g,m)=>m/(a.length-1)),d.length===2&&(d=TA)),e.interpolate((d===TA?Hn:WI)(h))):e.interpolate(h),o){const[g,m]=pn(a);(g>0||m<0)&&(a=O0(a),(rp(a)||1)===Math.sign(g)?a[0]=0:a[a.length-1]=0)}return p&&(a=_w(a)),e.domain(a).unknown(u),i&&(e.nice(H2t(i,r)),a=e.domain()),d!==void 0&&e.range(d),s&&e.clamp(s),{type:r,domain:a,range:d,scale:e,interpolate:h,interval:f}}function H2t(t,e){return t===!0?void 0:typeof t=="number"?t:a2t(t,e)}function X2t(t,e,n){return By(t,J2(),e,n)}function K2t(t,e,n){return BH(t,e,{...n,exponent:.5})}function BH(t,e,{exponent:n=1,...r}){return By(t,Z2().exponent(n),e,{...r,type:"pow"})}function Q2t(t,e,{base:n=10,domain:r=o_t(e),...i}){return By(t,ZC().base(n),e,{...i,domain:r})}function J2t(t,e,{constant:n=1,...r}){return By(t,eI().constant(n),e,r)}function Z2t(t,e,{range:n,quantiles:r=n===void 0?5:(n=[...n]).length,n:i=r,scheme:s="rdylbu",domain:o=a_t(e),unknown:a,interpolate:u,reverse:c}){return n===void 0&&(n=u!==void 0?fs(u,i):Xe.get(t)===Nu?w_(s,i):void 0),o.length>0&&(o=rI(o,n===void 0?{length:i}:n).quantiles()),qI(t,e,{domain:o,range:n,reverse:c,unknown:a})}function t_t(t,e,{range:n,n:r=n===void 0?5:(n=[...n]).length,scheme:i="rdylbu",domain:s=PH(t,e),unknown:o,interpolate:a,reverse:u}){const[c,l]=pn(s);let f;return n===void 0?(f=Lc(c,l,r),f[0]<=c&&f.splice(0,1),f[f.length-1]>=l&&f.pop(),r=f.length+1,n=a!==void 0?fs(a,r):Xe.get(t)===Nu?w_(i,r):void 0):(f=fs(qn(c,l),r+1).slice(1,-1),c instanceof Date&&(f=f.map(d=>new Date(d)))),rp(vu(s))<0&&f.reverse(),qI(t,e,{domain:f,range:n,reverse:u,unknown:o})}function qI(t,e,{domain:n=[0],unknown:r,scheme:i="rdylbu",interpolate:s,range:o=s!==void 0?fs(s,n.length+1):Xe.get(t)===Nu?w_(i,n.length+1):void 0,reverse:a}){n=vu(n);const u=rp(n);if(!isNaN(u)&&!e_t(n,u))throw new Error(`the ${t} scale has a non-monotonic domain`);return a&&(o=_w(o)),{type:"threshold",scale:iI(u<0?_w(n):n,o===void 0?[]:o).unknown(r),domain:n,range:o}}function e_t(t,e){for(let n=1,r=t.length,i=t[0];n<r;++n){const s=Tf(i,i=t[n]);if(s!==0&&s!==e)return!1}return!0}function n_t(t){return{type:"identity",scale:w2t(Xe.get(t))?QC():e=>e}}function P0(t,e=dx){return t.length?[wn(t,({value:n})=>n===void 0?n:wn(n,e)),Be(t,({value:n})=>n===void 0?n:Be(n,e))]:[0,1]}function PH(t,e){const n=Xe.get(t);return(n===Ry||n===Ly||n===Dy?r_t:P0)(e)}function r_t(t){return[0,t.length?Be(t,({value:e})=>e===void 0?e:Be(e,dx)):1]}function i_t(t,e){const n=t.find(({radius:o})=>o!==void 0);if(n!==void 0)return[0,n.radius];const r=Xo(t,.5,({value:o})=>o===void 0?NaN:Xo(o,.25,iu)),i=e.map(o=>3*Math.sqrt(o/r)),s=30/Be(i);return s<1?i.map(o=>o*s):i}function s_t(t,e){const n=Mf(t,({value:s})=>s===void 0?NaN:Mf(s,Math.abs)),r=e.map(s=>12*s/n),i=60/Be(r);return i<1?r.map(s=>s*i):r}function o_t(t){for(const{value:e}of t)if(e!==void 0)for(let n of e){if(n>0)return P0(t,iu);if(n<0)return P0(t,c_)}return[1,10]}function a_t(t){const e=[];for(const{value:n}of t)if(n!==void 0)for(const r of n)e.push(r);return e}function WI(t){return(e,n)=>r=>t(e+r*(n-e))}let TT=0,kT;function u_t(){const t=TT;return TT=0,kT=void 0,t}function su(t){t!==kT&&(kT=t,console.warn(t),++TT)}function x_(t,e,n,r,{type:i,nice:s,clamp:o,domain:a=P0(r),unknown:u,pivot:c=0,scheme:l,range:f,symmetric:d=!0,interpolate:h=Xe.get(t)===Nu?l==null&&f!==void 0?zc:jI(l!==void 0?l:"rdbu"):qn,reverse:p}){c=+c,a=vu(a);let[g,m]=a;if(a.length>2&&su(`Warning: the diverging ${t} scale domain contains extra elements.`),Tf(g,m)<0&&([g,m]=[m,g],p=!p),g=Math.min(g,c),m=Math.max(m,c),typeof h!="function"&&(h=LH(h)),f!==void 0&&(h=h.length===1?WI(h)(...f):Yp(h,f)),p&&(h=DH(h)),d){const y=n.apply(c),b=y-n.apply(g),w=n.apply(m)-y;b<w?g=n.invert(y-w):b>w&&(m=n.invert(y+b))}return e.domain([g,c,m]).unknown(u).interpolator(h),o&&e.clamp(o),s&&e.nice(s),{type:i,domain:[g,m],pivot:c,interpolate:h,scale:e}}function c_t(t,e,n){return x_(t,cI(),h_t,e,n)}function l_t(t,e,n){return zH(t,e,{...n,exponent:.5})}function zH(t,e,{exponent:n=1,...r}){return x_(t,i_().exponent(n=+n),m_t(n),e,{...r,type:"diverging-pow"})}function f_t(t,e,{base:n=10,pivot:r=1,domain:i=P0(e,r<0?c_:iu),...s}){return x_(t,lI().base(n=+n),p_t,e,{domain:i,pivot:r,...s})}function d_t(t,e,{constant:n=1,...r}){return x_(t,fI().constant(n=+n),y_t(n),e,r)}const h_t={apply(t){return t},invert(t){return t}},p_t={apply:Math.log,invert:Math.exp},g_t={apply(t){return Math.sign(t)*Math.sqrt(Math.abs(t))},invert(t){return Math.sign(t)*(t*t)}};function m_t(t){return t===.5?g_t:{apply(e){return Math.sign(e)*Math.pow(Math.abs(e),t)},invert(e){return Math.sign(e)*Math.pow(Math.abs(e),1/t)}}}function y_t(t){return{apply(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))},invert(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}}function UH(t,e,n,r){return By(t,e,n,r)}function b_t(t,e,n){return UH(t,BV(),e,n)}function v_t(t,e,n){return UH(t,PV(),e,n)}const Py=Symbol("ordinal");function jH(t,e,n,{type:r,interval:i,domain:s,range:o,reverse:a,hint:u}){return i=ng(i,r),s===void 0&&(s=WH(n,i,t)),(r==="categorical"||r===Py)&&(r="ordinal"),a&&(s=_w(s)),s=e.domain(s).domain(),o!==void 0&&(typeof o=="function"&&(o=o(s)),e.range(o)),{type:r,domain:s,range:o,scale:e,hint:u,interval:i}}function w_t(t,e,{type:n,interval:r,domain:i,range:s,scheme:o,unknown:a,...u}){r=ng(r,n),i===void 0&&(i=WH(e,r,t));let c;if(Xe.get(t)===m_)c=S_t(e),s=s===void 0?E_t(c):Te(s,CI);else if(Xe.get(t)===Nu&&(s===void 0&&(n==="ordinal"||n===Py)&&(s=V2t(i,o),s!==void 0&&(o=void 0)),o===void 0&&s===void 0&&(o=n==="ordinal"?"turbo":"observable10"),o!==void 0))if(s!==void 0){const l=jI(o),f=s[0],d=s[1]-s[0];s=({length:h})=>fs(p=>l(f+d*p),h)}else s=RH(o);if(a===ix)throw new Error(`implicit unknown on ${t} scale is not supported`);return jH(t,ky().unknown(a),e,{...u,type:n,domain:i,range:s,hint:c})}function x_t(t,e,{align:n=.5,padding:r=.5,...i}){return qH(swt().align(n).padding(r),e,i,t)}function __t(t,e,{align:n=.5,padding:r=.1,paddingInner:i=r,paddingOuter:s=t==="fx"||t==="fy"?0:r,...o}){return qH(K2().align(n).paddingInner(i).paddingOuter(s),e,o,t)}function qH(t,e,n,r){let{round:i}=n;return i!==void 0&&t.round(i=!!i),t=jH(r,t,e,n),t.round=i,t}function WH(t,e,n){const r=new pu;for(const{value:i,domain:s}of t){if(s!==void 0)return s();if(i!==void 0)for(const o of i)r.add(o)}if(e!==void 0){const[i,s]=pn(r).map(e.floor,e);return e.range(i,e.offset(s))}if(r.size>1e4&&Xe.get(n)===Lo)throw new Error(`implicit ordinal domain of ${n} scale has more than 10,000 values`);return ww(r,gs)}function d4(t,e){let n;for(const{hint:r}of t){const i=r==null?void 0:r[e];if(i!==void 0){if(n===void 0)n=i;else if(n!==i)return}}return n}function S_t(t){return{fill:d4(t,"fill"),stroke:d4(t,"stroke")}}function E_t(t){return je(t.fill)?Yxt:Gxt}function MT(t,{label:e,inset:n=0,insetTop:r=n,insetRight:i=n,insetBottom:s=n,insetLeft:o=n,round:a,nice:u,clamp:c,zero:l,align:f,padding:d,projection:h,facet:{label:p=e}={},...g}={}){const m={};for(const[y,b]of t){const w=g[y],v=XH(y,b,{round:Xe.get(y)===Lo?a:void 0,nice:u,clamp:c,zero:l,align:f,padding:d,projection:h,...w});if(v){let{label:x=y==="fx"||y==="fy"?p:e,percent:S,transform:_,inset:E,insetTop:A=E!==void 0?E:y==="y"?r:0,insetRight:$=E!==void 0?E:y==="x"?i:0,insetBottom:T=E!==void 0?E:y==="y"?s:0,insetLeft:C=E!==void 0?E:y==="x"?o:0}=w||{};if(_==null)_=void 0;else if(typeof _!="function")throw new Error("invalid scale transform; not a function");v.percent=!!S,v.label=x===void 0?$_t(b,v):x,v.transform=_,y==="x"||y==="fx"?(v.insetLeft=+C,v.insetRight=+$):(y==="y"||y==="fy")&&(v.insetTop=+A,v.insetBottom=+T),m[y]=v}}return m}function h4(t){const e={},n={scales:e};for(const[r,i]of Object.entries(t)){const{scale:s,type:o,interval:a,label:u}=i;e[r]=QH(i),n[r]=s,s.type=o,a!=null&&(s.interval=a),u!=null&&(s.label=u)}return n}function A_t(t,e){const{x:n,y:r,fx:i,fy:s}=t,o=i||s?VI(e):e;i&&p4(i,o),s&&g4(s,o);const a=i||s?GH(t,e):e;n&&p4(n,a),r&&g4(r,a)}function $_t(t=[],e){let n;for(const{label:r}of t)if(r!==void 0){if(n===void 0)n=r;else if(n!==r)return}if(n!==void 0)return!ud(e)&&e.percent&&(n=`${n} (%)`),{inferred:!0,toString:()=>n}}function VH(t){return Math.sign(rp(t.domain()))*Math.sign(rp(t.range()))}function VI(t){const{marginTop:e,marginRight:n,marginBottom:r,marginLeft:i,width:s,height:o,facet:{marginTop:a,marginRight:u,marginBottom:c,marginLeft:l}}=t;return{marginTop:Math.max(e,a),marginRight:Math.max(n,u),marginBottom:Math.max(r,c),marginLeft:Math.max(i,l),width:s,height:o}}function GH({fx:t,fy:e},n){const{marginTop:r,marginRight:i,marginBottom:s,marginLeft:o,width:a,height:u}=VI(n);return{marginTop:r,marginRight:i,marginBottom:s,marginLeft:o,width:t?t.scale.bandwidth()+o+i:a,height:e?e.scale.bandwidth()+r+s:u,facet:{width:a,height:u}}}function p4(t,e){if(t.range===void 0){const{insetLeft:n,insetRight:r}=t,{width:i,marginLeft:s=0,marginRight:o=0}=e,a=s+n,u=i-o-r;t.range=[a,Math.max(a,u)],ud(t)||(t.range=HH(t)),t.scale.range(t.range)}YH(t)}function g4(t,e){if(t.range===void 0){const{insetTop:n,insetBottom:r}=t,{height:i,marginTop:s=0,marginBottom:o=0}=e,a=s+n,u=i-o-r;t.range=[Math.max(a,u),a],ud(t)?t.range.reverse():t.range=HH(t),t.scale.range(t.range)}YH(t)}function YH(t){t.round===void 0&&M_t(t)&&T_t(t)<=30&&t.scale.round(!0)}function T_t({scale:t}){const e=t.domain().length,[n,r]=t.range(),i=t.paddingInner?t.paddingInner():1,s=t.paddingOuter?t.paddingOuter():t.padding(),o=e-i,a=Math.abs(r-n)/Math.max(1,o+s*2);return(a-Math.floor(a))*o}function HH(t){const e=t.scale.domain().length+KH(t);if(!(e>2))return t.range;const[n,r]=t.range;return Array.from({length:e},(i,s)=>n+s/(e-1)*(r-n))}function CT(t,e,n){return XH(t,n===void 0?void 0:[{hint:n}],{...e})}function XH(t,e=[],n={}){const r=k_t(t,e,n);if(n.type===void 0&&n.domain===void 0&&n.range===void 0&&n.interval==null&&t!=="fx"&&t!=="fy"&&ud({type:r})){const i=e.map(({value:s})=>s).filter(s=>s!==void 0);i.some(Wr)?su(`Warning: some data associated with the ${t} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${Ld(r)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${t} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${t} scale to "${Ld(r)}".`):i.some(f2t)?su(`Warning: some data associated with the ${t} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${Ld(r)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${t} scale to "${Ld(r)}".`):i.some(d2t)&&su(`Warning: some data associated with the ${t} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${Ld(r)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${t} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${t} scale to "${Ld(r)}".`)}switch(n.type=r,r){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":n=nb(e,n,si);break;case"identity":switch(Xe.get(t)){case Lo:n=nb(e,n,si);break;case m_:n=nb(e,n,C_t);break}break;case"utc":case"time":n=nb(e,n,sH);break}switch(r){case"diverging":return c_t(t,e,n);case"diverging-sqrt":return l_t(t,e,n);case"diverging-pow":return zH(t,e,n);case"diverging-log":return f_t(t,e,n);case"diverging-symlog":return d_t(t,e,n);case"categorical":case"ordinal":case Py:return w_t(t,e,n);case"cyclical":case"sequential":case"linear":return X2t(t,e,n);case"sqrt":return K2t(t,e,n);case"threshold":return qI(t,e,n);case"quantile":return Z2t(t,e,n);case"quantize":return t_t(t,e,n);case"pow":return BH(t,e,n);case"log":return Q2t(t,e,n);case"symlog":return J2t(t,e,n);case"utc":return v_t(t,e,n);case"time":return b_t(t,e,n);case"point":return x_t(t,e,n);case"band":return __t(t,e,n);case"identity":return n_t(t);case void 0:return;default:throw new Error(`unknown scale type: ${r}`)}}function Ld(t){return typeof t=="symbol"?t.description:t}function m4(t){return typeof t=="string"?`${t}`.toLowerCase():t}const y4={toString:()=>"projection"};function k_t(t,e,{type:n,domain:r,range:i,scheme:s,pivot:o,projection:a}){if(n=m4(n),t==="fx"||t==="fy")return"band";(t==="x"||t==="y")&&a!=null&&(n=y4);for(const c of e){const l=m4(c.type);if(l!==void 0){if(n===void 0)n=l;else if(n!==l)throw new Error(`scale incompatible with channel: ${n} !== ${l}`)}}if(n===y4)return;if(n!==void 0)return n;if(r===void 0&&!e.some(({value:c})=>c!==void 0))return;const u=Xe.get(t);if(u===Ry)return"sqrt";if(u===Ly||u===Dy)return"linear";if(u===m_)return"ordinal";if((r||i||[]).length>2)return kA(u);if(r!==void 0){if(Je(r))return kA(u);if(Wr(r))return"utc"}else{const c=e.map(({value:l})=>l).filter(l=>l!==void 0);if(c.some(Je))return kA(u);if(c.some(Wr))return"utc"}if(u===Nu){if(o!=null||Y2t(s))return"diverging";if(W2t(s))return"categorical"}return"linear"}function kA(t){switch(t){case Lo:return"point";case Nu:return Py;default:return"ordinal"}}function ud({type:t}){return t==="ordinal"||t==="point"||t==="band"||t===Py}function KH({type:t}){return t==="threshold"}function M_t({type:t}){return t==="point"||t==="band"}function Zo(t){if(t===void 0)return!0;const e=t.domain(),n=t(e[0]);for(let r=1,i=e.length;r<i;++r)if(t(e[r])-n)return!1;return!0}function nb(t,{domain:e,...n},r){var i;for(const s of t)s.value!==void 0&&(e===void 0&&(e=(i=s.value)==null?void 0:i.domain),s.value=r(s.value));return{domain:e===void 0?e:r(e),...n}}function C_t(t){return Te(t,CI)}function I_t(t={}){let e;for(const n in t)if(Xe.has(n)&&hf(t[n])){if(e!==void 0)throw new Error("ambiguous scale definition; multiple scales found");e=QH(CT(n,t[n]))}if(e===void 0)throw new Error("invalid scale definition; no scale found");return e}function F_t(t){return e=>{if(!Xe.has(e=`${e}`))throw new Error(`unknown scale: ${e}`);return t[e]}}function QH({scale:t,type:e,domain:n,range:r,interpolate:i,interval:s,transform:o,percent:a,pivot:u}){if(e==="identity")return{type:"identity",apply:l=>l,invert:l=>l};const c=t.unknown?t.unknown():void 0;return{type:e,domain:O0(n),...r!==void 0&&{range:O0(r)},...o!==void 0&&{transform:o},...a&&{percent:a},...c!==void 0&&{unknown:c},...s!==void 0&&{interval:s},...i!==void 0&&{interpolate:i},...t.clamp&&{clamp:t.clamp()},...u!==void 0&&{pivot:u,symmetric:!1},...t.base&&{base:t.base()},...t.exponent&&{exponent:t.exponent()},...t.constant&&{constant:t.constant()},...t.align&&{align:t.align(),round:t.round()},...t.padding&&(t.paddingInner?{paddingInner:t.paddingInner(),paddingOuter:t.paddingOuter()}:{padding:t.padding()}),...t.bandwidth&&{bandwidth:t.bandwidth(),step:t.step()},apply:l=>t(l),...t.invert&&{invert:l=>t.invert(l)}}}function N_t(t,e){const{fx:n,fy:r}=MT(t,e),i=n==null?void 0:n.scale.domain(),s=r==null?void 0:r.scale.domain();return i&&s?Ipt(i,s).map(([o,a],u)=>({x:o,y:a,i:u})):i?i.map((o,a)=>({x:o,i:a})):s?s.map((o,a)=>({y:o,i:a})):void 0}function O_t(t,{x:e,y:n}){return e&&(e=IT(e)),n&&(n=IT(n)),t.filter(e&&n?r=>e.has(r.x)&&n.has(r.y):e?r=>e.has(r.x):r=>n.has(r.y)).sort(e&&n?(r,i)=>e.get(r.x)-e.get(i.x)||n.get(r.y)-n.get(i.y):e?(r,i)=>e.get(r.x)-e.get(i.x):(r,i)=>n.get(r.y)-n.get(i.y))}function GI(t,{fx:e,fy:n}){const r=Iu(t),i=e==null?void 0:e.value,s=n==null?void 0:n.value;return e&&n?kh(r,o=>(o.fx=i[o[0]],o.fy=s[o[0]],o),o=>i[o],o=>s[o]):e?kh(r,o=>(o.fx=i[o[0]],o),o=>i[o]):kh(r,o=>(o.fy=s[o[0]],o),o=>s[o])}function R_t(t,e,{marginTop:n,marginLeft:r}){return t&&e?({x:i,y:s})=>`translate(${t(i)-r},${e(s)-n})`:t?({x:i})=>`translate(${t(i)-r},0)`:({y:i})=>`translate(0,${e(i)-n})`}function D_t(t){const e=[],n=new Uint32Array(ls(t,r=>r.length));for(const r of t){let i=0;for(const s of t)r!==s&&(n.set(s,i),i+=s.length);e.push(n.slice(0,i))}return e}const L_t=new Map([["top",MA],["right",FA],["bottom",CA],["left",IA],["top-left",rb(MA,IA)],["top-right",rb(MA,FA)],["bottom-left",rb(CA,IA)],["bottom-right",rb(CA,FA)],["top-empty",z_t],["right-empty",q_t],["bottom-empty",U_t],["left-empty",j_t],["empty",W_t]]);function B_t(t){if(t==null)return null;const e=L_t.get(`${t}`.toLowerCase());if(e)return e;throw new Error(`invalid facet anchor: ${t}`)}const b4=new WeakMap;function IT(t){let e=b4.get(t);return e||b4.set(t,e=new kf(Te(t,(n,r)=>[n,r]))),e}function dl(t,e){return IT(t).get(e)}function P_t(t,e,n){return e=tu(e),n=tu(n),t.find(r=>Object.is(tu(r.x),e)&&Object.is(tu(r.y),n))}function __(t,e,n){var r;return(r=P_t(t,e,n))==null?void 0:r.empty}function MA(t,{y:e},{y:n}){return e?dl(e,n)===0:!0}function CA(t,{y:e},{y:n}){return e?dl(e,n)===e.length-1:!0}function IA(t,{x:e},{x:n}){return e?dl(e,n)===0:!0}function FA(t,{x:e},{x:n}){return e?dl(e,n)===e.length-1:!0}function z_t(t,{y:e},{x:n,y:r,empty:i}){if(i)return!1;if(!e)return;const s=dl(e,r);if(s>0)return __(t,n,e[s-1])}function U_t(t,{y:e},{x:n,y:r,empty:i}){if(i)return!1;if(!e)return;const s=dl(e,r);if(s<e.length-1)return __(t,n,e[s+1])}function j_t(t,{x:e},{x:n,y:r,empty:i}){if(i)return!1;if(!e)return;const s=dl(e,n);if(s>0)return __(t,e[s-1],r)}function q_t(t,{x:e},{x:n,y:r,empty:i}){if(i)return!1;if(!e)return;const s=dl(e,n);if(s<e.length-1)return __(t,e[s+1],r)}function W_t(t,e,{empty:n}){return n}function rb(t,e){return function(){return t.apply(null,arguments)&&e.apply(null,arguments)}}function NA(t,{channels:{fx:e,fy:n},groups:r}){return e&&n?t.map(({x:i,y:s})=>{var o;return((o=r.get(i))==null?void 0:o.get(s))??[]}):e?t.map(({x:i})=>r.get(i)??[]):t.map(({y:i})=>r.get(i)??[])}const JH=Math.PI,Ia=2*JH,OA=.618;function V_t({projection:t,inset:e=0,insetTop:n=e,insetRight:r=e,insetBottom:i=e,insetLeft:s=e}={},o){if(t==null)return;if(typeof t.stream=="function")return t;let a,u,c="frame";if(Ss(t)){let x;if({type:t,domain:u,inset:x,insetTop:n=x!==void 0?x:n,insetRight:r=x!==void 0?x:r,insetBottom:i=x!==void 0?x:i,insetLeft:s=x!==void 0?x:s,clip:c=c,...a}=t,t==null)return}typeof t!="function"&&({type:t}=FT(t));const{width:l,height:f,marginLeft:d,marginRight:h,marginTop:p,marginBottom:g}=o,m=l-d-h-s-r,y=f-p-g-n-i;if(t=t==null?void 0:t({width:m,height:y,clip:c,...a}),t==null)return;c=G_t(c,d,p,l-h,f-g);let b=d+s,w=p+n,v;if(u!=null){const[[x,S],[_,E]]=eo(t).bounds(u),A=Math.min(m/(_-x),y/(E-S));A>0?(b-=(A*(x+_)-m)/2,w-=(A*(S+E)-y)/2,v=tx({point($,T){this.stream.point($*A+b,T*A+w)}})):su("Warning: the projection could not be fit to the specified domain; using the default scale.")}return v??(v=b===0&&w===0?ZH():tx({point(x,S){this.stream.point(x+b,S+w)}})),{stream:x=>t.stream(v.stream(c(x)))}}function FT(t){switch(`${t}`.toLowerCase()){case"albers-usa":return ks(zW,.7463,.4673);case"albers":return ib(YC,.7463,.4673);case"azimuthal-equal-area":return ks(qW,4,4);case"azimuthal-equidistant":return ks(VW,Ia,Ia);case"conic-conformal":return ib(HW,Ia,Ia);case"conic-equal-area":return ib(M0,6.1702,2.9781);case"conic-equidistant":return ib(KW,7.312,3.6282);case"equal-earth":return ks(JW,5.4133,2.6347);case"equirectangular":return ks(XW,Ia,JH);case"gnomonic":return ks(tV,3.4641,3.4641);case"identity":return{type:ZH};case"reflect-y":return{type:Y_t};case"mercator":return ks(GW,Ia,Ia);case"orthographic":return ks(rV,2,2);case"stereographic":return ks(sV,2,2);case"transverse-mercator":return ks(aV,Ia,Ia);default:throw new Error(`unknown projection type: ${t}`)}}function G_t(t,e,n,r,i){if(t===!1||t==null||typeof t=="number")return s=>s;switch(t===!0&&(t="frame"),`${t}`.toLowerCase()){case"frame":return UC(e,n,r,i);default:throw new Error(`unknown projection clip type: ${t}`)}}function ks(t,e,n){return{type:({width:r,height:i,rotate:s,precision:o=.15,clip:a})=>{var c,l,f;const u=t();return o!=null&&((c=u.precision)==null||c.call(u,o)),s!=null&&((l=u.rotate)==null||l.call(u,s)),typeof a=="number"&&((f=u.clipAngle)==null||f.call(u,a)),r!=null&&(u.scale(Math.min(r/e,i/n)),u.translate([r/2,i/2])),u},aspectRatio:n/e}}function ib(t,e,n){const{type:r,aspectRatio:i}=ks(t,e,n);return{type:s=>{const{parallels:o,domain:a,width:u,height:c}=s,l=r(s);return o!=null&&(l.parallels(o),a===void 0&&u!=null&&l.fitSize([u,c],{type:"Sphere"})),l},aspectRatio:i}}const ZH=Hn({stream:t=>t}),Y_t=Hn(tx({point(t,e){this.stream.point(t,-e)}}));function tX(t,e,n,r){const i=n[t],s=n[e],o=i.length,a=n[t]=new Float64Array(o).fill(NaN),u=n[e]=new Float64Array(o).fill(NaN);let c;const l=r.stream({point(f,d){a[c]=f,u[c]=d}});for(c=0;c<o;++c)l.point(i[c],s[c])}function H_t({projection:t}={}){return t==null?!1:typeof t.stream=="function"?!0:(Ss(t)&&(t=t.type),t!=null)}function X_t(t){if(typeof(t==null?void 0:t.stream)=="function")return OA;if(Ss(t)){let e,n;if({domain:e,type:t,...n}=t,e!=null&&t!=null){const r=typeof t=="string"?FT(t).type:t,[[i,s],[o,a]]=eo(r({...n,width:100,height:100})).bounds(e),u=(a-s)/(o-i);return u&&isFinite(u)?u<.2?.2:u>5?5:u:OA}}if(t!=null){if(typeof t!="function"){const{aspectRatio:e}=FT(t);if(e)return e}return OA}}function zy(t,e,{projection:n}){const{x:r,y:i}=t;let s={};return r&&(s.x=r),i&&(s.y=i),s=UI(s,e),n&&(r==null?void 0:r.scale)==="x"&&(i==null?void 0:i.scale)==="y"&&tX("x","y",s,n),r&&(s.x=si(s.x)),i&&(s.y=si(s.y)),s}function K_t(t){const e=[],n=[],r={scale:"x",value:e},i={scale:"y",value:n},s={point(o,a){e.push(o),n.push(a)},lineStart(){},lineEnd(){},polygonStart(){},polygonEnd(){},sphere(){}};for(const o of t.value)Co(o,s);return[r,i]}function S_(t={}){const{document:e=typeof window<"u"?window.document:void 0,clip:n}=t;return{document:e,clip:gH(n)}}function ne(t,{document:e}){return fr(L2(t).call(e.documentElement))}const NT=Symbol("unset");function op(t){return(t.length===1?Q_t:J_t)(t)}function Q_t(t){let e,n=NT;return r=>(Object.is(n,r)||(n=r,e=t(r)),e)}function J_t(t){let e,n;return(...r)=>(((n==null?void 0:n.length)!==r.length||n.some((i,s)=>!Object.is(i,r[s])))&&(n=r,e=t(...r)),e)}const Z_t=op(t=>new Intl.NumberFormat(t)),tSt=op((t,e)=>new Intl.DateTimeFormat(t,{timeZone:"UTC",...e&&{month:e}})),eSt=op((t,e)=>new Intl.DateTimeFormat(t,{timeZone:"UTC",...e&&{weekday:e}}));function eX(t="en-US"){const e=Z_t(t);return n=>n!=null&&!isNaN(n)?e.format(n):void 0}function nSt(t="en-US",e="short"){const n=tSt(t,e);return r=>r!=null&&!isNaN(r=+new Date(Date.UTC(2e3,+r)))?n.format(r):void 0}function rSt(t="en-US",e="short"){const n=eSt(t,e);return r=>r!=null&&!isNaN(r=+new Date(Date.UTC(2001,0,+r)))?n.format(r):void 0}function nX(t){return QY(t,"Invalid Date")}function iSt(t="en-US"){const e=eX(t);return n=>(n instanceof Date?nX:typeof n=="number"?e:dr)(n)}const ap=iSt(),Xn=(typeof window<"u"?window.devicePixelRatio>1:typeof it>"u")?0:.5;let sSt=0,oSt=0;function rX(){return`plot-clip-${++sSt}`}function aSt(){return`plot-pattern-${++oSt}`}function iX(t,{title:e,href:n,ariaLabel:r,ariaDescription:i,ariaHidden:s,target:o,fill:a,fillOpacity:u,stroke:c,strokeWidth:l,strokeOpacity:f,strokeLinejoin:d,strokeLinecap:h,strokeMiterlimit:p,strokeDasharray:g,strokeDashoffset:m,opacity:y,mixBlendMode:b,imageFilter:w,paintOrder:v,pointerEvents:x,shapeRendering:S,channels:_},{ariaLabel:E,fill:A="currentColor",fillOpacity:$,stroke:T="none",strokeOpacity:C,strokeWidth:F,strokeLinecap:M,strokeLinejoin:k,strokeMiterlimit:I,paintOrder:N}){A===null&&(a=null,u=null),T===null&&(c=null,f=null),je(A)?!je(T)&&(!je(a)||_!=null&&_.fill)&&(T="none"):je(T)&&(!je(c)||_!=null&&_.stroke)&&(A="none");const[R,D]=qr(a,A),[L,P]=cn(u,$),[B,G]=qr(c,T),[ct,Z]=cn(f,C),[lt,et]=cn(y);sp(G)||(l===void 0&&(l=F),h===void 0&&(h=M),d===void 0&&(d=k),p===void 0&&!g2t(d)&&(p=I),!sp(D)&&v===void 0&&(v=N));const[ut,V]=cn(l);return A!==null&&(t.fill=hn(D,"currentColor"),t.fillOpacity=Ug(P,1)),T!==null&&(t.stroke=hn(G,"none"),t.strokeWidth=Ug(V,1),t.strokeOpacity=Ug(Z,1),t.strokeLinejoin=hn(d,"miter"),t.strokeLinecap=hn(h,"butt"),t.strokeMiterlimit=Ug(p,4),t.strokeDasharray=hn(g,"none"),t.strokeDashoffset=hn(m,"0")),t.target=dr(o),t.ariaLabel=dr(E),t.ariaDescription=dr(i),t.ariaHidden=dr(s),t.opacity=Ug(et,1),t.mixBlendMode=hn(b,"normal"),t.imageFilter=hn(w,"none"),t.paintOrder=hn(v,"normal"),t.pointerEvents=hn(x,"auto"),t.shapeRendering=hn(S,"auto"),{title:{value:e,optional:!0,filter:null},href:{value:n,optional:!0,filter:null},ariaLabel:{value:r,optional:!0,filter:null},fill:{value:R,scale:"auto",optional:!0},fillOpacity:{value:L,scale:"auto",optional:!0},stroke:{value:B,scale:"auto",optional:!0},strokeOpacity:{value:ct,scale:"auto",optional:!0},strokeWidth:{value:ut,optional:!0},opacity:{value:lt,scale:"auto",optional:!0}}}function uSt(t,e){e&&t.filter(n=>yI(e[n])).append("title").call(lSt,e)}function cSt(t,e){e&&t.filter(([n])=>yI(e[n])).append("title").call(fSt,e)}function lSt(t,e){e&&t.text(n=>ap(e[n]))}function fSt(t,e){e&&t.text(([n])=>ap(e[n]))}function sn(t,{target:e,tip:n},{ariaLabel:r,title:i,fill:s,fillOpacity:o,stroke:a,strokeOpacity:u,strokeWidth:c,opacity:l,href:f}){r&&Et(t,"aria-label",d=>r[d]),s&&Et(t,"fill",d=>s[d]),o&&Et(t,"fill-opacity",d=>o[d]),a&&Et(t,"stroke",d=>a[d]),u&&Et(t,"stroke-opacity",d=>u[d]),c&&Et(t,"stroke-width",d=>c[d]),l&&Et(t,"opacity",d=>l[d]),f&&aX(t,d=>f[d],e),n||uSt(t,i)}function mx(t,{target:e,tip:n},{ariaLabel:r,title:i,fill:s,fillOpacity:o,stroke:a,strokeOpacity:u,strokeWidth:c,opacity:l,href:f}){r&&Et(t,"aria-label",([d])=>r[d]),s&&Et(t,"fill",([d])=>s[d]),o&&Et(t,"fill-opacity",([d])=>o[d]),a&&Et(t,"stroke",([d])=>a[d]),u&&Et(t,"stroke-opacity",([d])=>u[d]),c&&Et(t,"stroke-width",([d])=>c[d]),l&&Et(t,"opacity",([d])=>l[d]),f&&aX(t,([d])=>f[d],e),n||cSt(t,i)}function dSt({ariaLabel:t,title:e,fill:n,fillOpacity:r,stroke:i,strokeOpacity:s,strokeWidth:o,opacity:a,href:u},{tip:c}){return[t,c?void 0:e,n,r,i,s,o,a,u].filter(l=>l!==void 0)}function YI(t,e,n){const r=al(t,i=>e[i]);return n===void 0&&r.size>1+t.length>>1&&su("Warning: the implicit z channel has high cardinality. This may occur when the fill or stroke channel is associated with quantitative data rather than ordinal or categorical data. You can suppress this warning by setting the z option explicitly; if this data represents a single series, set z to null."),r.values()}function*sX(t,e,n,r){const{z:i}=n,{z:s}=r,o=dSt(r,n),a=[...e,...o];for(const u of s?YI(t,s,i):[t]){let c,l;t:for(const f of u){for(const d of a)if(!Qn(d[f])){l&&l.push(-1);continue t}if(c===void 0){l&&(yield l),c=o.map(d=>tu(d[f])),l=[f];continue}l.push(f);for(let d=0;d<o.length;++d)if(tu(o[d][f])!==c[d]){yield l,c=o.map(p=>tu(p[f])),l=[f];continue t}}l&&(yield l)}}function hSt(t,e,n,r){let i;const{clip:s=r.clip}=e;switch(s){case"frame":{t=ne("svg:g",r).each(function(){this.appendChild(t.node()),t.node=()=>this}),i=pSt(r,n);break}case"sphere":{i=gSt(r);break}}Et(t,"aria-label",e.ariaLabel),Et(t,"aria-description",e.ariaDescription),Et(t,"aria-hidden",e.ariaHidden),Et(t,"clip-path",i)}function oX(t){const e=new WeakMap;return(n,r)=>{let i=e.get(n);if(!i){const s=rX();fr(n.ownerSVGElement).append("clipPath").attr("id",s).call(t,n,r),e.set(n,i=`url(#${s})`)}return i}}const pSt=oX((t,e,n)=>{const{width:r,height:i,marginLeft:s,marginRight:o,marginTop:a,marginBottom:u}=n;t.append("rect").attr("x",s).attr("y",a).attr("width",r-o-s).attr("height",i-a-u)}),gSt=oX((t,e)=>{const{projection:n}=e;if(!n)throw new Error('the "sphere" clip option requires a projection');t.append("path").attr("d",eo(n)({type:"Sphere"}))});function Pe(t,e,n,r){hSt(t,e,n,r),Et(t,"class",e.className),Et(t,"fill",e.fill),Et(t,"fill-opacity",e.fillOpacity),Et(t,"stroke",e.stroke),Et(t,"stroke-width",e.strokeWidth),Et(t,"stroke-opacity",e.strokeOpacity),Et(t,"stroke-linejoin",e.strokeLinejoin),Et(t,"stroke-linecap",e.strokeLinecap),Et(t,"stroke-miterlimit",e.strokeMiterlimit),Et(t,"stroke-dasharray",e.strokeDasharray),Et(t,"stroke-dashoffset",e.strokeDashoffset),Et(t,"shape-rendering",e.shapeRendering),Et(t,"filter",e.imageFilter),Et(t,"paint-order",e.paintOrder);const{pointerEvents:i=r.pointerSticky===!1?"none":void 0}=e;Et(t,"pointer-events",i)}function Se(t,e){mSt(t,"mix-blend-mode",e.mixBlendMode),Et(t,"opacity",e.opacity)}function aX(t,e,n){t.each(function(r){const i=e(r);if(i!=null){const s=this.ownerDocument.createElementNS(gu.svg,"a");s.setAttribute("fill","inherit"),s.setAttributeNS(gu.xlink,"href",i),n!=null&&s.setAttribute("target",n),this.parentNode.insertBefore(s,this).appendChild(this)}})}function Et(t,e,n){n!=null&&t.attr(e,n)}function mSt(t,e,n){n!=null&&t.style(e,n)}function Me(t,e,{x:n,y:r},i=Xn,s=Xn){i+=e.dx,s+=e.dy,n!=null&&n.bandwidth&&(i+=n.bandwidth()/2),r!=null&&r.bandwidth&&(s+=r.bandwidth()/2),(i||s)&&t.attr("transform",`translate(${i},${s})`)}function hn(t,e){if((t=dr(t))!==e)return t}function Ug(t,e){if((t=Le(t))!==e)return t}const ySt=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/i;function E_(t){if(t===void 0)return"plot-d6a7b5";if(t=`${t}`,!ySt.test(t))throw new Error(`invalid class name: ${t}`);return t}function HI(t,e){if(typeof e=="string")t.property("style",e);else if(e!=null)for(const n of t)Object.assign(n.style,e)}function pa({frameAnchor:t},{width:e,height:n,marginTop:r,marginRight:i,marginBottom:s,marginLeft:o}){return[/left$/.test(t)?o:/right$/.test(t)?e-i:(o+e-i)/2,/^top/.test(t)?r:/^bottom/.test(t)?n-s:(r+n-s)/2]}let Ce=class{constructor(e,n={},r={},i){const{facet:s="auto",facetAnchor:o,fx:a,fy:u,sort:c,dx:l=0,dy:f=0,margin:d=0,marginTop:h=d,marginRight:p=d,marginBottom:g=d,marginLeft:m=d,className:y,clip:b=i==null?void 0:i.clip,channels:w,tip:v,render:x}=r;if(this.data=e,this.sort=Vc(c)?c:null,this.initializer=Vr(r).initializer,this.transform=this.initializer?r.transform:io(r).transform,s===null||s===!1?this.facet=null:(this.facet=zi(s===!0?"include":s,"facet",["auto","include","exclude","super"]),this.fx=e===Jm&&typeof a=="string"?[a]:a,this.fy=e===Jm&&typeof u=="string"?[u]:u),this.facetAnchor=B_t(o),n=TI(n),w!==void 0&&(n={...bSt(w),...n}),i!==void 0&&(n={...iX(this,r,i),...n}),this.channels=Object.fromEntries(Object.entries(n).map(([S,_])=>{if(Ao(_.value)){const{value:E,label:A=_.label,scale:$=_.scale}=_.value;_={..._,label:A,scale:$,value:E}}if(e===Jm&&typeof _.value=="string"){const{value:E}=_;_={..._,value:[E]}}return[S,_]}).filter(([S,{value:_,optional:E}])=>{if(_!=null)return!0;if(E)return!1;throw new Error(`missing channel value: ${S}`)})),this.dx=+l,this.dy=+f,this.marginTop=+h,this.marginRight=+p,this.marginBottom=+g,this.marginLeft=+m,this.clip=gH(b),this.tip=vSt(v),this.className=y?E_(y):null,this.facet==="super"){if(a||u)throw new Error("super-faceting cannot use fx or fy");for(const S in this.channels){const{scale:_}=n[S];if(!(_!=="x"&&_!=="y"))throw new Error("super-faceting cannot use x or y")}}x!=null&&(this.render=up(x,this.render))}initialize(e,n,r){let i=ip(this.data);e===void 0&&i!=null&&(e=[Iu(i)]);const s=e;this.transform!=null&&({facets:e,data:i}=this.transform(i,e,r),i=ip(i)),e!==void 0&&(e.original=s);const o=CH(this.channels,i);return this.sort!=null&&z2t(i,e,o,n,this.sort),{data:i,facets:e,channels:o}}filter(e,n,r){for(const i in n){const{filter:s=Qn}=n[i];if(s!==null){const o=r[i];e=e.filter(a=>s(o[a]))}}return e}project(e,n,r){for(const i in e)if(e[i].scale==="x"&&/^x|x$/.test(i)){const s=i.replace(/^x|x$/,"y");s in e&&e[s].scale==="y"&&tX(i,s,n,r.projection)}}scale(e,n,r){const i=UI(e,n);return r.projection&&this.project(e,i,r),i}};function ms(...t){return t.plot=Ce.prototype.plot,t}function up(t,e){if(t==null)return e===null?void 0:e;if(e==null)return t===null?void 0:t;if(typeof t!="function")throw new TypeError(`invalid render transform: ${t}`);if(typeof e!="function")throw new TypeError(`invalid render transform: ${e}`);return function(n,r,i,s,o,a){return t.call(this,n,r,i,s,o,(u,c,l,f,d)=>e.call(this,u,c,l,f,d,a))}}function bSt(t){return Object.fromEntries(Object.entries(TI(t)).map(([e,n])=>(n=typeof n=="string"?{value:n,label:e}:rg(n),n.filter===void 0&&n.scale==null&&(n={...n,filter:null}),[e,n])))}function vSt(t){return t===!0?"xy":t===!1||t==null?null:typeof t=="string"?zi(t,"tip",["x","y","xy"]):t}function cd(t,e){return(t==null?void 0:t.tip)===!0?{...t,tip:e}:Ss(t==null?void 0:t.tip)&&t.tip.pointer===void 0?{...t,tip:{...t.tip,pointer:e}}:t}function wSt(t,e,n={}){let r=.5-Xn,i=.5+Xn,s=.5+Xn,o=.5-Xn;for(const{marginTop:g,marginRight:m,marginBottom:y,marginLeft:b}of e)g>r&&(r=g),m>i&&(i=m),y>s&&(s=y),b>o&&(o=b);let{margin:a,marginTop:u=a!==void 0?a:r,marginRight:c=a!==void 0?a:i,marginBottom:l=a!==void 0?a:s,marginLeft:f=a!==void 0?a:o}=n;u=+u,c=+c,l=+l,f=+f;let{width:d=640,height:h=xSt(t,n,{width:d,marginTopDefault:r,marginRightDefault:i,marginBottomDefault:s,marginLeftDefault:o})+Math.max(0,u-r+l-s)}=n;d=+d,h=+h;const p={width:d,height:h,marginTop:u,marginRight:c,marginBottom:l,marginLeft:f};if(t.fx||t.fy){let{margin:g,marginTop:m=g!==void 0?g:u,marginRight:y=g!==void 0?g:c,marginBottom:b=g!==void 0?g:l,marginLeft:w=g!==void 0?g:f}=n.facet??{};m=+m,y=+y,b=+b,w=+w,p.facet={marginTop:m,marginRight:y,marginBottom:b,marginLeft:w}}return p}function xSt({x:t,y:e,fy:n,fx:r},{projection:i,aspectRatio:s},{width:o,marginTopDefault:a,marginRightDefault:u,marginBottomDefault:c,marginLeftDefault:l}){const f=n&&n.scale.domain().length||1,d=X_t(i);if(d){const p=r?r.scale.domain().length:1,g=(1.1*f-.1)/(1.1*p-.1)*d,m=Math.max(.1,Math.min(10,g));return Math.round((o-l-u)*m+a+c)}const h=e?ud(e)?e.scale.domain().length||1:Math.max(7,17/f):1;if(s!=null){if(s=+s,!(isFinite(s)&&s>0))throw new Error(`invalid aspectRatio: ${s}`);const p=v4("y",e)/(v4("x",t)*s),g=r?r.scale.bandwidth():1,m=n?n.scale.bandwidth():1,y=g*(o-l-u)-t.insetLeft-t.insetRight;return(p*y+e.insetTop+e.insetBottom)/m+a+c}return!!(e||n)*Math.max(1,Math.min(60,h*f))*20+!!r*30+60}function v4(t,e){if(!e)throw new Error(`aspectRatio requires ${t} scale`);const{type:n,domain:r}=e;let i;switch(n){case"linear":case"utc":case"time":i=Number;break;case"pow":{const a=e.scale.exponent();i=u=>Math.pow(u,a);break}case"log":i=Math.log;break;case"point":case"band":return r.length;default:throw new Error(`unsupported ${t} scale for aspectRatio: ${n}`)}const[s,o]=pn(r);return Math.abs(i(o)-i(s))}const w4=new WeakMap;function XI(t,e,{x:n,y:r,px:i,py:s,maxRadius:o=40,channels:a,render:u,...c}={}){return o=+o,i!=null&&(n??(n=null),a={...a,px:{value:i,scale:"x"}}),s!=null&&(r??(r=null),a={...a,py:{value:s,scale:"y"}}),{x:n,y:r,channels:a,...c,render:up(function(l,f,d,h,p,g){p={...p,pointerSticky:!1};const m=p.ownerSVGElement,{data:y}=p.getMarkState(this);let b=w4.get(m);b||w4.set(m,b={sticky:!1,roots:[],renders:[]});let w=b.renders.push(G)-1;const{x:v,y:x,fx:S,fy:_}=f;let E=S?S(l.fx)-h.marginLeft:0,A=_?_(l.fy)-h.marginTop:0;v!=null&&v.bandwidth&&(E+=v.bandwidth()/2),x!=null&&x.bandwidth&&(A+=x.bandwidth()/2);const $=l.fi!=null;let T;if($){let et=b.facetStates;et||(b.facetStates=et=new Map),T=et.get(this),T||et.set(this,T=new Map)}const[C,F]=pa(this,h),{px:M,py:k}=d,I=M?et=>M[et]:uX(d,C),N=k?et=>k[et]:cX(d,F);let R,D,L,P;function B(et,ut){if($)if(P&&(P=cancelAnimationFrame(P)),et==null)T.delete(l.fi);else{T.set(l.fi,ut),P=requestAnimationFrame(()=>{P=null;for(const[V,rt]of T)if(rt<ut||rt===ut&&V<l.fi){et=null;break}G(et)});return}G(et)}function G(et){if(R===et&&L===b.sticky)return;R=et,L=p.pointerSticky=b.sticky;const ut=R==null?[]:[R];$&&(ut.fx=l.fx,ut.fy=l.fy,ut.fi=l.fi);const V=g(ut,f,d,h,p);if(D){if($){const rt=D.parentNode,dt=D.getAttribute("transform"),q=V.getAttribute("transform");dt?V.setAttribute("transform",dt):V.removeAttribute("transform"),q?rt.setAttribute("transform",q):rt.removeAttribute("transform"),V.removeAttribute("aria-label"),V.removeAttribute("aria-description"),V.removeAttribute("aria-hidden")}D.replaceWith(V)}if(b.roots[w]=D=V,!(R==null&&(T==null?void 0:T.size)>1)){const rt=R==null?null:Cu(y)?y[R]:y.get(R);p.dispatchValue(rt)}return V}function ct(et){if(b.sticky||et.pointerType==="mouse"&&et.buttons===1)return;let[ut,V]=L3(et);ut-=E,V-=A;const rt=ut<h.marginLeft||ut>h.width-h.marginRight?1:t,dt=V<h.marginTop||V>h.height-h.marginBottom?1:e;let q=null,Ot=o*o;for(const yt of l){const Wt=rt*(I(yt)-ut),qt=dt*(N(yt)-V),ht=Wt*Wt+qt*qt;ht<=Ot&&(q=yt,Ot=ht)}if(q!=null&&(t!==1||e!==1)){const yt=I(q)-ut,Wt=N(q)-V;Ot=yt*yt+Wt*Wt}B(q,Ot)}function Z(et){et.pointerType==="mouse"&&R!=null&&(b.sticky&&b.roots.some(ut=>ut==null?void 0:ut.contains(et.target))||(b.sticky?(b.sticky=!1,b.renders.forEach(ut=>ut(null))):(b.sticky=!0,G(R)),et.stopImmediatePropagation()))}function lt(et){et.pointerType==="mouse"&&(b.sticky||B(null))}return m.addEventListener("pointerenter",ct),m.addEventListener("pointermove",ct),m.addEventListener("pointerdown",Z),m.addEventListener("pointerleave",lt),G(null)},u)}}function A_(t){return XI(1,1,t)}function $_(t){return XI(1,.01,t)}function z0(t){return XI(.01,1,t)}function uX({x1:t,x2:e,x:n=t},r){return t&&e?i=>(t[i]+e[i])/2:n?i=>n[i]:()=>r}function cX({y1:t,y2:e,y:n=t},r){return t&&e?i=>(t[i]+e[i])/2:n?i=>n[i]:()=>r}function lX(t){return ud(t)&&t.interval===void 0?void 0:"tabular-nums"}function _St(t,e){let{label:n=t.label,tickSize:r=6,width:i=240,height:s=44+r,marginTop:o=18,marginRight:a=0,marginBottom:u=16+r,marginLeft:c=0,style:l,ticks:f=(i-c-a)/64,tickFormat:d,fontVariant:h=lX(t),round:p=!0,opacity:g,className:m}=e;const y=S_(e);m=E_(m),g=cn(g)[1],d===null&&(d=()=>null);const b=ne("svg",y).attr("class",`${m}-ramp`).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",i).attr("height",s).attr("viewBox",`0 0 ${i} ${s}`).call(C=>C.append("style").text(`:where(.${m}-ramp) {
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
  overflow: visible;
}
:where(.${m}-ramp text) {
  white-space: pre;
}`)).call(HI,l);let w=C=>C.selectAll(".tick line").attr("y1",o+u-s),v;const x=p?(C,F)=>C.rangeRound(F):(C,F)=>C.range(F),{type:S,domain:_,range:E,interpolate:A,scale:$,pivot:T}=t;if(A){const C=E===void 0?A:Yp(A.length===1?WI(A):A,E);v=x($.copy(),fs(qn(c,i-a),Math.min(_.length+(T!==void 0),E===void 0?1/0:E.length)));const F=256,M=y.document.createElement("canvas");M.width=F,M.height=1;const k=M.getContext("2d");for(let I=0,N=F-1;I<F;++I)k.fillStyle=C(I/N),k.fillRect(I,0,1,1);b.append("image").attr("opacity",g).attr("x",c).attr("y",o).attr("width",i-c-a).attr("height",s-o-u).attr("preserveAspectRatio","none").attr("xlink:href",M.toDataURL())}else if(S==="threshold"){const C=_,F=d===void 0?M=>M:typeof d=="string"?id(d):d;v=x(J2().domain([-1,E.length-1]),[c,i-a]),b.append("g").attr("fill-opacity",g).selectAll().data(E).enter().append("rect").attr("x",(M,k)=>v(k-1)).attr("y",o).attr("width",(M,k)=>v(k)-v(k-1)).attr("height",s-o-u).attr("fill",M=>M),f=Te(C,(M,k)=>k),d=M=>F(C[M],M)}else v=x(K2().domain(_),[c,i-a]),b.append("g").attr("fill-opacity",g).selectAll().data(_).enter().append("rect").attr("x",v).attr("y",o).attr("width",Math.max(0,v.bandwidth()-1)).attr("height",s-o-u).attr("fill",$),w=()=>{};return b.append("g").attr("transform",`translate(0,${s-u})`).call(tgt(v).ticks(Array.isArray(f)?null:f,typeof d=="string"?d:void 0).tickFormat(typeof d=="function"?d:void 0).tickSize(r).tickValues(Array.isArray(f)?f:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",hn(h,"normal")).call(w).call(C=>C.select(".domain").remove()),n!==void 0&&b.append("text").attr("x",c).attr("y",o-6).attr("fill","currentColor").attr("font-weight","bold").text(n),b.node()}const yx=Math.PI/180;function ig(t,{marker:e,markerStart:n=e,markerMid:r=e,markerEnd:i=e}={}){t.markerStart=RA(n),t.markerMid=RA(r),t.markerEnd=RA(i)}function RA(t){if(t==null||t===!1)return null;if(t===!0)return _4;if(typeof t=="function")return t;switch(`${t}`.toLowerCase()){case"none":return null;case"arrow":return x4("auto");case"arrow-reverse":return x4("auto-start-reverse");case"dot":return SSt;case"circle":case"circle-fill":return _4;case"circle-stroke":return ESt;case"tick":return DA("auto");case"tick-x":return DA(90);case"tick-y":return DA(0)}throw new Error(`invalid marker: ${t}`)}function x4(t){return(e,n)=>ne("svg:marker",n).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("orient",t).attr("fill","none").attr("stroke",e).attr("stroke-width",1.5).attr("stroke-linecap","round").attr("stroke-linejoin","round").call(r=>r.append("path").attr("d","M-1.5,-3l3,3l-3,3")).node()}function SSt(t,e){return ne("svg:marker",e).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",t).attr("stroke","none").call(n=>n.append("circle").attr("r",2.5)).node()}function _4(t,e){return ne("svg:marker",e).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",t).attr("stroke","var(--plot-background)").attr("stroke-width",1.5).call(n=>n.append("circle").attr("r",3)).node()}function ESt(t,e){return ne("svg:marker",e).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill","var(--plot-background)").attr("stroke",t).attr("stroke-width",1.5).call(n=>n.append("circle").attr("r",3)).node()}function DA(t){return(e,n)=>ne("svg:marker",n).attr("viewBox","-3 -3 6 6").attr("markerWidth",6).attr("markerHeight",6).attr("orient",t).attr("stroke",e).call(r=>r.append("path").attr("d","M0,-3v6")).node()}let ASt=0;function Uy(t,e,{stroke:n},r){return dX(t,e,n&&(i=>n[i]),null,r)}function $St(t,e,{stroke:n,z:r},i){return dX(t,e,n&&(([s])=>n[s]),r,i)}const OT=1,fX=2;function TSt(t,e){const n=new Uint8Array(e.length),r=t.data().filter(s=>s.length>1),i=r.length;for(let s=0,o=NT;s<i;++s){const a=r[s];if(a.length>1){const u=a[0];o!==(o=tu(e[u]))&&(n[u]|=OT)}}for(let s=i-1,o=NT;s>=0;--s){const a=r[s];if(a.length>1){const u=a[0];o!==(o=tu(e[u]))&&(n[u]|=fX)}}return([s])=>n[s]}function dX(t,{markerStart:e,markerMid:n,markerEnd:r,stroke:i},s=()=>i,o,a){if(!e&&!n&&!r)return;const u=new Map,c=o&&TSt(t,o);function l(f,d,h){return function(p){if(h&&!h(p))return;const g=s(p);let m=u.get(d);m||u.set(d,m=new Map);let y=m.get(g);if(!y){const b=this.parentNode.insertBefore(d(g,a),this),w=`plot-marker-${++ASt}`;b.setAttribute("id",w),m.set(g,y=`url(#${w})`)}this.setAttribute(f,y)}}e&&t.each(l("marker-start",e,c&&(f=>c(f)&OT))),n&&c&&t.each(l("marker-start",n,f=>!(c(f)&OT))),n&&t.each(l("marker-mid",n)),r&&t.each(l("marker-end",r,c&&(f=>c(f)&fX)))}function jy({inset:t,insetLeft:e,insetRight:n,...r}={}){return[e,n]=hX(t,e,n),{inset:t,insetLeft:e,insetRight:n,...r}}function qy({inset:t,insetTop:e,insetBottom:n,...r}={}){return[e,n]=hX(t,e,n),{inset:t,insetTop:e,insetBottom:n,...r}}function hX(t,e,n){return t===void 0&&e===void 0&&n===void 0?Xn?[1,0]:[.5,.5]:[e,n]}function pX(t,{interval:e}){return t={...rg(t)},t.interval=g_(t.interval===void 0?e:t.interval),t}function T_(t,e,n,r){const{[t]:i,[`${t}1`]:s,[`${t}2`]:o}=n,{value:a,interval:u}=pX(i,n);if(a==null||u==null&&!r)return n;const c=ha(i);if(u==null){let h;const p={transform:g=>h||(h=Kt(g,a)),label:c};return{...n,[t]:void 0,[`${t}1`]:s===void 0?p:s,[`${t}2`]:o===void 0&&!(s===o&&r)?p:o}}let l,f;function d(h){return f!==void 0&&h===l?f:f=Te(Kt(l=h,a),p=>u.floor(p))}return e({...n,[t]:void 0,[`${t}1`]:s===void 0?{transform:d,label:c}:s,[`${t}2`]:o===void 0?{transform:h=>d(h).map(p=>u.offset(p)),label:c}:o})}function gX(t,e,n){const{[t]:r}=n,{value:i,interval:s}=pX(r,n);return i==null||s==null?n:e({...n,[t]:{label:ha(r),transform:o=>{const a=Te(Kt(o,i),c=>s.floor(c)),u=a.map(c=>s.offset(c));return a.map(Wr(a)?(c,l)=>c==null||isNaN(c=+c)||(l=u[l],l==null)||isNaN(l=+l)?void 0:new Date((c+l)/2):(c,l)=>c==null||(l=u[l],l==null)?NaN:(+c+ +l)/2)}}})}function mX(t={}){return T_("x",jy,t,!0)}function yX(t={}){return T_("y",qy,t,!0)}function KI(t={}){return T_("x",jy,t)}function QI(t={}){return T_("y",qy,t)}function bX(t={}){return gX("x",jy,t)}function vX(t={}){return gX("y",qy,t)}const wX={ariaLabel:"rule",fill:null,stroke:"currentColor"};class xX extends Ce{constructor(e,n={}){const{x:r,y1:i,y2:s,inset:o=0,insetTop:a=o,insetBottom:u=o}=n;super(e,{x:{value:r,scale:"x",optional:!0},y1:{value:i,scale:"y",optional:!0},y2:{value:s,scale:"y",optional:!0}},cd(n,"x"),wX),this.insetTop=Le(a),this.insetBottom=Le(u),ig(this,n)}render(e,n,r,i,s){const{x:o,y:a}=n,{x:u,y1:c,y2:l}=r,{width:f,height:d,marginTop:h,marginRight:p,marginLeft:g,marginBottom:m}=i,{insetTop:y,insetBottom:b}=this;return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,{x:u&&o},Xn,0).call(w=>w.selectAll().data(e).enter().append("line").call(Se,this).attr("x1",u?v=>u[v]:(g+f-p)/2).attr("x2",u?v=>u[v]:(g+f-p)/2).attr("y1",c&&!Zo(a)?v=>c[v]+y:h+y).attr("y2",l&&!Zo(a)?a.bandwidth?v=>l[v]+a.bandwidth()-b:v=>l[v]-b:d-m-b).call(sn,this,r).call(Uy,this,r,s)).node()}}class _X extends Ce{constructor(e,n={}){const{x1:r,x2:i,y:s,inset:o=0,insetRight:a=o,insetLeft:u=o}=n;super(e,{y:{value:s,scale:"y",optional:!0},x1:{value:r,scale:"x",optional:!0},x2:{value:i,scale:"x",optional:!0}},cd(n,"y"),wX),this.insetRight=Le(a),this.insetLeft=Le(u),ig(this,n)}render(e,n,r,i,s){const{x:o,y:a}=n,{y:u,x1:c,x2:l}=r,{width:f,height:d,marginTop:h,marginRight:p,marginLeft:g,marginBottom:m}=i,{insetLeft:y,insetRight:b}=this;return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,{y:u&&a},0,Xn).call(w=>w.selectAll().data(e).enter().append("line").call(Se,this).attr("x1",c&&!Zo(o)?v=>c[v]+y:g+y).attr("x2",l&&!Zo(o)?o.bandwidth?v=>l[v]+o.bandwidth()-b:v=>l[v]-b:f-p-b).attr("y1",u?v=>u[v]:(h+d-m)/2).attr("y2",u?v=>u[v]:(h+d-m)/2).call(sn,this,r).call(Uy,this,r,s)).node()}}function Gc(t,e){let{x:n=St,y:r,y1:i,y2:s,...o}=QI(e);return[i,s]=SX(r,i,s),new xX(t,{...o,x:n,y1:i,y2:s})}function Yc(t,e){let{y:n=St,x:r,x1:i,x2:s,...o}=KI(e);return[i,s]=SX(r,i,s),new _X(t,{...o,y:n,x1:i,x2:s})}function SX(t,e,n){if(t==null){if(e===void 0){if(n!==void 0)return[0,n]}else if(n===void 0)return[0,e]}else{if(e===void 0)return n===void 0?[0,t]:[t,n];if(n===void 0)return[t,e]}return[e,n]}function cp(t,...e){let n=e.length;for(let r=0,i=!0;r<n;++r)typeof e[r]!="function"&&(i&&(t=t.slice(),i=!1),t.splice(r,2,t[r]+e[r]+t[r+1]),e.splice(r,1),--r,--n);return r=>{let i=t[0];for(let s=0;s<n;++s)i+=e[s](r)+t[s+1];return i}}const kSt={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"},EX="";class k_ extends Ce{constructor(e,n={}){const{x:r,y:i,text:s=Fu(e)&&pH(e)?St:Ln,frameAnchor:o,textAnchor:a=/right$/i.test(o)?"end":/left$/i.test(o)?"start":"middle",lineAnchor:u=/^top/i.test(o)?"top":/^bottom/i.test(o)?"bottom":"middle",lineHeight:c=1,lineWidth:l=1/0,textOverflow:f,monospace:d,fontFamily:h=d?"ui-monospace, monospace":void 0,fontSize:p,fontStyle:g,fontVariant:m,fontWeight:y,rotate:b}=n,[w,v]=cn(b,0),[x,S]=FSt(p);if(super(e,{x:{value:r,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},fontSize:{value:x,optional:!0},rotate:{value:c2t(w),optional:!0},text:{value:s,filter:yI,optional:!0}},n,kSt),this.rotate=v,this.textAnchor=hn(a,"middle"),this.lineAnchor=zi(u,"lineAnchor",["top","middle","bottom"]),this.lineHeight=+c,this.lineWidth=+l,this.textOverflow=AX(f),this.monospace=!!d,this.fontFamily=dr(h),this.fontSize=S,this.fontStyle=dr(g),this.fontVariant=dr(m),this.fontWeight=dr(y),this.frameAnchor=Oy(o),!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${l}`);this.splitLines=MX(this),this.clipLine=CX(this)}render(e,n,r,i,s){const{x:o,y:a}=n,{x:u,y:c,rotate:l,text:f,title:d,fontSize:h}=r,{rotate:p}=this,[g,m]=pa(this,i);return ne("svg:g",s).call(Pe,this,i,s).call(kX,this,f,i).call(Me,this,{x:u&&o,y:c&&a}).call(y=>y.selectAll().data(e).enter().append("text").call(Se,this).call(MSt,this,f,d).attr("transform",cp`translate(${u?b=>u[b]:g},${c?b=>c[b]:m})${l?b=>` rotate(${l[b]})`:p?` rotate(${p})`:""}`).call(Et,"font-size",h&&(b=>h[b])).call(sn,this,r)).node()}}function AX(t){return t==null?null:zi(t,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}function MSt(t,e,n,r){if(!n)return;const{lineAnchor:i,lineHeight:s,textOverflow:o,splitLines:a,clipLine:u}=e;t.each(function(c){const l=a(ap(n[c])??"").map(u),f=l.length,d=i==="top"?.71:i==="bottom"?1-f:(164-f*100)/200;if(f>1){let h=0;for(let p=0;p<f;++p){if(++h,!l[p])continue;const g=this.ownerDocument.createElementNS(gu.svg,"tspan");g.setAttribute("x",0),p===h-1?g.setAttribute("y",`${(d+p)*s}em`):g.setAttribute("dy",`${h*s}em`),g.textContent=l[p],this.appendChild(g),h=0}}else d&&this.setAttribute("y",`${d*s}em`),this.textContent=l[0];if(o&&!r&&l[0]!==n[c]){const h=this.ownerDocument.createElementNS(gu.svg,"title");h.textContent=n[c],this.appendChild(h)}})}function lp(t,{x:e,y:n,...r}={}){return r.frameAnchor===void 0&&([e,n]=ro(e,n)),new k_(t,{...r,x:e,y:n})}function $X(t,{x:e=St,...n}={}){return new k_(t,vX({...n,x:e}))}function TX(t,{y:e=St,...n}={}){return new k_(t,bX({...n,y:e}))}function kX(t,e,n){Et(t,"text-anchor",e.textAnchor),Et(t,"font-family",e.fontFamily),Et(t,"font-size",e.fontSize),Et(t,"font-style",e.fontStyle),Et(t,"font-variant",e.fontVariant===void 0?CSt(n):e.fontVariant),Et(t,"font-weight",e.fontWeight)}function CSt(t){return t&&(gh(t)||Wr(t))?"tabular-nums":void 0}const ISt=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]);function FSt(t){return t==null||typeof t=="number"?[void 0,t]:typeof t!="string"?[t,void 0]:(t=t.trim().toLowerCase(),ISt.has(t)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(t)?[void 0,t]:[t,void 0])}function NSt(t,e,n){const r=[];let i,s=0;for(const[o,a,u]of OSt(t)){if(i===void 0&&(i=o),s>i&&n(t,i,a)>e&&(r.push(t.slice(i,s)+(t[s-1]===EX?"-":"")),i=o),u){r.push(t.slice(i,a)),i=void 0;continue}s=a}return r}function*OSt(t){let e=0,n=0;const r=t.length;for(;n<r;){let i=1;switch(t[n]){case EX:case"-":++n,yield[e,n,!1],e=n;break;case" ":for(yield[e,n,!1];t[++n]===" ";);e=n;break;case"\r":t[n+1]===`
`&&++i;case`
`:yield[e,n,!0],n+=i,e=n;break;default:++n;break}}yield[e,n,!0]}const S4={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"":31,"":31,"":47,"":47,"":82};function JI(t,e=0,n=t.length){let r=0;for(let i=e;i<n;i=sg(t,i))r+=S4[t[i]]??(FX(t,i)?120:S4.e);return r}function ZI(t,e=0,n=t.length){let r=0;for(let i=e;i<n;i=sg(t,i))r+=FX(t,i)?126:63;return r}function MX({monospace:t,lineWidth:e,textOverflow:n}){if(n!=null||e==1/0)return s=>s.split(/\r\n?|\n/g);const r=t?ZI:JI,i=e*100;return s=>NSt(s,i,r)}function CX({monospace:t,lineWidth:e,textOverflow:n}){if(n==null||e==1/0)return s=>s;const r=t?ZI:JI,i=e*100;switch(n){case"clip-start":return s=>A4(s,i,r,"");case"clip-end":return s=>E4(s,i,r,"");case"ellipsis-start":return s=>A4(s,i,r,Nh);case"ellipsis-middle":return s=>RSt(s,i,r,Nh);case"ellipsis-end":return s=>E4(s,i,r,Nh)}}const Nh="";function fp(t,e,n,r){const i=[];let s=0;for(let o=0,a=0,u=t.length;o<u;o=a){a=sg(t,o);const c=n(t,o,a);if(s+c>e){for(s+=r;s>e&&o>0;)a=o,o=i.pop(),s-=n(t,o,a);return[o,e-s]}s+=c,i.push(o)}return[-1,0]}function E4(t,e,n,r){t=t.trim();const i=n(r),[s]=fp(t,e,n,i);return s<0?t:t.slice(0,s).trimEnd()+r}function RSt(t,e,n,r){t=t.trim();const i=n(t);if(i<=e)return t;const s=n(r)/2,[o,a]=fp(t,e/2,n,s),[u]=fp(t,i-e/2-a+s,n,-s);return u<0?r:t.slice(0,o).trimEnd()+r+t.slice(sg(t,u)).trimStart()}function A4(t,e,n,r){t=t.trim();const i=n(t);if(i<=e)return t;const s=n(r),[o]=fp(t,i-e+s,n,-s);return o<0?r:r+t.slice(sg(t,o)).trimStart()}const RT=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy,$4=new RegExp("\\p{Extended_Pictographic}","uy");function sg(t,e){return e+=DSt(t,e)?2:1,BSt(t,e)&&(e=RT.lastIndex),LSt(t,e)?sg(t,e+1):e}function IX(t,e){return t.charCodeAt(e)<128}function DSt(t,e){const n=t.charCodeAt(e);if(n>=55296&&n<56320){const r=t.charCodeAt(e+1);return r>=56320&&r<57344}return!1}function LSt(t,e){return t.charCodeAt(e)===8205}function BSt(t,e){return IX(t,e)?!1:(RT.lastIndex=e,RT.test(t))}function FX(t,e){return IX(t,e)?!1:($4.lastIndex=e,$4.test(t))}const NX={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"},OX=3.5,PSt=OX*5,RX={draw(t,e,n){const r=e*n/PSt;t.moveTo(0,0),t.lineTo(0,-e),t.moveTo(-r,r-e),t.lineTo(0,-e),t.lineTo(r,r-e)}},DX={draw(t,e,n){t.moveTo(-n,0),t.lineTo(0,-e),t.lineTo(n,0)}},zSt=new Map([["arrow",RX],["spike",DX]]);function USt(t){return t&&typeof t.draw=="function"}function jSt(t){if(USt(t))return t;const e=zSt.get(`${t}`.toLowerCase());if(e)return e;throw new Error(`invalid shape: ${t}`)}class M_ extends Ce{constructor(e,n={}){const{x:r,y:i,r:s=OX,length:o,rotate:a,shape:u=RX,anchor:c="middle",frameAnchor:l}=n,[f,d]=cn(o,12),[h,p]=cn(a,0);super(e,{x:{value:r,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},length:{value:f,scale:"length",optional:!0},rotate:{value:h,optional:!0}},n,NX),this.r=+s,this.length=d,this.rotate=p,this.shape=jSt(u),this.anchor=zi(c,"anchor",["start","middle","end"]),this.frameAnchor=Oy(l)}render(e,n,r,i,s){const{x:o,y:a}=n,{x:u,y:c,length:l,rotate:f}=r,{length:d,rotate:h,anchor:p,shape:g,r:m}=this,[y,b]=pa(this,i);return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,{x:u&&o,y:c&&a}).call(w=>w.selectAll().data(e).enter().append("path").call(Se,this).attr("transform",cp`translate(${u?v=>u[v]:y},${c?v=>c[v]:b})${f?v=>` rotate(${f[v]})`:h?` rotate(${h})`:""}${p==="start"?"":p==="end"?l?v=>` translate(0,${l[v]})`:` translate(0,${d})`:l?v=>` translate(0,${l[v]/2})`:` translate(0,${d/2})`}`).attr("d",l?v=>{const x=Qa();return g.draw(x,l[v],m),x}:(()=>{const v=Qa();return g.draw(v,d,m),v})()).call(sn,this,r)).node()}}function LX(t,e={}){let{x:n,y:r,...i}=e;return e.frameAnchor===void 0&&([n,r]=ro(n,r)),new M_(t,{...i,x:n,y:r})}function BX(t,e={}){const{x:n=St,...r}=e;return new M_(t,{...r,x:n})}function PX(t,e={}){const{y:n=St,...r}=e;return new M_(t,{...r,y:n})}function qSt(t,e={}){const{shape:n=DX,stroke:r=NX.stroke,strokeWidth:i=1,fill:s=r,fillOpacity:o=.3,anchor:a="start",...u}=e;return LX(t,{...u,shape:n,stroke:r,strokeWidth:i,fill:s,fillOpacity:o,anchor:a})}function hl(t,e){return arguments.length<2&&!Fu(t)&&(e=t,t=null),e===void 0&&(e={}),[t,e]}function C_({anchor:t}={},e){return t===void 0?e[0]:zi(t,"anchor",e)}function zX(t){return C_(t,["left","right"])}function UX(t){return C_(t,["right","left"])}function jX(t){return C_(t,["bottom","top"])}function qX(t){return C_(t,["top","bottom"])}function tF(){const[t,e]=hl(...arguments);return GX("y",zX(e),t,e)}function WX(){const[t,e]=hl(...arguments);return GX("fy",UX(e),t,e)}function eF(){const[t,e]=hl(...arguments);return YX("x",jX(e),t,e)}function VX(){const[t,e]=hl(...arguments);return YX("fx",qX(e),t,e)}function GX(t,e,n,{color:r="currentColor",opacity:i=1,stroke:s=r,strokeOpacity:o=i,strokeWidth:a=1,fill:u=r,fillOpacity:c=i,textAnchor:l,textStroke:f,textStrokeOpacity:d,textStrokeWidth:h,tickSize:p=t==="y"?6:0,tickPadding:g,tickRotate:m,x:y,margin:b,marginTop:w=b===void 0?20:b,marginRight:v=b===void 0?e==="right"?40:0:b,marginBottom:x=b===void 0?20:b,marginLeft:S=b===void 0?e==="left"?40:0:b,label:_,labelAnchor:E,labelArrow:A,labelOffset:$,...T}){return p=Le(p),g=Le(g),m=Le(m),E!==void 0&&(E=zi(E,"labelAnchor",["center","top","bottom"])),A=sK(A),ms(p&&!je(s)?WSt(t,e,n,{stroke:s,strokeOpacity:o,strokeWidth:a,tickSize:p,tickPadding:g,tickRotate:m,x:y,...T}):null,je(u)?null:GSt(t,e,n,{fill:u,fillOpacity:c,stroke:f,strokeOpacity:d,strokeWidth:h,textAnchor:l,tickSize:p,tickPadding:g,tickRotate:m,x:y,marginTop:w,marginRight:v,marginBottom:x,marginLeft:S,...T}),!je(u)&&_!==null?lp([],eK({fill:u,fillOpacity:c,...T},function(C,F,M,k,I){const N=k[t],{marginTop:R,marginRight:D,marginBottom:L,marginLeft:P}=t==="y"&&I.inset||I,B=E??(N.bandwidth?"center":"top"),G=$??(e==="right"?D:P)-3;return B==="center"?(this.textAnchor=void 0,this.lineAnchor=e==="right"?"bottom":"top",this.frameAnchor=e,this.rotate=-90):(this.textAnchor=e==="right"?"end":"start",this.lineAnchor=B,this.frameAnchor=`${B}-${e}`,this.rotate=0),this.dy=B==="top"?3-R:B==="bottom"?L-3:0,this.dx=e==="right"?G:-G,this.ariaLabel=`${t}-axis label`,{facets:[[0]],channels:{text:{value:[iK(t,N,{anchor:e,label:_,labelAnchor:B,labelArrow:A})]}}}})):null)}function YX(t,e,n,{color:r="currentColor",opacity:i=1,stroke:s=r,strokeOpacity:o=i,strokeWidth:a=1,fill:u=r,fillOpacity:c=i,textAnchor:l,textStroke:f,textStrokeOpacity:d,textStrokeWidth:h,tickSize:p=t==="x"?6:0,tickPadding:g,tickRotate:m,y,margin:b,marginTop:w=b===void 0?e==="top"?30:0:b,marginRight:v=b===void 0?20:b,marginBottom:x=b===void 0?e==="bottom"?30:0:b,marginLeft:S=b===void 0?20:b,label:_,labelAnchor:E,labelArrow:A,labelOffset:$,...T}){return p=Le(p),g=Le(g),m=Le(m),E!==void 0&&(E=zi(E,"labelAnchor",["center","left","right"])),A=sK(A),ms(p&&!je(s)?VSt(t,e,n,{stroke:s,strokeOpacity:o,strokeWidth:a,tickSize:p,tickPadding:g,tickRotate:m,y,...T}):null,je(u)?null:YSt(t,e,n,{fill:u,fillOpacity:c,stroke:f,strokeOpacity:d,strokeWidth:h,textAnchor:l,tickSize:p,tickPadding:g,tickRotate:m,y,marginTop:w,marginRight:v,marginBottom:x,marginLeft:S,...T}),!je(u)&&_!==null?lp([],eK({fill:u,fillOpacity:c,...T},function(C,F,M,k,I){const N=k[t],{marginTop:R,marginRight:D,marginBottom:L,marginLeft:P}=t==="x"&&I.inset||I,B=E??(N.bandwidth?"center":"right"),G=$??(e==="top"?R:L)-3;return B==="center"?(this.frameAnchor=e,this.textAnchor=void 0):(this.frameAnchor=`${e}-${B}`,this.textAnchor=B==="right"?"end":"start"),this.lineAnchor=e,this.dy=e==="top"?-G:G,this.dx=B==="right"?D-3:B==="left"?3-P:0,this.ariaLabel=`${t}-axis label`,{facets:[[0]],channels:{text:{value:[iK(t,N,{anchor:e,label:_,labelAnchor:B,labelArrow:A})]}}}})):null)}function WSt(t,e,n,{strokeWidth:r=1,strokeLinecap:i=null,strokeLinejoin:s=null,facetAnchor:o=e+(t==="y"?"-empty":""),frameAnchor:a=e,tickSize:u,inset:c=0,insetLeft:l=c,insetRight:f=c,dx:d=0,y:h=t==="y"?void 0:null,...p}){return og(PX,t,n,{ariaLabel:`${t}-axis tick`,ariaHidden:!0},{strokeWidth:r,strokeLinecap:i,strokeLinejoin:s,facetAnchor:o,frameAnchor:a,y:h,...p,dx:e==="left"?+d-Xn+ +l:+d+Xn-f,anchor:"start",length:u,shape:e==="left"?QSt:JSt})}function VSt(t,e,n,{strokeWidth:r=1,strokeLinecap:i=null,strokeLinejoin:s=null,facetAnchor:o=e+(t==="x"?"-empty":""),frameAnchor:a=e,tickSize:u,inset:c=0,insetTop:l=c,insetBottom:f=c,dy:d=0,x:h=t==="x"?void 0:null,...p}){return og(BX,t,n,{ariaLabel:`${t}-axis tick`,ariaHidden:!0},{strokeWidth:r,strokeLinejoin:s,strokeLinecap:i,facetAnchor:o,frameAnchor:a,x:h,...p,dy:e==="bottom"?+d-Xn-f:+d+Xn+ +l,anchor:"start",length:u,shape:e==="bottom"?XSt:KSt})}function GSt(t,e,n,{facetAnchor:r=e+(t==="y"?"-empty":""),frameAnchor:i=e,tickSize:s,tickRotate:o=0,tickPadding:a=Math.max(3,9-s)+(Math.abs(o)>60?4*Math.cos(o*yx):0),text:u,textAnchor:c=Math.abs(o)>60?"middle":e==="left"?"end":"start",lineAnchor:l=o>60?"top":o<-60?"bottom":"middle",fontVariant:f,inset:d=0,insetLeft:h=d,insetRight:p=d,dx:g=0,y:m=t==="y"?void 0:null,...y}){return og(TX,t,n,{ariaLabel:`${t}-axis tick label`},{facetAnchor:r,frameAnchor:i,text:u,textAnchor:c,lineAnchor:l,fontVariant:f,rotate:o,y:m,...y,dx:e==="left"?+g-s-a+ +h:+g+ +s+ +a-p},function(b,w,v,x,S){f===void 0&&(this.fontVariant=rK(b)),u===void 0&&(S.text=nK(b,w,v,x,e))})}function YSt(t,e,n,{facetAnchor:r=e+(t==="x"?"-empty":""),frameAnchor:i=e,tickSize:s,tickRotate:o=0,tickPadding:a=Math.max(3,9-s)+(Math.abs(o)>=10?4*Math.cos(o*yx):0),text:u,textAnchor:c=Math.abs(o)>=10?o<0^e==="bottom"?"start":"end":"middle",lineAnchor:l=Math.abs(o)>=10?"middle":e==="bottom"?"top":"bottom",fontVariant:f,inset:d=0,insetTop:h=d,insetBottom:p=d,dy:g=0,x:m=t==="x"?void 0:null,...y}){return og($X,t,n,{ariaLabel:`${t}-axis tick label`},{facetAnchor:r,frameAnchor:i,text:u===void 0?null:u,textAnchor:c,lineAnchor:l,fontVariant:f,rotate:o,x:m,...y,dy:e==="bottom"?+g+ +s+ +a-p:+g-s-a+ +h},function(b,w,v,x,S){f===void 0&&(this.fontVariant=rK(b)),u===void 0&&(S.text=nK(b,w,v,x,e))})}function HX(){const[t,e]=hl(...arguments);return JX("y",zX(e),t,e)}function XX(){const[t,e]=hl(...arguments);return JX("fy",UX(e),t,e)}function KX(){const[t,e]=hl(...arguments);return ZX("x",jX(e),t,e)}function QX(){const[t,e]=hl(...arguments);return ZX("fx",qX(e),t,e)}function JX(t,e,n,{y:r=t==="y"?void 0:null,x:i=null,x1:s=e==="left"?i:null,x2:o=e==="right"?i:null,...a}){return og(Yc,t,n,{ariaLabel:`${t}-grid`,ariaHidden:!0},{y:r,x1:s,x2:o,...tK(a)})}function ZX(t,e,n,{x:r=t==="x"?void 0:null,y:i=null,y1:s=e==="top"?i:null,y2:o=e==="bottom"?i:null,...a}){return og(Gc,t,n,{ariaLabel:`${t}-grid`,ariaHidden:!0},{x:r,y1:s,y2:o,...tK(a)})}function tK({color:t="currentColor",opacity:e=.1,stroke:n=t,strokeOpacity:r=e,strokeWidth:i=1,...s}){return{stroke:n,strokeOpacity:r,strokeWidth:i,...s}}function eK({fill:t,fillOpacity:e,fontFamily:n,fontSize:r,fontStyle:i,fontVariant:s,fontWeight:o,monospace:a,pointerEvents:u,shapeRendering:c,clip:l=!1},f){return[,t]=qr(t),[,e]=cn(e),{facet:"super",x:null,y:null,fill:t,fillOpacity:e,fontFamily:n,fontSize:r,fontStyle:i,fontVariant:s,fontWeight:o,monospace:a,pointerEvents:u,shapeRendering:c,clip:l,initializer:f}}function og(t,e,n,r,i,s){let o;function a(l,f,d,h,p,g){const m=l==null&&(e==="fx"||e==="fy"),{[e]:y}=h;if(!y)throw new Error(`missing scale: ${e}`);const b=y.domain();let{interval:w,ticks:v,tickFormat:x,tickSpacing:S=e==="x"?80:35}=i;if(typeof v=="string"&&oK(y)&&(w=v,v=void 0),v===void 0&&(v=ng(w,y.type)??HSt(y,S)),l==null){if(Fu(v))l=vu(v);else if(ph(v))l=LA(v,...pn(b));else if(y.interval){let E=y.interval;if(y.ticks){const[A,$]=pn(b),T=($-A)/E[Fy];E=e4(E,T/v)??E,l=LA(E,A,$)}else{l=b;const A=l.length;E=e4(E,A/v)??E,E!==y.interval&&(l=LA(E,...pn(l)))}if(E===y.interval){const A=Math.round(l.length/v);A>1&&(l=l.filter(($,T)=>T%A===0))}}else y.ticks?l=y.ticks(v):l=b;if(!y.ticks&&l.length&&l!==b){const E=new pu(b);l=l.filter(A=>E.has(A)),l.length||su(`Warning: the ${e}-axis ticks appear to not align with the scale domain, resulting in no ticks. Try different ticks?`)}e==="y"||e==="x"?f=[Iu(l)]:o[e]={scale:e,value:St}}s==null||s.call(this,y,l,v,x,o);const _=Object.fromEntries(Object.entries(o).map(([E,A])=>[E,{...A,value:Kt(l,A.value)}]));return m&&(f=g.filterFacets(l,_)),{data:l,facets:f,channels:_}}const u=Vr(i).initializer,c=t(n,Vr({...i,initializer:a},u));return n==null?(o=c.channels,c.channels={}):o={},r!==void 0&&Object.assign(c,r),c.clip===void 0&&(c.clip=!1),c}function HSt(t,e){const[n,r]=pn(t.range());return(r-n)/e}function nK(t,e,n,r,i){return{value:nF(t,e,n,r,i)}}function nF(t,e,n,r,i){return typeof r=="function"&&!(t.type==="log"&&t.tickFormat)?r:r===void 0&&e&&Wr(e)?t2t(t.type,e,i)??ap:t.tickFormat?t.tickFormat(typeof n=="number"?n:null,r):r===void 0?ap:typeof r=="string"?(Wr(t.domain())?Zp:id)(r):Hn(r)}function LA(t,e,n){return t.range(e,t.offset(t.floor(n)))}const XSt={draw(t,e){t.moveTo(0,0),t.lineTo(0,e)}},KSt={draw(t,e){t.moveTo(0,0),t.lineTo(0,-e)}},QSt={draw(t,e){t.moveTo(0,0),t.lineTo(-e,0)}},JSt={draw(t,e){t.moveTo(0,0),t.lineTo(e,0)}};function rK(t){return t.bandwidth&&!t.interval?void 0:"tabular-nums"}function iK(t,e,{anchor:n,label:r=e.label,labelAnchor:i,labelArrow:s}={}){if(!(r==null||r.inferred&&oK(e)&&/^(date|time|year)$/i.test(r))){if(r=String(r),s==="auto"&&(s=(!e.bandwidth||e.interval)&&!/[]/.test(r)),!s)return r;if(s===!0){const o=VH(e);o&&(s=/x$/.test(t)||i==="center"?/x$/.test(t)===o<0?"left":"right":o<0?"up":"down")}switch(s){case"left":return` ${r}`;case"right":return`${r} `;case"up":return n==="right"?`${r} `:` ${r}`;case"down":return n==="right"?`${r} `:` ${r}`}return r}}function sK(t="auto"){return je(t)?!1:typeof t=="boolean"?t:zi(t,"labelArrow",["auto","up","right","down","left"])}function oK(t){return Wr(t.domain())}function T4(t,e){if(e==null)return e;const n=t(e);if(!n)throw new Error(`scale not found: ${e}`);return n}function ZSt(t,{opacity:e,...n}={}){if(!ud(t)&&!KH(t))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${t.type})`);return aK(t,n,(r,i,s,o)=>r.append("svg").attr("width",s).attr("height",o).attr("fill",i.scale).attr("fill-opacity",cn(e)[1]).append("rect").attr("width","100%").attr("height","100%"))}function tEt(t,{fill:e=(c=>(c=t.hint)==null?void 0:c.fill)()!==void 0?t.hint.fill:"none",fillOpacity:n=1,stroke:r=(l=>(l=t.hint)==null?void 0:l.stroke)()!==void 0?t.hint.stroke:je(e)?"currentColor":"none",strokeOpacity:i=1,strokeWidth:s=1.5,r:o=4.5,...a}={},u){const[f,d]=qr(e),[h,p]=qr(r),g=T4(u,f),m=T4(u,h),y=o*o*Math.PI;return n=cn(n)[1],i=cn(i)[1],s=cn(s)[1],aK(t,a,(b,w,v,x)=>b.append("svg").attr("viewBox","-8 -8 16 16").attr("width",v).attr("height",x).attr("fill",f==="color"?S=>g.scale(S):d).attr("fill-opacity",n).attr("stroke",h==="color"?S=>m.scale(S):p).attr("stroke-opacity",i).attr("stroke-width",s).append("path").attr("d",S=>{const _=Qa();return t.scale(S).draw(_,y),_}))}function aK(t,e={},n){let{columns:r,tickFormat:i,fontVariant:s=lX(t),swatchSize:o=15,swatchWidth:a=o,swatchHeight:u=o,marginLeft:c=0,className:l,style:f,width:d}=e;const h=S_(e);l=E_(l),i=nF(t.scale,t.domain,void 0,i);const p=ne("div",h).attr("class",`${l}-swatches ${l}-swatches-${r!=null?"columns":"wrap"}`);let g;return r!=null?(g=`:where(.${l}-swatches-columns .${l}-swatch) {
  display: flex;
  align-items: center;
  break-inside: avoid;
  padding-bottom: 1px;
}
:where(.${l}-swatches-columns .${l}-swatch::before) {
  flex-shrink: 0;
}
:where(.${l}-swatches-columns .${l}-swatch-label) {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}`,p.style("columns",r).selectAll().data(t.domain).enter().append("div").attr("class",`${l}-swatch`).call(n,t,a,u).call(m=>m.append("div").attr("class",`${l}-swatch-label`).attr("title",i).text(i))):(g=`:where(.${l}-swatches-wrap) {
  display: flex;
  align-items: center;
  min-height: 33px;
  flex-wrap: wrap;
}
:where(.${l}-swatches-wrap .${l}-swatch) {
  display: inline-flex;
  align-items: center;
  margin-right: 1em;
}`,p.selectAll().data(t.domain).enter().append("span").attr("class",`${l}-swatch`).call(n,t,a,u).append(function(){return this.ownerDocument.createTextNode(i.apply(this,arguments))})),p.call(m=>m.insert("style","*").text(`:where(.${l}-swatches) {
  font-family: system-ui, sans-serif;
  font-size: 10px;
  margin-bottom: 0.5em;
}
:where(.${l}-swatch > svg) {
  margin-right: 0.5em;
  overflow: visible;
}
${g}`)).style("margin-left",c?`${+c}px`:null).style("width",d===void 0?null:`${+d}px`).style("font-variant",hn(s,"normal")).call(HI,f).node()}const bx=new Map([["symbol",tEt],["color",uK],["opacity",rEt]]);function eEt(t={}){for(const[e,n]of bx){const r=t[e];if(hf(r)){const i=S_(t);let s;if(e==="symbol"){const{fill:o,stroke:a=o===void 0&&hf(t.color)?"color":void 0}=t;s={fill:o,stroke:a}}return n(CT(e,r,s),rF(i,r,t),o=>hf(t[o])?CT(o,t[o]):null)}}throw new Error("unknown legend type; no scale found")}function nEt(t,e,n={}){return(r,i)=>{if(!bx.has(r))throw new Error(`unknown legend type: ${r}`);if(r in t)return bx.get(r)(t[r],rF(e,n[r],i),s=>t[s])}}function rF({className:t,...e},{label:n,ticks:r,tickFormat:i}={},s){return m2t(s,{className:t,...e},{label:n,ticks:r,tickFormat:i})}function uK(t,{legend:e=!0,...n}){if(e===!0&&(e=t.type==="ordinal"?"swatches":"ramp"),t.domain!==void 0)switch(`${e}`.toLowerCase()){case"swatches":return ZSt(t,n);case"ramp":return _St(t,n);default:throw new Error(`unknown legend type: ${e}`)}}function rEt({type:t,interpolate:e,...n},{legend:r=!0,color:i=li(0,0,0),...s}){if(!e)throw new Error(`${t} opacity scales are not supported`);if(r===!0&&(r="ramp"),`${r}`.toLowerCase()!=="ramp")throw new Error(`${r} opacity legends are not supported`);return uK({type:t,...n,interpolate:iEt(i)},{legend:r,...s})}function iEt(t){const{r:e,g:n,b:r}=li(t)||li(0,0,0);return i=>`rgba(${e},${n},${r},${i})`}function sEt(t,e,n){const r=[];for(const[i,s]of bx){const o=n[i];if(o!=null&&o.legend&&i in t){const a=s(t[i],rF(e,t[i],o),u=>t[u]);a!=null&&r.push(a)}}return r}function I_(t={}){return uH(t)?t:{...t,x:St}}function F_(t={}){return cH(t)?t:{...t,y:St}}function cK(t,e){if(e.length===1)return{data:t,facets:e};const n=R0(t),r=new Uint8Array(n);let i=0;for(const a of e)for(const u of a)r[u]&&++i,r[u]=1;if(i===0)return{data:t,facets:e};t=O0(t);const s=t[rH]=new Uint32Array(n+i);e=e.map(a=>O0(a,Uint32Array));let o=n;r.fill(0);for(const a of e)for(let u=0,c=a.length;u<c;++u){const l=a[u];r[l]?(a[u]=o,t[o]=t[l],s[o]=l,++o):s[l]=l,r[l]=1}return{data:t,facets:e}}function lK(t={},e={}){arguments.length===1&&([t,e]=ag(t));const{y1:n,y:r=n,x:i,...s}=e,[o,a,u,c]=ug(r,i,"y","x",t,s);return{...o,y1:n,y:a,x1:u,x2:c,x:hx(u,c)}}function oEt(t={},e={}){arguments.length===1&&([t,e]=ag(t));const{y1:n,y:r=n,x:i}=e,[s,o,a]=ug(r,i,"y","x",t,e);return{...s,y1:n,y:o,x:a}}function aEt(t={},e={}){arguments.length===1&&([t,e]=ag(t));const{y1:n,y:r=n,x:i}=e,[s,o,,a]=ug(r,i,"y","x",t,e);return{...s,y1:n,y:o,x:a}}function fK(t={},e={}){arguments.length===1&&([t,e]=ag(t));const{x1:n,x:r=n,y:i,...s}=e,[o,a,u,c]=ug(r,i,"x","y",t,s);return{...o,x1:n,x:a,y1:u,y2:c,y:hx(u,c)}}function uEt(t={},e={}){arguments.length===1&&([t,e]=ag(t));const{x1:n,x:r=n,y:i}=e,[s,o,a]=ug(r,i,"x","y",t,e);return{...s,x1:n,x:o,y:a}}function cEt(t={},e={}){arguments.length===1&&([t,e]=ag(t));const{x1:n,x:r=n,y:i}=e,[s,o,,a]=ug(r,i,"x","y",t,e);return{...s,x1:n,x:o,y:a}}function N_({x:t,x1:e,x2:n,...r}={}){return r=cd(r,"y"),e===void 0&&n===void 0?lK({x:t,...r}):([e,n]=lH(t,e,n),{...r,x1:e,x2:n})}function O_({y:t,y1:e,y2:n,...r}={}){return r=cd(r,"x"),e===void 0&&n===void 0?fK({y:t,...r}):([e,n]=lH(t,e,n),{...r,y1:e,y2:n})}function ag(t){const{offset:e,order:n,reverse:r,...i}=t;return[{offset:e,order:n,reverse:r},i]}const lEt={length:!0};function ug(t,e=SI,n,r,{offset:i,order:s,reverse:o},a){if(e===null)throw new Error(`stack requires ${r}`);const u=fl(a),[c,l]=Zr(t),[f,d]=Ti(e),[h,p]=Ti(e);return f.hint=h.hint=lEt,i=fEt(i),s=pEt(s,i,r),[io(a,(g,m,y)=>{({data:g,facets:m}=cK(g,m));const b=t==null?void 0:l(px(Kt(g,t),y==null?void 0:y[n])),w=Kt(g,e,Float64Array),v=Kt(g,u),x=s&&s(g,b,w,v),S=R0(g),_=d(new Float64Array(S)),E=p(new Float64Array(S)),A=[];for(const $ of m){const T=b?Array.from(al($,C=>b[C]).values()):[$];if(x)for(const C of T)C.sort(x);for(const C of T){let F=0,M=0;o&&C.reverse();for(const k of C){const I=w[k];I<0?F=E[k]=(_[k]=F)+I:I>0?M=E[k]=(_[k]=M)+I:E[k]=_[k]=M}}A.push(T)}return i&&i(A,_,E,v),{data:g,facets:m}}),c,f,h]}function fEt(t){if(t!=null){if(typeof t=="function")return t;switch(`${t}`.toLowerCase()){case"expand":case"normalize":return dEt;case"center":case"silhouette":return hEt;case"wiggle":return hK}throw new Error(`unknown offset: ${t}`)}}function dK(t,e){let n=0,r=0;for(const i of t){const s=e[i];s<n&&(n=s),s>r&&(r=s)}return[n,r]}function dEt(t,e,n){for(const r of t)for(const i of r){const[s,o]=dK(i,n);for(const a of i){const u=1/(o-s||1);e[a]=u*(e[a]-s),n[a]=u*(n[a]-s)}}}function hEt(t,e,n){for(const r of t){for(const i of r){const[s,o]=dK(i,n);for(const a of i){const u=(o+s)/2;e[a]-=u,n[a]-=u}}pK(r,e,n)}gK(t,e,n)}function hK(t,e,n,r){for(const i of t){const s=new kf;let o=0;for(const a of i){let u=-1;const c=a.map(h=>Math.abs(n[h]-e[h])),l=a.map(h=>{u=r?r[h]:++u;const p=n[h]-e[h],g=s.has(u)?p-s.get(u):0;return s.set(u,p),g}),f=[0,...Fpt(l)];for(const h of a)e[h]+=o,n[h]+=o;const d=ls(c);d&&(o-=ls(c,(h,p)=>(l[p]/2+f[p])*h)/d)}pK(i,e,n)}gK(t,e,n)}function pK(t,e,n){const r=wn(t,i=>wn(i,s=>e[s]));for(const i of t)for(const s of i)e[s]-=r,n[s]-=r}function gK(t,e,n){const r=t.length;if(r===1)return;const i=t.map(a=>a.flat()),s=i.map(a=>(wn(a,u=>e[u])+Be(a,u=>n[u]))/2),o=wn(s);for(let a=0;a<r;a++){const u=o-s[a];for(const c of i[a])e[c]+=u,n[c]+=u}}function pEt(t,e,n){if(t===void 0&&e===hK)return k4(gs);if(t!=null){if(typeof t=="string"){const r=t.startsWith("-"),i=r?fx:gs;switch((r?t.slice(1):t).toLowerCase()){case"value":case n:return gEt(i);case"z":return mEt(i);case"sum":return yEt(i);case"appearance":return bEt(i);case"inside-out":return k4(i)}return M4(iH(t))}if(typeof t=="function")return(t.length===1?M4:vEt)(t);if(Cu(t))return wEt(t);throw new Error(`invalid order: ${t}`)}}function gEt(t){return(e,n,r)=>(i,s)=>t(r[i],r[s])}function mEt(t){return(e,n,r,i)=>(s,o)=>t(i[s],i[o])}function yEt(t){return R_(t,(e,n,r,i)=>_C(Iu(e),s=>ls(s,o=>r[o]),s=>i[s]))}function bEt(t){return R_(t,(e,n,r,i)=>_C(Iu(e),s=>n[EC(s,o=>r[o])],s=>i[s]))}function k4(t){return R_(t,(e,n,r,i)=>{const s=Iu(e),o=_C(s,f=>n[EC(f,d=>r[d])],f=>i[f]),a=kh(s,f=>ls(f,d=>r[d]),f=>i[f]),u=[],c=[];let l=0;for(const f of o)l<0?(l+=a.get(f),u.push(f)):(l-=a.get(f),c.push(f));return c.reverse().concat(u)})}function M4(t){return e=>{const n=Kt(e,t);return(r,i)=>gs(n[r],n[i])}}function vEt(t){return e=>Cu(e)?(n,r)=>t(e[n],e[r]):(n,r)=>t(e.get(n),e.get(r))}function wEt(t){return R_(gs,()=>t)}function R_(t,e){return(n,r,i,s)=>{if(!s)throw new Error("missing channel: z");const o=new kf(e(n,r,i,s).map((a,u)=>[a,u]));return(a,u)=>t(o.get(s[a]),o.get(s[u]))}}const xEt={ariaLabel:"rect"};class D_ extends Ce{constructor(e,n={}){const{x1:r,y1:i,x2:s,y2:o}=n;super(e,{x1:{value:r,scale:"x",type:r!=null&&s==null?"band":void 0,optional:!0},y1:{value:i,scale:"y",type:i!=null&&o==null?"band":void 0,optional:!0},x2:{value:s,scale:"x",optional:!0},y2:{value:o,scale:"y",optional:!0}},n,xEt),iF(this,n),sF(this,n)}render(e,n,r,i,s){const{x:o,y:a}=n;let{x1:u,y1:c,x2:l,y2:f}=r;const{marginTop:d,marginRight:h,marginBottom:p,marginLeft:g,width:m,height:y}=i,{projection:b}=s,{insetTop:w,insetRight:v,insetBottom:x,insetLeft:S}=this,{rx:_,ry:E,rx1y1:A,rx1y2:$,rx2y1:T,rx2y2:C}=this;(u||l)&&!b&&Zo(o)&&(u=l=null),(c||f)&&!b&&Zo(a)&&(c=f=null);const F=o!=null&&o.bandwidth?o.bandwidth():0,M=a!=null&&a.bandwidth?a.bandwidth():0;return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,{},0,0).call(k=>k.selectAll().data(e).enter().call(A||$||T||C?I=>I.append("path").call(Se,this).call(oF,u&&l?N=>u[N]+(l[N]<u[N]?-v:S):u?N=>u[N]+S:g+S,c&&f?N=>c[N]+(f[N]<c[N]?-x:w):c?N=>c[N]+w:d+w,u&&l?N=>l[N]-(l[N]<u[N]?-S:v):u?N=>u[N]+F-v:m-h-v,c&&f?N=>f[N]-(f[N]<c[N]?-w:x):c?N=>c[N]+M-x:y-p-x,this).call(sn,this,r):I=>I.append("rect").call(Se,this).attr("x",u?l?N=>Math.min(u[N],l[N])+S:N=>u[N]+S:g+S).attr("y",c?f?N=>Math.min(c[N],f[N])+w:N=>c[N]+w:d+w).attr("width",u?l?N=>Math.max(0,Math.abs(l[N]-u[N])+F-S-v):F-S-v:m-h-g-v-S).attr("height",c?f?N=>Math.max(0,Math.abs(c[N]-f[N])+M-w-x):M-w-x:y-d-p-w-x).call(Et,"rx",_).call(Et,"ry",E).call(sn,this,r))).node()}}function iF(t,{inset:e=0,insetTop:n=e,insetRight:r=e,insetBottom:i=e,insetLeft:s=e}={}){t.insetTop=Le(n),t.insetRight=Le(r),t.insetBottom=Le(i),t.insetLeft=Le(s)}function sF(t,{r:e,rx:n,ry:r,rx1:i=e,ry1:s=e,rx2:o=e,ry2:a=e,rx1y1:u=i!==void 0?+i:s!==void 0?+s:0,rx1y2:c=i!==void 0?+i:a!==void 0?+a:0,rx2y1:l=o!==void 0?+o:s!==void 0?+s:0,rx2y2:f=o!==void 0?+o:a!==void 0?+a:0}={}){u||c||l||f?(t.rx1y1=u,t.rx1y2=c,t.rx2y1=l,t.rx2y2=f):(t.rx=hn(n,"auto"),t.ry=hn(r,"auto"))}function oF(t,e,n,r,i,s){const{rx1y1:o,rx1y2:a,rx2y1:u,rx2y2:c}=s;typeof e!="function"&&(e=Hn(e)),typeof n!="function"&&(n=Hn(n)),typeof r!="function"&&(r=Hn(r)),typeof i!="function"&&(i=Hn(i));const l=Math.max(Math.abs(o+u),Math.abs(a+c)),f=Math.max(Math.abs(o+a),Math.abs(u+c));t.attr("d",d=>{const h=e(d),p=n(d),g=r(d),m=i(d),y=h>g,b=p>m,w=y?g:h,v=y?h:g,x=b?m:p,S=b?p:m,_=Math.min(1,(v-w)/l,(S-x)/f),E=_*(y?b?c:u:b?a:o),A=_*(y?b?a:o:b?c:u),$=_*(y?b?o:a:b?u:c),T=_*(y?b?u:c:b?o:a);return`M${w},${x+ob(E,T)}A${E},${E} 0 0 ${E<0?0:1} ${w+sb(E,T)},${x}H${v-sb(A,$)}A${A},${A} 0 0 ${A<0?0:1} ${v},${x+ob(A,$)}V${S-ob($,A)}A${$},${$} 0 0 ${$<0?0:1} ${v-sb($,A)},${S}H${w+sb(T,E)}A${T},${T} 0 0 ${T<0?0:1} ${w},${S-ob(T,E)}Z`})}function sb(t,e){return e<0?t:Math.abs(t)}function ob(t,e){return e<0?Math.abs(t):t}function aF(t,e){return new D_(t,mX(yX(e)))}function vx(t,e={}){return eg(e)||(e={...e,y:Ln,x2:St,interval:1}),new D_(t,N_(yX(I_(e))))}function wx(t,e={}){return eg(e)||(e={...e,x:Ln,y2:St,interval:1}),new D_(t,O_(mX(F_(e))))}const _Et={ariaLabel:"frame",fill:"none",stroke:"currentColor",clip:!1},SEt={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square",clip:!1};class mK extends Ce{constructor(e={}){const{anchor:n=null}=e;super(Jm,void 0,e,n==null?_Et:SEt),this.anchor=aH(n,"anchor",["top","right","bottom","left"]),iF(this,e),n||sF(this,e)}render(e,n,r,i,s){const{marginTop:o,marginRight:a,marginBottom:u,marginLeft:c,width:l,height:f}=i,{anchor:d,insetTop:h,insetRight:p,insetBottom:g,insetLeft:m}=this,{rx:y,ry:b,rx1y1:w,rx1y2:v,rx2y1:x,rx2y2:S}=this,_=c+m,E=l-a-p,A=o+h,$=f-u-g;return ne(d?"svg:line":w||v||x||S?"svg:path":"svg:rect",s).datum(0).call(Pe,this,i,s).call(Se,this).call(sn,this,r).call(Me,this,{}).call(d==="left"?T=>T.attr("x1",_).attr("x2",_).attr("y1",A).attr("y2",$):d==="right"?T=>T.attr("x1",E).attr("x2",E).attr("y1",A).attr("y2",$):d==="top"?T=>T.attr("x1",_).attr("x2",E).attr("y1",A).attr("y2",A):d==="bottom"?T=>T.attr("x1",_).attr("x2",E).attr("y1",$).attr("y2",$):w||v||x||S?T=>T.call(oF,_,A,E,$,this):T=>T.attr("x",_).attr("y",A).attr("width",E-_).attr("height",$-A).attr("rx",y).attr("ry",b)).node()}}function uF(t){return new mK(t)}const BA={ariaLabel:"tip",fill:"var(--plot-background)",stroke:"currentColor"},EEt=new Set(["geometry","href","src","ariaLabel","scales"]);class yK extends Ce{constructor(e,n={}){n.tip&&(n={...n,tip:!1}),n.title===void 0&&Fu(e)&&pH(e)&&(n={...n,title:St});const{x:r,y:i,x1:s,x2:o,y1:a,y2:u,anchor:c,preferredAnchor:l="bottom",monospace:f,fontFamily:d=f?"ui-monospace, monospace":void 0,fontSize:h,fontStyle:p,fontVariant:g,fontWeight:m,lineHeight:y=1,lineWidth:b=20,frameAnchor:w,format:v,textAnchor:x="start",textOverflow:S,textPadding:_=8,title:E,pointerSize:A=12,pathFilter:$="drop-shadow(0 3px 4px rgba(0,0,0,0.2))"}=n;super(e,{x:{value:s!=null&&o!=null?null:r,scale:"x",optional:!0},y:{value:a!=null&&u!=null?null:i,scale:"y",optional:!0},x1:{value:s,scale:"x",optional:o==null},y1:{value:a,scale:"y",optional:u==null},x2:{value:o,scale:"x",optional:s==null},y2:{value:u,scale:"y",optional:a==null},title:{value:E,optional:!0}},n,BA),this.anchor=ET(c,"anchor"),this.preferredAnchor=ET(l,"preferredAnchor"),this.frameAnchor=Oy(w),this.textAnchor=hn(x,"middle"),this.textPadding=+_,this.pointerSize=+A,this.pathFilter=dr($),this.lineHeight=+y,this.lineWidth=+b,this.textOverflow=AX(S),this.monospace=!!f,this.fontFamily=dr(d),this.fontSize=Le(h),this.fontStyle=dr(p),this.fontVariant=dr(g),this.fontWeight=dr(m);for(const T in BA)T in this.channels&&(this[T]=BA[T]);this.splitLines=MX(this),this.clipLine=CX(this),this.format=typeof v=="string"||typeof v=="function"?{title:v}:{...v}}render(e,n,r,i,s){const o=this,{x:a,y:u,fx:c,fy:l}=n,{ownerSVGElement:f,document:d}=s,{anchor:h,monospace:p,lineHeight:g,lineWidth:m}=this,{textPadding:y,pointerSize:b,pathFilter:w}=this,{marginTop:v,marginLeft:x}=i,{x1:S,y1:_,x2:E,y2:A,x:$=S??E,y:T=_??A}=r,C=c?c(e.fx)-x:0,F=l?l(e.fy)-v:0,[M,k]=pa(this,i),I=uX(r,M),N=cX(r,k),R=p?ZI:JI,D=R(Nh);let L,P;"title"in r?(L=C4.call(this,{title:r.channels.title},n),P=kEt):(L=C4.call(this,r.channels,n),P=MEt);const B=ne("svg:g",s).call(Pe,this,i,s).call(kX,this).call(Me,this,{x:$&&a,y:T&&u}).call(Z=>Z.selectAll().data(e).enter().append("g").attr("transform",lt=>`translate(${Math.round(I(lt))},${Math.round(N(lt))})`).call(Se,this).call(lt=>lt.append("path").attr("filter",w)).call(lt=>lt.append("text").each(function(et){const ut=fr(this);this.setAttribute("fill","currentColor"),this.setAttribute("fill-opacity",1),this.setAttribute("stroke","none");const V=P.call(o,et,e,L,n,r);if(typeof V=="string")for(const rt of o.splitLines(V))G(ut,{value:o.clipLine(rt)});else{const rt=new Set;for(const dt of V){const{label:q=""}=dt;q&&rt.has(q)||(rt.add(q),G(ut,dt))}}})));function G(Z,{label:lt,value:et,color:ut,opacity:V}){lt??(lt=""),et??(et="");const rt=ut!=null||V!=null;let dt,q=m*100;const[Ot]=fp(lt,q,R,D);if(Ot>=0)lt=lt.slice(0,Ot).trimEnd()+Nh,dt=et.trim(),et="";else{(lt||!et&&!rt)&&(et=" "+et);const[Wt]=fp(et,q-R(lt),R,D);Wt>=0&&(dt=et.trim(),et=et.slice(0,Wt).trimEnd()+Nh)}const yt=Z.append("tspan").attr("x",0).attr("dy",`${g}em`).text("");lt&&yt.append("tspan").attr("font-weight","bold").text(lt),et&&yt.append(()=>d.createTextNode(et)),rt&&yt.append("tspan").text(" ").attr("fill",ut).attr("fill-opacity",V).style("user-select","none"),dt&&yt.append("title").text(dt)}function ct(){const{width:Z,height:lt}=i.facet??i;B.selectChildren().each(function(et){let{x:ut,width:V,height:rt}=this.getBBox();V=Math.round(V),rt=Math.round(rt);let dt=h;if(dt===void 0){const yt=I(et)+C,Wt=N(et)+F,qt=yt+V+b+y*2<Z,ht=yt-V-b-y*2>0,ie=Wt+rt+b+y*2<lt,vi=Wt-rt-b-y*2>0;dt=qt&&ht?ie&&vi?o.preferredAnchor:vi?"bottom":"top":ie&&vi?qt?"left":"right":(qt||ht)&&(ie||vi)?`${vi?"bottom":"top"}-${qt?"left":"right"}`:o.preferredAnchor}const q=this.firstChild,Ot=this.lastChild;if(q.setAttribute("d",TEt(dt,b,y,V,rt)),ut)for(const yt of Ot.childNodes)yt.setAttribute("x",-ut);Ot.setAttribute("y",`${+AEt(dt,Ot.childNodes.length,g).toFixed(6)}em`),Ot.setAttribute("transform",`translate(${$Et(dt,b,y,V,rt)})`)}),B.attr("visibility",null)}return e.length&&(B.attr("visibility","hidden"),f.isConnected?Promise.resolve().then(ct):typeof requestAnimationFrame<"u"&&requestAnimationFrame(ct)),B.node()}}function bK(t,{x:e,y:n,...r}={}){return r.frameAnchor===void 0&&([e,n]=ro(e,n)),new yK(t,{...r,x:e,y:n})}function AEt(t,e,n){return/^top(?:-|$)/.test(t)?.94-n:-.29-e*n}function $Et(t,e,n,r,i){switch(t){case"middle":return[-r/2,i/2];case"top-left":return[n,e+n];case"top":return[-r/2,e/2+n];case"top-right":return[-r-n,e+n];case"right":return[-e/2-r-n,i/2];case"bottom-left":return[n,-e-n];case"bottom":return[-r/2,-e/2-n];case"bottom-right":return[-r-n,-e-n];case"left":return[n+e/2,i/2]}}function TEt(t,e,n,r,i){const s=r+n*2,o=i+n*2;switch(t){case"middle":return`M${-s/2},${-o/2}h${s}v${o}h${-s}z`;case"top-left":return`M0,0l${e},${e}h${s-e}v${o}h${-s}z`;case"top":return`M0,0l${e/2},${e/2}h${(s-e)/2}v${o}h${-s}v${-o}h${(s-e)/2}z`;case"top-right":return`M0,0l${-e},${e}h${e-s}v${o}h${s}z`;case"right":return`M0,0l${-e/2},${-e/2}v${e/2-o/2}h${-s}v${o}h${s}v${e/2-o/2}z`;case"bottom-left":return`M0,0l${e},${-e}h${s-e}v${-o}h${-s}z`;case"bottom":return`M0,0l${e/2},${-e/2}h${(s-e)/2}v${-o}h${-s}v${o}h${(s-e)/2}z`;case"bottom-right":return`M0,0l${-e},${-e}h${e-s}v${-o}h${s}z`;case"left":return`M0,0l${e/2},${-e/2}v${e/2-o/2}h${s}v${o}h${-s}v${e/2-o/2}z`}}function C4(t,e){var i,s;const n={};let r=this.format;r=I4(r,t,"x"),r=I4(r,t,"y"),this.format=r;for(const o in r){const a=r[o];if(!(a===null||a===!1))if(o==="fx"||o==="fy")n[o]=!0;else{const u=$T(t,o);u&&(n[o]=u)}}for(const o in t){if(o in n||o in r||EEt.has(o)||(o==="x"||o==="y")&&t.geometry)continue;const a=$T(t,o);if(a){if(a.scale==null&&a.defaultScale==="color")continue;n[o]=a}}this.facet&&(e.fx&&!("fx"in r)&&(n.fx=!0),e.fy&&!("fy"in r)&&(n.fy=!0));for(const o in n){const a=this.format[o];if(typeof a=="string"){const u=((i=n[o])==null?void 0:i.value)??((s=e[o])==null?void 0:s.domain())??[];this.format[o]=(Wr(u)?Zp:id)(a)}else if(a===void 0||a===!0){const u=e[o];this.format[o]=u!=null&&u.bandwidth?nF(u,u.domain()):ap}}return n}function I4(t,e,n){if(!(n in t))return t;const r=`${n}1`,i=`${n}2`;if((r in t||!(r in e))&&(i in t||!(i in e)))return t;const s=Object.entries(t),o=t[n];return s.splice(s.findIndex(([a])=>a===n)+1,0,[r,o],[i,o]),Object.fromEntries(s)}function kEt(t,e,{title:n}){return this.format.title(n.value[t],t)}function*MEt(t,e,n,r,i){for(const s in n){if(s==="fx"||s==="fy"){yield{label:xx(r,n,s),value:this.format[s](e[s],t)};continue}if(s==="x1"&&"x2"in n||s==="y1"&&"y2"in n)continue;const o=n[s];if(s==="x2"&&"x1"in n)yield{label:N4(r,n,"x"),value:F4(this.format.x2,n.x1,o,t)};else if(s==="y2"&&"y1"in n)yield{label:N4(r,n,"y"),value:F4(this.format.y2,n.y1,o,t)};else{const a=o.value[t],u=o.scale;if(!Qn(a)&&u==null)continue;yield{label:xx(r,n,s),value:this.format[s](a,t),color:u==="color"?i[s][t]:null,opacity:u==="opacity"?i[s][t]:null}}}}function F4(t,e,n,r){var i;return(i=n.hint)!=null&&i.length?`${t(n.value[r]-e.value[r],r)}`:`${t(e.value[r],r)}${t(n.value[r],r)}`}function N4(t,e,n){const r=xx(t,e,`${n}1`,n),i=xx(t,e,`${n}2`,n);return r===i?r:`${r}${i}`}function xx(t,e,n,r=n){const i=e[n],s=t[(i==null?void 0:i.scale)??n];return String((s==null?void 0:s.label)??(i==null?void 0:i.label)??r)}function cF(t={}){var D;const{facet:e,style:n,title:r,subtitle:i,caption:s,ariaLabel:o,ariaDescription:a}=t,u=E_(t.className),c=t.marks===void 0?[]:R4(t.marks);c.push(...DEt(c));const l=OEt(e,t),f=new Map;for(const L of c){const P=D4(L,l,t);P&&f.set(L,P)}const d=new Map;l&&jg(d,[l],t),jg(d,f,t);const h=R4(LEt(c,d,t));for(const L of h){const P=D4(L,l,t);P&&f.set(L,P)}c.unshift(...h);let p=N_t(d,t);if(p!==void 0){const L=l?NA(p,l):void 0;for(const B of c){if(B.facet===null||B.facet==="super")continue;const G=f.get(B);G!==void 0&&(G.facetsIndex=B.fx!=null||B.fy!=null?NA(p,G):L)}const P=new Set;for(const{facetsIndex:B}of f.values())B==null||B.forEach((G,ct)=>{(G==null?void 0:G.length)>0&&P.add(ct)});p.forEach(0<P.size&&P.size<p.length?(B,G)=>B.empty=!P.has(G):B=>B.empty=!1);for(const B of c)if(B.facet==="exclude"){const G=f.get(B);G!==void 0&&(G.facetsIndex=D_t(G.facetsIndex))}}for(const L of Xe.keys())hf(t[L])&&L!=="fx"&&L!=="fy"&&d.set(L,[]);const g=new Map;for(const L of c){if(g.has(L))throw new Error("duplicate mark; each mark must be unique");const{facetsIndex:P,channels:B}=f.get(L)??{},{data:G,facets:ct,channels:Z}=L.initialize(P,B,t);lF(Z,t),g.set(L,{data:G,facets:ct,channels:Z})}const m=MT(jg(d,g,t),t),y=wSt(m,c,t);A_t(m,y);const b=h4(m),{fx:w,fy:v}=b,x=w||v?GH(m,y):y,S=w||v?WEt(b,y):y,_=S_(t),E=_.document,A=L2("svg").call(E.documentElement);let $=A;_.ownerSVGElement=A,_.className=u,_.projection=V_t(t,x),_.filterFacets=(L,P)=>NA(p,{channels:P,groups:GI(L,P)}),_.getMarkState=L=>{const P=g.get(L),B=f.get(L);return{...P,channels:{...P.channels,...B==null?void 0:B.channels}}},_.dispatchValue=L=>{$.value!==L&&($.value=L,$.dispatchEvent(new Event("input",{bubbles:!0})))};const T=new Set;for(const[L,P]of g)if(L.initializer!=null){const B=L.facet==="super"?S:x,G=L.initializer(P.data,P.facets,P.channels,b,B,_);if(G.data!==void 0&&(P.data=G.data),G.facets!==void 0&&(P.facets=G.facets),G.channels!==void 0){const{fx:ct,fy:Z,...lt}=G.channels;NEt(lt),Object.assign(P.channels,lt);for(const et of Object.values(lt)){const{scale:ut}=et;ut!=null&&!v2t(Xe.get(ut))&&(vK(et,t),T.add(ut))}(ct!=null||Z!=null)&&f.set(L,!0)}}if(T.size){const L=new Map;jg(L,g,t,ct=>T.has(ct)),jg(d,g,t,ct=>T.has(ct));const P=qEt(MT(L,t),m),{scales:B,...G}=h4(P);Object.assign(m,P),Object.assign(b,G),Object.assign(b.scales,B)}let C,F;p!==void 0&&(C={x:w==null?void 0:w.domain(),y:v==null?void 0:v.domain()},p=O_t(p,C),F=R_t(w,v,y));for(const[L,P]of g)P.values=L.scale(P.channels,b,_);const{width:M,height:k}=y;fr(A).attr("class",u).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",M).attr("height",k).attr("viewBox",`0 0 ${M} ${k}`).attr("aria-label",o).attr("aria-description",a).call(L=>L.append("style").text(`:where(.${u}) {
  --plot-background: white;
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
}
:where(.${u} text),
:where(.${u} tspan) {
  white-space: pre;
}`)).call(HI,n);for(const L of c){const{channels:P,values:B,facets:G}=g.get(L);if(p===void 0||L.facet==="super"){let ct=null;if(G&&(ct=G[0],ct=L.filter(ct,P,B),ct.length===0))continue;const Z=L.render(ct,b,B,S,_);if(Z==null)continue;A.appendChild(Z)}else{let ct;for(const Z of p){if(!(((D=L.facetAnchor)==null?void 0:D.call(L,p,C,Z))??!Z.empty))continue;let lt=null;if(G){const ut=f.has(L);if(lt=G[ut?Z.i:0],lt=L.filter(lt,P,B),lt.length===0)continue;!ut&&lt===G[0]&&(lt=pf(lt)),lt.fx=Z.x,lt.fy=Z.y,lt.fi=Z.i}const et=L.render(lt,b,B,x,_);if(et!=null){(ct??(ct=fr(A).append("g"))).append(()=>et).datum(Z);for(const ut of["aria-label","aria-description","aria-hidden","transform"])et.hasAttribute(ut)&&(ct.attr(ut,et.getAttribute(ut)),et.removeAttribute(ut))}}ct==null||ct.selectChildren().attr("transform",F)}}const I=sEt(m,_,t),{figure:N=r!=null||i!=null||s!=null||I.length>0}=t;N&&($=E.createElement("figure"),$.className=`${u}-figure`,$.style.maxWidth="initial",r!=null&&$.append(O4(E,r,"h2")),i!=null&&$.append(O4(E,i,"h3")),$.append(...I,A),s!=null&&$.append(CEt(E,s)),"value"in A&&($.value=A.value,delete A.value)),$.scale=F_t(b.scales),$.legend=nEt(m,_,t);const R=u_t();return R>0&&fr(A).append("text").attr("x",M).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("").append("title").text(`${R.toLocaleString("en-US")} warning${R===1?"":"s"}. Please check the console.`),$}function O4(t,e,n){if(e.ownerDocument)return e;const r=t.createElement(n);return r.append(e),r}function CEt(t,e){const n=t.createElement("figcaption");return n.append(e),n}function R4(t){return t.flat(1/0).filter(e=>e!=null).map(IEt)}function IEt(t){return typeof t.render=="function"?t:new FEt(t)}let FEt=class extends Ce{constructor(e){if(typeof e!="function")throw new TypeError("invalid mark; missing render function");super(),this.render=e}render(){}};function lF(t,e){for(const n in t)vK(t[n],e);return t}function vK(t,e){const{scale:n,transform:r=!0}=t;if(n==null||!r)return;const{type:i,percent:s,interval:o,transform:a=s?u=>u==null?NaN:u*100:dH(o,i)}=e[n]??{};a!=null&&(t.value=Te(t.value,a),t.transform=!1)}function NEt(t){for(const e in t)IH(e,t[e])}function jg(t,e,n,r=s2t){var i,s;for(const{channels:o}of e.values())for(const a in o){const u=o[a],{scale:c}=u;if(c!=null&&r(c))if(c==="projection"){if(!H_t(n)){const l=((i=n.x)==null?void 0:i.domain)===void 0,f=((s=n.y)==null?void 0:s.domain)===void 0;if(l||f){const[d,h]=K_t(u);l&&PA(t,"x",d),f&&PA(t,"y",h)}}}else PA(t,c,u)}return t}function PA(t,e,n){const r=t.get(e);r!==void 0?r.push(n):t.set(e,[n])}function OEt(t,e){if(t==null)return;const{x:n,y:r}=t;if(n==null&&r==null)return;const i=ip(t.data);if(i==null)throw new Error("missing facet data");const s={};n!=null&&(s.fx=B0(i,{value:n,scale:"fx"})),r!=null&&(s.fy=B0(i,{value:r,scale:"fy"})),lF(s,e);const o=GI(i,s);return{channels:s,groups:o,data:t.data}}function D4(t,e,n){if(t.facet===null||t.facet==="super")return;const{fx:r,fy:i}=t;if(r!=null||i!=null){const u=ip(t.data??r??i);if(u===void 0)throw new Error(`missing facet data in ${t.ariaLabel}`);if(u===null)return;const c={};return r!=null&&(c.fx=B0(u,{value:r,scale:"fx"})),i!=null&&(c.fy=B0(u,{value:i,scale:"fy"})),lF(c,n),{channels:c,groups:GI(u,c)}}if(e===void 0)return;const{channels:s,groups:o,data:a}=e;if(t.facet!=="auto"||t.data===a)return{channels:s,groups:o};a.length>0&&(o.size>1||o.size===1&&s.fx&&s.fy&&[...o][0][1].size>1)&&R0(ip(t.data))===R0(a)&&su(`Warning: the ${t.ariaLabel} mark appears to use faceted data, but isnt faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function REt(t,e={}){return Vr({...e,x:null,y:null},(n,r,i,s,o,a)=>a.getMarkState(t))}function DEt(t){const e=[];for(const n of t){let r=n.tip;if(r){r===!0?r={}:typeof r=="string"&&(r={pointer:r});let{pointer:i,preferredAnchor:s}=r;i=/^x$/i.test(i)?$_:/^y$/i.test(i)?z0:A_,r=i(REt(n,r)),r.title=null,s===void 0&&(r.preferredAnchor=i===z0?"left":"bottom");const o=bK(n.data,r);o.facet=n.facet,o.facetAnchor=n.facetAnchor,e.push(o)}}return e}function LEt(t,e,n){let{projection:r,x:i={},y:s={},fx:o={},fy:a={},axis:u,grid:c,facet:l={},facet:{axis:f=u,grid:d}=l,x:{axis:h=u,grid:p=h===null?null:c}=i,y:{axis:g=u,grid:m=g===null?null:c}=s,fx:{axis:y=f,grid:b=y===null?null:d}=o,fy:{axis:w=f,grid:v=w===null?null:d}=a}=n;(r||!hf(i)&&!L4("x",t))&&(h=p=null),(r||!hf(s)&&!L4("y",t))&&(g=m=null),e.has("fx")||(y=b=null),e.has("fy")||(w=v=null),h===void 0&&(h=!cb(t,"x")),g===void 0&&(g=!cb(t,"y")),y===void 0&&(y=!cb(t,"fx")),w===void 0&&(w=!cb(t,"fy")),h===!0&&(h="bottom"),g===!0&&(g="left"),y===!0&&(y=h==="top"||h===null?"bottom":"top"),w===!0&&(w=g==="right"||g===null?"left":"right");const x=[];return ub(x,v,XX,a),ab(x,w,WX,"right","left",l,a),ub(x,b,QX,o),ab(x,y,VX,"top","bottom",l,o),ub(x,m,HX,s),ab(x,g,tF,"left","right",n,s),ub(x,p,KX,i),ab(x,h,eF,"bottom","top",n,i),x}function ab(t,e,n,r,i,s,o){if(!e)return;const a=BEt(e);o=PEt(a?r:e,s,o);const{line:u}=o;(n===tF||n===eF)&&u&&!sp(u)&&t.push(uF(zEt(o))),t.push(n(o)),a&&t.push(n({...o,anchor:i,label:null}))}function ub(t,e,n,r){!e||sp(e)||t.push(n(UEt(e,r)))}function BEt(t){return/^\s*both\s*$/i.test(t)}function PEt(t,e,{line:n=e.line,ticks:r,tickSize:i,tickSpacing:s,tickPadding:o,tickFormat:a,tickRotate:u,fontVariant:c,ariaLabel:l,ariaDescription:f,label:d=e.label,labelAnchor:h,labelArrow:p=e.labelArrow,labelOffset:g}){return{anchor:t,line:n,ticks:r,tickSize:i,tickSpacing:s,tickPadding:o,tickFormat:a,tickRotate:u,fontVariant:c,ariaLabel:l,ariaDescription:f,label:d,labelAnchor:h,labelArrow:p,labelOffset:g}}function zEt(t){const{anchor:e,line:n}=t;return{anchor:e,facetAnchor:e+"-empty",stroke:n===!0?void 0:n}}function UEt(t,{stroke:e=Ny(t)?t:void 0,ticks:n=jEt(t)?t:void 0,tickSpacing:r,ariaLabel:i,ariaDescription:s}){return{stroke:e,ticks:n,tickSpacing:r,ariaLabel:i,ariaDescription:s}}function jEt(t){switch(typeof t){case"number":return!0;case"string":return!Ny(t)}return Fu(t)||typeof(t==null?void 0:t.range)=="function"}function cb(t,e){const n=`${e}-axis `;return t.some(r=>{var i;return(i=r.ariaLabel)==null?void 0:i.startsWith(n)})}function L4(t,e){for(const n of e)for(const r in n.channels){const{scale:i}=n.channels[r];if(i===t||i==="projection")return!0}return!1}function qEt(t,e){for(const n in t){const r=t[n],i=e[n];r.label===void 0&&i&&(r.label=i.label)}return t}function WEt({fx:t,fy:e},n){const{marginTop:r,marginRight:i,marginBottom:s,marginLeft:o,width:a,height:u}=VI(n),c=t&&B4(t),l=e&&B4(e);return{marginTop:e?l[0]:r,marginRight:t?a-c[1]:i,marginBottom:e?u-l[1]:s,marginLeft:t?c[0]:o,inset:{marginTop:n.marginTop,marginRight:n.marginRight,marginBottom:n.marginBottom,marginLeft:n.marginLeft},width:a,height:u}}function B4(t){const e=t.domain();if(e.length===0)return[0,t.bandwidth()];let n=t(e[0]),r=t(e[e.length-1]);return r<n&&([n,r]=[r,n]),[n,r+t.bandwidth()]}const VEt=new Map([["basis",EY],["basis-closed",$Y],["basis-open",kY],["bundle",CY],["bump-x",Lxt],["bump-y",Bxt],["cardinal",IY],["cardinal-closed",FY],["cardinal-open",NY],["catmull-rom",RY],["catmull-rom-closed",LY],["catmull-rom-open",PY],["linear",tg],["linear-closed",UY],["monotone-x",WY],["monotone-y",VY],["natural",YY],["step",HY],["step-after",KY],["step-before",XY]]);function fF(t=tg,e){if(typeof t=="function")return t;const n=VEt.get(`${t}`.toLowerCase());if(!n)throw new Error(`unknown curve: ${t}`);if(e!==void 0){if("beta"in n)return n.beta(e);if("tension"in n)return n.tension(e);if("alpha"in n)return n.alpha(e)}return n}function wK(t=dp,e){return typeof t!="function"&&`${t}`.toLowerCase()==="auto"?dp:fF(t,e)}function dp(t){return tg(t)}function oc(t={y:"count"},e={}){[t,e]=gF(t,e);const{x:n,y:r}=e;return pF(_x(n,e,St),null,null,r,t,jy(e))}function ac(t={x:"count"},e={}){[t,e]=gF(t,e);const{x:n,y:r}=e;return pF(null,_x(r,e,St),n,null,t,qy(e))}function Yl(t={fill:"count"},e={}){[t,e]=gF(t,e);const{x:n,y:r}=GEt(e);return pF(n,r,null,null,t,jy(qy(e)))}function xK(t,e,n={}){if((n==null?void 0:n.interval)==null)return n;const{reduce:r=zI}=n,i={filter:null};return n[e]!=null&&(i[e]=r),n[`${e}1`]!=null&&(i[`${e}1`]=r),n[`${e}2`]!=null&&(i[`${e}2`]=r),t(i,n)}function dF(t={}){return xK(oc,"y",cd(t,"x"))}function hF(t={}){return xK(ac,"x",cd(t,"y"))}function pF(t,e,n,r,{data:i=PI,filter:s=gx,sort:o,reverse:a,...u}={},c={}){t=P4(t),e=P4(e),u=YEt(u,c),i=AK(i,St),o=o==null?void 0:SK("sort",o,c),s=s==null?void 0:EK("filter",s,c),n!=null&&hc(u,"x","x1","x2")&&(n=null),r!=null&&hc(u,"y","y1","y2")&&(r=null);const[l,f]=Zr(t),[d,h]=Zr(t),[p,g]=Zr(e),[m,y]=Zr(e),[b,w]=n!=null?[n,"x"]:r!=null?[r,"y"]:[],[v,x]=Zr(b),{x:S,y:_,z:E,fill:A,stroke:$,x1:T,x2:C,y1:F,y2:M,domain:k,cumulative:I,thresholds:N,interval:R,...D}=c,[L,P]=Zr(E),[B]=qr(A),[G]=qr($),[ct,Z]=Zr(B),[lt,et]=Zr(G);return{..."z"in c&&{z:L||E},..."fill"in c&&{fill:ct||A},..."stroke"in c&&{stroke:lt||$},...io(D,(ut,V,rt)=>{const dt=px(Kt(ut,b),rt==null?void 0:rt[w]),q=Kt(ut,E),Ot=Kt(ut,B),yt=Kt(ut,G),Wt=BI(u,{z:q,fill:Ot,stroke:yt}),qt=[],ht=[],ie=dt&&x([]),vi=q&&P([]),po=Ot&&Z([]),sat=yt&&et([]),vD=t&&f([]),oat=t&&h([]),wD=e&&g([]),aat=e&&y([]),uat=KEt(t,e,ut);let cat=0;for(const Ad of u)Ad.initialize(ut);o&&o.initialize(ut),s&&s.initialize(ut);for(const Ad of V){const xD=[];for(const $d of u)$d.scope("facet",Ad);o&&o.scope("facet",Ad),s&&s.scope("facet",Ad);for(const[$d,lat]of gf(Ad,Wt))for(const[fat,I1]of gf(lat,dt))for(const[go,Aa]of uat(I1))if(Wt&&(Aa.z=$d),!(s&&!s.reduce(go,Aa))){xD.push(cat++),ht.push(i.reduceIndex(go,ut,Aa)),dt&&ie.push(fat),q&&vi.push(Wt===q?$d:q[(go.length>0?go:I1)[0]]),Ot&&po.push(Wt===Ot?$d:Ot[(go.length>0?go:I1)[0]]),yt&&sat.push(Wt===yt?$d:yt[(go.length>0?go:I1)[0]]),vD&&(vD.push(Aa.x1),oat.push(Aa.x2)),wD&&(wD.push(Aa.y1),aat.push(Aa.y2));for(const dat of u)dat.reduce(go,Aa);o&&o.reduce(go,Aa)}qt.push(xD)}return kH(qt,o,a),{data:ht,facets:qt}}),...!hc(u,"x")&&(l?{x1:l,x2:d,x:hx(l,d)}:{x:S,x1:T,x2:C}),...!hc(u,"y")&&(p?{y1:p,y2:m,y:hx(p,m)}:{y:_,y1:F,y2:M}),...v&&{[w]:v},...Object.fromEntries(u.map(({name:ut,output:V})=>[ut,V]))}}function gF({cumulative:t,domain:e,thresholds:n,interval:r,...i},s){return[i,{cumulative:t,domain:e,thresholds:n,interval:r,...s}]}function _x(t,{cumulative:e,domain:n,thresholds:r,interval:i},s){return t={...rg(t)},t.domain===void 0&&(t.domain=n),t.cumulative===void 0&&(t.cumulative=e),t.thresholds===void 0&&(t.thresholds=r),t.interval===void 0&&(t.interval=i),t.value===void 0&&(t.value=s),t.thresholds=_K(t.thresholds,t.interval),t}function GEt(t){let{x:e,y:n}=t;return e=_x(e,t),n=_x(n,t),[e.value,n.value]=ro(e.value,n.value),{x:e,y:n}}function P4(t){if(t==null)return;const{value:e,cumulative:n,domain:r=pn,thresholds:i}=t,s=o=>{let a=Kt(o,e),u;if(Wr(a)||XEt(i)){a=Te(a,oH,Float64Array);let[l,f]=typeof r=="function"?r(a):r,d=typeof i=="function"&&!ph(i)?i(a,l,f):i;typeof d=="number"&&(d=CV(l,f,d)),ph(d)&&(r===pn&&(l=d.floor(l),f=d.offset(d.floor(f))),d=d.range(l,d.offset(f))),u=d}else{a=si(a);let[l,f]=typeof r=="function"?r(a):r,d=typeof i=="function"&&!ph(i)?i(a,l,f):i;if(typeof d=="number")if(r===pn){let h=x0(l,f,d);if(isFinite(h))if(h>0){let p=Math.round(l/h),g=Math.round(f/h);p*h<=l||--p,g*h>f||++g;let m=g-p+1;d=new Float64Array(m);for(let y=0;y<m;++y)d[y]=(p+y)*h}else if(h<0){h=-h;let p=Math.round(l*h),g=Math.round(f*h);p/h<=l||--p,g/h>f||++g;let m=g-p+1;d=new Float64Array(m);for(let y=0;y<m;++y)d[y]=(p+y)/h}else d=[l];else d=[l]}else d=Lc(l,f,d);else ph(d)&&(r===pn&&(l=d.floor(l),f=d.offset(d.floor(f))),d=d.range(l,d.offset(f)));u=d}const c=[];if(u.length===1)c.push([u[0],u[0]]);else for(let l=1;l<u.length;++l)c.push([u[l-1],u[l]]);return c.bin=(n<0?JEt:n>0?QEt:mF)(c,u,a),c};return s.label=ha(e),s}function _K(t,e,n=z4){if(t===void 0)return e===void 0?n:ng(e);if(typeof t=="string"){switch(t.toLowerCase()){case"freedman-diaconis":return Ppt;case"scott":return nq;case"sturges":return SC;case"auto":return z4}return f_(t)}return t}function YEt(t,e){return SH(t,e,SK)}function SK(t,e,n){return DI(t,e,n,EK)}function EK(t,e,n){return LI(t,e,n,AK)}function AK(t,e){return v_(t,e,HEt)}function HEt(t){switch(`${t}`.toLowerCase()){case"x":return ZEt;case"x1":return eAt;case"x2":return nAt;case"y":return tAt;case"y1":return rAt;case"y2":return iAt;case"z":return MH}throw new Error(`invalid bin reduce: ${t}`)}function z4(t,e,n){return Math.min(200,nq(t,e,n))}function XEt(t){return u2t(t)||Fu(t)&&Wr(t)}function KEt(t,e,n){const r=t==null?void 0:t(n),i=e==null?void 0:e(n);return r&&i?function*(s){const o=r.bin(s);for(const[a,[u,c]]of r.entries()){const l=i.bin(o[a]);for(const[f,[d,h]]of i.entries())yield[l[f],{data:n,x1:u,y1:d,x2:c,y2:h}]}}:r?function*(s){const o=r.bin(s);for(const[a,[u,c]]of r.entries())yield[o[a],{data:n,x1:u,x2:c}]}:function*(s){const o=i.bin(s);for(const[a,[u,c]]of i.entries())yield[o[a],{data:n,y1:u,y2:c}]}}function mF(t,e,n){return e=si(e),r=>{var s;const i=t.map(()=>[]);for(const o of r)(s=i[hu(e,n[o])-1])==null||s.push(o);return i}}function QEt(t,e,n){const r=mF(t,e,n);return i=>{const s=r(i);for(let o=1,a=s.length;o<a;++o){const u=s[o-1],c=s[o];for(const l of u)c.push(l)}return s}}function JEt(t,e,n){const r=mF(t,e,n);return i=>{const s=r(i);for(let o=s.length-2;o>=0;--o){const a=s[o+1],u=s[o];for(const c of a)u.push(c)}return s}}function $K(t,e){const n=(+t+ +e)/2;return t instanceof Date?new Date(n):n}const ZEt={reduceIndex(t,e,{x1:n,x2:r}){return $K(n,r)}},tAt={reduceIndex(t,e,{y1:n,y2:r}){return $K(n,r)}},eAt={reduceIndex(t,e,{x1:n}){return n}},nAt={reduceIndex(t,e,{x2:n}){return n}},rAt={reduceIndex(t,e,{y1:n}){return n}},iAt={reduceIndex(t,e,{y2:n}){return n}},sAt={ariaLabel:"area",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class L_ extends Ce{constructor(e,n={}){const{x1:r,y1:i,x2:s,y2:o,z:a,curve:u,tension:c}=n;super(e,{x1:{value:r,scale:"x"},y1:{value:i,scale:"y"},x2:{value:s,scale:"x",optional:!0},y2:{value:o,scale:"y",optional:!0},z:{value:fl(n),optional:!0}},n,sAt),this.z=a,this.curve=fF(u,c)}filter(e){return e}render(e,n,r,i,s){const{x1:o,y1:a,x2:u=o,y2:c=a}=r;return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,n,0,0).call(l=>l.selectAll().data(sX(e,[o,a,u,c],this,r)).enter().append("path").call(Se,this).call(mx,this,r).attr("d",Iy().curve(this.curve).defined(f=>f>=0).x0(f=>o[f]).y0(f=>a[f]).x1(f=>u[f]).y1(f=>c[f]))).node()}}function DT(t,e){return e===void 0?hp(t,{x:h_,y:N0}):new L_(t,e)}function U0(t,e){const{y:n=Ln,...r}=hF(e);return new L_(t,N_(I_({...r,y1:n,y2:void 0})))}function hp(t,e){const{x:n=Ln,...r}=dF(e);return new L_(t,O_(F_({...r,x1:n,x2:void 0})))}const oAt={ariaLabel:"link",fill:"none",stroke:"currentColor",strokeMiterlimit:1};class TK extends Ce{constructor(e,n={}){const{x1:r,y1:i,x2:s,y2:o,curve:a,tension:u}=n;super(e,{x1:{value:r,scale:"x"},y1:{value:i,scale:"y"},x2:{value:s,scale:"x",optional:!0},y2:{value:o,scale:"y",optional:!0}},n,oAt),this.curve=wK(a,u),ig(this,n)}project(e,n,r){this.curve!==dp&&super.project(e,n,r)}render(e,n,r,i,s){const{x1:o,y1:a,x2:u=o,y2:c=a}=r,{curve:l}=this;return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,n).call(f=>f.selectAll().data(e).enter().append("path").call(Se,this).attr("d",l===dp&&s.projection?aAt(s.projection,o,a,u,c):d=>{const h=Qa(),p=l(h);return p.lineStart(),p.point(o[d],a[d]),p.point(u[d],c[d]),p.lineEnd(),h}).call(sn,this,r).call(Uy,this,r,s)).node()}}function aAt(t,e,n,r,i){const s=eo(t);return e=si(e),n=si(n),r=si(r),i=si(i),o=>s({type:"LineString",coordinates:[[e[o],n[o]],[r[o],i[o]]]})}function kK(t,{x:e,x1:n,x2:r,y:i,y1:s,y2:o,...a}={}){return[n,r]=Sx(e,n,r),[s,o]=Sx(i,s,o),new TK(t,{...a,x1:n,x2:r,y1:s,y2:o})}function Sx(t,e,n){if(t===void 0){if(e===void 0){if(n!==void 0)return[n]}else if(n===void 0)return[e]}else{if(e===void 0)return n===void 0?[t]:[t,n];if(n===void 0)return[t,e]}return[e,n]}const uAt={ariaLabel:"arrow",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:1,strokeWidth:1.5};class MK extends Ce{constructor(e,n={}){const{x1:r,y1:i,x2:s,y2:o,bend:a=0,headAngle:u=60,headLength:c=8,inset:l=0,insetStart:f=l,insetEnd:d=l,sweep:h}=n;super(e,{x1:{value:r,scale:"x"},y1:{value:i,scale:"y"},x2:{value:s,scale:"x",optional:!0},y2:{value:o,scale:"y",optional:!0}},n,uAt),this.bend=a===!0?22.5:Math.max(-90,Math.min(90,a)),this.headAngle=+u,this.headLength=+c,this.insetStart=+f,this.insetEnd=+d,this.sweep=cAt(h)}render(e,n,r,i,s){const{x1:o,y1:a,x2:u=o,y2:c=a,SW:l}=r,{strokeWidth:f,bend:d,headAngle:h,headLength:p,insetStart:g,insetEnd:m}=this,y=l?v=>l[v]:Hn(f===void 0?1:f),b=h*yx/2,w=p/1.5;return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,n).call(v=>v.selectAll().data(e).enter().append("path").call(Se,this).attr("d",x=>{let S=o[x],_=a[x],E=u[x],A=c[x];const $=Math.hypot(E-S,A-_);if($<=g+m)return null;let T=Math.atan2(A-_,E-S);const C=Math.min(w*y(x),$/3),F=this.sweep(S,_,E,A)*d*yx,M=Math.hypot($/Math.tan(F),$)/2;if(g||m)if(M<1e5){const ct=Math.sign(F),[Z,lt]=lAt([S,_],[E,A],M,ct);if(g&&([S,_]=U4([Z,lt,M],[S,_,g],-ct*Math.sign(g))),m){const[et,ut]=U4([Z,lt,M],[E,A,m],ct*Math.sign(m));T+=Math.atan2(ut-lt,et-Z)-Math.atan2(A-lt,E-Z),E=et,A=ut}}else{const ct=E-S,Z=A-_,lt=Math.hypot(ct,Z);g&&(S+=ct/lt*g,_+=Z/lt*g),m&&(E-=ct/lt*m,A-=Z/lt*m)}const k=T+F,I=k+b,N=k-b,R=E-C*Math.cos(I),D=A-C*Math.sin(I),L=E-C*Math.cos(N),P=A-C*Math.sin(N),B=M<1e5?`A${M},${M} 0,0,${F>0?1:0} `:"L",G=C?`M${R},${D}L${E},${A}L${L},${P}`:"";return`M${S},${_}${B}${E},${A}${G}`}).call(sn,this,r)).node()}}function cAt(t=1){if(typeof t=="number")return Hn(Math.sign(t));if(typeof t=="function")return(e,n,r,i)=>Math.sign(t(e,n,r,i));switch(zi(t,"sweep",["+x","-x","+y","-y"])){case"+x":return(e,n,r)=>Fe(e,r);case"-x":return(e,n,r)=>Tf(e,r);case"+y":return(e,n,r,i)=>Fe(n,i);case"-y":return(e,n,r,i)=>Tf(n,i)}}function lAt([t,e],[n,r],i,s){const o=n-t,a=r-e,u=Math.hypot(o,a),c=s*Math.sqrt(i*i-u*u/4)/u;return[(t+n)/2-a*c,(e+r)/2+o*c]}function U4([t,e,n],[r,i,s],o){const a=r-t,u=i-e,c=Math.hypot(a,u),l=(a*a+u*u-s*s+n*n)/(2*c),f=o*Math.sqrt(n*n-l*l);return[t+(a*l+u*f)/c,e+(u*l-a*f)/c]}function fAt(t,{x:e,x1:n,x2:r,y:i,y1:s,y2:o,...a}={}){return[n,r]=Sx(e,n,r),[s,o]=Sx(i,s,o),new MK(t,{...a,x1:n,x2:r,y1:s,y2:o})}const dAt={ariaLabel:"bar"};class yF extends Ce{constructor(e,n,r={},i=dAt){super(e,n,r,i),iF(this,r),sF(this,r)}render(e,n,r,i,s){const{rx:o,ry:a,rx1y1:u,rx1y2:c,rx2y1:l,rx2y2:f}=this,d=this._x(n,r,i),h=this._y(n,r,i),p=this._width(n,r,i),g=this._height(n,r,i);return ne("svg:g",s).call(Pe,this,i,s).call(this._transform,this,n).call(m=>m.selectAll().data(e).enter().call(u||c||l||f?y=>y.append("path").call(Se,this).call(oF,d,h,j4(d,p),j4(h,g),this).call(sn,this,r):y=>y.append("rect").call(Se,this).attr("x",d).attr("width",p).attr("y",h).attr("height",g).call(Et,"rx",o).call(Et,"ry",a).call(sn,this,r))).node()}_x(e,{x:n},{marginLeft:r}){const{insetLeft:i}=this;return n?s=>n[s]+i:r+i}_y(e,{y:n},{marginTop:r}){const{insetTop:i}=this;return n?s=>n[s]+i:r+i}_width({x:e},{x:n},{marginRight:r,marginLeft:i,width:s}){const{insetLeft:o,insetRight:a}=this,u=n&&e?e.bandwidth():s-r-i;return Math.max(0,u-o-a)}_height({y:e},{y:n},{marginTop:r,marginBottom:i,height:s}){const{insetTop:o,insetBottom:a}=this,u=n&&e?e.bandwidth():s-r-i;return Math.max(0,u-o-a)}}function j4(t,e){return typeof t=="function"&&typeof e=="function"?n=>t(n)+e(n):typeof t=="function"?n=>t(n)+e:typeof e=="function"?n=>t+e(n):t+e}class bF extends yF{constructor(e,n={},r){const{x1:i,x2:s,y:o}=n;super(e,{x1:{value:i,scale:"x"},x2:{value:s,scale:"x"},y:{value:o,scale:"y",type:"band",optional:!0}},n,r)}_transform(e,n,{x:r}){e.call(Me,n,{x:r},0,0)}_x({x:e},{x1:n,x2:r},{marginLeft:i}){const{insetLeft:s}=this;return Zo(e)?i+s:o=>Math.min(n[o],r[o])+s}_width({x:e},{x1:n,x2:r},{marginRight:i,marginLeft:s,width:o}){const{insetLeft:a,insetRight:u}=this;return Zo(e)?o-i-s-a-u:c=>Math.max(0,Math.abs(r[c]-n[c])-a-u)}}class vF extends yF{constructor(e,n={},r){const{x:i,y1:s,y2:o}=n;super(e,{y1:{value:s,scale:"y"},y2:{value:o,scale:"y"},x:{value:i,scale:"x",type:"band",optional:!0}},n,r)}_transform(e,n,{y:r}){e.call(Me,n,{y:r},0,0)}_y({y:e},{y1:n,y2:r},{marginTop:i}){const{insetTop:s}=this;return Zo(e)?i+s:o=>Math.min(n[o],r[o])+s}_height({y:e},{y1:n,y2:r},{marginTop:i,marginBottom:s,height:o}){const{insetTop:a,insetBottom:u}=this;return Zo(e)?o-i-s-a-u:c=>Math.max(0,Math.abs(r[c]-n[c])-a-u)}}function rf(t,e={}){return eg(e)||(e={...e,y:Ln,x2:St}),new bF(t,N_(KI(I_(e))))}function sf(t,e={}){return eg(e)||(e={...e,x:Ln,y2:St}),new vF(t,O_(QI(F_(e))))}const hAt={ariaLabel:"cell"};class B_ extends yF{constructor(e,{x:n,y:r,...i}={}){super(e,{x:{value:n,scale:"x",type:"band",optional:!0},y:{value:r,scale:"y",type:"band",optional:!0}},i,hAt)}_transform(e,n){e.call(Me,n,{},0,0)}}function mh(t,{x:e,y:n,...r}={}){return[e,n]=ro(e,n),new B_(t,{...r,x:e,y:n})}function pAt(t,{x:e=Ln,fill:n,stroke:r,...i}={}){return n===void 0&&qr(r)[0]===void 0&&(n=St),new B_(t,{...i,x:e,fill:n,stroke:r})}function gAt(t,{y:e=Ln,fill:n,stroke:r,...i}={}){return n===void 0&&qr(r)[0]===void 0&&(n=St),new B_(t,{...i,y:e,fill:n,stroke:r})}const mAt={ariaLabel:"dot",fill:"none",stroke:"currentColor",strokeWidth:1.5};function wF(t){return t.sort===void 0&&t.reverse===void 0?xH({channel:"-r"},t):t}class P_ extends Ce{constructor(e,n={}){const{x:r,y:i,r:s,rotate:o,symbol:a=np,frameAnchor:u}=n,[c,l]=cn(o,0),[f,d]=S2t(a),[h,p]=cn(s,f==null?3:4.5);super(e,{x:{value:r,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},r:{value:h,scale:"r",filter:iu,optional:!0},rotate:{value:c,optional:!0},symbol:{value:f,scale:"auto",optional:!0}},wF(n),mAt),this.r=p,this.rotate=l,this.symbol=d,this.frameAnchor=Oy(u);const{channels:g}=this,{symbol:m}=g;if(m){const{fill:y,stroke:b}=g;m.hint={fill:y?y.value===m.value?"color":"currentColor":this.fill??"currentColor",stroke:b?b.value===m.value?"color":"currentColor":this.stroke??"none"}}}render(e,n,r,i,s){const{x:o,y:a}=n,{x:u,y:c,r:l,rotate:f,symbol:d}=r,{r:h,rotate:p,symbol:g}=this,[m,y]=pa(this,i),b=g===np,w=l?void 0:h*h*Math.PI;return c_(h)&&(e=[]),ne("svg:g",s).call(Pe,this,i,s).call(Me,this,{x:u&&o,y:c&&a}).call(v=>v.selectAll().data(e).enter().append(b?"circle":"path").call(Se,this).call(b?x=>{x.attr("cx",u?S=>u[S]:m).attr("cy",c?S=>c[S]:y).attr("r",l?S=>l[S]:h)}:x=>{x.attr("transform",cp`translate(${u?S=>u[S]:m},${c?S=>c[S]:y})${f?S=>` rotate(${f[S]})`:p?` rotate(${p})`:""}`).attr("d",l&&d?S=>{const _=Qa();return d[S].draw(_,l[S]*l[S]*Math.PI),_}:l?S=>{const _=Qa();return g.draw(_,l[S]*l[S]*Math.PI),_}:d?S=>{const _=Qa();return d[S].draw(_,w),_}:(()=>{const S=Qa();return g.draw(S,w),S})())}).call(sn,this,r)).node()}}function pl(t,{x:e,y:n,...r}={}){return r.frameAnchor===void 0&&([e,n]=ro(e,n)),new P_(t,{...r,x:e,y:n})}function yAt(t,{x:e=St,...n}={}){return new P_(t,vX({...n,x:e}))}function bAt(t,{y:e=St,...n}={}){return new P_(t,bX({...n,y:e}))}function vAt(t,e){return pl(t,{...e,symbol:"circle"})}function wAt(t,e){return pl(t,{...e,symbol:"hexagon"})}const xAt={ariaLabel:"line",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class z_ extends Ce{constructor(e,n={}){const{x:r,y:i,z:s,curve:o,tension:a}=n;super(e,{x:{value:r,scale:"x"},y:{value:i,scale:"y"},z:{value:fl(n),optional:!0}},n,xAt),this.z=s,this.curve=wK(o,a),ig(this,n)}filter(e){return e}project(e,n,r){this.curve!==dp&&super.project(e,n,r)}render(e,n,r,i,s){const{x:o,y:a}=r,{curve:u}=this;return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,n).call(c=>c.selectAll().data(sX(e,[o,a],this,r)).enter().append("path").call(Se,this).call(mx,this,r).call($St,this,r,s).attr("d",u===dp&&s.projection?_At(s.projection,o,a):dI().curve(u).defined(l=>l>=0).x(l=>o[l]).y(l=>a[l]))).node()}}function _At(t,e,n){const r=eo(t);return e=si(e),n=si(n),i=>{let s=[];const o=[s];for(const a of i)a===-1?(s=[],o.push(s)):s.push([e[a],n[a]]);return r({type:"MultiLineString",coordinates:o})}}function U_(t,{x:e,y:n,...r}={}){return[e,n]=ro(e,n),new z_(t,{...r,x:e,y:n})}function j0(t,{x:e=St,y:n=Ln,...r}={}){return new z_(t,hF({...r,x:e,y:n}))}function q0(t,{x:e=Ln,y:n=St,...r}={}){return new z_(t,dF({...r,x:e,y:n}))}function CK(t,e){e=EAt(e);const{x:n,y:r,color:i,size:s}=e,o=lb(t,n),a=lb(t,r),u=lb(t,i),c=lb(t,s);let{fx:l,fy:f,x:{value:d,reduce:h,zero:p,...g},y:{value:m,reduce:y,zero:b,...w},color:{value:v,color:x,reduce:S},size:{value:_,reduce:E},mark:A}=e;if(h===void 0&&(h=y==null&&d==null&&_==null&&m!=null?"count":null),y===void 0&&(y=h==null&&m==null&&_==null&&d!=null?"count":null),E===void 0&&_==null&&S==null&&h==null&&y==null&&(d==null||Je(o))&&(m==null||Je(a))&&(E="count"),p===void 0&&(p=fb(h)?!0:void 0),b===void 0&&(b=fb(y)?!0:void 0),d==null&&m==null)throw new Error("must specify x or y");if(h!=null&&m==null)throw new Error("reducing x requires y");if(y!=null&&d==null)throw new Error("reducing y requires x");A===void 0&&(A=_!=null||E!=null?"dot":fb(h)||fb(y)||S!=null?"bar":d!=null&&m!=null?Je(o)||Je(a)||h==null&&y==null&&!qg(o)&&!qg(a)?"dot":"line":d!=null||m!=null?"rule":null);let $,T,C;switch(A){case"dot":C=pl,T="stroke";break;case"line":C=o&&a||h!=null||y!=null?b||y!=null||o&&qg(o)?q0:p||h!=null||a&&qg(a)?j0:U_:o?j0:q0,T="stroke",W4(u)&&($=null);break;case"area":C=!(b||y!=null)&&(p||h!=null||a&&qg(a))?U0:hp,T="fill",W4(u)&&($=null);break;case"rule":C=o?Gc:Yc,T="stroke";break;case"bar":C=h!=null?Je(a)?q4(h)&&o&&Je(o)?mh:rf:vx:y!=null?Je(o)?q4(y)&&a&&Je(a)?mh:sf:wx:S!=null||E!=null?o&&Je(o)&&a&&Je(a)?mh:o&&Je(o)?sf:a&&Je(a)?rf:aF:o&&gh(o)&&!(a&&gh(a))?rf:a&&gh(a)&&!(o&&gh(o))?sf:mh,T="fill";break;default:throw new Error(`invalid mark: ${A}`)}let F={fx:l,fy:f,x:o??void 0,y:a??void 0,[T]:u??x,z:$,r:c??void 0,tip:!0},M,k={[T]:S??void 0,r:E??void 0};if(h!=null&&y!=null)throw new Error("cannot reduce both x and y");return y!=null?(k.y=y,M=Je(o)?D0:oc):h!=null?(k.x=h,M=Je(a)?L0:ac):(S!=null||E!=null)&&(o&&a?M=Je(o)&&Je(a)?RI:Je(o)?ac:Je(a)?oc:Yl:o?M=Je(o)?D0:oc:a&&(M=Je(a)?L0:ac)),(M===Yl||M===oc)&&(F.x={value:o,...g}),(M===Yl||M===ac)&&(F.y={value:a,...w}),p===void 0&&(p=o&&!(M===Yl||M===oc)&&(C===rf||C===U0||C===vx||C===Yc)),b===void 0&&(b=a&&!(M===Yl||M===ac)&&(C===sf||C===hp||C===wx||C===Gc)),{fx:l??null,fy:f??null,x:{value:d??null,reduce:h??null,zero:!!p,...g},y:{value:m??null,reduce:y??null,zero:!!b,...w},color:{value:v??null,reduce:S??null,...x!==void 0&&{color:x}},size:{value:_??null,reduce:E??null},mark:A,markImpl:V4[C],markOptions:F,transformImpl:V4[M],transformOptions:k,colorMode:T}}function SAt(t,e){const n=CK(t,e),{fx:r,fy:i,x:{zero:s},y:{zero:o},markOptions:a,transformOptions:u,colorMode:c}=n,l=LT[n.markImpl],f=LT[n.transformImpl],d=r!=null||i!=null?uF({strokeOpacity:.1}):null,h=[s?Gc([0]):null,o?Yc([0]):null],p=l(t,f?f(u,a):a);return c==="stroke"?ms(d,h,p):ms(d,p,h)}function qg(t){let e,n;for(const r of t){if(r==null)continue;if(e===void 0){e=r;continue}const i=Math.sign(Fe(e,r));if(i){if(n!==void 0&&i!==n)return!1;e=r,n=i}}return!0}function EAt({x:t,y:e,color:n,size:r,fx:i,fy:s,mark:o}={}){return Ao(t)||(t=Bd(t)),Ao(e)||(e=Bd(e)),Ao(n)||(n=Ny(n)?{color:n}:Bd(n)),Ao(r)||(r=Bd(r)),Ao(i)&&({value:i}=Bd(i)),Ao(s)&&({value:s}=Bd(s)),o!=null&&(o=`${o}`.toLowerCase()),{x:t,y:e,color:n,size:r,fx:i,fy:s,mark:o}}function lb(t,e){const n=Kt(t,e.value);return n&&(n.label=ha(e.value)),n}function Bd(t){return AAt(t)?{reduce:t}:{value:t}}function fb(t){return/^(?:distinct|count|sum|proportion)$/i.test(t)}function q4(t){return/^(?:first|last|mode)$/i.test(t)}function AAt(t){if(t==null)return!1;if(typeof t.reduceIndex=="function"||typeof t.reduce=="function"&&Ss(t)||/^p\d{2}$/i.test(t))return!0;switch(`${t}`.toLowerCase()){case"first":case"last":case"count":case"distinct":case"sum":case"proportion":case"proportion-facet":case"deviation":case"min":case"min-index":case"max":case"max-index":case"mean":case"median":case"variance":case"mode":return!0}return!1}function W4(t){return t?new pu(t).size>t.length>>1:!1}const LT={dot:pl,line:U_,lineX:j0,lineY:q0,areaX:U0,areaY:hp,ruleX:Gc,ruleY:Yc,barX:rf,barY:sf,rect:aF,rectX:vx,rectY:wx,cell:mh,bin:Yl,binX:oc,binY:ac,group:RI,groupX:D0,groupY:L0},V4=Object.fromEntries(Object.entries(LT).map(([t,e])=>[e,t]));function xF(t,e={}){let{x:n,x1:r,x2:i}=e;n===void 0&&r===void 0&&i===void 0&&(e={...e,x:n=St});const s={};return n!=null&&(s.x=t),r!=null&&(s.x1=t),i!=null&&(s.x2=t),ta(s,e)}function _F(t,e={}){let{y:n,y1:r,y2:i}=e;n===void 0&&r===void 0&&i===void 0&&(e={...e,y:n=St});const s={};return n!=null&&(s.y=t),r!=null&&(s.y1=t),i!=null&&(s.y2=t),ta(s,e)}function ta(t={},e={}){const n=fl(e),r=Object.entries(t).map(([i,s])=>{const o=fH(i,e);if(o==null)throw new Error(`missing channel: ${i}`);const[a,u]=Ti(o);return{key:i,input:o,output:a,setOutput:u,map:$At(s)}});return{...io(e,(i,s)=>{const o=Kt(i,n),a=r.map(({input:c})=>Kt(i,c)),u=r.map(({setOutput:c})=>c(new Array(i.length)));for(const c of s)for(const l of o?al(c,f=>o[f]).values():[c])r.forEach(({map:f},d)=>f.mapIndex(l,a[d],u[d]));return{data:i,facets:s}}),...Object.fromEntries(r.map(({key:i,output:s})=>[i,s]))}}function $At(t){if(t==null)throw new Error("missing map");if(typeof t.mapIndex=="function")return t;if(typeof t.map=="function"&&Ss(t))return TAt(t);if(typeof t=="function")return zA($I(t));switch(`${t}`.toLowerCase()){case"cumsum":return MAt;case"rank":return zA((e,n)=>sq(e,r=>n[r]));case"quantile":return zA((e,n)=>kAt(e,r=>n[r]))}throw new Error(`invalid map: ${t}`)}function TAt(t){return console.warn("deprecated map interface; implement mapIndex instead."),{mapIndex:t.map.bind(t)}}function kAt(t,e){const n=O2(t,e)-1;return sq(t,e).map(r=>r/n)}function zA(t){return{mapIndex(e,n,r){const i=t(e,n);if(i.length!==e.length)throw new Error("map function returned a mismatched length");for(let s=0,o=e.length;s<o;++s)r[e[s]]=i[s]}}}const MAt={mapIndex(t,e,n){let r=0;for(const i of t)n[i]=r+=e[i]}};function CAt(t={},e){return arguments.length===1&&(e=t),xF(j_(t),e)}function IAt(t={},e){return arguments.length===1&&(e=t),_F(j_(t),e)}function j_(t={}){typeof t=="number"&&(t={k:t});let{k:e,reduce:n,shift:r,anchor:i,strict:s}=t;if(i===void 0&&r!==void 0&&(i=NAt(r),su(`Warning: the shift option is deprecated; please use anchor "${i}" instead.`)),!((e=Math.floor(e))>0))throw new Error(`invalid k: ${e}`);return OAt(n)(e,FAt(i,e),s)}function FAt(t="middle",e){switch(`${t}`.toLowerCase()){case"middle":return e-1>>1;case"start":return 0;case"end":return e-1}throw new Error(`invalid anchor: ${t}`)}function NAt(t){switch(`${t}`.toLowerCase()){case"centered":return"middle";case"leading":return"start";case"trailing":return"end"}throw new Error(`invalid shift: ${t}`)}function OAt(t="mean"){if(typeof t=="string"){if(/^p\d{2}$/i.test(t))return db(EI(t));switch(t.toLowerCase()){case"deviation":return db(Wp);case"max":return hb((e,n)=>Be(e,r=>n[r]));case"mean":return RAt;case"median":return db(Mf);case"min":return hb((e,n)=>wn(e,r=>n[r]));case"mode":return hb((e,n)=>iq(e,r=>n[r]));case"sum":return IK;case"variance":return db(vC);case"difference":return BAt;case"ratio":return PAt;case"first":return zAt;case"last":return UAt}}if(typeof t!="function")throw new Error(`invalid reduce: ${t}`);return hb($I(t))}function db(t){return(e,n,r)=>r?{mapIndex(i,s,o){const a=c=>s[c]==null?NaN:+s[c];let u=0;for(let c=0;c<e-1;++c)isNaN(a(c))&&++u;for(let c=0,l=i.length-e+1;c<l;++c)isNaN(a(c+e-1))&&++u,o[i[c+n]]=u===0?t(pf(i,c,c+e),a):NaN,isNaN(a(c))&&--u}}:{mapIndex(i,s,o){const a=u=>s[u]==null?NaN:+s[u];for(let u=-n;u<0;++u)o[i[u+n]]=t(pf(i,0,u+e),a);for(let u=0,c=i.length-n;u<c;++u)o[i[u+n]]=t(pf(i,u,u+e),a)}}}function hb(t){return(e,n,r)=>r?{mapIndex(i,s,o){let a=0;for(let u=0;u<e-1;++u)a+=Qn(s[i[u]]);for(let u=0,c=i.length-e+1;u<c;++u)a+=Qn(s[i[u+e-1]]),a===e&&(o[i[u+n]]=t(pf(i,u,u+e),s)),a-=Qn(s[i[u]])}}:{mapIndex(i,s,o){for(let a=-n;a<0;++a)o[i[a+n]]=t(pf(i,0,a+e),s);for(let a=0,u=i.length-n;a<u;++a)o[i[a+n]]=t(pf(i,a,a+e),s)}}}function IK(t,e,n){return n?{mapIndex(r,i,s){let o=0,a=0;for(let u=0;u<t-1;++u){const c=i[r[u]];c===null||isNaN(c)?++o:a+=+c}for(let u=0,c=r.length-t+1;u<c;++u){const l=i[r[u]],f=i[r[u+t-1]];f===null||isNaN(f)?++o:a+=+f,s[r[u+e]]=o===0?a:NaN,l===null||isNaN(l)?--o:a-=+l}}}:{mapIndex(r,i,s){let o=0;const a=r.length;for(let u=0,c=Math.min(a,t-e-1);u<c;++u)o+=+i[r[u]]||0;for(let u=-e,c=a-e;u<c;++u)o+=+i[r[u+t-1]]||0,s[r[u+e]]=o,o-=+i[r[u]]||0}}}function RAt(t,e,n){if(n){const r=IK(t,e,n);return{mapIndex(i,s,o){r.mapIndex(i,s,o);for(let a=0,u=i.length-t+1;a<u;++a)o[i[a+e]]/=t}}}else return{mapIndex(r,i,s){let o=0,a=0;const u=r.length;for(let c=0,l=Math.min(u,t-e-1);c<l;++c){let f=i[r[c]];f!==null&&!isNaN(f=+f)&&(o+=f,++a)}for(let c=-e,l=u-e;c<l;++c){let f=i[r[c+t-1]],d=i[r[c]];f!==null&&!isNaN(f=+f)&&(o+=f,++a),s[r[c+e]]=o/a,d!==null&&!isNaN(d=+d)&&(o-=d,--a)}}}}function DAt(t,e,n,r){for(let i=n+r;n<i;++n){const s=t[e[n]];if(Qn(s))return s}}function LAt(t,e,n,r){for(let i=n+r-1;i>=n;--i){const s=t[e[i]];if(Qn(s))return s}}function FK(t,e,n,r){for(let i=n+r;n<i;++n){let s=t[e[n]];if(s!==null&&!isNaN(s=+s))return s}}function NK(t,e,n,r){for(let i=n+r-1;i>=n;--i){let s=t[e[i]];if(s!==null&&!isNaN(s=+s))return s}}function BAt(t,e,n){return n?{mapIndex(r,i,s){for(let o=0,a=r.length-t;o<a;++o){const u=i[r[o]],c=i[r[o+t-1]];s[r[o+e]]=u===null||c===null?NaN:c-u}}}:{mapIndex(r,i,s){for(let o=-e,a=r.length-t+e+1;o<a;++o)s[r[o+e]]=NK(i,r,o,t)-FK(i,r,o,t)}}}function PAt(t,e,n){return n?{mapIndex(r,i,s){for(let o=0,a=r.length-t;o<a;++o){const u=i[r[o]],c=i[r[o+t-1]];s[r[o+e]]=u===null||c===null?NaN:c/u}}}:{mapIndex(r,i,s){for(let o=-e,a=r.length-t+e+1;o<a;++o)s[r[o+e]]=NK(i,r,o,t)/FK(i,r,o,t)}}}function zAt(t,e,n){return n?{mapIndex(r,i,s){for(let o=0,a=r.length-t;o<a;++o)s[r[o+e]]=i[r[o]]}}:{mapIndex(r,i,s){for(let o=-e,a=r.length-t+e+1;o<a;++o)s[r[o+e]]=DAt(i,r,o,t)}}}function UAt(t,e,n){return n?{mapIndex(r,i,s){for(let o=0,a=r.length-t;o<a;++o)s[r[o+e]]=i[r[o+t-1]]}}:{mapIndex(r,i,s){for(let o=-e,a=r.length-t+e+1;o<a;++o)s[r[o+e]]=LAt(i,r,o,t)}}}const ou={n:20,k:2,color:"currentColor",opacity:.2,strict:!0,anchor:"end"};function jAt(t,{x:e=St,y:n,k:r=ou.k,color:i=ou.color,opacity:s=ou.opacity,fill:o=i,fillOpacity:a=s,stroke:u=i,strokeOpacity:c,strokeWidth:l,...f}={}){return ms(je(o)?null:U0(t,ta({x1:mf({k:-r,...f}),x2:mf({k:r,...f})},{x1:e,x2:e,y:n,fill:o,fillOpacity:a,...f})),je(u)?null:j0(t,ta({x:mf(f)},{x:e,y:n,stroke:u,strokeOpacity:c,strokeWidth:l,...f})))}function qAt(t,{x:e,y:n=St,k:r=ou.k,color:i=ou.color,opacity:s=ou.opacity,fill:o=i,fillOpacity:a=s,stroke:u=i,strokeOpacity:c,strokeWidth:l,...f}={}){return ms(je(o)?null:hp(t,ta({y1:mf({k:-r,...f}),y2:mf({k:r,...f})},{x:e,y1:n,y2:n,fill:o,fillOpacity:a,...f})),je(u)?null:q0(t,ta({y:mf(f)},{x:e,y:n,stroke:u,strokeOpacity:c,strokeWidth:l,...f})))}function mf({n:t=ou.n,k:e=0,strict:n=ou.strict,anchor:r=ou.anchor}={}){return j_({k:t,reduce:i=>wy(i)+e*(Wp(i)||0),strict:n,anchor:r})}const WAt={ariaLabel:"tick",fill:null,stroke:"currentColor"};class OK extends Ce{constructor(e,n,r){super(e,n,r,WAt),ig(this,r)}render(e,n,r,i,s){return ne("svg:g",s).call(Pe,this,i,s).call(this._transform,this,n).call(o=>o.selectAll().data(e).enter().append("line").call(Se,this).attr("x1",this._x1(n,r,i)).attr("x2",this._x2(n,r,i)).attr("y1",this._y1(n,r,i)).attr("y2",this._y2(n,r,i)).call(sn,this,r).call(Uy,this,r,s)).node()}}class RK extends OK{constructor(e,n={}){const{x:r,y:i,inset:s=0,insetTop:o=s,insetBottom:a=s}=n;super(e,{x:{value:r,scale:"x"},y:{value:i,scale:"y",type:"band",optional:!0}},n),this.insetTop=Le(o),this.insetBottom=Le(a)}_transform(e,n,{x:r}){e.call(Me,n,{x:r},Xn,0)}_x1(e,{x:n}){return r=>n[r]}_x2(e,{x:n}){return r=>n[r]}_y1({y:e},{y:n},{marginTop:r}){const{insetTop:i}=this;return n&&e?s=>n[s]+i:r+i}_y2({y:e},{y:n},{height:r,marginBottom:i}){const{insetBottom:s}=this;return n&&e?o=>n[o]+e.bandwidth()-s:r-i-s}}class DK extends OK{constructor(e,n={}){const{x:r,y:i,inset:s=0,insetRight:o=s,insetLeft:a=s}=n;super(e,{y:{value:i,scale:"y"},x:{value:r,scale:"x",type:"band",optional:!0}},n),this.insetRight=Le(o),this.insetLeft=Le(a)}_transform(e,n,{y:r}){e.call(Me,n,{y:r},0,Xn)}_x1({x:e},{x:n},{marginLeft:r}){const{insetLeft:i}=this;return n&&e?s=>n[s]+i:r+i}_x2({x:e},{x:n},{width:r,marginRight:i}){const{insetRight:s}=this;return n&&e?o=>n[o]+e.bandwidth()-s:r-i-s}_y1(e,{y:n}){return r=>n[r]}_y2(e,{y:n}){return r=>n[r]}}function LK(t,{x:e=St,...n}={}){return new RK(t,{...n,x:e})}function BK(t,{y:e=St,...n}={}){return new DK(t,{...n,y:e})}function VAt(t,{x:e=St,y:n=null,r,fill:i="#ccc",fillOpacity:s,stroke:o="currentColor",strokeOpacity:a,strokeWidth:u=2,sort:c,...l}={}){const f=n!=null?L0:OI;return ms(Yc(t,f({x1:SF,x2:EF},{x:e,y:n,stroke:o,strokeOpacity:a,...l})),rf(t,f({x1:"p25",x2:"p75"},{x:e,y:n,fill:i,fillOpacity:s,...l})),LK(t,f({x:"p50"},{x:e,y:n,stroke:o,strokeOpacity:a,strokeWidth:u,sort:c,...l})),pl(t,ta({x:PK},{x:e,y:n,z:n,r,stroke:o,strokeOpacity:a,...l})))}function GAt(t,{y:e=St,x:n=null,r,fill:i="#ccc",fillOpacity:s,stroke:o="currentColor",strokeOpacity:a,strokeWidth:u=2,sort:c,...l}={}){const f=n!=null?D0:OI;return ms(Gc(t,f({y1:SF,y2:EF},{x:n,y:e,stroke:o,strokeOpacity:a,...l})),sf(t,f({y1:"p25",y2:"p75"},{x:n,y:e,fill:i,fillOpacity:s,...l})),BK(t,f({y:"p50"},{x:n,y:e,stroke:o,strokeOpacity:a,strokeWidth:u,sort:c,...l})),pl(t,ta({y:PK},{x:n,y:e,z:n,r,stroke:o,strokeOpacity:a,...l})))}function PK(t){const e=SF(t),n=EF(t);return t.map(r=>r<e||r>n?r:NaN)}function SF(t){const e=zK(t)*2.5-UK(t)*1.5;return wn(t,n=>n>=e?n:NaN)}function EF(t){const e=UK(t)*2.5-zK(t)*1.5;return Be(t,n=>n<=e?n:NaN)}function zK(t){return Xo(t,.25)}function UK(t){return Xo(t,.75)}const YAt={ariaLabel:"raster",stroke:null,pixelSize:1};function Pd(t,e){const n=+t;if(isNaN(n))throw new Error(`invalid ${e}: ${t}`);return n}function G4(t,e){const n=Math.floor(t);if(isNaN(n))throw new Error(`invalid ${e}: ${t}`);return n}class jK extends Ce{constructor(e,n,r={},i){let{width:s,height:o,x:a,y:u,x1:c=a==null?0:void 0,y1:l=u==null?0:void 0,x2:f=a==null?s:void 0,y2:d=u==null?o:void 0,pixelSize:h=i.pixelSize,blur:p=0,interpolate:g}=r;if(s!=null&&(s=G4(s,"width")),o!=null&&(o=G4(o,"height")),c!=null&&(c=Pd(c,"x1")),l!=null&&(l=Pd(l,"y1")),f!=null&&(f=Pd(f,"x2")),d!=null&&(d=Pd(d,"y2")),a==null&&(c==null||f==null))throw new Error("missing x");if(u==null&&(l==null||d==null))throw new Error("missing y");e!=null&&s!=null&&o!=null&&(a===void 0&&c!=null&&f!=null&&(a=n$t(c,f,s)),u===void 0&&l!=null&&d!=null&&(u=r$t(l,d,s,o))),super(e,{x:{value:a,scale:"x",optional:!0},y:{value:u,scale:"y",optional:!0},x1:{value:c==null?null:[c],scale:"x",optional:!0,filter:null},y1:{value:l==null?null:[l],scale:"y",optional:!0,filter:null},x2:{value:f==null?null:[f],scale:"x",optional:!0,filter:null},y2:{value:d==null?null:[d],scale:"y",optional:!0,filter:null},...n},r,i),this.width=s,this.height=o,this.pixelSize=Pd(h,"pixelSize"),this.blur=Pd(p,"blur"),this.interpolate=a==null||u==null?null:XAt(g)}}class qK extends jK{constructor(e,n={}){const{imageRendering:r}=n;if(e==null){const{fill:i,fillOpacity:s}=n;cn(s)[0]!==void 0&&(n=BT("fillOpacity",n)),qr(i)[0]!==void 0&&(n=BT("fill",n))}super(e,void 0,n,YAt),this.imageRendering=hn(r,"auto")}scale(e,{color:n,...r},i){return super.scale(e,r,i)}render(e,n,r,i,s){var k;const o=n[(k=r.channels.fill)==null?void 0:k.scale]??(I=>I),{x:a,y:u}=r,{document:c}=s,[l,f,d,h]=VK(r,i,s),p=d-l,g=h-f,{pixelSize:m,width:y=Math.round(Math.abs(p)/m),height:b=Math.round(Math.abs(g)/m)}=this,w=y*b;let{fill:v,fillOpacity:x}=r,S=0;if(this.interpolate){const I=y/p,N=b/g,R=Te(a,L=>(L-l)*I,Float64Array),D=Te(u,L=>(L-f)*N,Float64Array);v&&(v=this.interpolate(e,y,b,R,D,v)),x&&(x=this.interpolate(e,y,b,R,D,x))}else this.data==null&&e&&(S=e.fi*w);const _=c.createElement("canvas");_.width=y,_.height=b;const E=_.getContext("2d"),A=E.createImageData(y,b),$=A.data;let{r:T,g:C,b:F}=li(this.fill)??{r:0,g:0,b:0},M=(this.fillOpacity??1)*255;for(let I=0;I<w;++I){const N=I<<2;if(v){const R=o(v[I+S]);if(R==null){$[N+3]=0;continue}({r:T,g:C,b:F}=li(R))}x&&(M=x[I+S]*255),$[N+0]=T,$[N+1]=C,$[N+2]=F,$[N+3]=M}return this.blur>0&&Ept(A,this.blur),E.putImageData(A,0,0),ne("svg:g",s).call(Pe,this,i,s).call(Me,this,n).call(I=>I.append("image").attr("transform",`translate(${l},${f}) scale(${Math.sign(d-l)},${Math.sign(h-f)})`).attr("width",Math.abs(p)).attr("height",Math.abs(g)).attr("preserveAspectRatio","none").call(Et,"image-rendering",this.imageRendering).call(Se,this).attr("xlink:href",_.toDataURL())).node()}}function WK(t,e,n){arguments.length<3&&(n=e,e=null);let{x:r,y:i,[t]:s,...o}=n;return r===void 0&&i===void 0&&l2t(e)&&(r=h_,i=N0,s===void 0&&(s=o2t)),[e,{...o,x:r,y:i,[t]:s}]}function HAt(){const[t,e]=WK("fill",...arguments);return new qK(t,t==null||e.fill!==void 0||e.fillOpacity!==void 0?e:{...e,fill:St})}function VK({x1:t,y1:e,x2:n,y2:r},i,{projection:s}){const{width:o,height:a,marginTop:u,marginRight:c,marginBottom:l,marginLeft:f}=i;return[t&&s==null?t[0]:f,e&&s==null?e[0]:u,n&&s==null?n[0]:o-c,r&&s==null?r[0]:a-l]}function GK({x1:t,y1:e,x2:n,y2:r},i,s,o){const a={};return t&&(a.x1=t),e&&(a.y1=e),n&&(a.x2=n),r&&(a.y2=r),VK(UI(a,i),s,o)}function BT(t,e={}){const{[t]:n}=e;if(typeof n!="function")throw new Error(`invalid ${t}: not a function`);return Vr({...e,[t]:void 0},function(r,i,s,o,a,u){const{x:c,y:l}=o;if(!c)throw new Error("missing scale: x");if(!l)throw new Error("missing scale: y");const[f,d,h,p]=GK(s,o,a,u),g=h-f,m=p-d,{pixelSize:y}=this,{width:b=Math.round(Math.abs(g)/y),height:w=Math.round(Math.abs(m)/y)}=e,v=new Array(b*w*(i?i.length:1)),x=g/b,S=m/w;let _=0;for(const E of i??[void 0])for(let A=.5;A<w;++A)for(let $=.5;$<b;++$,++_)v[_]=n(c.invert(f+$*x),l.invert(d+A*S),E);return{data:v,facets:i,channels:{[t]:{value:v,scale:"auto"}}}})}function XAt(t){if(typeof t=="function")return t;if(t==null)return PT;switch(`${t}`.toLowerCase()){case"none":return PT;case"nearest":return HK;case"barycentric":return YK();case"random-walk":return XK()}throw new Error(`invalid interpolate: ${t}`)}function PT(t,e,n,r,i,s){const o=new Array(e*n);for(const a of t)r[a]<0||r[a]>=e||i[a]<0||i[a]>=n||(o[Math.floor(i[a])*e+Math.floor(r[a])]=s[a]);return o}function YK({random:t=KC(42)}={}){return(e,n,r,i,s,o)=>{const{points:a,triangles:u,hull:c}=Mu.from(e,h=>i[h],h=>s[h]),l=new o.constructor(n*r).fill(NaN),f=new Uint8Array(n*r),d=e$t(o,t);for(let h=0;h<u.length;h+=3){const p=u[h],g=u[h+1],m=u[h+2],y=a[2*p],b=a[2*g],w=a[2*m],v=a[2*p+1],x=a[2*g+1],S=a[2*m+1],_=Math.min(y,b,w),E=Math.max(y,b,w),A=Math.min(v,x,S),$=Math.max(v,x,S),T=(x-S)*(y-w)+(v-S)*(w-b);if(!T)continue;const C=o[e[p]],F=o[e[g]],M=o[e[m]];for(let k=Math.floor(_);k<E;++k)for(let I=Math.floor(A);I<$;++I){if(k<0||k>=n||I<0||I>=r)continue;const N=k+.5,R=I+.5,D=Math.sign(T),L=(x-S)*(N-w)+(R-S)*(w-b);if(L*D<0)continue;const P=(S-v)*(N-w)+(R-S)*(y-w);if(P*D<0)continue;const B=T-(L+P);if(B*D<0)continue;const G=k+n*I;l[G]=d(C,L/T,F,P/T,M,B/T,k,I),f[G]=1}}return KAt(l,f,i,s,o,n,r,c,e,d),l}}function KAt(t,e,n,r,i,s,o,a,u,c){n=Float64Array.from(a,h=>n[u[h]]),r=Float64Array.from(a,h=>r[u[h]]),i=Array.from(a,h=>i[u[h]]);const l=n.length,f=Array.from({length:l},(h,p)=>JAt(p,n,r));let d=0;for(let h=0;h<o;++h){const p=h+.5;for(let g=0;g<s;++g){const m=g+s*h;if(!e[m]){const y=g+.5;for(let b=0;b<l;++b){const w=(l+d+(b%2?(b+1)/2:-b/2))%l;if(f[w](y,p)){const v=QAt(n.at(w-1),r.at(w-1),n[w],r[w],y,p);t[m]=c(i.at(w-1),v,i[w],1-v,i[w],0,g,h),d=w;break}}}}}}function QAt(t,e,n,r,i,s){const o=n-t,a=r-e,u=o*(n-i)+a*(r-s),c=o*(i-t)+a*(s-e);return u>0&&c>0?u/(u+c):+(u>c)}function Wg(t,e,n,r){return t*r-n*e}function JAt(t,e,n){const r=e.length,i=e.at(t-2),s=n.at(t-2),o=e.at(t-1),a=n.at(t-1),u=e[t],c=n[t],l=e.at(t+1-r),f=n.at(t+1-r),d=o-u,h=a-c,p=i-o,g=s-a,m=u-l,y=c-f,b=Math.hypot(d,h),w=Math.hypot(p,g),v=Math.hypot(m,y);return(x,S)=>{const _=x-o,E=S-a,A=x-u,$=S-c;return Wg(_,E,A,$)>-1e-6&&Wg(_,E,d,h)*w-Wg(_,E,p,g)*b>-1e-6&&Wg(A,$,m,y)*b-Wg(A,$,d,h)*v<=0}}function HK(t,e,n,r,i,s){const o=new s.constructor(e*n),a=Mu.from(t,l=>r[l],l=>i[l]);let u,c;for(let l=.5,f=0;l<n;++l){c=u;for(let d=.5;d<e;++d,++f)c=a.find(d,l,c),d===.5&&(u=c),o[f]=s[t[c]]}return o}function XK({random:t=KC(42),minDistance:e=.5,maxSteps:n=2}={}){return(r,i,s,o,a,u)=>{const c=new u.constructor(i*s),l=Mu.from(r,p=>o[p],p=>a[p]);let f,d,h;for(let p=.5,g=0;p<s;++p){d=f;for(let m=.5;m<i;++m,++g){let y=m,b=p;h=d=l.find(y,b,d),m===.5&&(f=d);let w,v=0;for(;(w=Math.hypot(o[r[h]]-y,a[r[h]]-b))>e&&v<n;){const x=t(m,p,v)*2*Math.PI;y+=Math.cos(x)*w,b+=Math.sin(x)*w,h=l.find(y,b,h),++v}c[g]=u[r[h]]}}return c}}function ZAt(t,e,n,r,i,s){return e*t+r*n+s*i}function t$t(t){return(e,n,r,i,s,o,a,u)=>{const c=t(a,u);return c<n?e:c<n+i?r:s}}function e$t(t,e){return gh(t)||Wr(t)?ZAt:t$t(e)}function n$t(t,e,n){return{transform(r){const i=r.length,s=new Float64Array(i),o=(e-t)/n,a=t+o/2;for(let u=0;u<i;++u)s[u]=u%n*o+a;return s}}}function r$t(t,e,n,r){return{transform(i){const s=i.length,o=new Float64Array(s),a=(e-t)/r,u=t+a/2;for(let c=0;c<s;++c)o[c]=Math.floor(c/n)%r*a+u;return o}}}const Y4={ariaLabel:"contour",fill:"none",stroke:"currentColor",strokeMiterlimit:1,pixelSize:2};let KK=class extends jK{constructor(e,{smooth:n=!0,value:r,...i}={}){const s=iX({},i,Y4);if(r===void 0){for(const a in s)if(s[a].value!=null){if(r!==void 0)throw new Error("ambiguous contour value");r=i[a],i[a]="value"}}if(r!=null){const a={transform:u=>u.map(c=>c.value),label:ha(r)};for(const u in s)i[u]==="value"&&(i[u]=a)}if(e==null){if(r==null)throw new Error("missing contour value");i=BT("value",{value:r,...i}),r=null}else{let{interpolate:a}=i;r===void 0&&(r=St),a===void 0&&(i.interpolate="nearest")}super(e,{value:{value:r,optional:!0}},i$t(i),Y4);const o={geometry:{value:St}};for(const a in this.channels){const u=this.channels[a],{scale:c}=u;c==="x"||c==="y"||a==="value"||(o[a]=u,delete this.channels[a])}this.contourChannels=o,this.smooth=!!n}filter(e,{x:n,y:r,value:i,...s},o){return super.filter(e,s,o)}render(e,n,r,i,s){const{geometry:o}=r,a=eo();return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,n).call(u=>{u.selectAll().data(e).enter().append("path").call(Se,this).attr("d",c=>a(o[c])).call(sn,this,r)}).node()}};function i$t({thresholds:t,interval:e,...n}){return t=_K(t,e,SC),Vr(n,function(r,i,s,o,a,u){const[c,l,f,d]=GK(s,o,a,u),h=f-c,p=d-l,{pixelSize:g,width:m=Math.round(Math.abs(h)/g),height:y=Math.round(Math.abs(p)/g)}=this,b=m/h,w=y/p,v=s.value.value,x=[];if(this.interpolate){const{x:$,y:T}=zy(s,o,u),C=Te($,I=>(I-c)*b,Float64Array),F=Te(T,I=>(I-l)*w,Float64Array),M=[s.x,s.y,s.value],k=[C,F,v];for(const I of i){const N=this.filter(I,M,k);x.push(this.interpolate(N,m,y,C,F,v))}}else if(i){const $=m*y,T=i.length;for(let C=0;C<T;++C)x.push(v.slice(C*$,C*$+$))}else x.push(v);if(this.blur>0)for(const $ of x)Gj({data:$,width:m,height:y},this.blur);const S=s$t(t,v,...a$t(x));if(S===null)throw new Error(`unsupported thresholds: ${t}`);const{contour:_}=H3().size([m,y]).smooth(this.smooth),E=[],A=[];for(const $ of x)A.push(xn(E.length,E.push(...Te(S,T=>_($,T)))));for(const{coordinates:$}of E)for(const T of $)for(const C of T)for(const F of C)F[0]=F[0]/b+c,F[1]=F[1]/w+l;return{data:E,facets:A,channels:CH(this.contourChannels,E)}})}function s$t(t,e,n,r){if(typeof(t==null?void 0:t.range)=="function")return t.range(t.floor(n),r);if(typeof t=="function"&&(t=t(e,n,r)),typeof t!="number")return vu(t);const i=Lc(...Zj(n,r,t),t);for(;i[i.length-1]>=r;)i.pop();for(;i[1]<n;)i.shift();return i}function o$t(){return new KK(...WK("value",...arguments))}function a$t(t){return[wn(t,e=>wn(e,H4)),Be(t,e=>Be(e,H4))]}function H4(t){return isFinite(t)?t:NaN}function u$t(t,e){return AF(A_,t,e)}function c$t(t,e={}){return AF($_,t,e)}function l$t(t,e={}){return AF(z0,t,e)}function AF(t,e,n={}){const{x:r,y:i,maxRadius:s}=n,o=t({px:r,py:i,maxRadius:s}),a=[];r!=null&&a.push(Gc(e,X4("x",{...o,inset:-6},n))),i!=null&&a.push(Yc(e,X4("y",{...o,inset:-6},n))),r!=null&&a.push(lp(e,K4("x",{...o,dy:9,frameAnchor:"bottom",lineAnchor:"top"},n))),i!=null&&a.push(lp(e,K4("y",{...o,dx:-9,frameAnchor:"left",textAnchor:"end"},n)));for(const u of a)u.ariaLabel=`crosshair ${u.ariaLabel}`;return ms(...a)}function QK(t,{channels:e,...n},{facet:r,facetAnchor:i,fx:s,fy:o,[t]:a,channels:u,transform:c,initializer:l}){return{...n,facet:r,facetAnchor:i,fx:s,fy:o,[t]:a,channels:{...e,...u},transform:c,initializer:f$t(t,l)}}function f$t(t,e){return e==null?e:function(n,r,{x:i,y:s,px:o,py:a,...u},...c){const{channels:{x:l,y:f,...d}={},...h}=e.call(this,n,r,{...u,x:o,y:a},...c);return{channels:{...d,...l&&{px:l,...t==="x"&&{x:l}},...f&&{py:f,...t==="y"&&{y:f}}},...h}}}function X4(t,e,n){const{color:r="currentColor",opacity:i=.2,ruleStroke:s=r,ruleStrokeOpacity:o=i,ruleStrokeWidth:a}=n;return{...QK(t,e,n),stroke:s,strokeOpacity:o,strokeWidth:a}}function K4(t,e,n){const{color:r="currentColor",textFill:i=r,textFillOpacity:s,textStroke:o="var(--plot-background)",textStrokeOpacity:a,textStrokeWidth:u=5}=n;return{...QK(t,e,d$t(t,n)),fill:i,fillOpacity:s,stroke:o,strokeOpacity:a,strokeWidth:u}}function d$t(t,e){return Vr(e,(n,r,i)=>{var s;return{channels:{text:{value:(s=$T(i,t))==null?void 0:s.value}}}})}const h$t={ariaLabel:"delaunay link",fill:"none",stroke:"currentColor",strokeMiterlimit:1},p$t={ariaLabel:"delaunay mesh",fill:null,stroke:"currentColor",strokeOpacity:.2},g$t={ariaLabel:"hull",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:1},m$t={ariaLabel:"voronoi",fill:"none",stroke:"currentColor",strokeMiterlimit:1},y$t={ariaLabel:"voronoi mesh",fill:null,stroke:"currentColor",strokeOpacity:.2};class b$t extends Ce{constructor(e,n={}){const{x:r,y:i,z:s,curve:o,tension:a}=n;super(e,{x:{value:r,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},z:{value:s,optional:!0}},n,h$t),this.curve=fF(o,a),ig(this,n)}render(e,n,r,i,s){const{x:o,y:a}=n,{x:u,y:c,z:l}=r,{curve:f}=this,[d,h]=pa(this,i),p=u?b=>u[b]:Hn(d),g=c?b=>c[b]:Hn(h),m=this;function y(b){let w=-1;const v=[],x={};for(const M in r)x[M]=[];const S=[],_=[],E=[],A=[];function $(M,k){M=b[M],k=b[k],v.push(++w),S[w]=p(M),E[w]=g(M),_[w]=p(k),A[w]=g(k);for(const I in r)x[I].push(r[I][k])}const{halfedges:T,hull:C,triangles:F}=Mu.from(b,p,g);for(let M=0;M<T.length;++M){const k=T[M];k>M&&$(F[M],F[k])}for(let M=0;M<C.length;++M)$(C[M],C[(M+1)%C.length]);fr(this).selectAll().data(v).enter().append("path").call(Se,m).attr("d",M=>{const k=Qa(),I=f(k);return I.lineStart(),I.point(S[M],E[M]),I.point(_[M],A[M]),I.lineEnd(),k}).call(sn,m,x).call(Uy,m,x,s)}return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,{x:u&&o,y:c&&a}).call(l?b=>b.selectAll().data(al(e,w=>l[w]).values()).enter().append("g").each(y):b=>b.datum(e).each(y)).node()}}class $F extends Ce{constructor(e,n={},r,i=({z:s})=>s){const{x:s,y:o}=n;super(e,{x:{value:s,scale:"x",optional:!0},y:{value:o,scale:"y",optional:!0},z:{value:i(n),optional:!0}},n,r)}render(e,n,r,i,s){const{x:o,y:a}=n,{x:u,y:c,z:l}=r,[f,d]=pa(this,i),h=u?y=>u[y]:Hn(f),p=c?y=>c[y]:Hn(d),g=this;function m(y){const b=Mu.from(y,h,p);fr(this).append("path").datum(y[0]).call(Se,g).attr("d",g._render(b,i)).call(sn,g,r)}return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,{x:u&&o,y:c&&a}).call(l?y=>y.selectAll().data(al(e,b=>l[b]).values()).enter().append("g").each(m):y=>y.datum(e).each(m)).node()}}class v$t extends $F{constructor(e,n={}){super(e,n,p$t),this.fill="none"}_render(e){return e.render()}}class w$t extends $F{constructor(e,n={}){super(e,n,g$t,fl)}_render(e){return e.renderHull()}}let x$t=class extends Ce{constructor(e,n={}){const{x:r,y:i,z:s}=n;super(e,{x:{value:r,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},z:{value:s,optional:!0}},Vr(n,function(o,a,u,c,l,f){let{x:d,y:h,z:p}=u;({x:d,y:h}=zy(u,c,f)),p=p==null?void 0:p.value;const g=new Array((d??h).length).fill(null),[m,y]=pa(this,l),b=d?v=>d[v]:Hn(m),w=h?v=>h[v]:Hn(y);for(let v of a){d&&(v=v.filter(x=>Qn(b(x)))),h&&(v=v.filter(x=>Qn(w(x))));for(const[,x]of gf(v,p)){const S=Mu.from(x,b,w),_=JK(S,l);for(let E=0,A=x.length;E<A;++E)g[x[E]]=_.renderCell(E)}}return{data:o,facets:a,channels:{cells:{value:g}}}}),m$t)}render(e,n,r,i,s){const{x:o,y:a}=n,{x:u,y:c,cells:l}=r;return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,{x:u&&o,y:c&&a}).call(f=>{f.selectAll().data(e).enter().append("path").call(Se,this).attr("d",d=>l[d]).call(sn,this,r)}).node()}};class _$t extends $F{constructor(e,n){super(e,n,y$t),this.fill="none"}_render(e,n){return JK(e,n).render()}}function JK(t,e){const{width:n,height:r,marginTop:i,marginRight:s,marginBottom:o,marginLeft:a}=e;return t.voronoi([a,i,n-s,r-o])}function Wy(t,e,{x:n,y:r,...i}={}){return[n,r]=ro(n,r),new t(e,{...i,x:n,y:r})}function S$t(t,e){return Wy(b$t,t,e)}function E$t(t,e){return Wy(v$t,t,e)}function A$t(t,e){return Wy(w$t,t,e)}function $$t(t,{x:e,y:n,initializer:r,...i}={}){return Wy(x$t,t,{...io({...i,x:e,y:n},cK),initializer:r})}function T$t(t,e){return Wy(_$t,t,e)}const k$t={ariaLabel:"density",fill:"none",stroke:"currentColor",strokeMiterlimit:1};let ZK=class extends Ce{constructor(e,{x:n,y:r,z:i,weight:s,fill:o,stroke:a,...u}={}){const c=Q4(o)&&(o="currentColor",!0),l=Q4(a)&&(a="currentColor",!0);super(e,{x:{value:n,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},z:{value:fl({z:i,fill:o,stroke:a}),optional:!0},weight:{value:s,optional:!0}},I$t({...u,fill:o,stroke:a},c,l),k$t),c&&(this.fill=void 0),l&&(this.stroke=void 0),this.z=i}filter(e){return e}render(e,n,r,i,s){const{contours:o}=r,a=eo();return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,{}).call(u=>u.selectAll().data(e).enter().append("path").call(Se,this).call(sn,this,r).attr("d",c=>a(o[c]))).node()}};function M$t(t,{x:e,y:n,...r}={}){return[e,n]=ro(e,n),new ZK(t,{...r,x:e,y:n})}const C$t=new Set(["x","y","z","weight"]);function I$t(t,e,n){let{bandwidth:i,thresholds:s}=t;return i=i===void 0?20:+i,s=s===void 0?20:typeof(s==null?void 0:s[Symbol.iterator])=="function"?si(s):+s,Vr(t,function(o,a,u,c,l,f){var F;const d=u.weight?si(u.weight.value):null,h=(F=u.z)==null?void 0:F.value,{z:p}=this,[g,m]=pa(this,l),{width:y,height:b}=l,{x:w,y:v}=zy(u,c,f),x=Object.fromEntries(Object.entries(u).filter(([M])=>!C$t.has(M)).map(([M,k])=>[M,{...k,value:[]}])),S=e&&[],_=n&&[],E=Zyt().x(w?M=>w[M]:g).y(v?M=>v[M]:m).weight(d?M=>d[M]:1).size([y,b]).bandwidth(i),A=[];for(const M of a){const k=[];A.push(k);for(const I of h?YI(M,h,p):[M]){const N=E.contours(I);k.push([I,N])}}let $=s;if(!($ instanceof d_)){let M=0;for(const k of A)for(const[,I]of k){const N=I.max;N>M&&(M=N)}$=Float64Array.from({length:s-1},(k,I)=>M*100*(I+1)/s)}const T=[],C=[];for(const M of A){const k=[];T.push(k);for(const[I,N]of M)for(const R of $){k.push(C.length),C.push(N(R/100)),S&&S.push(R),_&&_.push(R);for(const D in x)x[D].value.push(u[D].value[I[0]])}}return S&&S.push(0),_&&_.push(0),{data:o,facets:T,channels:{...x,...S&&{fill:{value:S,scale:"color"}},..._&&{stroke:{value:_,scale:"color"}},contours:{value:C}}}})}function Q4(t){return/^density$/i.test(t)}function F$t(t,e){return tQ("x",t,e)}function N$t(t,e){return tQ("y",t,e)}function tQ(t,e,{x1:n,x2:r,y1:i,y2:s,x:o=n===void 0&&r===void 0?t==="y"?Ln:St:void 0,y:a=i===void 0&&s===void 0?t==="x"?Ln:St:void 0,fill:u,positiveFill:c="#3ca951",negativeFill:l="#4269d0",fillOpacity:f=1,positiveFillOpacity:d=f,negativeFillOpacity:h=f,stroke:p,strokeOpacity:g,z:m=qr(p)[0],clip:y,tip:b,render:w,...v}={}){return[n,r]=J4(o,n,r),[i,s]=J4(a,i,s),n===r&&i===s&&(t==="y"?i=ja(0):n=ja(0)),{tip:b}=cd({tip:b},t==="y"?"x":"y"),ms(je(c)?null:Object.assign(DT(e,{x1:n,x2:r,y1:i,y2:s,z:m,fill:c,fillOpacity:d,render:up(w,Z4(t,!0)),clip:y,...v}),{ariaLabel:"positive difference"}),je(l)?null:Object.assign(DT(e,{x1:n,x2:r,y1:i,y2:s,z:m,fill:l,fillOpacity:h,render:up(w,Z4(t,!1)),clip:y,...v}),{ariaLabel:"negative difference"}),U_(e,{x:r,y:s,z:m,stroke:p,strokeOpacity:g,tip:b,clip:!0,...v}))}function J4(t,e,n){return e===void 0&&n===void 0?e=n=ja(t):e===void 0?(n=ja(n),e=t===void 0?n:ja(t)):n===void 0?(e=ja(e),n=t===void 0?e:ja(t)):(e=ja(e),n=ja(n)),[e,n]}function ja(t){let e;const{value:n,label:r=ha(n)}=rg(t);return{transform:i=>e||(e=Kt(i,n)),label:r}}function Z4(t,e){const n=t==="x"?"y":"x",r=`${n}1`,i=`${n}2`,s=`${t}1`,o=`${t}2`;return(a,u,c,l,f,d)=>{const{[r]:h,[i]:p}=c,g=new Float32Array(h.length),m=new Float32Array(p.length),y=l[t==="y"?"height":"width"];(e===VH(u[t])<0?g:m).fill(y);const b=d(a,u,{...c,[i]:h,[o]:m},l,f),w=d(a,u,{...c,[r]:p,[s]:g},l,f),v=b.querySelector("g")??b,x=w.querySelector("g")??w;for(let S=0;v.firstChild;S+=2){const _=rX(),E=ne("svg:clipPath",f).attr("id",_).node();E.appendChild(v.firstChild),x.childNodes[S].setAttribute("clip-path",`url(#${_})`),x.insertBefore(E,x.childNodes[S])}return w}}function eQ({geometry:t=St,...e}={}){const n=op(r=>Kt(r,t));return Vr({...e,x:null,y:null,geometry:{transform:n}},(r,i,s,o,a,{projection:u})=>{const c=n(r),l=c.length,f=new Float64Array(l),d=new Float64Array(l),h=eo(u);for(let p=0;p<l;++p)[f[p],d[p]]=h.centroid(c[p]);return{data:r,facets:i,channels:{x:{value:f,scale:u==null?"x":null,source:null},y:{value:d,scale:u==null?"y":null,source:null}}}})}function O$t({geometry:t=St,...e}={}){const n=op(i=>Kt(i,t)),r=op(i=>Kt(n(i),_W));return{...e,x:{transform:i=>Float64Array.from(r(i),([s])=>s)},y:{transform:i=>Float64Array.from(r(i),([,s])=>s)},geometry:{transform:n}}}const R$t={ariaLabel:"geo",fill:"none",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class nQ extends Ce{constructor(e,n={}){const[r,i]=cn(n.r,3);super(e,{x:{value:n.tip?n.x:null,scale:"x",optional:!0},y:{value:n.tip?n.y:null,scale:"y",optional:!0},r:{value:r,scale:"r",filter:iu,optional:!0},geometry:{value:n.geometry,scale:"projection"}},wF(n),R$t),this.r=i}render(e,n,r,i,s){const{geometry:o,r:a}=r,u=eo(s.projection??D$t(n)),{r:c}=this;return c_(c)?e=[]:c!==void 0&&u.pointRadius(c),ne("svg:g",s).call(Pe,this,i,s).call(Me,this,n).call(l=>{l.selectAll().data(e).enter().append("path").call(Se,this).attr("d",a?f=>u.pointRadius(a[f])(o[f]):f=>u(o[f])).call(sn,this,r)}).node()}}function D$t({x:t,y:e}){if(t||e)return t??(t=n=>n),e??(e=n=>n),tx({point(n,r){this.stream.point(t(n),e(r))}})}function TF(t,e={}){return e.tip&&e.x===void 0&&e.y===void 0?e=eQ(e):e.geometry===void 0&&(e={...e,geometry:St}),new nQ(t,e)}function L$t({strokeWidth:t=1.5,...e}={}){return TF({type:"Sphere"},{strokeWidth:t,...e})}function B$t({strokeOpacity:t=.1,...e}={}){return TF(Nbt(),{strokeOpacity:t,...e})}const Zm=.5,t0=0;function P$t(t={fill:"count"},{binWidth:e,...n}={}){const{z:r}=n;return e=e===void 0?20:Le(e),t=EH(t,n),hc(t,"fill")&&(n.channels={...n.channels,fill:{value:[]}}),n.symbol===void 0&&(n.symbol="hexagon"),n.r===void 0&&!hc(t,"r")&&(n.r=e/2),Vr(n,(i,s,o,a,u,c)=>{let{x:l,y:f,z:d,fill:h,stroke:p,symbol:g}=o;if(l===void 0)throw new Error("missing channel: x");if(f===void 0)throw new Error("missing channel: y");({x:l,y:f}=zy(o,a,c)),d=d?d.value:Kt(i,r),h=h==null?void 0:h.value,p=p==null?void 0:p.value,g=g==null?void 0:g.value;const m=BI(t,{z:d,fill:h,stroke:p,symbol:g}),y=d&&[],b=h&&[],w=p&&[],v=g&&[],x=[],S=[],_=[];let E=-1;for(const C of t)C.initialize(i);for(const C of s){const F=[];for(const M of t)M.scope("facet",C);for(const[M,k]of gf(C,m))for(const{index:I,extent:N}of z$t(i,k,l,f,e)){F.push(++E),S.push(N.x),_.push(N.y),d&&y.push(m===d?M:d[I[0]]),h&&b.push(m===h?M:h[I[0]]),p&&w.push(m===p?M:p[I[0]]),g&&v.push(m===g?M:g[I[0]]);for(const R of t)R.reduce(I,N)}x.push(F)}const A=o.x.scale,$=o.y.scale,T={x:{value:S,source:a[A]?{value:Te(S,a[A].invert),scale:A}:null},y:{value:_,source:a[$]?{value:Te(_,a[$].invert),scale:$}:null},...d&&{z:{value:y}},...h&&{fill:{value:b,scale:"auto"}},...p&&{stroke:{value:w,scale:"auto"}},...g&&{symbol:{value:v,scale:"auto"}},...Object.fromEntries(t.map(({name:C,output:F})=>[C,{scale:"auto",label:F.label,radius:C==="r"?e/2:void 0,value:F.transform()}]))};return{data:i,facets:x,channels:T}})}function z$t(t,e,n,r,i){const s=i*(1.5/vH),o=new Map;for(const a of e){let u=n[a],c=r[a];if(isNaN(u)||isNaN(c))continue;let l=Math.round(c=(c-t0)/s),f=Math.round(u=(u-Zm)/i-(l&1)/2),d=c-l;if(Math.abs(d)*3>1){let g=u-f,m=f+(u<f?-1:1)/2,y=l+(c<l?-1:1),b=u-m,w=c-y;g*g+d*d>b*b+w*w&&(f=m+(l&1?1:-1)/2,l=y)}const h=`${f},${l}`;let p=o.get(h);p===void 0&&(p={index:[],extent:{data:t,x:(f+(l&1)/2)*i+Zm,y:l*s+t0}},o.set(h,p)),p.index.push(a)}return o.values()}const U$t={ariaLabel:"hexgrid",fill:"none",stroke:"currentColor",strokeOpacity:.1};function j$t(t){return new rQ(t)}class rQ extends Ce{constructor({binWidth:e=20,clip:n=!0,...r}={}){super(Jm,void 0,{clip:n,...r},U$t),this.binWidth=Le(e)}render(e,n,r,i,s){const{binWidth:o}=this,{marginTop:a,marginRight:u,marginBottom:c,marginLeft:l,width:f,height:d}=i,h=l-Zm,p=f-u-Zm,g=a-t0,m=d-c-t0,y=o/2,b=y*wH,w=b/2,v=y*2,x=b*1.5,S=Math.floor(h/v),_=Math.ceil(p/v),E=Math.floor((g+w)/x),A=Math.ceil((m-w)/x)+1,$=`m0,${Wu(-b)}l${Wu(y)},${Wu(w)}v${Wu(b)}l${Wu(-y)},${Wu(w)}`;let T=$;for(let C=E;C<A;++C)for(let F=S;F<_;++F)T+=`M${Wu(F*v+(C&1)*y)},${Wu(C*x)}${$}`;return ne("svg:g",s).datum(0).call(Pe,this,i,s).call(Me,this,{},Xn+Zm,Xn+t0).call(C=>C.append("path").call(Se,this).call(sn,this,r).attr("d",T)).node()}}function Wu(t){return Math.round(t*1e3)/1e3}const q$t={ariaLabel:"image",fill:null,stroke:null};function W$t(t){return/^\.*\//.test(t)}function V$t(t){return/^(blob|data|file|http|https):/i.test(t)}function G$t(t){return typeof t=="string"&&(W$t(t)||V$t(t))?[void 0,t]:[t,void 0]}let iQ=class extends Ce{constructor(e,n={}){let{x:r,y:i,r:s,width:o,height:a,rotate:u,src:c,preserveAspectRatio:l,crossOrigin:f,frameAnchor:d,imageRendering:h}=n;s==null&&(s=void 0),s===void 0&&o===void 0&&a===void 0?o=a=16:o===void 0&&a!==void 0?o=a:a===void 0&&o!==void 0&&(a=o);const[p,g]=G$t(c),[m,y]=cn(s),[b,w]=cn(o,y!==void 0?y*2:void 0),[v,x]=cn(a,y!==void 0?y*2:void 0),[S,_]=cn(u,0);super(e,{x:{value:r,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},r:{value:m,scale:"r",filter:iu,optional:!0},width:{value:b,filter:iu,optional:!0},height:{value:v,filter:iu,optional:!0},rotate:{value:S,optional:!0},src:{value:p,optional:!0}},wF(n),q$t),this.src=g,this.width=w,this.rotate=_,this.height=x,this.r=y,this.preserveAspectRatio=hn(l,"xMidYMid"),this.crossOrigin=dr(f),this.frameAnchor=Oy(d),this.imageRendering=hn(h,"auto")}render(e,n,r,i,s){const{x:o,y:a}=n,{x:u,y:c,width:l,height:f,r:d,rotate:h,src:p}=r,{r:g,width:m,height:y,rotate:b}=this,[w,v]=pa(this,i);return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,{x:u&&o,y:c&&a}).call(x=>x.selectAll().data(e).enter().append("image").call(Se,this).attr("x",tL(u,l,d,w,m,g)).attr("y",tL(c,f,d,v,y,g)).attr("width",l?S=>l[S]:m!==void 0?m:d?S=>d[S]*2:g*2).attr("height",f?S=>f[S]:y!==void 0?y:d?S=>d[S]*2:g*2).attr("transform",h?S=>`rotate(${h[S]})`:b?`rotate(${b})`:null).attr("transform-origin",h||b?cp`${u?S=>u[S]:w}px ${c?S=>c[S]:v}px`:null).call(Et,"href",p?S=>p[S]:this.src).call(Et,"preserveAspectRatio",this.preserveAspectRatio).call(Et,"crossorigin",this.crossOrigin).call(Et,"image-rendering",this.imageRendering).call(Et,"clip-path",d?S=>`circle(${d[S]}px)`:g!==void 0?`circle(${g}px)`:null).call(sn,this,r)).node()}};function tL(t,e,n,r,i,s){return e&&t?o=>t[o]-e[o]/2:e?o=>r-e[o]/2:t&&i!==void 0?o=>t[o]-i/2:i!==void 0?r-i/2:n&&t?o=>t[o]-n[o]:n?o=>r-n[o]:t?o=>t[o]-s:r-s}function Y$t(t,{x:e,y:n,...r}={}){return r.frameAnchor===void 0&&([e,n]=ro(e,n)),new iQ(t,{...r,x:e,y:n})}function H$t(t,e,n){var r=1e-8,i=e-1,s=n-1,o=0,a,u,c,l,f,d,h,p;if(t<=0)return 0;if(t>=1)return 1;for(a=Math.log(e/(e+n)),u=Math.log(n/(e+n)),c=Math.exp(e*a)/e,l=Math.exp(n*u)/n,h=c+l,t<c/h?d=Math.pow(e*h*t,1/e):d=1-Math.pow(n*h*(1-t),1/n),p=-Oh(e)-Oh(n)+Oh(e+n);o<10;o++){if(d===0||d===1)return d;if(f=X$t(d,e,n)-t,c=Math.exp(i*Math.log(d)+s*Math.log(1-d)+p),l=f/c,d-=c=l/(1-.5*Math.min(1,l*(i/d-s/(1-d)))),d<=0&&(d=.5*(d+c)),d>=1&&(d=.5*(d+c+1)),Math.abs(c)<r*d&&o>0)break}return d}function X$t(t,e,n){var r=t===0||t===1?0:Math.exp(Oh(e+n)-Oh(e)-Oh(n)+e*Math.log(t)+n*Math.log(1-t));return t<0||t>1?!1:t<(e+1)/(e+n+2)?r*eL(t,e,n)/e:1-r*eL(1-t,n,e)/n}function eL(t,e,n){var r=1e-30,i=1,s=e+n,o=e+1,a=e-1,u=1,c=1-s*t/o,l,f,d,h;for(Math.abs(c)<r&&(c=r),c=1/c,h=c;i<=100&&(l=2*i,f=i*(n-i)*t/((a+l)*(e+l)),c=1+f*c,Math.abs(c)<r&&(c=r),u=1+f/u,Math.abs(u)<r&&(u=r),c=1/c,h*=c*u,f=-(e+i)*(s+i)*t/((e+l)*(o+l)),c=1+f*c,Math.abs(c)<r&&(c=r),u=1+f/u,Math.abs(u)<r&&(u=r),c=1/c,d=c*u,h*=d,!(Math.abs(d-1)<3e-7));i++);return h}function Oh(t){var e=0,n=[76.18009172947146,-86.5053203294167,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],r=1.000000000190015,i,s,o;for(o=(s=i=t)+5.5,o-=(i+.5)*Math.log(o);e<6;e++)r+=n[e]/++s;return Math.log(2.506628274631*r/i)-o}function K$t(t,e){var n=H$t(2*Math.min(t,1-t),.5*e,.5);return n=Math.sqrt(e*(1-n)/n),t>.5?n:-n}const Q$t={ariaLabel:"linear-regression",fill:"currentColor",fillOpacity:.1,stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class sQ extends Ce{constructor(e,n={}){const{x:r,y:i,z:s,ci:o=.95,precision:a=4}=n;if(super(e,{x:{value:r,scale:"x"},y:{value:i,scale:"y"},z:{value:fl(n),optional:!0}},n,Q$t),this.z=s,this.ci=+o,this.precision=+a,!(0<=this.ci&&this.ci<1))throw new Error(`invalid ci; not in [0, 1): ${o}`);if(!(this.precision>0))throw new Error(`invalid precision: ${a}`)}render(e,n,r,i,s){const{x:o,y:a,z:u}=r,{ci:c}=this;return ne("svg:g",s).call(Pe,this,i,s).call(Me,this,n).call(l=>l.selectAll().data(u?YI(e,u,this.z):[e]).enter().call(f=>f.append("path").attr("fill","none").call(Se,this).call(mx,this,{...r,fill:null,fillOpacity:null}).attr("d",d=>this._renderLine(d,o,a)).call(c&&!sp(this.fill)?d=>d.select(J$t).attr("stroke","none").call(Se,this).call(mx,this,{...r,stroke:null,strokeOpacity:null,strokeWidth:null}).attr("d",h=>this._renderBand(h,o,a)):()=>{}))).node()}}function J$t(){return this.parentNode.insertBefore(this.ownerDocument.createElementNS(gu.svg,"path"),this)}class Z$t extends sQ{constructor(e,n){super(e,n)}_renderBand(e,n,r){const{ci:i,precision:s}=this,[o,a]=pn(e,l=>r[l]),u=Ex(e,r,n),c=oQ(e,r,n,(1-i)/2,u);return Iy().y(l=>l).x0(l=>c(l,-1)).x1(l=>c(l,1))(xn(o,a-s/2,s).concat(a))}_renderLine(e,n,r){const[i,s]=pn(e,a=>r[a]),o=Ex(e,r,n);return`M${o(i)},${i}L${o(s)},${s}`}}class t3t extends sQ{constructor(e,n){super(e,n)}_renderBand(e,n,r){const{ci:i,precision:s}=this,[o,a]=pn(e,l=>n[l]),u=Ex(e,n,r),c=oQ(e,n,r,(1-i)/2,u);return Iy().x(l=>l).y0(l=>c(l,-1)).y1(l=>c(l,1))(xn(o,a-s/2,s).concat(a))}_renderLine(e,n,r){const[i,s]=pn(e,a=>n[a]),o=Ex(e,n,r);return`M${i},${o(i)}L${s},${o(s)}`}}function e3t(t,{y:e=Ln,x:n=St,stroke:r,fill:i=je(r)?"currentColor":r,...s}={}){return new Z$t(t,hF({...s,x:n,y:e,fill:i,stroke:r}))}function n3t(t,{x:e=Ln,y:n=St,stroke:r,fill:i=je(r)?"currentColor":r,...s}={}){return new t3t(t,dF({...s,x:e,y:n,fill:i,stroke:r}))}function Ex(t,e,n){let r=0,i=0,s=0,o=0;for(const l of t){const f=e[l],d=n[l];r+=f,i+=d,s+=f*d,o+=f*f}const a=t.length,u=(a*s-r*i)/(a*o-r*r),c=(i-u*r)/a;return l=>u*l+c}function oQ(t,e,n,r,i){const s=ls(t,l=>e[l])/t.length;let o=0,a=0;for(const l of t)o+=(e[l]-s)**2,a+=(n[l]-i(e[l]))**2;const u=Math.sqrt(a/(t.length-2)),c=K$t(r,t.length-2);return(l,f)=>{const d=i(l),h=u*Math.sqrt(1/t.length+(l-s)**2/o);return d+f*c*h}}function zT({path:t=St,delimiter:e,frameAnchor:n,treeLayout:r=C0,treeSort:i,treeSeparation:s,treeAnchor:o,treeFilter:a,...u}={}){o=kF(o),i=uQ(i),a!=null&&(a=jT(a)),n===void 0&&(n=o.frameAnchor);const c=cQ(e),l=mQ(u,jT),[f,d]=Ti(),[h,p]=Ti();return{x:f,y:h,frameAnchor:n,...io(u,(g,m)=>{const y=c(Kt(g,t)),b=d([]),w=p([]);let v=-1;const x=[],S=[],_=rx().path($=>y[$]),E=Cu(g)?$=>$.data=g[$.data]:$=>$.data=g.get($.data),A=r();A.nodeSize&&A.nodeSize([1,1]),A.separation&&s!==void 0&&A.separation(s??SI);for(const $ of l)$[Ax]=$[pQ]([]);for(const $ of m){const T=[],C=_($.filter(F=>y[F]!=null)).each(E);i!=null&&C.sort(i),A(C);for(const F of C.descendants())if(!(a!=null&&!a(F))){T.push(++v),x[v]=F.data,o.position(F,v,b,w);for(const M of l)M[Ax][v]=M[gQ](F)}S.push(T)}return{data:x,facets:S}}),...Object.fromEntries(l)}}function aQ({path:t=St,delimiter:e,curve:n="bump-x",stroke:r="#555",strokeWidth:i=1.5,strokeOpacity:s=.5,treeLayout:o=C0,treeSort:a,treeSeparation:u,treeAnchor:c,treeFilter:l,...f}={}){c=kF(c),a=uQ(a),l!=null&&(l=rL(l)),f={curve:n,stroke:r,strokeWidth:i,strokeOpacity:s,...f};const d=cQ(e),h=mQ(f,rL),[p,g]=Ti(),[m,y]=Ti(),[b,w]=Ti(),[v,x]=Ti();return{x1:p,x2:m,y1:b,y2:v,...io(f,(S,_)=>{const E=d(Kt(S,t)),A=g([]),$=y([]),T=w([]),C=x([]);let F=-1;const M=[],k=[],I=rx().path(R=>E[R]),N=o();N.nodeSize&&N.nodeSize([1,1]),N.separation&&u!==void 0&&N.separation(u??SI);for(const R of h)R[Ax]=R[pQ]([]);for(const R of _){const D=[],L=I(R.filter(P=>E[P]!=null)).each(P=>P.data=S[P.data]);a!=null&&L.sort(a),N(L);for(const{source:P,target:B}of L.links())if(!(l!=null&&!l(B,P))){D.push(++F),M[F]=B.data,c.position(P,F,A,T),c.position(B,F,$,C);for(const G of h)G[Ax][F]=G[gQ](B,P)}k.push(D)}return{data:M,facets:k}}),...Object.fromEntries(h)}}function kF(t="left"){switch(`${t}`.trim().toLowerCase()){case"left":return r3t;case"right":return i3t}throw new Error(`invalid tree anchor: ${t}`)}const r3t={frameAnchor:"left",dx:6,position({x:t,y:e},n,r,i){r[n]=e,i[n]=-t}},i3t={frameAnchor:"right",dx:-6,position({x:t,y:e},n,r,i){r[n]=-e,i[n]=-t}};function uQ(t){return t==null||typeof t=="function"?t:`${t}`.trim().toLowerCase().startsWith("node:")?nL(jT(t)):nL(s3t(t))}function nL(t){return(e,n)=>gs(t(e),t(n))}function s3t(t){return e=>{var n;return(n=e.data)==null?void 0:n[t]}}function cQ(t="/"){if(t=`${t}`,t==="/")return n=>n;if(t.length!==1)throw new Error("delimiter must be exactly one character");const e=t.charCodeAt(0);return n=>n.map(r=>o3t(r,e))}const UT=92,lQ=47;function o3t(t,e){if(e===UT)throw new Error("delimiter cannot be backslash");let n=!1;for(let r=0,i=t.length;r<i;++r){switch(t.charCodeAt(r)){case UT:if(!n){n=!0;continue}break;case e:n?(t=t.slice(0,r-1)+t.slice(r),--r,--i):t=t.slice(0,r)+"/"+t.slice(r+1);break;case lQ:n?(t=t.slice(0,r)+"\\\\"+t.slice(r),r+=2,i+=2):(t=t.slice(0,r)+"\\"+t.slice(r),++r,++i);break}n=!1}return t}function a3t(t){let e=!1;for(let n=0,r=t.length;n<r;++n){switch(t.charCodeAt(n)){case UT:if(!e){e=!0;continue}case lQ:e&&(t=t.slice(0,n-1)+t.slice(n),--n,--r);break}e=!1}return t}function fQ(t){return Ss(t)&&typeof t.node=="function"}function u3t(t){return Ss(t)&&typeof t.link=="function"}function jT(t){if(fQ(t))return t.node;if(t=`${t}`.trim().toLowerCase(),!!t.startsWith("node:")){switch(t){case"node:name":return WT;case"node:path":return qT;case"node:internal":return dQ;case"node:external":return hQ;case"node:depth":return VT;case"node:height":return GT}throw new Error(`invalid node value: ${t}`)}}function rL(t){if(fQ(t))return t.node;if(u3t(t))return t.link;if(t=`${t}`.trim().toLowerCase(),!(!t.startsWith("node:")&&!t.startsWith("parent:"))){switch(t){case"parent:name":return pb(WT);case"parent:path":return pb(qT);case"parent:depth":return pb(VT);case"parent:height":return pb(GT);case"node:name":return WT;case"node:path":return qT;case"node:internal":return dQ;case"node:external":return hQ;case"node:depth":return VT;case"node:height":return GT}throw new Error(`invalid link value: ${t}`)}}function qT(t){return t.id}function WT(t){return c3t(t.id)}function VT(t){return t.depth}function GT(t){return t.height}function dQ(t){return!!t.children}function hQ(t){return!t.children}function pb(t){return(e,n)=>n==null?void 0:t(n)}function c3t(t){let e=t.length;for(;--e>0&&!l3t(t,e););return a3t(t.slice(e+1))}function l3t(t,e){if(t[e]==="/"){let n=0;for(;e>0&&t[--e]==="\\";)++n;if(!(n&1))return!0}return!1}const pQ=2,gQ=3,Ax=4;function mQ(t,e){const n=[];for(const r in t){const i=t[r],s=e(i);s!==void 0&&n.push([r,...Ti(i),s])}return n}function yQ(t,{fill:e,stroke:n,strokeWidth:r,strokeOpacity:i,strokeLinejoin:s,strokeLinecap:o,strokeMiterlimit:a,strokeDasharray:u,strokeDashoffset:c,marker:l,markerStart:f=l,markerEnd:d=l,dot:h=je(f)&&je(d),text:p="node:name",textStroke:g="var(--plot-background)",title:m="node:path",dx:y,dy:b,textAnchor:w,treeLayout:v=C0,textLayout:x=v===C0||v===HC?"mirrored":"normal",tip:S,..._}={}){if(y===void 0&&(y=kF(_.treeAnchor).dx),w!==void 0)throw new Error("textAnchor is not a configurable tree option");x=zi(x,"textLayout",["mirrored","normal"]);function E(A){return lp(t,zT({treeLayout:v,text:p,fill:e===void 0?"currentColor":e,stroke:g,dx:y,dy:b,title:m,...A,..._}))}return ms(kK(t,aQ({treeLayout:v,markerStart:f,markerEnd:d,stroke:n!==void 0?n:e===void 0?"node:internal":e,strokeWidth:r,strokeOpacity:i,strokeLinejoin:s,strokeLinecap:o,strokeMiterlimit:a,strokeDasharray:u,strokeDashoffset:c,..._})),h?pl(t,zT({treeLayout:v,fill:e===void 0?"node:internal":e,title:m,tip:S,..._})):null,p!=null?x==="mirrored"?[E({textAnchor:"start",treeFilter:"node:external"}),E({textAnchor:"end",treeFilter:"node:internal",dx:-y})]:E():null)}function f3t(t,e){return yQ(t,{...e,treeLayout:HC})}const bQ={ariaLabel:"waffle"};class vQ extends bF{constructor(e,{unit:n=1,gap:r=1,round:i,render:s,multiple:o,...a}={}){super(e,{...a,render:up(s,xQ("x"))},bQ),this.unit=Math.max(0,n),this.gap=+r,this.round=_Q(i),this.multiple=SQ(o)}}class wQ extends vF{constructor(e,{unit:n=1,gap:r=1,round:i,render:s,multiple:o,...a}={}){super(e,{...a,render:up(s,xQ("y"))},bQ),this.unit=Math.max(0,n),this.gap=+r,this.round=_Q(i),this.multiple=SQ(o)}}function xQ(t){return function(e,n,r,i,s){const{unit:o,gap:a,rx:u,ry:c,round:l}=this,{document:f}=s,d=r.channels[`${t}1`].value,h=r.channels[`${t}2`].value,p=this[t==="y"?"_width":"_height"](n,r,i),g=this[t==="y"?"_x":"_y"](n,r,i),m=o*d3t(n.scales[t]),{multiple:y=Math.max(1,Math.floor(Math.sqrt(p/m)))}=this,b=Math.min(p/y,m*y),w=m*y,v=t==="y"?([T,C])=>[T*b,-C*w]:([T,C])=>[C*w,T*b],x=(p-y*b)/2,S=typeof g=="function"?T=>g(T)+x:g+x,_=n[t](0),E=aSt(),A=f.createElementNS(gu.svg,"pattern");A.setAttribute("width",t==="y"?b:w),A.setAttribute("height",t==="y"?w:b),A.setAttribute("patternUnits","userSpaceOnUse");const $=A.appendChild(f.createElementNS(gu.svg,"rect"));return $.setAttribute("x",a/2),$.setAttribute("y",a/2),$.setAttribute("width",(t==="y"?b:w)-a),$.setAttribute("height",(t==="y"?w:b)-a),u!=null&&$.setAttribute("rx",u),c!=null&&$.setAttribute("ry",c),ne("svg:g",s).call(Pe,this,i,s).call(this._transform,this,n).call(T=>T.selectAll().data(e).enter().append(()=>A.cloneNode(!0)).attr("id",C=>`${E}-${C}`).select("rect").call(Se,this).call(sn,this,r)).call(T=>T.selectAll().data(e).enter().append("path").attr("transform",t==="y"?cp`translate(${S},${_})`:cp`translate(${_},${S})`).attr("d",C=>`M${YT(l(d[C]/o),l(h[C]/o),y).map(v).join("L")}Z`).attr("fill",C=>`url(#${E}-${C})`).attr("stroke",this.stroke==null?null:C=>`url(#${E}-${C})`)).node()}}function YT(t,e,n){if(t<0||e<0){const r=Math.ceil(-Math.min(t,e)/n);return YT(t+r*n,e+r*n,n).map(([i,s])=>[i,s-r])}return e<t?YT(e,t,n):[[0,Math.ceil(t/n)],[Math.floor(t%n),Math.ceil(t/n)],[Math.floor(t%n),Math.floor(t/n)+t%1],[Math.ceil(t%n),Math.floor(t/n)+t%1],...t%n>n-1?[]:[[Math.ceil(t%n),Math.floor(t/n)],[n,Math.floor(t/n)]],[n,Math.floor(e/n)],[Math.ceil(e%n),Math.floor(e/n)],[Math.ceil(e%n),Math.floor(e/n)+e%1],[Math.floor(e%n),Math.floor(e/n)+e%1],...e%n<1?[]:[[Math.floor(e%n),Math.ceil(e/n)],[0,Math.ceil(e/n)]]]}function _Q(t){if(t===void 0||t===!1)return Number;if(t===!0)return Math.round;if(typeof t!="function")throw new Error(`invalid round: ${t}`);return t}function SQ(t){return t===void 0?void 0:Math.max(1,Math.floor(t))}function d3t({domain:t,range:e}){return iL(e)/iL(t)}function iL(t){const[e,n]=pn(t);return n-e}function h3t(t,e={}){return eg(e)||(e={...e,y:Ln,x2:St}),new vQ(t,N_(KI(I_(e))))}function p3t(t,e={}){return eg(e)||(e={...e,x:Ln,y2:St}),new wQ(t,O_(QI(F_(e))))}function g3t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var UA,sL;function m3t(){if(sL)return UA;sL=1;function t(o,a,u,c,l){for(var f=l+1;c<=l;){var d=c+l>>>1,h=o[d],p=u!==void 0?u(h,a):h-a;p>=0?(f=d,l=d-1):c=d+1}return f}function e(o,a,u,c,l){for(var f=l+1;c<=l;){var d=c+l>>>1,h=o[d],p=u!==void 0?u(h,a):h-a;p>0?(f=d,l=d-1):c=d+1}return f}function n(o,a,u,c,l){for(var f=c-1;c<=l;){var d=c+l>>>1,h=o[d],p=u!==void 0?u(h,a):h-a;p<0?(f=d,c=d+1):l=d-1}return f}function r(o,a,u,c,l){for(var f=c-1;c<=l;){var d=c+l>>>1,h=o[d],p=u!==void 0?u(h,a):h-a;p<=0?(f=d,c=d+1):l=d-1}return f}function i(o,a,u,c,l){for(;c<=l;){var f=c+l>>>1,d=o[f],h=u!==void 0?u(d,a):d-a;if(h===0)return f;h<=0?c=f+1:l=f-1}return-1}function s(o,a,u,c,l,f){return typeof u=="function"?f(o,a,u,c===void 0?0:c|0,l===void 0?o.length-1:l|0):f(o,a,void 0,u===void 0?0:u|0,c===void 0?o.length-1:c|0)}return UA={ge:function(o,a,u,c,l){return s(o,a,u,c,l,t)},gt:function(o,a,u,c,l){return s(o,a,u,c,l,e)},lt:function(o,a,u,c,l){return s(o,a,u,c,l,n)},le:function(o,a,u,c,l){return s(o,a,u,c,l,r)},eq:function(o,a,u,c,l){return s(o,a,u,c,l,i)}},UA}var jA,oL;function y3t(){if(oL)return jA;oL=1;var t=m3t(),e=0,n=1,r=2;jA=w;function i(v,x,S,_,E){this.mid=v,this.left=x,this.right=S,this.leftPoints=_,this.rightPoints=E,this.count=(x?x.count:0)+(S?S.count:0)+_.length}var s=i.prototype;function o(v,x){v.mid=x.mid,v.left=x.left,v.right=x.right,v.leftPoints=x.leftPoints,v.rightPoints=x.rightPoints,v.count=x.count}function a(v,x){var S=m(x);v.mid=S.mid,v.left=S.left,v.right=S.right,v.leftPoints=S.leftPoints,v.rightPoints=S.rightPoints,v.count=S.count}function u(v,x){var S=v.intervals([]);S.push(x),a(v,S)}function c(v,x){var S=v.intervals([]),_=S.indexOf(x);return _<0?e:(S.splice(_,1),a(v,S),n)}s.intervals=function(v){return v.push.apply(v,this.leftPoints),this.left&&this.left.intervals(v),this.right&&this.right.intervals(v),v},s.insert=function(v){var x=this.count-this.leftPoints.length;if(this.count+=1,v[1]<this.mid)this.left?4*(this.left.count+1)>3*(x+1)?u(this,v):this.left.insert(v):this.left=m([v]);else if(v[0]>this.mid)this.right?4*(this.right.count+1)>3*(x+1)?u(this,v):this.right.insert(v):this.right=m([v]);else{var S=t.ge(this.leftPoints,v,p),_=t.ge(this.rightPoints,v,g);this.leftPoints.splice(S,0,v),this.rightPoints.splice(_,0,v)}},s.remove=function(v){var x=this.count-this.leftPoints;if(v[1]<this.mid){if(!this.left)return e;var S=this.right?this.right.count:0;if(4*S>3*(x-1))return c(this,v);var _=this.left.remove(v);return _===r?(this.left=null,this.count-=1,n):(_===n&&(this.count-=1),_)}else if(v[0]>this.mid){if(!this.right)return e;var E=this.left?this.left.count:0;if(4*E>3*(x-1))return c(this,v);var _=this.right.remove(v);return _===r?(this.right=null,this.count-=1,n):(_===n&&(this.count-=1),_)}else{if(this.count===1)return this.leftPoints[0]===v?r:e;if(this.leftPoints.length===1&&this.leftPoints[0]===v){if(this.left&&this.right){for(var A=this,$=this.left;$.right;)A=$,$=$.right;if(A===this)$.right=this.right;else{var T=this.left,_=this.right;A.count-=$.count,A.right=$.left,$.left=T,$.right=_}o(this,$),this.count=(this.left?this.left.count:0)+(this.right?this.right.count:0)+this.leftPoints.length}else this.left?o(this,this.left):o(this,this.right);return n}for(var T=t.ge(this.leftPoints,v,p);T<this.leftPoints.length&&this.leftPoints[T][0]===v[0];++T)if(this.leftPoints[T]===v){this.count-=1,this.leftPoints.splice(T,1);for(var _=t.ge(this.rightPoints,v,g);_<this.rightPoints.length&&this.rightPoints[_][1]===v[1];++_)if(this.rightPoints[_]===v)return this.rightPoints.splice(_,1),n}return e}};function l(v,x,S){for(var _=0;_<v.length&&v[_][0]<=x;++_){var E=S(v[_]);if(E)return E}}function f(v,x,S){for(var _=v.length-1;_>=0&&v[_][1]>=x;--_){var E=S(v[_]);if(E)return E}}function d(v,x){for(var S=0;S<v.length;++S){var _=x(v[S]);if(_)return _}}s.queryPoint=function(v,x){if(v<this.mid){if(this.left){var S=this.left.queryPoint(v,x);if(S)return S}return l(this.leftPoints,v,x)}else if(v>this.mid){if(this.right){var S=this.right.queryPoint(v,x);if(S)return S}return f(this.rightPoints,v,x)}else return d(this.leftPoints,x)},s.queryInterval=function(v,x,S){if(v<this.mid&&this.left){var _=this.left.queryInterval(v,x,S);if(_)return _}if(x>this.mid&&this.right){var _=this.right.queryInterval(v,x,S);if(_)return _}return x<this.mid?l(this.leftPoints,x,S):v>this.mid?f(this.rightPoints,v,S):d(this.leftPoints,S)};function h(v,x){return v-x}function p(v,x){var S=v[0]-x[0];return S||v[1]-x[1]}function g(v,x){var S=v[1]-x[1];return S||v[0]-x[0]}function m(v){if(v.length===0)return null;for(var x=[],S=0;S<v.length;++S)x.push(v[S][0],v[S][1]);x.sort(h);for(var _=x[x.length>>1],E=[],A=[],$=[],S=0;S<v.length;++S){var T=v[S];T[1]<_?E.push(T):_<T[0]?A.push(T):$.push(T)}var C=$,F=$.slice();return C.sort(p),F.sort(g),new i(_,m(E),m(A),C,F)}function y(v){this.root=v}var b=y.prototype;b.insert=function(v){this.root?this.root.insert(v):this.root=new i(v[0],null,null,[v],[v])},b.remove=function(v){if(this.root){var x=this.root.remove(v);return x===r&&(this.root=null),x!==e}return!1},b.queryPoint=function(v,x){if(this.root)return this.root.queryPoint(v,x)},b.queryInterval=function(v,x,S){if(v<=x&&this.root)return this.root.queryInterval(v,x,S)},Object.defineProperty(b,"count",{get:function(){return this.root?this.root.count:0}}),Object.defineProperty(b,"intervals",{get:function(){return this.root?this.root.intervals([]):[]}});function w(v){return!v||v.length===0?new y(null):new y(m(v))}return jA}var b3t=y3t();const v3t=g3t(b3t),w3t=({marginLeft:t})=>[1,t],x3t=({width:t,marginRight:e})=>[-1,t-e],_3t=({width:t,marginLeft:e,marginRight:n})=>[0,(e+t-n)/2],S3t=({marginTop:t})=>[1,t],E3t=({height:t,marginBottom:e})=>[-1,t-e],A3t=({height:t,marginTop:e,marginBottom:n})=>[0,(e+t-n)/2];function EQ(t){return typeof t=="string"?{anchor:t}:t}function $3t(t={},e={}){arguments.length===1&&([t,e]=AQ(t));let{anchor:n="left",padding:r=1,r:i=e.r}=EQ(t);switch(`${n}`.toLowerCase()){case"left":n=w3t;break;case"right":n=x3t;break;case"middle":n=_3t;break;default:throw new Error(`unknown dodge anchor: ${n}`)}return $Q("x","y",n,Le(r),i,e)}function T3t(t={},e={}){arguments.length===1&&([t,e]=AQ(t));let{anchor:n="bottom",padding:r=1,r:i=e.r}=EQ(t);switch(`${n}`.toLowerCase()){case"top":n=S3t;break;case"bottom":n=E3t;break;case"middle":n=A3t;break;default:throw new Error(`unknown dodge anchor: ${n}`)}return $Q("y","x",n,Le(r),i,e)}function AQ(t){const{anchor:e,padding:n,...r}=t,{r:i}=r;return[{anchor:e,padding:n,r:i},r]}function $Q(t,e,n,r,i,s){if(i!=null&&typeof i!="number"){let{channels:o,sort:a,reverse:u}=s;o=TI(o),(o==null?void 0:o.r)===void 0&&(s={...s,channels:{...o,r:{value:i,scale:"r"}}}),a===void 0&&u===void 0&&(s.sort={channel:"-r"})}return Vr(s,function(o,a,u,c,l,f){let{[e]:d,r:h}=u;if(!u[e])throw new Error(`missing channel: ${e}`);({[e]:d}=zy(u,c,f));const p=h?void 0:i!==void 0?Le(i):this.r!==void 0?this.r:3;h&&(h=Kt(h.value,c[h.scale]||St,Float64Array));let[g,m]=n(l);const y=g?M3t:k3t,b=new Float64Array(d.length),w=h?v=>h[v]:()=>p;for(let v of a){const x=v3t();v=v.filter(h?_=>dx(d[_])&&iu(h[_]):_=>dx(d[_]));const S=new Float64Array(2*v.length+2);for(const _ of v){const E=w(_),A=g?E+r:0,$=d[_]-E,T=d[_]+E;let C=2;x.queryInterval($-r,T+r,([,,M])=>{const k=b[M]-A,I=d[_]-d[M],N=r+(h?h[_]+h[M]:2*p),R=Math.sqrt(N*N-I*I);S[C++]=k-R,S[C++]=k+R});let F=S.slice(0,C);g&&(F=F.filter(M=>M>=0));t:for(const M of F.sort(y)){for(let k=0;k<C;k+=2)if(S[k]+1e-6<M&&M<S[k+1]-1e-6)continue t;b[_]=M+A;break}x.insert([$,T,_])}}g||(g=1);for(const v of a)for(const x of v)b[x]=b[x]*g+m;return{data:o,facets:a,channels:{[t]:{value:b,source:null},[e]:{value:d,source:u[e]},...h&&{r:{value:h,source:u.r}}}}})}function k3t(t,e){return Math.abs(t)-Math.abs(e)}function M3t(t,e){return t-e}function C3t(t,e){return arguments.length===1&&({basis:t,...e}=t),xF(MF(t),e)}function I3t(t,e){return arguments.length===1&&({basis:t,...e}=t),_F(MF(t),e)}function MF(t){if(t===void 0)return aL;if(typeof t=="function")return q_($I(t));if(/^p\d{2}$/i.test(t))return cg(EI(t));switch(`${t}`.toLowerCase()){case"deviation":return O3t;case"first":return aL;case"last":return N3t;case"max":return R3t;case"mean":return D3t;case"median":return L3t;case"min":return B3t;case"sum":return P3t;case"extent":return F3t}throw new Error(`invalid basis: ${t}`)}function q_(t){return{mapIndex(e,n,r){const i=+t(e,n);for(const s of e)r[s]=n[s]===null?NaN:n[s]/i}}}function cg(t){return q_((e,n)=>t(e,r=>n[r]))}const F3t={mapIndex(t,e,n){const[r,i]=pn(t,o=>e[o]),s=i-r;for(const o of t)n[o]=e[o]===null?NaN:(e[o]-r)/s}},aL=q_((t,e)=>{for(let n=0;n<t.length;++n){const r=e[t[n]];if(Qn(r))return r}}),N3t=q_((t,e)=>{for(let n=t.length-1;n>=0;--n){const r=e[t[n]];if(Qn(r))return r}}),O3t={mapIndex(t,e,n){const r=wy(t,s=>e[s]),i=Wp(t,s=>e[s]);for(const s of t)n[s]=e[s]===null?NaN:i?(e[s]-r)/i:0}},R3t=cg(Be),D3t=cg(wy),L3t=cg(Mf),B3t=cg(wn),P3t=cg(ls);function z3t(t,e){return TQ("x",t,e)}function U3t(t,e){return TQ("y",t,e)}function TQ(t,e,n={}){let r,i=1;if(typeof e=="number")i=e,r=(c,l)=>+c+l;else{if(typeof e=="string"){const c=e.startsWith("-")?-1:1;[e,i]=wI(e.replace(/^[+-]/,"")),i*=c}e=g_(e),r=(c,l)=>e.offset(c,l)}const s=`${t}1`,o=`${t}2`,a=ta({[s]:c=>c.map(l=>r(l,i)),[o]:c=>c},n),u=a[o].transform;return a[o].transform=()=>{const c=u(),[l,f]=pn(c);return c.domain=i<0?[l,r(f,i)]:[r(l,i),f],c},a}function j3t(t,e={}){if(typeof t=="string")switch(t.toLowerCase()){case"first":return CF(e);case"last":return IF(e)}if(typeof t=="function")return Hc(null,t,e);let n,r;for(n in t){if(r!==void 0)throw new Error("ambiguous selector; multiple inputs");r=q3t(t[n])}if(r===void 0)throw new Error(`invalid selector: ${t}`);return Hc(n,r,e)}function q3t(t){if(typeof t=="function")return t;switch(`${t}`.toLowerCase()){case"min":return FF;case"max":return NF}throw new Error(`unknown selector: ${t}`)}function CF(t){return Hc(null,W3t,t)}function IF(t){return Hc(null,V3t,t)}function kQ(t){return Hc("x",FF,t)}function MQ(t){return Hc("y",FF,t)}function CQ(t){return Hc("x",NF,t)}function IQ(t){return Hc("y",NF,t)}function*W3t(t){yield t[0]}function*V3t(t){yield t[t.length-1]}function*FF(t,e){yield qpt(t,n=>e[n])}function*NF(t,e){yield EC(t,n=>e[n])}function Hc(t,e,n){if(t!=null){if(n[t]==null)throw new Error(`missing channel: ${t}`);t=n[t]}const r=fl(n);return io(n,(i,s)=>{const o=Kt(i,r),a=Kt(i,t),u=[];for(const c of s){const l=[];for(const f of o?al(c,d=>o[d]).values():[c])for(const d of e(f,a))l.push(d);u.push(l)}return{data:i,facets:u}})}Ce.prototype.plot=function({marks:t=[],...e}={}){return cF({...e,marks:[...t,this]})};const G3t=Object.freeze(Object.defineProperty({__proto__:null,Area:L_,Arrow:MK,BarX:bF,BarY:vF,Cell:B_,Contour:KK,Density:ZK,Dot:P_,Frame:mK,Geo:nQ,Hexgrid:rQ,Image:iQ,Line:z_,Link:TK,Mark:Ce,Raster:qK,Rect:D_,RuleX:xX,RuleY:_X,Text:k_,TickX:RK,TickY:DK,Tip:yK,Vector:M_,WaffleX:vQ,WaffleY:wQ,area:DT,areaX:U0,areaY:hp,arrow:fAt,auto:SAt,autoSpec:CK,axisFx:VX,axisFy:WX,axisX:eF,axisY:tF,barX:rf,barY:sf,bin:Yl,binX:oc,binY:ac,bollinger:mf,bollingerX:jAt,bollingerY:qAt,boxX:VAt,boxY:GAt,cell:mh,cellX:pAt,cellY:gAt,centroid:eQ,circle:vAt,cluster:f3t,column:Ti,contour:o$t,crosshair:u$t,crosshairX:c$t,crosshairY:l$t,delaunayLink:S$t,delaunayMesh:E$t,density:M$t,differenceX:F$t,differenceY:N$t,dodgeX:$3t,dodgeY:T3t,dot:pl,dotX:yAt,dotY:bAt,filter:E2t,find:P2t,formatIsoDate:nX,formatMonth:nSt,formatNumber:eX,formatWeekday:rSt,frame:uF,geo:TF,geoCentroid:O$t,graticule:B$t,gridFx:QX,gridFy:XX,gridX:KX,gridY:HX,group:RI,groupX:D0,groupY:L0,groupZ:OI,hexagon:wAt,hexbin:P$t,hexgrid:j$t,hull:A$t,identity:St,image:Y$t,indexOf:Ln,initializer:Vr,interpolateNearest:HK,interpolateNone:PT,interpolatorBarycentric:YK,interpolatorRandomWalk:XK,legend:eEt,line:U_,lineX:j0,lineY:q0,linearRegressionX:e3t,linearRegressionY:n3t,link:kK,map:ta,mapX:xF,mapY:_F,marks:ms,normalize:MF,normalizeX:C3t,normalizeY:I3t,numberInterval:hH,plot:cF,pointer:A_,pointerX:$_,pointerY:z0,raster:HAt,rect:aF,rectX:vx,rectY:wx,reverse:A2t,ruleX:Gc,ruleY:Yc,scale:I_t,select:j3t,selectFirst:CF,selectLast:IF,selectMaxX:CQ,selectMaxY:IQ,selectMinX:kQ,selectMinY:MQ,shiftX:z3t,shiftY:U3t,shuffle:$2t,sort:xH,sphere:L$t,spike:qSt,stackX:lK,stackX1:oEt,stackX2:aEt,stackY:fK,stackY1:uEt,stackY2:cEt,text:lp,textX:$X,textY:TX,tickX:LK,tickY:BK,timeInterval:xI,tip:bK,transform:io,tree:yQ,treeLink:aQ,treeNode:zT,utcInterval:f_,valueof:Kt,vector:LX,vectorX:BX,vectorY:PX,voronoi:$$t,voronoiMesh:T$t,waffleX:h3t,waffleY:p3t,window:j_,windowX:CAt,windowY:IAt},Symbol.toStringTag,{value:"Module"})),Y3t=new Map([["style","style"],["width","width"],["height","height"],["margin","margin"],["marginLeft","marginLeft"],["marginRight","marginRight"],["marginTop","marginTop"],["marginBottom","marginBottom"],["align","align"],["aspectRatio","aspectRatio"],["axis","axis"],["inset","inset"],["grid","grid"],["label","label"],["padding","padding"],["xScale","x.type"],["xDomain","x.domain"],["xRange","x.range"],["xNice","x.nice"],["xInset","x.inset"],["xInsetLeft","x.insetLeft"],["xInsetRight","x.insetRight"],["xClamp","x.clamp"],["xRound","x.round"],["xAlign","x.align"],["xPadding","x.padding"],["xPaddingInner","x.paddingInner"],["xPaddingOuter","x.paddingOuter"],["xAxis","x.axis"],["xTicks","x.ticks"],["xTickSize","x.tickSize"],["xTickSpacing","x.tickSpacing"],["xTickPadding","x.tickPadding"],["xTickFormat","x.tickFormat"],["xTickRotate","x.tickRotate"],["xGrid","x.grid"],["xLine","x.line"],["xLabel","x.label"],["xLabelAnchor","x.labelAnchor"],["xLabelArrow","x.labelArrow"],["xLabelOffset","x.labelOffset"],["xFontVariant","x.fontVariant"],["xAriaLabel","x.ariaLabel"],["xAriaDescription","x.ariaDescription"],["xPercent","x.percent"],["xReverse","x.reverse"],["xZero","x.zero"],["xBase","x.base"],["xExponent","x.exponent"],["xConstant","x.constant"],["yScale","y.type"],["yDomain","y.domain"],["yRange","y.range"],["yNice","y.nice"],["yInset","y.inset"],["yInsetTop","y.insetTop"],["yInsetBottom","y.insetBottom"],["yClamp","y.clamp"],["yRound","y.round"],["yAlign","y.align"],["yPadding","y.padding"],["yPaddingInner","y.paddingInner"],["yPaddingOuter","y.paddingOuter"],["yAxis","y.axis"],["yTicks","y.ticks"],["yTickSize","y.tickSize"],["yTickSpacing","y.tickSpacing"],["yTickPadding","y.tickPadding"],["yTickFormat","y.tickFormat"],["yTickRotate","y.tickRotate"],["yGrid","y.grid"],["yLine","y.line"],["yLabel","y.label"],["yLabelAnchor","y.labelAnchor"],["yLabelArrow","y.labelArrow"],["yLabelOffset","y.labelOffset"],["yFontVariant","y.fontVariant"],["yAriaLabel","y.ariaLabel"],["yAriaDescription","y.ariaDescription"],["yPercent","y.percent"],["yReverse","y.reverse"],["yZero","y.zero"],["yBase","y.base"],["yExponent","y.exponent"],["yConstant","y.constant"],["facetMargin","facet.margin"],["facetMarginTop","facet.marginTop"],["facetMarginBottom","facet.marginBottom"],["facetMarginLeft","facet.marginLeft"],["facetMarginRight","facet.marginRight"],["facetGrid","facet.grid"],["facetLabel","facet.label"],["fxDomain","fx.domain"],["fxRange","fx.range"],["fxInset","fx.inset"],["fxInsetLeft","fx.insetLeft"],["fxInsetRight","fx.insetRight"],["fxRound","fx.round"],["fxAlign","fx.align"],["fxPadding","fx.padding"],["fxPaddingInner","fx.paddingInner"],["fxPaddingOuter","fx.paddingOuter"],["fxAxis","fx.axis"],["fxTicks","fx.ticks"],["fxTickSize","fx.tickSize"],["fxTickSpacing","fx.tickSpacing"],["fxTickPadding","fx.tickPadding"],["fxTickFormat","fx.tickFormat"],["fxTickRotate","fx.tickRotate"],["fxGrid","fx.grid"],["fxLine","fx.line"],["fxLabel","fx.label"],["fxLabelAnchor","fx.labelAnchor"],["fxLabelOffset","fx.labelOffset"],["fxFontVariant","fx.fontVariant"],["fxAriaLabel","fx.ariaLabel"],["fxAriaDescription","fx.ariaDescription"],["fxReverse","fx.reverse"],["fyDomain","fy.domain"],["fyRange","fy.range"],["fyInset","fy,inset"],["fyInsetTop","fy.insetTop"],["fyInsetBottom","fy.insetBottom"],["fyRound","fy.round"],["fyAlign","fy.align"],["fyPadding","fy.padding"],["fyPaddingInner","fy.paddingInner"],["fyPaddingOuter","fy.paddingOuter"],["fyAxis","fy.axis"],["fyTicks","fy.ticks"],["fyTickSize","fy.tickSize"],["fyTickSpacing","fy.tickSpacing"],["fyTickPadding","fy.tickPadding"],["fyTickFormat","fy.tickFormat"],["fyTickRotate","fy.tickRotate"],["fyGrid","fy.grid"],["fyLine","fy.line"],["fyLabel","fy.label"],["fyLabelAnchor","fy.labelAnchor"],["fyLabelOffset","fy.labelOffset"],["fyFontVariant","fy.fontVariant"],["fyAriaLabel","fy.ariaLabel"],["fyAriaDescription","fy.ariaDescription"],["fyReverse","fy.reverse"],["colorScale","color.type"],["colorDomain","color.domain"],["colorRange","color.range"],["colorClamp","color.clamp"],["colorN","color.n"],["colorNice","color.nice"],["colorScheme","color.scheme"],["colorInterpolate","color.interpolate"],["colorPivot","color.pivot"],["colorSymmetric","color.symmetric"],["colorLabel","color.label"],["colorPercent","color.percent"],["colorReverse","color.reverse"],["colorZero","color.zero"],["colorTickFormat","color.tickFormat"],["colorBase","color.base"],["colorExponent","color.exponent"],["colorConstant","color.constant"],["opacityScale","opacity.type"],["opacityDomain","opacity.domain"],["opacityRange","opacity.range"],["opacityClamp","opacity.clamp"],["opacityNice","opacity.nice"],["opacityLabel","opacity.label"],["opacityPercent","opacity.percent"],["opacityReverse","opacity.reverse"],["opacityZero","opacity.zero"],["opacityTickFormat","opacity.tickFormat"],["opacityBase","opacity.base"],["opacityExponent","opacity.exponent"],["opacityConstant","opacity.constant"],["symbolScale","symbol.type"],["symbolDomain","symbol.domain"],["symbolRange","symbol.range"],["rScale","r.type"],["rDomain","r.domain"],["rRange","r.range"],["rClamp","r.clamp"],["rNice","r.nice"],["rLabel","r.label"],["rPercent","r.percent"],["rZero","r.zero"],["rBase","r.base"],["rExponent","r.exponent"],["rConstant","r.constant"],["lengthScale","length.type"],["lengthDomain","length.domain"],["lengthRange","length.range"],["lengthClamp","length.clamp"],["lengthNice","length.nice"],["lengthPercent","length.percent"],["lengthZero","length.zero"],["lengthBase","length.base"],["lengthExponent","length.exponent"],["lengthConstant","length.constant"],["projectionType","projection.type"],["projectionParallels","projection.parallels"],["projectionPrecision","projection.precision"],["projectionRotate","projection.rotate"],["projectionDomain","projection.domain"],["projectionInset","projection.inset"],["projectionInsetLeft","projection.insetLeft"],["projectionInsetRight","projection.insetRight"],["projectionInsetTop","projection.insetTop"],["projectionInsetBottom","projection.insetBottom"],["projectionClip","projection.clip"]]);function H3t(t,e,n){for(let r=0;r<e.length;++r){const i=e[r];r===e.length-1?t[i]=n:t=t[i]||(t[i]={})}}function X3t(t,e,n){for(const r in t){const i=Y3t.get(r);if(i==null)throw new Error(`Unrecognized plot attribute: ${r}`);const s=t[r];typeof s=="symbol"?n.push(r):s!==void 0&&H3t(e,i.split("."),s)}}const K3t=new Set(["frame","hexgrid","sphere","graticule"]),Q3t=new Map([["first",CF],["last",IF],["maxX",CQ],["maxY",IQ],["minX",kQ],["minY",MQ],["nearest",A_],["nearestX",$_],["nearestXY",z0]]);async function J3t(t){var a;const e={marks:[]},n=[],{attributes:r,marks:i}=t;X3t(r,e,n);const s=[];for(const u of i)for(const{type:c,data:l,options:f}of u.plotSpecs()){const{select:d,...h}=f,p=((a=Q3t.get(d))==null?void 0:a(h))??h,g=K3t.has(c)?[p]:[l,p];e.marks.push(G3t[c](...g)),s.push(u.index)}tTt(e,t);const o=cF(e);nTt(o,s),Z3t(t,o,r,n);for(const u of t.interactors)await u.init(o);return o}function Z3t(t,e,n,r){r.forEach(i=>{const s=n[i];if(s===qj){if(!i.endsWith("Domain"))throw new Error(`Unsupported fixed attribute: ${i}`);const o=i.slice(0,-6),a=e.scale(o);a!=null&&a.domain&&t.setAttribute(i,n[`${o}Reverse`]?a.domain.slice().reverse():a.domain)}else throw new Error(`Unrecognized symbol: ${s}`)})}function tTt(t,e){const{marks:n}=e;gb("x",t,n),gb("y",t,n),gb("fx",t,n),gb("fy",t,n)}function gb(t,e,n){const r=e[t]||{};if(r.axis===null||r.label!==void 0)return;const i=n.map(o=>{var a;return(a=o.channelField(t))==null?void 0:a.field});if(i.every(o=>o==null))return;let s;for(let o=0;o<i.length;++o){const a=FQ(i[o]);a!==void 0&&(s===void 0?s=a:s!==a&&(s=void 0))}s!==void 0&&(e[t]={...r,label:s})}function FQ(t){if(t){switch(t.type){case"COLUMN_REF":return t.column;case"CAST":return FQ(t.expr);case"FUNCTION":if(t.name==="make_date")return"date";break}return eTt(t)}}function eTt(t){const e=`${t}`.replaceAll('"',"").replaceAll("(*)","()");return e.endsWith("()")?e.slice(0,-2):e}function nTt(t,e){let n=-1;for(const r of t.children){const i=r.getAttribute("aria-label")||"";r.nodeName==="style"||i.includes("-axis")||i.includes("-grid")||r.setAttribute("data-index",e[++n])}}const rTt={width:640,marginLeft:40,marginRight:20,marginTop:20,marginBottom:30};class iTt{constructor(e){this.attributes={...rTt},this.listeners=null,this.interactors=[],this.legends=[],this.marks=[],this.markset=null,this.params=new Map,this.synch=ypt(),this.element=e||document.createElement("div"),this.element.setAttribute("class","plot"),this.element.style.display="flex",Object.assign(this.element,{value:this})}margins(){return{left:this.getAttribute("marginLeft"),top:this.getAttribute("marginTop"),bottom:this.getAttribute("marginBottom"),right:this.getAttribute("marginRight")}}innerWidth(){const{left:e,right:n}=this.margins();return this.getAttribute("width")-e-n}innerHeight(e=400){const{top:n,bottom:r}=this.margins();let i=this.getAttribute("height");return i==null&&(i=sTt(this,n,r)||e,this.setAttribute("height",i,{silent:!0})),i-n-r}pending(e){this.synch.pending(e)}update(e){return this.synch.ready(e)&&!this.pendingRender&&(this.pendingRender=!0,requestAnimationFrame(()=>this.render())),this.synch.promise}async render(){this.pendingRender=!1;const e=await J3t(this),n=this.legends.flatMap(({legend:r,include:i})=>{const s=r.init(e);return i?s:[]});this.element.replaceChildren(e,...n),this.synch.resolve()}getAttribute(e){return this.attributes[e]}setAttribute(e,n,r){var i,s;return Dz(this.attributes[e],n)?(n===void 0?delete this.attributes[e]:this.attributes[e]=n,r!=null&&r.silent||(s=(i=this.listeners)==null?void 0:i.get(e))==null||s.forEach(o=>o(e,n)),!0):!1}addAttributeListener(e,n){const r=this.listeners||(this.listeners=new Map);return r.has(e)||r.set(e,new Set),r.get(e).add(n),this}removeAttributeListener(e,n){var r,i;return(i=(r=this.listeners)==null?void 0:r.get(e))==null?void 0:i.delete(n)}addParams(e,n){const{params:r}=this;for(const i of n)r.has(i)?r.get(i).push(e):(r.set(i,[e]),i.addEventListener("value",()=>Promise.allSettled(r.get(i).map(s=>s.initialize()))))}addMark(e){return e.setPlot(this,this.marks.length),this.marks.push(e),this.markset=null,this}get markSet(){return this.markset||(this.markset=new Set(this.marks))}addInteractor(e){return this.interactors.push(e),this}addLegend(e,n=!0){e.setPlot(this),this.legends.push({legend:e,include:n})}}function sTt(t,e,n){const r=t.getAttribute("aspectRatio");if(r==null)return;const i=t.getAttribute("xDomain"),s=t.getAttribute("yDomain");if(!i||!s)return;const o=Math.abs(i[1]-i[0]);return Math.abs(s[1]-s[0])*t.innerWidth()/(r*o)+e+n}function oTt(t){return typeof t!="string"?!1:(t=t.toLowerCase().trim(),t==="none"||t==="currentcolor"||t.startsWith("url(")&&t.endsWith(")")||t.startsWith("var(")&&t.endsWith(")")||Pc(t)!==null)}const aTt=new Set(["offset","order","reverse","sort","label","anchor","curve","tension","marker","markerStart","markerMid","markerEnd","textAnchor","lineAnchor","lineHeight","textOverflow","monospace","fontFamily","fontSize","fontStyle","fontVariant","fontWeight","frameAnchor","strokeLinejoin","strokeLinecap","strokeMiterlimit","strokeDasharray","strokeDashoffset","mixBlendMode","shapeRendering","imageRendering","preserveAspectRatio","interpolate","crossOrigin","paintOrder","pointerEvents","target","select"]);function uTt(t){return aTt.has(t)}const cTt=new Set(["asterisk","circle","cross","diamond","diamond2","hexagon","plus","square","square2","star","times","triangle","triangle2","wye"]);function lTt(t){return cTt.has(`${t}`.toLowerCase())}const NQ=t=>t==="stroke"||t==="fill",fTt=t=>/opacity$/i.test(t),dTt=t=>t==="symbol",hTt=(t,e)=>t!=="sort"&&t!=="tip"&&e!=null&&!Array.isArray(e),qA=(t,e)=>({channel:t,field:e,as:S2(e)&&!lct(e)?e.column:t}),WA=(t,e)=>({channel:t,value:e}),uL=t=>Array.isArray(t);let OQ=class extends k2{constructor(e,n,r,i={}){var c;super((c=n==null?void 0:n.options)==null?void 0:c.filterBy),this.type=e,this.reqs=i,this.source=n;const s=this.channels=[],o=this.detail=new Set,a=this.params=new Set;uL(n)?this.data=c5(n):uf(n==null?void 0:n.table)&&a.add(n.table);const u=(l,f)=>{const d=typeof f;if(l==="channels")for(const h in f)o.add(h),u(h,f[h]);else if(d==="function"&&f[wpt]){const h=f(this,l);for(const p in h)u(p,h[p])}else if(d==="string")uTt(l)||NQ(l)&&oTt(f)||dTt(l)&&lTt(f)?s.push(WA(l,f)):s.push(qA(l,lz(f)));else if(hy(f)){const h=WA(l,f.value);s.push(h),f.addEventListener("value",p=>(h.value=p,this.update()))}else du(f)?(Hct(f).forEach(h=>a.add(h)),s.push(qA(l,f))):d==="object"&&hTt(l,f)?s.push(qA(l,f)):f!==void 0&&s.push(WA(l,f))};for(const l in r)u(l,r[l])}setPlot(e,n){var r;this.plot=e,this.index=n,e.addParams(this,this.params),(r=this.source)!=null&&r.table&&this.queryPending()}sourceTable(){var n;const e=(n=this.source)==null?void 0:n.table;return e?uf(e)?e.value:e:null}hasOwnData(){return this.source==null||uL(this.source)}hasFieldInfo(){return!!this._fieldInfo}channel(e){return this.channels.find(n=>n.channel===e)}channelField(e,{exact:n=!1}={}){const r=n?this.channel(e):this.channels.find(i=>i.channel.startsWith(e));return r!=null&&r.field?r:null}fields(){var s,o,a;if(this.hasOwnData())return null;const{channels:e,reqs:n}=this,r=new Map;for(const{channel:u,field:c}of e){if(!c)continue;const l=((s=c.stats)==null?void 0:s.stats)||[],f=((o=c.stats)==null?void 0:o.column)??c,d=r.get(f)??r.set(f,new Set).get(f);l.forEach(h=>d.add(h)),(a=n[u])==null||a.forEach(h=>d.add(h))}const i=this.sourceTable();return Array.from(r,([u,c])=>({table:i,column:u,stats:Array.from(c)}))}fieldInfo(e){var r;const n=Object.fromEntries(e.map(i=>[i.column,i]));for(const i of this.channels){const{field:s}=i;s&&Object.assign(i,n[((r=s.stats)==null?void 0:r.column)??s])}return this._fieldInfo=!0,this}query(e=[]){return this.hasOwnData()?null:gTt(this.channels,this.sourceTable()).where(e)}queryPending(){return this.plot.pending(this),this}queryResult(e){return this.data=c5(e),this}update(){return this.plot.update(this)}plotSpecs(){const{type:e,data:n,detail:r,channels:i}=this;return mTt(e,r,i,n)}};function pTt(t,e){const n=(e==null?void 0:e[t.as])??t.as;return Object.hasOwn(t,"value")?t.value:NQ(t.channel)?{value:n,scale:"color"}:fTt(t.channel)?{value:n,scale:"opacity"}:n}function gTt(t,e,n=[]){const r=Ni.from({source:e}),i=new Set;let s=!1;for(const o of t){const{channel:a,field:u,as:c}=o;if(!n.includes(a)){if(a==="orderby")r.orderby(o.value??u);else if(u){if(T2(u))s=!0;else{if(i.has(c))continue;i.add(c)}r.select({[c]:u})}}}return s&&r.groupby(Array.from(i)),r}function mTt(t,e,n,r,i={}){const{numRows:s,values:o,columns:a}=r??{},u={};for(const f of n){const d=e.has(f.channel)?u:i;d[f.channel]=pTt(f,a)}return e.size&&(i.channels=u),[{type:t,data:o??(r?{length:s}:null),options:i}]}function yTt(t,e){const{plot:n}=t;let r=n.getAttribute(`${e}Scale`);if(!r){const{type:s}=t.channelField(e);r=s==="date"?"time":"linear"}const i={type:r};switch(r){case"log":i.base=n.getAttribute(`${e}Base`)??10;break;case"pow":i.exponent=n.getAttribute(`${e}Exponent`)??1;break;case"symlog":i.constant=n.getAttribute(`${e}Constant`)??1;break}return Tz(i)}function bTt(t,e,n,r,i=1,s){const{field:o}=t.channelField(e);s=s??o;const{type:a,apply:u,sqlApply:c}=yTt(t,e),l=!!t.plot.getAttribute(`${e}Reverse`),[f,d]=r.map(g=>u(g)),h=c(s),p=a==="time"||a==="utc"?h:s;return[Jct(h,f,d,n-i,l),p]}function vTt(t,e){if(!t)return;let n,r;return[t].flat().forEach(i=>Ef(i,s=>{if(s instanceof pz&&`${s.expr}`===e){const o=(s.extent??[]).map(a=>(a==null?void 0:a.value)??a);(n==null||o[0]<n)&&(n=o[0]),(r==null||o[1]>r)&&(r=o[1])}})),n!=null&&r!=null&&n!==r?[n,r]:void 0}class wTt extends OQ{constructor(e,n,r){const i=e.endsWith("X")?"y":e.endsWith("Y")?"x":null,s=i?{[i]:["count","min","max"]}:void 0;super(e,n,r,s),this.dim=i}query(e=[]){var y,b;const{plot:n,dim:r,source:i}=this;let s=(y=i.options)==null?void 0:y.optimize;const o=super.query(e);if(!r)return o;const a=r==="x"?"y":"x",u=(b=this.channelField(a,{exact:!0}))==null?void 0:b.as,{field:c,as:l,type:f,count:d,min:h,max:p}=this.channelField(r),g=f==="date"||f==="number",m=r==="x"?n.innerWidth():n.innerHeight();if(s??(s=d/m>10),s&&g&&u){const[w,v]=vTt(e,c)||[h,p],[x]=bTt(this,r,m,[w,v],1,l),S=o._select.map(_=>_.alias).filter(_=>_!==l&&_!==u);return Zct(o,x,l,u,S)}else return o.orderby(l)}}function xTt(t){const e=t.toLowerCase(),n=t.length;let r="";for(let i=0;i<n;++i)r+=(t[i]!==e[i]?"-":"")+e[i];return r}function _Tt(t){const e={};for(const n in t)e[xTt(n)]=t[n];return e}function STt(){const t=this,e=t.getScreenCTM;let n;t.getScreenCTM=()=>t.isConnected?n=e.call(t):n}function RQ(t){const e=t.on;let n=!0;function r(i){n=!1,i(),n=!0}return t.reset=(...i)=>{r(()=>t.clear(...i))},t.moveSilent=(...i)=>{r(()=>t.move(...i))},t.on=(...i)=>{if(i.length>1&&i[1]){const s=i[1];i[1]=(...o)=>n&&s(...o)}return e(...i)},t}function ETt(){return RQ(Dyt())}function ATt(){return RQ(Lyt())}function $Tt(t,e,n,r,i){let s=fr(e??t).append("g").attr("class",i);const o=t.scale("fx"),a=t.scale("fy");if(o||a){const u=o==null?void 0:o.domain.map(l=>o.apply(l)-n),c=a==null?void 0:a.domain.map(l=>a.apply(l)-r);if(u&&c)for(let l=0;l<u.length;++l)for(let f=0;f<c.length;++f)s.append("g").attr("transform",`translate(${u[l]}, ${c[f]})`);else if(u)for(let l=0;l<u.length;++l)s.append("g").attr("transform",`translate(${u[l]}, 0})`);else if(c)for(let l=0;l<c.length;++l)s.append("g").attr("transform",`translate(0, ${c[l]})`);s=s.selectAll("g")}return s.each(STt)}const cL=1e-12;function TTt(t,e){return t===e||t&&e&&Math.abs(t[0]-e[0])<cL&&Math.abs(t[1]-e[1])<cL||!1}function kTt(t){if(du(t)){if(t.type==="COLUMN_REF")return t.column;if(t.type==="AGGREGATE")return t.args[0]??t}return t}function MTt(t,e){var n;return kTt((n=t.channelField(e))==null?void 0:n.field)}function CTt(t,e,n=1){return e.invert(n*Math.floor(t/n))}class ITt{constructor(e,{channel:n,selection:r,field:i=void 0,pixelSize:s=1,peers:o=!0,brush:a}){this.mark=e,this.channel=n,this.pixelSize=s||1,this.selection=r,this.peers=o,this.field=i||MTt(e,n),this.style=a&&_Tt(a),this.brush=n==="y"?ATt():ETt(),this.brush.on("brush end",({selection:u})=>this.publish(u))}reset(){this.value=void 0,this.g&&this.brush.reset(this.g)}activate(){this.selection.activate(this.clause(this.value||[0,1]))}publish(e){let n;e&&(n=e.map(r=>CTt(r,this.scale,this.pixelSize)).sort((r,i)=>r-i)),TTt(n,this.value)||(this.value=n,this.g.call(this.brush.moveSilent,e),this.selection.update(this.clause(n)))}clause(e){const{mark:n,pixelSize:r,field:i,scale:s}=this;return gpt(i,e,{source:this,clients:this.peers?n.plot.markSet:new Set().add(n),scale:s,pixelSize:r})}init(e,n){var c;const{brush:r,channel:i,style:s}=this;this.scale=e.scale(i);const o=(c=this.value)==null?void 0:c.map(this.scale.apply).sort(Fe),a=e.scale("x").range,u=e.scale("y").range;if(r.extent([[wn(a),wn(u)],[Be(a),Be(u)]]),this.g=$Tt(e,n,wn(a),wn(u),`interval-${i}`).call(r).call(r.moveSilent,o),s){const l=this.g.selectAll("rect.selection");for(const f in s)l.attr(f,s[f])}e.addEventListener("pointerenter",l=>{l.buttons||this.activate()})}}const FTt=t=>t&&typeof t=="object"&&!Array.isArray(t);class NTt extends k2{constructor({element:e,filterBy:n,as:r,from:i,column:s,label:o=s,format:a=f=>f,options:u,value:c,field:l=s}={}){super(n),this.from=i,this.column=s,this.format=a,this.field=l;const f=this.selection=r;this.element=e??document.createElement("div"),this.element.setAttribute("class","input"),Object.defineProperty(this.element,"value",{value:this});const d=document.createElement("label");if(d.innerText=o||s,this.element.appendChild(d),this.select=document.createElement("select"),this.element.appendChild(this.select),u&&(this.data=u.map(h=>FTt(h)?h:{value:h}),this.selectedValue(c===void 0?"":c),this.update()),f){const h=!N1(f);c!=null&&(!h||f.value===void 0)&&this.publish(c),this.select.addEventListener("input",()=>{this.publish(this.selectedValue()??null)}),h?this.selection.addEventListener("value",p=>{p!==this.select.value&&this.selectedValue(p)}):(this.select.addEventListener("pointerenter",p=>{p.buttons||this.activate()}),this.select.addEventListener("focus",()=>this.activate()))}}selectedValue(e){var n;if(arguments.length===0){const r=this.select.selectedIndex;return this.data[r].value}else{const r=(n=this.data)==null?void 0:n.findIndex(i=>i.value===e);r>=0?this.select.selectedIndex=r:this.select.value=String(e)}}reset(){this.select.selectedIndex=this.from?0:-1}activate(){N1(this.selection)&&this.selection.activate(u5(this.field,0,{source:this}))}publish(e){const{selection:n,field:r}=this;if(N1(n)){e===""&&(e=void 0);const i=u5(r,e,{source:this});n.update(i)}else uf(n)&&n.update(e)}query(e=[]){const{from:n,column:r}=this;return n?Ni.from(n).select({value:r}).distinct().where(e).orderby(r):null}queryResult(e){return this.data=[{value:"",label:"All"},...e],this}update(){const{data:e,format:n,select:r,selection:i}=this;r.replaceChildren();for(const{value:s,label:o}of e){const a=document.createElement("option");a.setAttribute("value",s),a.innerText=o??n(s),this.select.appendChild(a)}if(i){const s=N1(i)?i.valueFor(this):i.value;this.selectedValue(s===void 0?"":s)}return this}}const OTt=LQ(t=>{const e=DQ(t);return n=>n==null?"":typeof n=="number"?e(n):n instanceof Date?RTt(n):`${n}`}),DQ=LQ(t=>e=>e===0?"0":e.toLocaleString(t));OTt();DQ();function RTt(t){return QY(t,"Invalid Date")}function LQ(t){let e=null,n;return(r="en")=>r===e?n:n=t(e=r)}function BQ(t,...e){var r;const n=((r=t==null?void 0:t.context)==null?void 0:r.coordinator)??cm();for(const i of e)n.connect(i)}function DTt(t,e,n){const r=new e(n);return BQ(t,r),r.element}function LTt(t){return DTt(this,NTt,t)}function PQ({direction:t="vertical",wrap:e=!1},n){const r=document.createElement("div");return r.style.display="flex",r.style.flexDirection=t==="vertical"?"column":"row",r.style.flexWrap=e?e===!0?"wrap":e:"nowrap",r.style.justifyContent="flex-start",r.style.alignItems="flex-start",n.forEach(i=>r.appendChild(i)),Object.assign(r,{value:{element:r}}),r}function BTt(...t){return PQ({direction:"vertical"},t.flat())}function lL(...t){return PQ({direction:"horizontal"},t.flat())}function zQ({dim:t="width",size:e=10}){const n=document.createElement("span");return n.style.display="inline-block",n.style[t]=Number.isNaN(+e)?e:`${e}px`,Object.assign(n,{value:{element:n}})}function PTt(t){return zQ({dim:"height",size:t})}function fL(t){return zQ({dim:"width",size:t})}function UQ(t,e,n){uf(n)?(n.addEventListener("value",r=>{t.setAttribute(e,r),t.update()}),n.value!==void 0&&t.setAttribute(e,n.value)):t.setAttribute(e,n)}function zTt(t,e){return n=>{UQ(n,t,e)}}function UTt(t){return e=>{for(const[n,r]of Object.entries(t))UQ(e,n,r)}}function jTt(t){return UTt({xDomain:t,yDomain:t})}const jQ=t=>e=>zTt(t,e),qTt=jQ("width"),WTt=jQ("height");function VTt(t,e){return{table:t,options:e}}const GTt=new Set(["frame","axisX","axisY","axisFx","axisFy","gridX","gridY","gridFx","gridFy","hexgrid","graticule","sphere"]);function YTt(t,e,n={}){arguments.length===2&&!Array.isArray(e)&&(n=e,e=GTt.has(t)?null:[{}]);const r=t.startsWith("area")||t.startsWith("line")?wTt:OQ;return HTt(r,t,e,n)}function HTt(t,e,n,r){return i=>{i.addMark(new t(e,n,r))}}const XTt=(...t)=>YTt("dot",...t);function KTt(t,e){return n=>{const r=n.marks[n.marks.length-1];n.addInteractor(new t(r,e))}}function QTt({as:t,...e}){return KTt(ITt,{...e,selection:t,channel:"x"})}function JTt(...t){const e=new iTt;return t.flat().forEach(n=>n(e)),BQ(this,...e.marks),e.update(),e.element}const ZTt=/("(?:[^\\"]|\\.)*")|[:,]/g;function VA(t,e={}){const n=JSON.stringify([1],void 0,e.indent===void 0?2:e.indent).slice(2,-3),r=n===""?1/0:e.maxLength===void 0?80:e.maxLength;let{replacer:i}=e;return function s(o,a,u){o&&typeof o.toJSON=="function"&&(o=o.toJSON());const c=JSON.stringify(o,i);if(c===void 0)return c;const l=r-a.length-u;if(c.length<=l){const f=c.replace(ZTt,(d,h)=>h||`${d} `);if(f.length<=l)return f}if(i!=null&&(o=JSON.parse(c),i=void 0),typeof o=="object"&&o!==null){const f=a+n,d=[];let h=0,p,g;if(Array.isArray(o)){p="[",g="]";const{length:m}=o;for(;h<m;h++)d.push(s(o[h],f,h===m-1?0:1)||"null")}else{p="{",g="}";const m=Object.keys(o),{length:y}=m;for(;h<y;h++){const b=m[h],w=`${JSON.stringify(b)}: `,v=s(o[b],f,w.length+(h===y-1?0:1));v!==void 0&&d.push(w+v)}}if(d.length>0)return[p,n+d.join(`,
${f}`),g].join(`
${a}`)}return c}(t,"",0)}function yi(t,e,n){return t.fields=e||[],t.fname=n,t}function rn(t){return t==null?null:t.fname}function yr(t){return t==null?null:t.fields}function qQ(t){return t.length===1?tkt(t[0]):ekt(t)}const tkt=t=>function(e){return e[t]},ekt=t=>{const e=t.length;return function(n){for(let r=0;r<e;++r)n=n[t[r]];return n}};function j(t){throw Error(t)}function ga(t){const e=[],n=t.length;let r=null,i=0,s="",o,a,u;t=t+"";function c(){e.push(s+t.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=t[a],u==="\\")s+=t.substring(o,a++),o=a;else if(u===r)c(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?c():o=a+1:u==="["?(a>o&&c(),i=o=a+1):u==="]"&&(i||j("Access path missing open bracket: "+t),i>0&&c(),i=0,o=a+1)}return i&&j("Access path missing closing bracket: "+t),r&&j("Access path missing closing quote: "+t),a>o&&(a++,c()),e}function ys(t,e,n){const r=ga(t);return t=r.length===1?r[0]:t,yi((n&&n.get||qQ)(r),[t],e||t)}const Vy=ys("id"),Er=yi(t=>t,[],"identity"),uc=yi(()=>0,[],"zero"),lg=yi(()=>1,[],"one"),bs=yi(()=>!0,[],"true"),Hu=yi(()=>!1,[],"false");function nkt(t,e,n){const r=[e].concat([].slice.call(n));console[t].apply(console,r)}const WQ=0,OF=1,RF=2,VQ=3,GQ=4;function DF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:nkt,r=t||WQ;return{level(i){return arguments.length?(r=+i,this):r},error(){return r>=OF&&n(e||"error","ERROR",arguments),this},warn(){return r>=RF&&n(e||"warn","WARN",arguments),this},info(){return r>=VQ&&n(e||"log","INFO",arguments),this},debug(){return r>=GQ&&n(e||"log","DEBUG",arguments),this}}}var W=Array.isArray;function st(t){return t===Object(t)}const dL=t=>t!=="__proto__";function fg(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.reduce((r,i)=>{for(const s in i)if(s==="signals")r.signals=rkt(r.signals,i.signals);else{const o=s==="legend"?{layout:1}:s==="style"?!0:null;dg(r,s,i[s],o)}return r},{})}function dg(t,e,n,r){if(!dL(e))return;let i,s;if(st(n)&&!W(n)){s=st(t[e])?t[e]:t[e]={};for(i in n)r&&(r===!0||r[i])?dg(s,i,n[i]):dL(i)&&(s[i]=n[i])}else t[e]=n}function rkt(t,e){if(t==null)return e;const n={},r=[];function i(s){n[s.name]||(n[s.name]=1,r.push(s))}return e.forEach(i),t.forEach(i),r}function te(t){return t[t.length-1]}function pr(t){return t==null||t===""?null:+t}const YQ=t=>e=>t*Math.exp(e),HQ=t=>e=>Math.log(t*e),XQ=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),KQ=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t,$x=t=>e=>e<0?-Math.pow(-e,t):Math.pow(e,t);function W_(t,e,n,r){const i=n(t[0]),s=n(te(t)),o=(s-i)*e;return[r(i-o),r(s-o)]}function QQ(t,e){return W_(t,e,pr,Er)}function JQ(t,e){var n=Math.sign(t[0]);return W_(t,e,HQ(n),YQ(n))}function ZQ(t,e,n){return W_(t,e,$x(n),$x(1/n))}function tJ(t,e,n){return W_(t,e,XQ(n),KQ(n))}function V_(t,e,n,r,i){const s=r(t[0]),o=r(te(t)),a=e!=null?r(e):(s+o)/2;return[i(a+(s-a)*n),i(a+(o-a)*n)]}function LF(t,e,n){return V_(t,e,n,pr,Er)}function BF(t,e,n){const r=Math.sign(t[0]);return V_(t,e,n,HQ(r),YQ(r))}function Tx(t,e,n,r){return V_(t,e,n,$x(r),$x(1/r))}function PF(t,e,n,r){return V_(t,e,n,XQ(r),KQ(r))}function eJ(t){return 1+~~(new Date(t).getMonth()/3)}function nJ(t){return 1+~~(new Date(t).getUTCMonth()/3)}function ot(t){return t!=null?W(t)?t:[t]:[]}function rJ(t,e,n){let r=t[0],i=t[1],s;return i<r&&(s=i,i=r,r=s),s=i-r,s>=n-e?[e,n]:[r=Math.min(Math.max(r,e),n-s),r+s]}function jt(t){return typeof t=="function"}const ikt="descending";function zF(t,e,n){n=n||{},e=ot(e)||[];const r=[],i=[],s={},o=n.comparator||skt;return ot(t).forEach((a,u)=>{a!=null&&(r.push(e[u]===ikt?-1:1),i.push(a=jt(a)?a:ys(a,null,n)),(yr(a)||[]).forEach(c=>s[c]=1))}),i.length===0?null:yi(o(i,r),Object.keys(s))}const Gy=(t,e)=>(t<e||t==null)&&e!=null?-1:(t>e||e==null)&&t!=null?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e===e?-1:e!==e&&t===t?1:0),skt=(t,e)=>t.length===1?okt(t[0],e[0]):akt(t,e,t.length),okt=(t,e)=>function(n,r){return Gy(t(n),t(r))*e},akt=(t,e,n)=>(e.push(0),function(r,i){let s,o=0,a=-1;for(;o===0&&++a<n;)s=t[a],o=Gy(s(r),s(i));return o*e[a]});function Ar(t){return jt(t)?t:()=>t}function UF(t,e){let n;return r=>{n&&clearTimeout(n),n=setTimeout(()=>(e(r),n=null),t)}}function Pt(t){for(let e,n,r=1,i=arguments.length;r<i;++r){e=arguments[r];for(n in e)t[n]=e[n]}return t}function ea(t,e){let n=0,r,i,s,o;if(t&&(r=t.length))if(e==null){for(i=t[n];n<r&&(i==null||i!==i);i=t[++n]);for(s=o=i;n<r;++n)i=t[n],i!=null&&(i<s&&(s=i),i>o&&(o=i))}else{for(i=e(t[n]);n<r&&(i==null||i!==i);i=e(t[++n]));for(s=o=i;n<r;++n)i=e(t[n]),i!=null&&(i<s&&(s=i),i>o&&(o=i))}return[s,o]}function iJ(t,e){const n=t.length;let r=-1,i,s,o,a,u;if(e==null){for(;++r<n;)if(s=t[r],s!=null&&s>=s){i=o=s;break}if(r===n)return[-1,-1];for(a=u=r;++r<n;)s=t[r],s!=null&&(i>s&&(i=s,a=r),o<s&&(o=s,u=r))}else{for(;++r<n;)if(s=e(t[r],r,t),s!=null&&s>=s){i=o=s;break}if(r===n)return[-1,-1];for(a=u=r;++r<n;)s=e(t[r],r,t),s!=null&&(i>s&&(i=s,a=r),o<s&&(o=s,u=r))}return[a,u]}function ft(t,e){return Object.hasOwn(t,e)}const mb={};function hg(t){let e={},n;function r(s){return ft(e,s)&&e[s]!==mb}const i={size:0,empty:0,object:e,has:r,get(s){return r(s)?e[s]:void 0},set(s,o){return r(s)||(++i.size,e[s]===mb&&--i.empty),e[s]=o,this},delete(s){return r(s)&&(--i.size,++i.empty,e[s]=mb),this},clear(){i.size=i.empty=0,i.object=e={}},test(s){return arguments.length?(n=s,i):n},clean(){const s={};let o=0;for(const a in e){const u=e[a];u!==mb&&(!n||!n(u))&&(s[a]=u,++o)}i.size=o,i.empty=0,i.object=e=s}};return t&&Object.keys(t).forEach(s=>{i.set(s,t[s])}),i}function sJ(t,e,n,r,i,s){if(!n&&n!==0)return s;const o=+n;let a=t[0],u=te(t),c;u<a&&(c=a,a=u,u=c),c=Math.abs(e-a);const l=Math.abs(u-e);return c<l&&c<=o?r:l<=o?i:s}function tt(t,e,n){const r=t.prototype=Object.create(e.prototype);return Object.defineProperty(r,"constructor",{value:t,writable:!0,enumerable:!0,configurable:!0}),Pt(r,n)}function yh(t,e,n,r){let i=e[0],s=e[e.length-1],o;return i>s&&(o=i,i=s,s=o),n=n===void 0||n,r=r===void 0||r,(n?i<=t:i<t)&&(r?t<=s:t<s)}function gl(t){return typeof t=="boolean"}function Ec(t){return Object.prototype.toString.call(t)==="[object Date]"}function oJ(t){return t&&jt(t[Symbol.iterator])}function ue(t){return typeof t=="number"}function aJ(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function at(t){return typeof t=="string"}function jF(t,e,n){t&&(t=e?ot(t).map(a=>a.replace(/\\(.)/g,"$1")):ot(t));const r=t&&t.length,i=n&&n.get||qQ,s=a=>i(e?[a]:ga(a));let o;if(!r)o=function(){return""};else if(r===1){const a=s(t[0]);o=function(u){return""+a(u)}}else{const a=t.map(s);o=function(u){let c=""+a[0](u),l=0;for(;++l<r;)c+="|"+a[l](u);return c}}return yi(o,t,"key")}function uJ(t,e){const n=t[0],r=te(t),i=+e;return i?i===1?r:n+i*(r-n):n}const ukt=1e4;function cJ(t){t=+t||ukt;let e,n,r;const i=()=>{e={},n={},r=0},s=(o,a)=>(++r>t&&(n=e,e={},r=1),e[o]=a);return i(),{clear:i,has:o=>ft(e,o)||ft(n,o),get:o=>ft(e,o)?e[o]:ft(n,o)?s(o,n[o]):void 0,set:(o,a)=>ft(e,o)?e[o]=a:s(o,a)}}function lJ(t,e,n,r){const i=e.length,s=n.length;if(!s)return e;if(!i)return n;const o=r||new e.constructor(i+s);let a=0,u=0,c=0;for(;a<i&&u<s;++c)o[c]=t(e[a],n[u])>0?n[u++]:e[a++];for(;a<i;++a,++c)o[c]=e[a];for(;u<s;++u,++c)o[c]=n[u];return o}function Mm(t,e){let n="";for(;--e>=0;)n+=t;return n}function fJ(t,e,n,r){const i=n||" ",s=t+"",o=e-s.length;return o<=0?s:r==="left"?Mm(i,o)+s:r==="center"?Mm(i,~~(o/2))+s+Mm(i,Math.ceil(o/2)):s+Mm(i,o)}function Yy(t){return t&&te(t)-t[0]||0}function J(t){return W(t)?"["+t.map(J)+"]":st(t)||at(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function qF(t){return t==null||t===""?null:!t||t==="false"||t==="0"?!1:!!t}const ckt=t=>ue(t)||Ec(t)?t:Date.parse(t);function WF(t,e){return e=e||ckt,t==null||t===""?null:e(t)}function VF(t){return t==null||t===""?null:t+""}function Gs(t){const e={},n=t.length;for(let r=0;r<n;++r)e[t[r]]=!0;return e}function dJ(t,e,n,r){const i=r??"",s=t+"",o=s.length,a=Math.max(0,e-i.length);return o<=e?s:n==="left"?i+s.slice(o-a):n==="center"?s.slice(0,Math.ceil(a/2))+i+s.slice(o-~~(a/2)):s.slice(0,a)+i}function nc(t,e,n){if(t)if(e){const r=t.length;for(let i=0;i<r;++i){const s=e(t[i]);s&&n(s,i,t)}}else t.forEach(n)}function lkt(t){return t}function fkt(t){if(t==null)return lkt;var e,n,r=t.scale[0],i=t.scale[1],s=t.translate[0],o=t.translate[1];return function(a,u){u||(e=n=0);var c=2,l=a.length,f=new Array(l);for(f[0]=(e+=a[0])*r+s,f[1]=(n+=a[1])*i+o;c<l;)f[c]=a[c],++c;return f}}function dkt(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}function hkt(t,e){return typeof e=="string"&&(e=t.objects[e]),e.type==="GeometryCollection"?{type:"FeatureCollection",features:e.geometries.map(function(n){return hL(t,n)})}:hL(t,e)}function hL(t,e){var n=e.id,r=e.bbox,i=e.properties==null?{}:e.properties,s=hJ(t,e);return n==null&&r==null?{type:"Feature",properties:i,geometry:s}:r==null?{type:"Feature",id:n,properties:i,geometry:s}:{type:"Feature",id:n,bbox:r,properties:i,geometry:s}}function hJ(t,e){var n=fkt(t.transform),r=t.arcs;function i(l,f){f.length&&f.pop();for(var d=r[l<0?~l:l],h=0,p=d.length;h<p;++h)f.push(n(d[h],h));l<0&&dkt(f,p)}function s(l){return n(l)}function o(l){for(var f=[],d=0,h=l.length;d<h;++d)i(l[d],f);return f.length<2&&f.push(f[0]),f}function a(l){for(var f=o(l);f.length<4;)f.push(f[0]);return f}function u(l){return l.map(a)}function c(l){var f=l.type,d;switch(f){case"GeometryCollection":return{type:f,geometries:l.geometries.map(c)};case"Point":d=s(l.coordinates);break;case"MultiPoint":d=l.coordinates.map(s);break;case"LineString":d=o(l.arcs);break;case"MultiLineString":d=l.arcs.map(o);break;case"Polygon":d=u(l.arcs);break;case"MultiPolygon":d=l.arcs.map(u);break;default:return null}return{type:f,coordinates:d}}return c(e)}function pkt(t,e){var n={},r={},i={},s=[],o=-1;e.forEach(function(c,l){var f=t.arcs[c<0?~c:c],d;f.length<3&&!f[1][0]&&!f[1][1]&&(d=e[++o],e[o]=c,e[l]=d)}),e.forEach(function(c){var l=a(c),f=l[0],d=l[1],h,p;if(h=i[f])if(delete i[h.end],h.push(c),h.end=d,p=r[d]){delete r[p.start];var g=p===h?h:h.concat(p);r[g.start=h.start]=i[g.end=p.end]=g}else r[h.start]=i[h.end]=h;else if(h=r[d])if(delete r[h.start],h.unshift(c),h.start=f,p=i[f]){delete i[p.end];var m=p===h?h:p.concat(h);r[m.start=p.start]=i[m.end=h.end]=m}else r[h.start]=i[h.end]=h;else h=[c],r[h.start=f]=i[h.end=d]=h});function a(c){var l=t.arcs[c<0?~c:c],f=l[0],d;return t.transform?(d=[0,0],l.forEach(function(h){d[0]+=h[0],d[1]+=h[1]})):d=l[l.length-1],c<0?[d,f]:[f,d]}function u(c,l){for(var f in c){var d=c[f];delete l[d.start],delete d.start,delete d.end,d.forEach(function(h){n[h<0?~h:h]=1}),s.push(d)}}return u(i,r),u(r,i),e.forEach(function(c){n[c<0?~c:c]||s.push([c])}),s}function gkt(t){return hJ(t,mkt.apply(this,arguments))}function mkt(t,e,n){var r,i,s;if(arguments.length>1)r=ykt(t,e,n);else for(i=0,r=new Array(s=t.arcs.length);i<s;++i)r[i]=i;return{type:"MultiLineString",arcs:pkt(t,r)}}function ykt(t,e,n){var r=[],i=[],s;function o(f){var d=f<0?~f:f;(i[d]||(i[d]=[])).push({i:f,g:s})}function a(f){f.forEach(o)}function u(f){f.forEach(a)}function c(f){f.forEach(u)}function l(f){switch(s=f,f.type){case"GeometryCollection":f.geometries.forEach(l);break;case"LineString":a(f.arcs);break;case"MultiLineString":case"Polygon":u(f.arcs);break;case"MultiPolygon":c(f.arcs);break}}return l(e),i.forEach(n==null?function(f){r.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&r.push(f[0].i)}),r}const Jn="year",di="quarter",br="month",_n="week",hi="date",hr="day",na="dayofyear",Di="hours",Li="minutes",vs="seconds",Ys="milliseconds",GF=[Jn,di,br,_n,hi,hr,na,Di,Li,vs,Ys],GA=GF.reduce((t,e,n)=>(t[e]=1+n,t),{});function YF(t){const e=ot(t).slice(),n={};return e.length||j("Missing time unit."),e.forEach(i=>{ft(GA,i)?n[i]=1:j(`Invalid time unit: ${i}.`)}),(n[_n]||n[hr]?1:0)+(n[di]||n[br]||n[hi]?1:0)+(n[na]?1:0)>1&&j(`Incompatible time units: ${t}`),e.sort((i,s)=>GA[i]-GA[s]),e}const bkt={[Jn]:"%Y ",[di]:"Q%q ",[br]:"%b ",[hi]:"%d ",[_n]:"W%U ",[hr]:"%a ",[na]:"%j ",[Di]:"%H:00",[Li]:"00:%M",[vs]:":%S",[Ys]:".%L",[`${Jn}-${br}`]:"%Y-%m ",[`${Jn}-${br}-${hi}`]:"%Y-%m-%d ",[`${Di}-${Li}`]:"%H:%M"};function pJ(t,e){const n=Pt({},bkt,e),r=YF(t),i=r.length;let s="",o=0,a,u;for(o=0;o<i;)for(a=r.length;a>o;--a)if(u=r.slice(o,a).join("-"),n[u]!=null){s+=n[u],o=a;break}return s.trim()}const Hl=new Date;function HF(t){return Hl.setFullYear(t),Hl.setMonth(0),Hl.setDate(1),Hl.setHours(0,0,0,0),Hl}function gJ(t){return yJ(new Date(t))}function mJ(t){return HT(new Date(t))}function yJ(t){return js.count(HF(t.getFullYear())-1,t)}function HT(t){return Uc.count(HF(t.getFullYear())-1,t)}function XT(t){return HF(t).getDay()}function vkt(t,e,n,r,i,s,o){if(0<=t&&t<100){const a=new Date(-1,e,n,r,i,s,o);return a.setFullYear(t),a}return new Date(t,e,n,r,i,s,o)}function bJ(t){return wJ(new Date(t))}function vJ(t){return KT(new Date(t))}function wJ(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return Sc.count(e-1,t)}function KT(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return jc.count(e-1,t)}function QT(t){return Hl.setTime(Date.UTC(t,0,1)),Hl.getUTCDay()}function wkt(t,e,n,r,i,s,o){if(0<=t&&t<100){const a=new Date(Date.UTC(-1,e,n,r,i,s,o));return a.setUTCFullYear(n.y),a}return new Date(Date.UTC(t,e,n,r,i,s,o))}function xJ(t,e,n,r,i){const s=e||1,o=te(t),a=(y,b,w)=>(w=w||y,xkt(n[w],r[w],y===o&&s,b)),u=new Date,c=Gs(t),l=c[Jn]?a(Jn):Ar(2012),f=c[br]?a(br):c[di]?a(di):uc,d=c[_n]&&c[hr]?a(hr,1,_n+hr):c[_n]?a(_n,1):c[hr]?a(hr,1):c[hi]?a(hi,1):c[na]?a(na,1):lg,h=c[Di]?a(Di):uc,p=c[Li]?a(Li):uc,g=c[vs]?a(vs):uc,m=c[Ys]?a(Ys):uc;return function(y){u.setTime(+y);const b=l(u);return i(b,f(u),d(u,b),h(u),p(u),g(u),m(u))}}function xkt(t,e,n,r){const i=n<=1?t:r?(s,o)=>r+n*Math.floor((t(s,o)-r)/n):(s,o)=>n*Math.floor(t(s,o)/n);return e?(s,o)=>e(i(s,o),o):i}function pp(t,e,n){return e+t*7-(n+6)%7}const _kt={[Jn]:t=>t.getFullYear(),[di]:t=>Math.floor(t.getMonth()/3),[br]:t=>t.getMonth(),[hi]:t=>t.getDate(),[Di]:t=>t.getHours(),[Li]:t=>t.getMinutes(),[vs]:t=>t.getSeconds(),[Ys]:t=>t.getMilliseconds(),[na]:t=>yJ(t),[_n]:t=>HT(t),[_n+hr]:(t,e)=>pp(HT(t),t.getDay(),XT(e)),[hr]:(t,e)=>pp(1,t.getDay(),XT(e))},Skt={[di]:t=>3*t,[_n]:(t,e)=>pp(t,0,XT(e))};function _J(t,e){return xJ(t,e||1,_kt,Skt,vkt)}const Ekt={[Jn]:t=>t.getUTCFullYear(),[di]:t=>Math.floor(t.getUTCMonth()/3),[br]:t=>t.getUTCMonth(),[hi]:t=>t.getUTCDate(),[Di]:t=>t.getUTCHours(),[Li]:t=>t.getUTCMinutes(),[vs]:t=>t.getUTCSeconds(),[Ys]:t=>t.getUTCMilliseconds(),[na]:t=>wJ(t),[_n]:t=>KT(t),[hr]:(t,e)=>pp(1,t.getUTCDay(),QT(e)),[_n+hr]:(t,e)=>pp(KT(t),t.getUTCDay(),QT(e))},Akt={[di]:t=>3*t,[_n]:(t,e)=>pp(t,0,QT(e))};function SJ(t,e){return xJ(t,e||1,Ekt,Akt,wkt)}const $kt={[Jn]:hs,[di]:Lf.every(3),[br]:Lf,[_n]:Uc,[hi]:js,[hr]:js,[na]:js,[Di]:Qp,[Li]:Xp,[vs]:$i,[Ys]:ep},Tkt={[Jn]:ps,[di]:Bf.every(3),[br]:Bf,[_n]:jc,[hi]:Sc,[hr]:Sc,[na]:Sc,[Di]:Jp,[Li]:Kp,[vs]:$i,[Ys]:ep};function pg(t){return $kt[t]}function gg(t){return Tkt[t]}function EJ(t,e,n){return t?t.offset(e,n):void 0}function AJ(t,e,n){return EJ(pg(t),e,n)}function $J(t,e,n){return EJ(gg(t),e,n)}function TJ(t,e,n,r){return t?t.range(e,n,r):void 0}function kJ(t,e,n,r){return TJ(pg(t),e,n,r)}function MJ(t,e,n,r){return TJ(gg(t),e,n,r)}const Cm=1e3,Im=Cm*60,Fm=Im*60,G_=Fm*24,kkt=G_*7,pL=G_*30,JT=G_*365,CJ=[Jn,br,hi,Di,Li,vs,Ys],Nm=CJ.slice(0,-1),Om=Nm.slice(0,-1),Rm=Om.slice(0,-1),Mkt=Rm.slice(0,-1),Ckt=[Jn,_n],gL=[Jn,br],IJ=[Jn],Vg=[[Nm,1,Cm],[Nm,5,5*Cm],[Nm,15,15*Cm],[Nm,30,30*Cm],[Om,1,Im],[Om,5,5*Im],[Om,15,15*Im],[Om,30,30*Im],[Rm,1,Fm],[Rm,3,3*Fm],[Rm,6,6*Fm],[Rm,12,12*Fm],[Mkt,1,G_],[Ckt,1,kkt],[gL,1,pL],[gL,3,3*pL],[IJ,1,JT]];function FJ(t){const e=t.extent,n=t.maxbins||40,r=Math.abs(Yy(e))/n;let i=rd(a=>a[2]).right(Vg,r),s,o;return i===Vg.length?(s=IJ,o=Bc(e[0]/JT,e[1]/JT,n)):i?(i=Vg[r/Vg[i-1][2]<Vg[i][2]/r?i-1:i],s=i[0],o=i[1]):(s=CJ,o=Math.max(Bc(e[0],e[1],n),1)),{units:s,step:o}}function Dm(t){const e={};return n=>e[n]||(e[n]=t(n))}function Ikt(t,e){return n=>{const r=t(n),i=r.indexOf(e);if(i<0)return r;let s=Fkt(r,i);const o=s<r.length?r.slice(s):"";for(;--s>i;)if(r[s]!=="0"){++s;break}return r.slice(0,s)+o}}function Fkt(t,e){let n=t.lastIndexOf("e"),r;if(n>0)return n;for(n=t.length;--n>e;)if(r=t.charCodeAt(n),r>=48&&r<=57)return n+1}function NJ(t){const e=Dm(t.format),n=t.formatPrefix;return{format:e,formatPrefix:n,formatFloat(r){const i=Ff(r||",");if(i.precision==null){switch(i.precision=12,i.type){case"%":i.precision-=2;break;case"e":i.precision-=1;break}return Ikt(e(i),e(".1f")(1)[1])}else return e(i)},formatSpan(r,i,s,o){o=Ff(o??",f");const a=Bc(r,i,s),u=Math.max(Math.abs(r),Math.abs(i));let c;if(o.precision==null)switch(o.type){case"s":return isNaN(c=uW(a,u))||(o.precision=c),n(o,u);case"":case"e":case"g":case"p":case"r":{isNaN(c=cW(a,u))||(o.precision=c-(o.type==="e"));break}case"f":case"%":{isNaN(c=aW(a))||(o.precision=c-(o.type==="%")*2);break}}return e(o)}}}let ZT;OJ();function OJ(){return ZT=NJ({format:id,formatPrefix:BC})}function RJ(t){return NJ(oW(t))}function kx(t){return arguments.length?ZT=RJ(t):ZT}function mL(t,e,n){n=n||{},st(n)||j(`Invalid time multi-format specifier: ${n}`);const r=e(vs),i=e(Li),s=e(Di),o=e(hi),a=e(_n),u=e(br),c=e(di),l=e(Jn),f=t(n[Ys]||".%L"),d=t(n[vs]||":%S"),h=t(n[Li]||"%I:%M"),p=t(n[Di]||"%I %p"),g=t(n[hi]||n[hr]||"%a %d"),m=t(n[_n]||"%b %d"),y=t(n[br]||"%B"),b=t(n[di]||"%B"),w=t(n[Jn]||"%Y");return v=>(r(v)<v?f:i(v)<v?d:s(v)<v?h:o(v)<v?p:u(v)<v?a(v)<v?g:m:l(v)<v?c(v)<v?y:b:w)(v)}function DJ(t){const e=Dm(t.format),n=Dm(t.utcFormat);return{timeFormat:r=>at(r)?e(r):mL(e,pg,r),utcFormat:r=>at(r)?n(r):mL(n,gg,r),timeParse:Dm(t.parse),utcParse:Dm(t.utcParse)}}let tk;LJ();function LJ(){return tk=DJ({format:e_,parse:DV,utcFormat:Zp,utcParse:LV})}function BJ(t){return DJ(IV(t))}function W0(t){return arguments.length?tk=BJ(t):tk}const ek=(t,e)=>Pt({},t,e);function PJ(t,e){const n=t?RJ(t):kx(),r=e?BJ(e):W0();return ek(n,r)}function XF(t,e){const n=arguments.length;return n&&n!==2&&j("defaultLocale expects either zero or two arguments."),n?ek(kx(t),W0(e)):ek(kx(),W0())}function Nkt(){return OJ(),LJ(),XF()}const Okt=/^(data:|([A-Za-z]+:)?\/\/)/,Rkt=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,Dkt=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,yL="file://";function Lkt(t,e){return n=>({options:n||{},sanitize:Pkt,load:Bkt,fileAccess:!1,file:zkt(e),http:jkt(t)})}async function Bkt(t,e){const n=await this.sanitize(t,e),r=n.href;return n.localFile?this.file(r):this.http(r,e)}async function Pkt(t,e){e=Pt({},this.options,e);const n=this.fileAccess,r={href:null};let i,s,o;const a=Rkt.test(t.replace(Dkt,""));(t==null||typeof t!="string"||!a)&&j("Sanitize failure, invalid URI: "+J(t));const u=Okt.test(t);return(o=e.baseURL)&&!u&&(!t.startsWith("/")&&!o.endsWith("/")&&(t="/"+t),t=o+t),s=(i=t.startsWith(yL))||e.mode==="file"||e.mode!=="http"&&!u&&n,i?t=t.slice(yL.length):t.startsWith("//")&&(e.defaultProtocol==="file"?(t=t.slice(2),s=!0):t=(e.defaultProtocol||"http")+":"+t),Object.defineProperty(r,"localFile",{value:!!s}),r.href=t,e.target&&(r.target=e.target+""),e.rel&&(r.rel=e.rel+""),e.context==="image"&&e.crossOrigin&&(r.crossOrigin=e.crossOrigin+""),r}function zkt(t){return t?e=>new Promise((n,r)=>{t.readFile(e,(i,s)=>{i?r(i):n(s)})}):Ukt}async function Ukt(){j("No file system access.")}function jkt(t){return t?async function(e,n){const r=Pt({},this.options.http,n),i=n&&n.response,s=await t(e,r);return s.ok?jt(s[i])?s[i]():s.text():j(s.status+""+s.statusText)}:qkt}async function qkt(){j("No HTTP fetch method available.")}const Wkt=t=>t!=null&&t===t,Vkt=t=>t==="true"||t==="false"||t===!0||t===!1,Gkt=t=>!Number.isNaN(Date.parse(t)),zJ=t=>!Number.isNaN(+t)&&!(t instanceof Date),Ykt=t=>zJ(t)&&Number.isInteger(+t),nk={boolean:qF,integer:pr,number:pr,date:WF,string:VF,unknown:Er},yb=[Vkt,Ykt,zJ,Gkt],Hkt=["boolean","integer","number","date"];function UJ(t,e){if(!t||!t.length)return"unknown";const n=t.length,r=yb.length,i=yb.map((s,o)=>o+1);for(let s=0,o=0,a,u;s<n;++s)for(u=e?t[s][e]:t[s],a=0;a<r;++a)if(i[a]&&Wkt(u)&&!yb[a](u)&&(i[a]=0,++o,o===yb.length))return"string";return Hkt[i.reduce((s,o)=>s===0?o:s,0)-1]}function jJ(t,e){return e.reduce((n,r)=>(n[r]=UJ(t,r),n),{})}function bL(t){const e=function(n,r){const i={delimiter:t};return KF(n,r?Pt(r,i):i)};return e.responseType="text",e}function KF(t,e){return e.header&&(t=e.header.map(J).join(e.delimiter)+`
`+t),S1t(e.delimiter).parse(t+"")}KF.responseType="text";function Xkt(t){return typeof Buffer=="function"&&jt(Buffer.isBuffer)?Buffer.isBuffer(t):!1}function QF(t,e){const n=e&&e.property?ys(e.property):Er;return st(t)&&!Xkt(t)?Kkt(n(t),e):n(JSON.parse(t))}QF.responseType="json";function Kkt(t,e){return!W(t)&&oJ(t)&&(t=[...t]),e&&e.copy?JSON.parse(JSON.stringify(t)):t}const Qkt={interior:(t,e)=>t!==e,exterior:(t,e)=>t===e};function qJ(t,e){let n,r,i,s;return t=QF(t,e),e&&e.feature?(n=hkt,i=e.feature):e&&e.mesh?(n=gkt,i=e.mesh,s=Qkt[e.filter]):j("Missing TopoJSON feature or mesh parameter."),r=(r=t.objects[i])?n(t,r,s):j("Invalid TopoJSON object: "+i),r&&r.features||[r]}qJ.responseType="json";const hv={dsv:KF,csv:bL(","),tsv:bL("	"),json:QF,topojson:qJ};function JF(t,e){return arguments.length>1?(hv[t]=e,this):ft(hv,t)?hv[t]:null}function WJ(t){const e=JF(t);return e&&e.responseType||"text"}function VJ(t,e,n,r){e=e||{};const i=JF(e.type||"json");return i||j("Unknown data format type: "+e.type),t=i(t,e),e.parse&&Jkt(t,e.parse,n,r),ft(t,"columns")&&delete t.columns,t}function Jkt(t,e,n,r){if(!t.length)return;const i=W0();n=n||i.timeParse,r=r||i.utcParse;let s=t.columns||Object.keys(t[0]),o,a,u,c,l,f;e==="auto"&&(e=jJ(t,s)),s=Object.keys(e);const d=s.map(h=>{const p=e[h];let g,m;if(p&&(p.startsWith("date:")||p.startsWith("utc:")))return g=p.split(/:(.+)?/,2),m=g[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1)),(g[0]==="utc"?r:n)(m);if(!nk[p])throw Error("Illegal format pattern: "+h+":"+p);return nk[p]});for(u=0,l=t.length,f=s.length;u<l;++u)for(o=t[u],c=0;c<f;++c)a=s[c],o[a]=d[c](o[a])}const Y_=Lkt(typeof fetch<"u"&&fetch,null);function H_(t){const e=t||Er,n=[],r={};return n.add=i=>{const s=e(i);return r[s]||(r[s]=1,n.push(i)),n},n.remove=i=>{const s=e(i);if(r[s]){r[s]=0;const o=n.indexOf(i);o>=0&&n.splice(o,1)}return n},n}async function pv(t,e){try{await e(t)}catch(n){t.error(n)}}const GJ=Symbol("vega_id");let Zkt=1;function X_(t){return!!(t&&vt(t))}function vt(t){return t[GJ]}function YJ(t,e){return t[GJ]=e,t}function le(t){const e=t===Object(t)?t:{data:t};return vt(e)?e:YJ(e,Zkt++)}function ZF(t){return K_(t,le({}))}function K_(t,e){for(const n in t)e[n]=t[n];return e}function HJ(t,e){return YJ(e,vt(t))}function ld(t,e){return t?e?(n,r)=>t(n,r)||vt(e(n))-vt(e(r)):(n,r)=>t(n,r)||vt(n)-vt(r):null}function XJ(t){return t&&t.constructor===fd}function fd(){const t=[],e=[],n=[],r=[],i=[];let s=null,o=!1;return{constructor:fd,insert(a){const u=ot(a),c=u.length;for(let l=0;l<c;++l)t.push(u[l]);return this},remove(a){const u=jt(a)?r:e,c=ot(a),l=c.length;for(let f=0;f<l;++f)u.push(c[f]);return this},modify(a,u,c){const l={field:u,value:Ar(c)};return jt(a)?(l.filter=a,i.push(l)):(l.tuple=a,n.push(l)),this},encode(a,u){return jt(a)?i.push({filter:a,field:u}):n.push({tuple:a,field:u}),this},clean(a){return s=a,this},reflow(){return o=!0,this},pulse(a,u){const c={},l={};let f,d,h,p,g,m;for(f=0,d=u.length;f<d;++f)c[vt(u[f])]=1;for(f=0,d=e.length;f<d;++f)g=e[f],c[vt(g)]=-1;for(f=0,d=r.length;f<d;++f)p=r[f],u.forEach(b=>{p(b)&&(c[vt(b)]=-1)});for(f=0,d=t.length;f<d;++f)g=t[f],m=vt(g),c[m]?c[m]=1:a.add.push(le(t[f]));for(f=0,d=u.length;f<d;++f)g=u[f],c[vt(g)]<0&&a.rem.push(g);function y(b,w,v){v?b[w]=v(b):a.encode=w,o||(l[vt(b)]=b)}for(f=0,d=n.length;f<d;++f)h=n[f],g=h.tuple,p=h.field,m=c[vt(g)],m>0&&(y(g,p,h.value),a.modifies(p));for(f=0,d=i.length;f<d;++f)h=i[f],p=h.filter,u.forEach(b=>{p(b)&&c[vt(b)]>0&&y(b,h.field,h.value)}),a.modifies(h.field);if(o)a.mod=e.length||r.length?u.filter(b=>c[vt(b)]>0):u.slice();else for(m in l)a.mod.push(l[m]);return(s||s==null&&(e.length||r.length))&&a.clean(!0),a}}}const gv="_:mod:_";function Q_(){Object.defineProperty(this,gv,{writable:!0,value:{}})}Q_.prototype={set(t,e,n,r){const i=this,s=i[t],o=i[gv];return e!=null&&e>=0?(s[e]!==n||r)&&(s[e]=n,o[e+":"+t]=-1,o[t]=-1):(s!==n||r)&&(i[t]=n,o[t]=W(n)?1+n.length:-1),i},modified(t,e){const n=this[gv];if(arguments.length){if(W(t)){for(let r=0;r<t.length;++r)if(n[t[r]])return!0;return!1}}else{for(const r in n)if(n[r])return!0;return!1}return e!=null&&e>=0?e+1<n[t]||!!n[e+":"+t]:!!n[t]},clear(){return this[gv]={},this}};let tMt=0;const eMt="pulse",nMt=new Q_,rMt=1,iMt=2;function $e(t,e,n,r){this.id=++tMt,this.value=t,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,e&&(this._update=e),n&&this.parameters(n,r)}function vL(t){return function(e){const n=this.flags;return arguments.length===0?!!(n&t):(this.flags=e?n|t:n&~t,this)}}$e.prototype={targets(){return this._targets||(this._targets=H_(Vy))},set(t){return this.value!==t?(this.value=t,1):0},skip:vL(rMt),modified:vL(iMt),parameters(t,e,n){e=e!==!1;const r=this._argval=this._argval||new Q_,i=this._argops=this._argops||[],s=[];let o,a,u,c;const l=(f,d,h)=>{h instanceof $e?(h!==this&&(e&&h.targets().add(this),s.push(h)),i.push({op:h,name:f,index:d})):r.set(f,d,h)};for(o in t)if(a=t[o],o===eMt)ot(a).forEach(f=>{f instanceof $e?f!==this&&(f.targets().add(this),s.push(f)):j("Pulse parameters must be operator instances.")}),this.source=a;else if(W(a))for(r.set(o,-1,Array(u=a.length)),c=0;c<u;++c)l(o,c,a[c]);else l(o,-1,a);return this.marshall().clear(),n&&(i.initonly=!0),s},marshall(t){const e=this._argval||nMt,n=this._argops;let r,i,s,o;if(n){const a=n.length;for(i=0;i<a;++i)r=n[i],s=r.op,o=s.modified()&&s.stamp===t,e.set(r.name,r.index,s.value,o);if(n.initonly){for(i=0;i<a;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return e},detach(){const t=this._argops;let e,n,r,i;if(t)for(e=0,n=t.length;e<n;++e)r=t[e],i=r.op,i._targets&&i._targets.remove(this);this.pulse=null,this.source=null},evaluate(t){const e=this._update;if(e){const n=this.marshall(t.stamp),r=e.call(this,n,t);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return t.StopPropagation}},run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?(this.skip(!1),e=0):e=this.evaluate(t),this.pulse=e||t}};function sMt(t,e,n,r){let i=1,s;return t instanceof $e?s=t:t&&t.prototype instanceof $e?s=new t:jt(t)?s=new $e(null,t):(i=0,s=new $e(t,e)),this.rank(s),i&&(r=n,n=e),n&&this.connect(s,s.parameters(n,r)),this.touch(s),s}function oMt(t,e){const n=t.rank,r=e.length;for(let i=0;i<r;++i)if(n<e[i].rank){this.rerank(t);return}}let aMt=0;function J_(t,e,n){this.id=++aMt,this.value=null,n&&(this.receive=n),t&&(this._filter=t),e&&(this._apply=e)}function Xu(t,e,n){return new J_(t,e,n)}J_.prototype={_filter:bs,_apply:Er,targets(){return this._targets||(this._targets=H_(Vy))},consume(t){return arguments.length?(this._consume=!!t,this):!!this._consume},receive(t){if(this._filter(t)){const e=this.value=this._apply(t),n=this._targets,r=n?n.length:0;for(let i=0;i<r;++i)n[i].receive(e);this._consume&&(t.preventDefault(),t.stopPropagation())}},filter(t){const e=Xu(t);return this.targets().add(e),e},apply(t){const e=Xu(null,t);return this.targets().add(e),e},merge(){const t=Xu();this.targets().add(t);for(let e=0,n=arguments.length;e<n;++e)arguments[e].targets().add(t);return t},throttle(t){let e=-1;return this.filter(()=>{const n=Date.now();return n-e>t?(e=n,1):0})},debounce(t){const e=Xu();return this.targets().add(Xu(null,null,UF(t,n=>{const r=n.dataflow;e.receive(n),r&&r.run&&r.run()}))),e},between(t,e){let n=!1;return t.targets().add(Xu(null,null,()=>n=!0)),e.targets().add(Xu(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=bs,this._targets=null}};function uMt(t,e,n,r){const i=this,s=Xu(n,r),o=function(c){c.dataflow=i;try{s.receive(c)}catch(l){i.error(l)}finally{i.run()}};let a;typeof t=="string"&&typeof document<"u"?a=document.querySelectorAll(t):a=ot(t);const u=a.length;for(let c=0;c<u;++c)a[c].addEventListener(e,o);return s}function cMt(t,e){const n=this.locale();return VJ(t,e,n.timeParse,n.utcParse)}function lMt(t,e,n){return e=this.parse(e,n),this.pulse(t,this.changeset().insert(e))}async function fMt(t,e){const n=this;let r=0,i;try{i=await n.loader().load(t,{context:"dataflow",response:WJ(e&&e.type)});try{i=n.parse(i,e)}catch(s){r=-2,n.warn("Data ingestion failed",t,s)}}catch(s){r=-1,n.warn("Loading failed",t,s)}return{data:i,status:r}}async function dMt(t,e,n){const r=this,i=r._pending||hMt(r);i.requests+=1;const s=await r.request(e,n);return r.pulse(t,r.changeset().remove(bs).insert(s.data||[])),i.done(),s}function hMt(t){let e;const n=new Promise(r=>e=r);return n.requests=0,n.done=()=>{--n.requests===0&&(t._pending=null,e(t))},t._pending=n}const pMt={skip:!0};function gMt(t,e,n,r,i){return(t instanceof $e?yMt:mMt)(this,t,e,n,r,i),this}function mMt(t,e,n,r,i,s){const o=Pt({},s,pMt);let a,u;jt(n)||(n=Ar(n)),r===void 0?a=c=>t.touch(n(c)):jt(r)?(u=new $e(null,r,i,!1),a=c=>{u.evaluate(c);const l=n(c),f=u.value;XJ(f)?t.pulse(l,f,s):t.update(l,f,o)}):a=c=>t.update(n(c),r,o),e.apply(a)}function yMt(t,e,n,r,i,s){if(r===void 0)e.targets().add(n);else{const o=s||{},a=new $e(null,bMt(n,r),i,!1);a.modified(o.force),a.rank=e.rank,e.targets().add(a),n&&(a.skip(!0),a.value=n.value,a.targets().add(n),t.connect(n,[a]))}}function bMt(t,e){return e=jt(e)?e:Ar(e),t?function(n,r){const i=e(n,r);return t.skip()||(t.skip(i!==this.value).value=i),i}:e}function vMt(t){t.rank=++this._rank}function wMt(t){const e=[t];let n,r,i;for(;e.length;)if(this.rank(n=e.pop()),r=n._targets)for(i=r.length;--i>=0;)e.push(n=r[i]),n===t&&j("Cycle detected in dataflow graph.")}const Mx={},So=1,rc=2,qa=4,xMt=So|rc,wL=So|qa,zd=So|rc|qa,xL=8,Gg=16,_L=32,SL=64;function Ac(t,e,n){this.dataflow=t,this.stamp=e??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function YA(t,e){const n=[];return nc(t,e,r=>n.push(r)),n}function EL(t,e){const n={};return t.visit(e,r=>{n[vt(r)]=1}),r=>n[vt(r)]?null:r}function bb(t,e){return t?(n,r)=>t(n,r)&&e(n,r):e}Ac.prototype={StopPropagation:Mx,ADD:So,REM:rc,MOD:qa,ADD_REM:xMt,ADD_MOD:wL,ALL:zd,REFLOW:xL,SOURCE:Gg,NO_SOURCE:_L,NO_FIELDS:SL,fork(t){return new Ac(this.dataflow).init(this,t)},clone(){const t=this.fork(zd);return t.add=t.add.slice(),t.rem=t.rem.slice(),t.mod=t.mod.slice(),t.source&&(t.source=t.source.slice()),t.materialize(zd|Gg)},addAll(){let t=this;return!t.source||t.add===t.rem||!t.rem.length&&t.source.length===t.add.length||(t=new Ac(this.dataflow).init(this),t.add=t.source,t.rem=[]),t},init(t,e){const n=this;return n.stamp=t.stamp,n.encode=t.encode,t.fields&&!(e&SL)&&(n.fields=t.fields),e&So?(n.addF=t.addF,n.add=t.add):(n.addF=null,n.add=[]),e&rc?(n.remF=t.remF,n.rem=t.rem):(n.remF=null,n.rem=[]),e&qa?(n.modF=t.modF,n.mod=t.mod):(n.modF=null,n.mod=[]),e&_L?(n.srcF=null,n.source=null):(n.srcF=t.srcF,n.source=t.source,t.cleans&&(n.cleans=t.cleans)),n},runAfter(t){this.dataflow.runAfter(t)},changed(t){const e=t||zd;return e&So&&this.add.length||e&rc&&this.rem.length||e&qa&&this.mod.length},reflow(t){if(t)return this.fork(zd).reflow();const e=this.add.length,n=this.source&&this.source.length;return n&&n!==e&&(this.mod=this.source,e&&this.filter(qa,EL(this,So))),this},clean(t){return arguments.length?(this.cleans=!!t,this):this.cleans},modifies(t){const e=this.fields||(this.fields={});return W(t)?t.forEach(n=>e[n]=!0):e[t]=!0,this},modified(t,e){const n=this.fields;return(e||this.mod.length)&&n?arguments.length?W(t)?t.some(r=>n[r]):n[t]:!!n:!1},filter(t,e){const n=this;return t&So&&(n.addF=bb(n.addF,e)),t&rc&&(n.remF=bb(n.remF,e)),t&qa&&(n.modF=bb(n.modF,e)),t&Gg&&(n.srcF=bb(n.srcF,e)),n},materialize(t){t=t||zd;const e=this;return t&So&&e.addF&&(e.add=YA(e.add,e.addF),e.addF=null),t&rc&&e.remF&&(e.rem=YA(e.rem,e.remF),e.remF=null),t&qa&&e.modF&&(e.mod=YA(e.mod,e.modF),e.modF=null),t&Gg&&e.srcF&&(e.source=e.source.filter(e.srcF),e.srcF=null),e},visit(t,e){const n=this,r=e;if(t&Gg)return nc(n.source,n.srcF,r),n;t&So&&nc(n.add,n.addF,r),t&rc&&nc(n.rem,n.remF,r),t&qa&&nc(n.mod,n.modF,r);const i=n.source;if(t&xL&&i){const s=n.add.length+n.mod.length;s===i.length||(s?nc(i,EL(n,wL),r):nc(i,n.srcF,r))}return n}};function t6(t,e,n,r){const i=this;let s=0;this.dataflow=t,this.stamp=e,this.fields=null,this.encode=r||null,this.pulses=n;for(const o of n)if(o.stamp===e){if(o.fields){const a=i.fields||(i.fields={});for(const u in o.fields)a[u]=1}o.changed(i.ADD)&&(s|=i.ADD),o.changed(i.REM)&&(s|=i.REM),o.changed(i.MOD)&&(s|=i.MOD)}this.changes=s}tt(t6,Ac,{fork(t){const e=new Ac(this.dataflow).init(this,t&this.NO_FIELDS);return t!==void 0&&(t&e.ADD&&this.visit(e.ADD,n=>e.add.push(n)),t&e.REM&&this.visit(e.REM,n=>e.rem.push(n)),t&e.MOD&&this.visit(e.MOD,n=>e.mod.push(n))),e},changed(t){return this.changes&t},modified(t){const e=this,n=e.fields;return n&&e.changes&e.MOD?W(t)?t.some(r=>n[r]):n[t]:0},filter(){j("MultiPulse does not support filtering.")},materialize(){j("MultiPulse does not support materialization.")},visit(t,e){const n=this,r=n.pulses,i=r.length;let s=0;if(t&n.SOURCE)for(;s<i;++s)r[s].visit(t,e);else for(;s<i;++s)r[s].stamp===n.stamp&&r[s].visit(t,e);return n}});async function _Mt(t,e,n){const r=this,i=[];if(r._pulse)return KJ(r);if(r._pending&&await r._pending,e&&await pv(r,e),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const s=++r._clock;r._pulse=new Ac(r,s,t),r._touched.forEach(l=>r._enqueue(l,!0)),r._touched=H_(Vy);let o=0,a,u,c;try{for(;r._heap.size()>0;){if(a=r._heap.pop(),a.rank!==a.qrank){r._enqueue(a,!0);continue}u=a.run(r._getPulse(a,t)),u.then?u=await u:u.async&&(i.push(u.async),u=Mx),u!==Mx&&a._targets&&a._targets.forEach(l=>r._enqueue(l)),++o}}catch(l){r._heap.clear(),c=l}if(r._input={},r._pulse=null,r.debug(`Pulse ${s}: ${o} operators`),c&&(r._postrun=[],r.error(c)),r._postrun.length){const l=r._postrun.sort((f,d)=>d.priority-f.priority);r._postrun=[];for(let f=0;f<l.length;++f)await pv(r,l[f].callback)}return n&&await pv(r,n),i.length&&Promise.all(i).then(l=>r.runAsync(null,()=>{l.forEach(f=>{try{f(r)}catch(d){r.error(d)}})})),r}async function SMt(t,e,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(t,e,n)).then(r,r),this._running}function EMt(t,e,n){return this._pulse?KJ(this):(this.evaluate(t,e,n),this)}function AMt(t,e,n){if(this._pulse||e)this._postrun.push({priority:n||0,callback:t});else try{t(this)}catch(r){this.error(r)}}function KJ(t){return t.error("Dataflow already running. Use runAsync() to chain invocations."),t}function $Mt(t,e){const n=t.stamp<this._clock;n&&(t.stamp=this._clock),(n||e)&&(t.qrank=t.rank,this._heap.push(t))}function TMt(t,e){const n=t.source,r=this._clock;return n&&W(n)?new t6(this,r,n.map(i=>i.pulse),e):this._input[t.id]||kMt(this._pulse,n&&n.pulse)}function kMt(t,e){return e&&e.stamp===t.stamp?e:(t=t.fork(),e&&e!==Mx&&(t.source=e.source),t)}const e6={skip:!1,force:!1};function MMt(t,e){const n=e||e6;return this._pulse?this._enqueue(t):this._touched.add(t),n.skip&&t.skip(!0),this}function CMt(t,e,n){const r=n||e6;return(t.set(e)||r.force)&&this.touch(t,r),this}function IMt(t,e,n){this.touch(t,n||e6);const r=new Ac(this,this._clock+(this._pulse?0:1)),i=t.pulse&&t.pulse.source||[];return r.target=t,this._input[t.id]=e.pulse(r,i),this}function FMt(t){let e=[];return{clear:()=>e=[],size:()=>e.length,peek:()=>e[0],push:n=>(e.push(n),QJ(e,0,e.length-1,t)),pop:()=>{const n=e.pop();let r;return e.length?(r=e[0],e[0]=n,NMt(e,0,t)):r=n,r}}}function QJ(t,e,n,r){let i,s;const o=t[n];for(;n>e;){if(s=n-1>>1,i=t[s],r(o,i)<0){t[n]=i,n=s;continue}break}return t[n]=o}function NMt(t,e,n){const r=e,i=t.length,s=t[e];let o=(e<<1)+1,a;for(;o<i;)a=o+1,a<i&&n(t[o],t[a])>=0&&(o=a),t[e]=t[o],e=o,o=(e<<1)+1;return t[e]=s,QJ(t,r,e,n)}function Rh(){this.logger(DF()),this.logLevel(OF),this._clock=0,this._rank=0,this._locale=XF();try{this._loader=Y_()}catch{}this._touched=H_(Vy),this._input={},this._pulse=null,this._heap=FMt((t,e)=>t.qrank-e.qrank),this._postrun=[]}function Yg(t){return function(){return this._log[t].apply(this,arguments)}}Rh.prototype={stamp(){return this._clock},loader(t){return arguments.length?(this._loader=t,this):this._loader},locale(t){return arguments.length?(this._locale=t,this):this._locale},logger(t){return arguments.length?(this._log=t,this):this._log},error:Yg("error"),warn:Yg("warn"),info:Yg("info"),debug:Yg("debug"),logLevel:Yg("level"),cleanThreshold:1e4,add:sMt,connect:oMt,rank:vMt,rerank:wMt,pulse:IMt,touch:MMt,update:CMt,changeset:fd,ingest:lMt,parse:cMt,preload:dMt,request:fMt,events:uMt,on:gMt,evaluate:_Mt,run:EMt,runAsync:SMt,runAfter:AMt,_enqueue:$Mt,_getPulse:TMt};function z(t,e){$e.call(this,t,null,e)}tt(z,$e,{run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?this.skip(!1):e=this.evaluate(t),e=e||t,e.then?e=e.then(n=>this.pulse=n):e!==t.StopPropagation&&(this.pulse=e),e},evaluate(t){const e=this.marshall(t.stamp),n=this.transform(e,t);return e.clear(),n},transform(){}});const gp={};function JJ(t){const e=ZJ(t);return e&&e.Definition||null}function ZJ(t){return t=t&&t.toLowerCase(),ft(gp,t)?gp[t]:null}function*tZ(t,e){if(e==null)for(let n of t)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of t)r=e(r,++n,t),r!=null&&r!==""&&(r=+r)>=r&&(yield r)}}function n6(t,e,n){const r=Float64Array.from(tZ(t,n));return r.sort(Fe),e.map(i=>eq(r,i))}function r6(t,e){return n6(t,[.25,.5,.75],e)}function i6(t,e){const n=t.length,r=Wp(t,e),i=r6(t,e),s=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,s)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function eZ(t){const e=t.maxbins||20,n=t.base||10,r=Math.log(n),i=t.divide||[5,2];let s=t.extent[0],o=t.extent[1],a,u,c,l,f,d;const h=t.span||o-s||Math.abs(s)||1;if(t.step)a=t.step;else if(t.steps){for(l=h/e,f=0,d=t.steps.length;f<d&&t.steps[f]<l;++f);a=t.steps[Math.max(0,f-1)]}else{for(u=Math.ceil(Math.log(e)/r),c=t.minstep||0,a=Math.max(c,Math.pow(n,Math.round(Math.log(h)/r)-u));Math.ceil(h/a)>e;)a*=n;for(f=0,d=i.length;f<d;++f)l=a/i[f],l>=c&&h/l<=e&&(a=l)}l=Math.log(a);const p=l>=0?0:~~(-l/r)+1,g=Math.pow(n,-p-1);return(t.nice||t.nice===void 0)&&(l=Math.floor(s/a+g)*a,s=s<l?l-a:l,o=Math.ceil(o/a)*a),{start:s,stop:o===s?s+a:o,step:a}}var ws=Math.random;function OMt(t){ws=t}function nZ(t,e,n,r){if(!t.length)return[void 0,void 0];const i=Float64Array.from(tZ(t,r)),s=i.length,o=e;let a,u,c,l;for(c=0,l=Array(o);c<o;++c){for(a=0,u=0;u<s;++u)a+=i[~~(ws()*s)];l[c]=a/s}return l.sort(Fe),[Xo(l,n/2),Xo(l,1-n/2)]}function rZ(t,e,n,r){r=r||(d=>d);const i=t.length,s=new Float64Array(i);let o=0,a=1,u=r(t[0]),c=u,l=u+e,f;for(;a<i;++a){if(f=r(t[a]),f>=l){for(c=(u+c)/2;o<a;++o)s[o]=c;l=f+e,u=f}c=f}for(c=(u+c)/2;o<a;++o)s[o]=c;return n?RMt(s,e+e/4):s}function RMt(t,e){const n=t.length;let r=0,i=1,s,o;for(;t[r]===t[i];)++i;for(;i<n;){for(s=i+1;t[i]===t[s];)++s;if(t[i]-t[i-1]<e){for(o=i+(r+s-i-i>>1);o<i;)t[o++]=t[i];for(;o>i;)t[o--]=t[r]}r=i,i=s}return t}function DMt(t){return function(){return t=(1103515245*t+12345)%2147483647,t/2147483647}}function LMt(t,e){e==null&&(e=t,t=0);let n,r,i;const s={min(o){return arguments.length?(n=o||0,i=r-n,s):n},max(o){return arguments.length?(r=o||0,i=r-n,s):r},sample(){return n+Math.floor(i*ws())},pdf(o){return o===Math.floor(o)&&o>=n&&o<r?1/i:0},cdf(o){const a=Math.floor(o);return a<n?0:a>=r?1:(a-n+1)/i},icdf(o){return o>=0&&o<=1?n-1+Math.floor(o*i):NaN}};return s.min(t).max(e)}const iZ=Math.sqrt(2*Math.PI),BMt=Math.SQRT2;let Hg=NaN;function Z_(t,e){t=t||0,e=e??1;let n=0,r=0,i,s;if(Hg===Hg)n=Hg,Hg=NaN;else{do n=ws()*2-1,r=ws()*2-1,i=n*n+r*r;while(i===0||i>1);s=Math.sqrt(-2*Math.log(i)/i),n*=s,Hg=r*s}return t+n*e}function s6(t,e,n){n=n??1;const r=(t-(e||0))/n;return Math.exp(-.5*r*r)/(n*iZ)}function tS(t,e,n){e=e||0,n=n??1;const r=(t-e)/n,i=Math.abs(r);let s;if(i>37)s=0;else{const o=Math.exp(-i*i/2);let a;i<7.07106781186547?(a=.0352624965998911*i+.700383064443688,a=a*i+6.37396220353165,a=a*i+33.912866078383,a=a*i+112.079291497871,a=a*i+221.213596169931,a=a*i+220.206867912376,s=o*a,a=.0883883476483184*i+1.75566716318264,a=a*i+16.064177579207,a=a*i+86.7807322029461,a=a*i+296.564248779674,a=a*i+637.333633378831,a=a*i+793.826512519948,a=a*i+440.413735824752,s=s/a):(a=i+.65,a=i+4/a,a=i+3/a,a=i+2/a,a=i+1/a,s=o/a/2.506628274631)}return r>0?1-s:s}function eS(t,e,n){return t<0||t>1?NaN:(e||0)+(n??1)*BMt*PMt(2*t-1)}function PMt(t){let e=-Math.log((1-t)*(1+t)),n;return e<6.25?(e-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*e,n=128584807152564e-32+n*e,n=11157877678025181e-33+n*e,n=-1333171662854621e-31+n*e,n=20972767875968562e-33+n*e,n=6637638134358324e-30+n*e,n=-4054566272975207e-29+n*e,n=-8151934197605472e-29+n*e,n=26335093153082323e-28+n*e,n=-12975133253453532e-27+n*e,n=-5415412054294628e-26+n*e,n=10512122733215323e-25+n*e,n=-4112633980346984e-24+n*e,n=-29070369957882005e-24+n*e,n=42347877827932404e-23+n*e,n=-13654692000834679e-22+n*e,n=-13882523362786469e-21+n*e,n=.00018673420803405714+n*e,n=-.000740702534166267+n*e,n=-.006033670871430149+n*e,n=.24015818242558962+n*e,n=1.6536545626831027+n*e):e<16?(e=Math.sqrt(e)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*e,n=-27517406297064545e-23+n*e,n=18239629214389228e-24+n*e,n=15027403968909828e-22+n*e,n=-4013867526981546e-21+n*e,n=29234449089955446e-22+n*e,n=12475304481671779e-21+n*e,n=-47318229009055734e-21+n*e,n=6828485145957318e-20+n*e,n=24031110387097894e-21+n*e,n=-.0003550375203628475+n*e,n=.0009532893797373805+n*e,n=-.0016882755560235047+n*e,n=.002491442096107851+n*e,n=-.003751208507569241+n*e,n=.005370914553590064+n*e,n=1.0052589676941592+n*e,n=3.0838856104922208+n*e):Number.isFinite(e)?(e=Math.sqrt(e)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*e,n=15076572693500548e-25+n*e,n=-3789465440126737e-24+n*e,n=761570120807834e-23+n*e,n=-1496002662714924e-23+n*e,n=2914795345090108e-23+n*e,n=-6771199775845234e-23+n*e,n=22900482228026655e-23+n*e,n=-99298272942317e-20+n*e,n=4526062597223154e-21+n*e,n=-1968177810553167e-20+n*e,n=7599527703001776e-20+n*e,n=-.00021503011930044477+n*e,n=-.00013871931833623122+n*e,n=1.0103004648645344+n*e,n=4.849906401408584+n*e):n=1/0,n*t}function o6(t,e){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s??1,i):r},sample:()=>Z_(n,r),pdf:s=>s6(s,n,r),cdf:s=>tS(s,n,r),icdf:s=>eS(s,n,r)};return i.mean(t).stdev(e)}function a6(t,e){const n=o6();let r=0;const i={data(s){return arguments.length?(t=s,r=s?s.length:0,i.bandwidth(e)):t},bandwidth(s){return arguments.length?(e=s,!e&&t&&(e=i6(t)),i):e},sample(){return t[~~(ws()*r)]+e*n.sample()},pdf(s){let o=0,a=0;for(;a<r;++a)o+=n.pdf((s-t[a])/e);return o/e/r},cdf(s){let o=0,a=0;for(;a<r;++a)o+=n.cdf((s-t[a])/e);return o/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(t)}function u6(t,e){return t=t||0,e=e??1,Math.exp(t+Z_()*e)}function c6(t,e,n){if(t<=0)return 0;e=e||0,n=n??1;const r=(Math.log(t)-e)/n;return Math.exp(-.5*r*r)/(n*iZ*t)}function l6(t,e,n){return tS(Math.log(t),e,n)}function f6(t,e,n){return Math.exp(eS(t,e,n))}function sZ(t,e){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s??1,i):r},sample:()=>u6(n,r),pdf:s=>c6(s,n,r),cdf:s=>l6(s,n,r),icdf:s=>f6(s,n,r)};return i.mean(t).stdev(e)}function oZ(t,e){let n=0,r;function i(o){const a=[];let u=0,c;for(c=0;c<n;++c)u+=a[c]=o[c]==null?1:+o[c];for(c=0;c<n;++c)a[c]/=u;return a}const s={weights(o){return arguments.length?(r=i(e=o||[]),s):e},distributions(o){return arguments.length?(o?(n=o.length,t=o):(n=0,t=[]),s.weights(e)):t},sample(){const o=ws();let a=t[n-1],u=r[0],c=0;for(;c<n-1;u+=r[++c])if(o<u){a=t[c];break}return a.sample()},pdf(o){let a=0,u=0;for(;u<n;++u)a+=r[u]*t[u].pdf(o);return a},cdf(o){let a=0,u=0;for(;u<n;++u)a+=r[u]*t[u].cdf(o);return a},icdf(){throw Error("Mixture icdf not supported.")}};return s.distributions(t).weights(e)}function d6(t,e){return e==null&&(e=t??1,t=0),t+(e-t)*ws()}function h6(t,e,n){return n==null&&(n=e??1,e=0),t>=e&&t<=n?1/(n-e):0}function p6(t,e,n){return n==null&&(n=e??1,e=0),t<e?0:t>n?1:(t-e)/(n-e)}function g6(t,e,n){return n==null&&(n=e??1,e=0),t>=0&&t<=1?e+t*(n-e):NaN}function aZ(t,e){let n,r;const i={min(s){return arguments.length?(n=s||0,i):n},max(s){return arguments.length?(r=s??1,i):r},sample:()=>d6(n,r),pdf:s=>h6(s,n,r),cdf:s=>p6(s,n,r),icdf:s=>g6(s,n,r)};return e==null&&(e=t??1,t=0),i.min(t).max(e)}function m6(t,e,n){let r=0,i=0;for(const s of t){const o=n(s);e(s)==null||o==null||isNaN(o)||(r+=(o-r)/++i)}return{coef:[r],predict:()=>r,rSquared:0}}function Hy(t,e,n,r){const i=r-t*t,s=Math.abs(i)<1e-24?0:(n-t*e)/i;return[e-s*t,s]}function nS(t,e,n,r){t=t.filter(h=>{let p=e(h),g=n(h);return p!=null&&(p=+p)>=p&&g!=null&&(g=+g)>=g}),r&&t.sort((h,p)=>e(h)-e(p));const i=t.length,s=new Float64Array(i),o=new Float64Array(i);let a=0,u=0,c=0,l,f,d;for(d of t)s[a]=l=+e(d),o[a]=f=+n(d),++a,u+=(l-u)/a,c+=(f-c)/a;for(a=0;a<i;++a)s[a]-=u,o[a]-=c;return[s,o,u,c]}function Xy(t,e,n,r){let i=-1,s,o;for(const a of t)s=e(a),o=n(a),s!=null&&(s=+s)>=s&&o!=null&&(o=+o)>=o&&r(s,o,++i)}function mg(t,e,n,r,i){let s=0,o=0;return Xy(t,e,n,(a,u)=>{const c=u-i(a),l=u-r;s+=c*c,o+=l*l}),1-s/o}function y6(t,e,n){let r=0,i=0,s=0,o=0,a=0;Xy(t,e,n,(l,f)=>{++a,r+=(l-r)/a,i+=(f-i)/a,s+=(l*f-s)/a,o+=(l*l-o)/a});const u=Hy(r,i,s,o),c=l=>u[0]+u[1]*l;return{coef:u,predict:c,rSquared:mg(t,e,n,i,c)}}function uZ(t,e,n){let r=0,i=0,s=0,o=0,a=0;Xy(t,e,n,(l,f)=>{++a,l=Math.log(l),r+=(l-r)/a,i+=(f-i)/a,s+=(l*f-s)/a,o+=(l*l-o)/a});const u=Hy(r,i,s,o),c=l=>u[0]+u[1]*Math.log(l);return{coef:u,predict:c,rSquared:mg(t,e,n,i,c)}}function cZ(t,e,n){const[r,i,s,o]=nS(t,e,n);let a=0,u=0,c=0,l=0,f=0,d,h,p;Xy(t,e,n,(b,w)=>{d=r[f++],h=Math.log(w),p=d*w,a+=(w*h-a)/f,u+=(p-u)/f,c+=(p*h-c)/f,l+=(d*p-l)/f});const[g,m]=Hy(u/o,a/o,c/o,l/o),y=b=>Math.exp(g+m*(b-s));return{coef:[Math.exp(g-m*s),m],predict:y,rSquared:mg(t,e,n,o,y)}}function lZ(t,e,n){let r=0,i=0,s=0,o=0,a=0,u=0;Xy(t,e,n,(f,d)=>{const h=Math.log(f),p=Math.log(d);++u,r+=(h-r)/u,i+=(p-i)/u,s+=(h*p-s)/u,o+=(h*h-o)/u,a+=(d-a)/u});const c=Hy(r,i,s,o),l=f=>c[0]*Math.pow(f,c[1]);return c[0]=Math.exp(c[0]),{coef:c,predict:l,rSquared:mg(t,e,n,a,l)}}function b6(t,e,n){const[r,i,s,o]=nS(t,e,n),a=r.length;let u=0,c=0,l=0,f=0,d=0,h,p,g,m;for(h=0;h<a;)p=r[h],g=i[h++],m=p*p,u+=(m-u)/h,c+=(m*p-c)/h,l+=(m*m-l)/h,f+=(p*g-f)/h,d+=(m*g-d)/h;const y=l-u*u,b=u*y-c*c,w=(d*u-f*c)/b,v=(f*y-d*c)/b,x=-w*u,S=_=>(_=_-s,w*_*_+v*_+x+o);return{coef:[x-v*s+w*s*s+o,v-2*w*s,w],predict:S,rSquared:mg(t,e,n,o,S)}}function fZ(t,e,n,r){if(r===0)return m6(t,e,n);if(r===1)return y6(t,e,n);if(r===2)return b6(t,e,n);const[i,s,o,a]=nS(t,e,n),u=i.length,c=[],l=[],f=r+1;let d,h,p,g,m;for(d=0;d<f;++d){for(p=0,g=0;p<u;++p)g+=Math.pow(i[p],d)*s[p];for(c.push(g),m=new Float64Array(f),h=0;h<f;++h){for(p=0,g=0;p<u;++p)g+=Math.pow(i[p],d+h);m[h]=g}l.push(m)}l.push(c);const y=UMt(l),b=w=>{w-=o;let v=a+y[0]+y[1]*w+y[2]*w*w;for(d=3;d<f;++d)v+=y[d]*Math.pow(w,d);return v};return{coef:zMt(f,y,-o,a),predict:b,rSquared:mg(t,e,n,a,b)}}function zMt(t,e,n,r){const i=Array(t);let s,o,a,u;for(s=0;s<t;++s)i[s]=0;for(s=t-1;s>=0;--s)for(a=e[s],u=1,i[s]+=a,o=1;o<=s;++o)u*=(s+1-o)/o,i[s-o]+=a*Math.pow(n,o)*u;return i[0]+=r,i}function UMt(t){const e=t.length-1,n=[];let r,i,s,o,a;for(r=0;r<e;++r){for(o=r,i=r+1;i<e;++i)Math.abs(t[r][i])>Math.abs(t[r][o])&&(o=i);for(s=r;s<e+1;++s)a=t[s][r],t[s][r]=t[s][o],t[s][o]=a;for(i=r+1;i<e;++i)for(s=e;s>=r;s--)t[s][i]-=t[s][r]*t[r][i]/t[r][r]}for(i=e-1;i>=0;--i){for(a=0,s=i+1;s<e;++s)a+=t[s][i]*n[s];n[i]=(t[e][i]-a)/t[i][i]}return n}const AL=2,$L=1e-12;function dZ(t,e,n,r){const[i,s,o,a]=nS(t,e,n,!0),u=i.length,c=Math.max(2,~~(r*u)),l=new Float64Array(u),f=new Float64Array(u),d=new Float64Array(u).fill(1);for(let h=-1;++h<=AL;){const p=[0,c-1];for(let m=0;m<u;++m){const y=i[m],b=p[0],w=p[1],v=y-i[b]>i[w]-y?b:w;let x=0,S=0,_=0,E=0,A=0;const $=1/Math.abs(i[v]-y||1);for(let F=b;F<=w;++F){const M=i[F],k=s[F],I=jMt(Math.abs(y-M)*$)*d[F],N=M*I;x+=I,S+=N,_+=k*I,E+=k*N,A+=M*N}const[T,C]=Hy(S/x,_/x,E/x,A/x);l[m]=T+C*y,f[m]=Math.abs(s[m]-l[m]),qMt(i,m+1,p)}if(h===AL)break;const g=Mf(f);if(Math.abs(g)<$L)break;for(let m=0,y,b;m<u;++m)y=f[m]/(6*g),d[m]=y>=1?$L:(b=1-y*y)*b}return WMt(i,l,o,a)}function jMt(t){return(t=1-t*t*t)*t*t}function qMt(t,e,n){const r=t[e];let i=n[0],s=n[1]+1;if(!(s>=t.length))for(;e>i&&t[s]-r<=r-t[i];)n[0]=++i,n[1]=s,++s}function WMt(t,e,n,r){const i=t.length,s=[];let o=0,a=0,u=[],c;for(;o<i;++o)c=t[o]+n,u[0]===c?u[1]+=(e[o]-u[1])/++a:(a=0,u[1]+=r,u=[c,e[o]],s.push(u));return u[1]+=r,s}const VMt=.5*Math.PI/180;function rS(t,e,n,r){n=n||25,r=Math.max(n,r||200);const i=g=>[g,t(g)],s=e[0],o=e[1],a=o-s,u=a/r,c=[i(s)],l=[];if(n===r){for(let g=1;g<r;++g)c.push(i(s+g/n*a));return c.push(i(o)),c}else{l.push(i(o));for(let g=n;--g>0;)l.push(i(s+g/n*a))}let f=c[0],d=l[l.length-1];const h=1/a,p=GMt(f[1],l);for(;d;){const g=i((f[0]+d[0])/2);g[0]-f[0]>=u&&YMt(f,g,d,h,p)>VMt?l.push(g):(f=d,c.push(d),l.pop()),d=l[l.length-1]}return c}function GMt(t,e){let n=t,r=t;const i=e.length;for(let s=0;s<i;++s){const o=e[s][1];o<n&&(n=o),o>r&&(r=o)}return 1/(r-n)}function YMt(t,e,n,r,i){const s=Math.atan2(i*(n[1]-t[1]),r*(n[0]-t[0])),o=Math.atan2(i*(e[1]-t[1]),r*(e[0]-t[0]));return Math.abs(s-o)}function HMt(t){return e=>{const n=t.length;let r=1,i=String(t[0](e));for(;r<n;++r)i+="|"+t[r](e);return i}}function rk(t){return!t||!t.length?function(){return""}:t.length===1?t[0]:HMt(t)}function hZ(t,e,n){return n||t+(e?"_"+e:"")}const HA=()=>{},XMt={init:HA,add:HA,rem:HA,idx:0},V0={values:{init:t=>t.cell.store=!0,value:t=>t.cell.data.values(),idx:-1},count:{value:t=>t.cell.num},__count__:{value:t=>t.missing+t.valid},missing:{value:t=>t.missing},valid:{value:t=>t.valid},sum:{init:t=>t.sum=0,value:t=>t.valid?t.sum:void 0,add:(t,e)=>t.sum+=+e,rem:(t,e)=>t.sum-=e},product:{init:t=>t.product=1,value:t=>t.valid?t.product:void 0,add:(t,e)=>t.product*=e,rem:(t,e)=>t.product/=e},mean:{init:t=>t.mean=0,value:t=>t.valid?t.mean:void 0,add:(t,e)=>(t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid),rem:(t,e)=>(t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean)},average:{value:t=>t.valid?t.mean:void 0,req:["mean"],idx:1},variance:{init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):void 0,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean),req:["mean"],idx:1},variancep:{value:t=>t.valid>1?t.dev/t.valid:void 0,req:["variance"],idx:2},stdev:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):void 0,req:["variance"],idx:2},stderr:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid*(t.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:t=>t.cell.data.distinct(t.get),req:["values"],idx:3},ci0:{value:t=>t.cell.data.ci0(t.get),req:["values"],idx:3},ci1:{value:t=>t.cell.data.ci1(t.get),req:["values"],idx:3},median:{value:t=>t.cell.data.q2(t.get),req:["values"],idx:3},q1:{value:t=>t.cell.data.q1(t.get),req:["values"],idx:3},q3:{value:t=>t.cell.data.q3(t.get),req:["values"],idx:3},min:{init:t=>t.min=void 0,value:t=>t.min=Number.isNaN(t.min)?t.cell.data.min(t.get):t.min,add:(t,e)=>{(e<t.min||t.min===void 0)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)},req:["values"],idx:4},max:{init:t=>t.max=void 0,value:t=>t.max=Number.isNaN(t.max)?t.cell.data.max(t.get):t.max,add:(t,e)=>{(e>t.max||t.max===void 0)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)},req:["values"],idx:4},argmin:{init:t=>t.argmin=void 0,value:t=>t.argmin||t.cell.data.argmin(t.get),add:(t,e,n)=>{e<t.min&&(t.argmin=n)},rem:(t,e)=>{e<=t.min&&(t.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:t=>t.argmax=void 0,value:t=>t.argmax||t.cell.data.argmax(t.get),add:(t,e,n)=>{e>t.max&&(t.argmax=n)},rem:(t,e)=>{e>=t.max&&(t.argmax=void 0)},req:["max","values"],idx:3},exponential:{init:(t,e)=>{t.exp=0,t.exp_r=e},value:t=>t.valid?t.exp*(1-t.exp_r)/(1-t.exp_r**t.valid):void 0,add:(t,e)=>t.exp=t.exp_r*t.exp+e,rem:(t,e)=>t.exp=(t.exp-e/t.exp_r**(t.valid-1))/t.exp_r},exponentialb:{value:t=>t.valid?t.exp*(1-t.exp_r):void 0,req:["exponential"],idx:1}},Ky=Object.keys(V0).filter(t=>t!=="__count__");function KMt(t,e){return(n,r)=>Pt({name:t,aggregate_param:r,out:n||t},XMt,e)}[...Ky,"__count__"].forEach(t=>{V0[t]=KMt(t,V0[t])});function pZ(t,e,n){return V0[t](n,e)}function gZ(t,e){return t.idx-e.idx}function QMt(t){const e={};t.forEach(r=>e[r.name]=r);const n=r=>{r.req&&r.req.forEach(i=>{e[i]||n(e[i]=V0[i]())})};return t.forEach(n),Object.values(e).sort(gZ)}function JMt(){this.valid=0,this.missing=0,this._ops.forEach(t=>t.aggregate_param==null?t.init(this):t.init(this,t.aggregate_param))}function ZMt(t,e){if(t==null||t===""){++this.missing;return}t===t&&(++this.valid,this._ops.forEach(n=>n.add(this,t,e)))}function tCt(t,e){if(t==null||t===""){--this.missing;return}t===t&&(--this.valid,this._ops.forEach(n=>n.rem(this,t,e)))}function eCt(t){return this._out.forEach(e=>t[e.out]=e.value(this)),t}function mZ(t,e){const n=e||Er,r=QMt(t),i=t.slice().sort(gZ);function s(o){this._ops=r,this._out=i,this.cell=o,this.init()}return s.prototype.init=JMt,s.prototype.add=ZMt,s.prototype.rem=tCt,s.prototype.set=eCt,s.prototype.get=n,s.fields=t.map(o=>o.out),s}function v6(t){this._key=t?ys(t):vt,this.reset()}const rr=v6.prototype;rr.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null};rr.add=function(t){this._add.push(t)};rr.rem=function(t){this._rem.push(t)};rr.values=function(){if(this._get=null,this._rem.length===0)return this._add;const t=this._add,e=this._rem,n=this._key,r=t.length,i=e.length,s=Array(r-i),o={};let a,u,c;for(a=0;a<i;++a)o[n(e[a])]=1;for(a=0,u=0;a<r;++a)o[n(c=t[a])]?o[n(c)]=0:s[u++]=c;return this._rem=[],this._add=s};rr.distinct=function(t){const e=this.values(),n={};let r=e.length,i=0,s;for(;--r>=0;)s=t(e[r])+"",ft(n,s)||(n[s]=1,++i);return i};rr.extent=function(t){if(this._get!==t||!this._ext){const e=this.values(),n=iJ(e,t);this._ext=[e[n[0]],e[n[1]]],this._get=t}return this._ext};rr.argmin=function(t){return this.extent(t)[0]||{}};rr.argmax=function(t){return this.extent(t)[1]||{}};rr.min=function(t){const e=this.extent(t)[0];return e!=null?t(e):void 0};rr.max=function(t){const e=this.extent(t)[1];return e!=null?t(e):void 0};rr.quartile=function(t){return(this._get!==t||!this._q)&&(this._q=r6(this.values(),t),this._get=t),this._q};rr.q1=function(t){return this.quartile(t)[0]};rr.q2=function(t){return this.quartile(t)[1]};rr.q3=function(t){return this.quartile(t)[2]};rr.ci=function(t){return(this._get!==t||!this._ci)&&(this._ci=nZ(this.values(),1e3,.05,t),this._get=t),this._ci};rr.ci0=function(t){return this.ci(t)[0]};rr.ci1=function(t){return this.ci(t)[1]};function Xc(t){z.call(this,null,t),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Xc.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Ky},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};tt(Xc,z,{transform(t,e){const n=this,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.modified();return n.stamp=r.stamp,n.value&&(i||e.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(t):Object.create(null),e.visit(e.SOURCE,s=>n.add(s))):(n.value=n.value||n.init(t),e.visit(e.REM,s=>n.rem(s)),e.visit(e.ADD,s=>n.add(s))),r.modifies(n._outputs),n._drop=t.drop!==!1,t.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),e.clean()&&n._drop&&r.clean(!0).runAfter(()=>this.clean()),n.changes(r)},cross(){const t=this,e=t.value,n=t._dnames,r=n.map(()=>({})),i=n.length;function s(a){let u,c,l,f;for(u in a)for(l=a[u].tuple,c=0;c<i;++c)r[c][f=l[n[c]]]=f}s(t._prev),s(e);function o(a,u,c){const l=n[c],f=r[c++];for(const d in f){const h=a?a+"|"+d:d;u[l]=f[d],c<i?o(h,u,c):e[h]||t.cell(h,u)}}o("",{},0)},init(t){const e=this._inputs=[],n=this._outputs=[],r={};function i(b){const w=ot(yr(b)),v=w.length;let x=0,S;for(;x<v;++x)r[S=w[x]]||(r[S]=1,e.push(S))}this._dims=ot(t.groupby),this._dnames=this._dims.map(b=>{const w=rn(b);return i(b),n.push(w),w}),this.cellkey=t.key?t.key:rk(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const s=t.fields||[null],o=t.ops||["count"],a=t.aggregate_params||[null],u=t.as||[],c=s.length,l={};let f,d,h,p,g,m,y;for(c!==o.length&&j("Unmatched number of fields and aggregate ops."),y=0;y<c;++y){if(f=s[y],d=o[y],h=a[y]||null,f==null&&d!=="count"&&j("Null aggregate field specified."),g=rn(f),m=hZ(d,g,u[y]),n.push(m),d==="count"){this._counts.push(m);continue}p=l[g],p||(i(f),p=l[g]=[],p.field=f,this._measures.push(p)),d!=="count"&&(this._countOnly=!1),p.push(pZ(d,h,m))}return this._measures=this._measures.map(b=>mZ(b,b.field)),Object.create(null)},cellkey:rk(),cell(t,e){let n=this.value[t];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[t]=this.newcell(t,e),this._adds[this._alen++]=n),n},newcell(t,e){const n={key:t,num:0,agg:null,tuple:this.newtuple(e,this._prev&&this._prev[t]),stamp:this.stamp,store:!1};if(!this._countOnly){const r=this._measures,i=r.length;n.agg=Array(i);for(let s=0;s<i;++s)n.agg[s]=new r[s](n)}return n.store&&(n.data=new v6),n},newtuple(t,e){const n=this._dnames,r=this._dims,i=r.length,s={};for(let o=0;o<i;++o)s[n[o]]=r[o](t);return e?HJ(e.tuple,s):le(s)},clean(){const t=this.value;for(const e in t)t[e].num===0&&delete t[e]},add(t){const e=this.cellkey(t),n=this.cell(e,t);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(t);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].add(r[i].get(t),t)},rem(t){const e=this.cellkey(t),n=this.cell(e,t);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(t);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].rem(r[i].get(t),t)},celltuple(t){const e=t.tuple,n=this._counts;t.store&&t.data.values();for(let r=0,i=n.length;r<i;++r)e[n[r]]=t.num;if(!this._countOnly){const r=t.agg;for(let i=0,s=r.length;i<s;++i)r[i].set(e)}return e},changes(t){const e=this._adds,n=this._mods,r=this._prev,i=this._drop,s=t.add,o=t.rem,a=t.mod;let u,c,l,f;if(r)for(c in r)u=r[c],(!i||u.num)&&o.push(u.tuple);for(l=0,f=this._alen;l<f;++l)s.push(this.celltuple(e[l])),e[l]=null;for(l=0,f=this._mlen;l<f;++l)u=n[l],(u.num===0&&i?o:a).push(this.celltuple(u)),n[l]=null;return this._alen=this._mlen=0,this._prev=null,t}});const nCt=1e-14;function w6(t){z.call(this,null,t)}w6.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};tt(w6,z,{transform(t,e){const n=t.interval!==!1,r=this._bins(t),i=r.start,s=r.step,o=t.as||["bin0","bin1"],a=o[0],u=o[1];let c;return t.modified()?(e=e.reflow(!0),c=e.SOURCE):c=e.modified(yr(t.field))?e.ADD_MOD:e.ADD,e.visit(c,n?l=>{const f=r(l);l[a]=f,l[u]=f==null?null:i+s*(1+(f-i)/s)}:l=>l[a]=r(l)),e.modifies(n?o:a)},_bins(t){if(this.value&&!t.modified())return this.value;const e=t.field,n=eZ(t),r=n.step;let i=n.start,s=i+Math.ceil((n.stop-i)/r)*r,o,a;(o=t.anchor)!=null&&(a=o-(i+r*Math.floor((o-i)/r)),i+=a,s+=a);const u=function(c){let l=pr(e(c));return l==null?null:l<i?-1/0:l>s?1/0:(l=Math.max(i,Math.min(l,s-r)),i+r*Math.floor(nCt+(l-i)/r))};return u.start=i,u.stop=n.stop,u.step=r,this.value=yi(u,yr(e),t.name||"bin_"+rn(e))}});function yZ(t,e,n){const r=t;let i=e||[],s=n||[],o={},a=0;return{add:u=>s.push(u),remove:u=>o[r(u)]=++a,size:()=>i.length,data:(u,c)=>(a&&(i=i.filter(l=>!o[r(l)]),o={},a=0),c&&u&&i.sort(u),s.length&&(i=u?lJ(u,i,s.sort(u)):i.concat(s),s=[]),i)}}function x6(t){z.call(this,[],t)}x6.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};tt(x6,z,{transform(t,e){const n=e.fork(e.ALL),r=yZ(vt,this.value,n.materialize(n.ADD).add),i=t.sort,s=e.changed()||i&&(t.modified("sort")||e.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(s),this.value=n.source=r.data(ld(i),s),e.source&&e.source.root&&(this.value.root=e.source.root),n}});function bZ(t){$e.call(this,null,rCt,t)}tt(bZ,$e);function rCt(t){return this.value&&!t.modified()?this.value:zF(t.fields,t.orders)}function _6(t){z.call(this,null,t)}_6.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function iCt(t,e,n){switch(e){case"upper":t=t.toUpperCase();break;case"lower":t=t.toLowerCase();break}return t.match(n)}tt(_6,z,{transform(t,e){const n=f=>d=>{for(var h=iCt(a(d),t.case,s)||[],p,g=0,m=h.length;g<m;++g)o.test(p=h[g])||f(p)},r=this._parameterCheck(t,e),i=this._counts,s=this._match,o=this._stop,a=t.field,u=t.as||["text","count"],c=n(f=>i[f]=1+(i[f]||0)),l=n(f=>i[f]-=1);return r?e.visit(e.SOURCE,c):(e.visit(e.ADD,c),e.visit(e.REM,l)),this._finish(e,u)},_parameterCheck(t,e){let n=!1;return(t.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(t.stopwords||"")+"$","i"),n=!0),(t.modified("pattern")||!this._match)&&(this._match=new RegExp(t.pattern||"[\\w']+","g"),n=!0),(t.modified("field")||e.modified(t.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(t,e){const n=this._counts,r=this._tuples||(this._tuples={}),i=e[0],s=e[1],o=t.fork(t.NO_SOURCE|t.NO_FIELDS);let a,u,c;for(a in n)u=r[a],c=n[a]||0,!u&&c?(r[a]=u=le({}),u[i]=a,u[s]=c,o.add.push(u)):c===0?(u&&o.rem.push(u),n[a]=null,r[a]=null):u[s]!==c&&(u[s]=c,o.mod.push(u));return o.modifies(e)}});function S6(t){z.call(this,null,t)}S6.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};tt(S6,z,{transform(t,e){const n=e.fork(e.NO_SOURCE),r=t.as||["a","b"],i=r[0],s=r[1],o=!this.value||e.changed(e.ADD_REM)||t.modified("as")||t.modified("filter");let a=this.value;return o?(a&&(n.rem=a),a=e.materialize(e.SOURCE).source,n.add=this.value=sCt(a,i,s,t.filter||bs)):n.mod=a,n.source=this.value,n.modifies(r)}});function sCt(t,e,n,r){for(var i=[],s={},o=t.length,a=0,u,c;a<o;++a)for(s[e]=c=t[a],u=0;u<o;++u)s[n]=t[u],r(s)&&(i.push(le(s)),s={},s[e]=c);return i}const TL={kde:a6,mixture:oZ,normal:o6,lognormal:sZ,uniform:aZ},oCt="distributions",kL="function",aCt="field";function vZ(t,e){const n=t[kL];ft(TL,n)||j("Unknown distribution function: "+n);const r=TL[n]();for(const i in t)i===aCt?r.data((t.from||e()).map(t[i])):i===oCt?r[i](t[i].map(s=>vZ(s,e))):typeof r[i]===kL&&r[i](t[i]);return r}function E6(t){z.call(this,null,t)}const wZ=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],uCt={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:wZ},{name:"weights",type:"number",array:!0}]};E6.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:wZ.concat(uCt)},{name:"as",type:"string",array:!0,default:["value","density"]}]};tt(E6,z,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const r=vZ(t.distribution,cCt(e)),i=t.steps||t.minsteps||25,s=t.steps||t.maxsteps||200;let o=t.method||"pdf";o!=="pdf"&&o!=="cdf"&&j("Invalid density method: "+o),!t.extent&&!r.data&&j("Missing density extent parameter."),o=r[o];const a=t.as||["value","density"],u=t.extent||ea(r.data()),c=rS(o,u,i,s).map(l=>{const f={};return f[a[0]]=l[0],f[a[1]]=l[1],le(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});function cCt(t){return()=>t.materialize(t.SOURCE).source}function xZ(t,e){return t?t.map((n,r)=>e[r]||rn(n)):null}function A6(t,e,n){const r=[],i=f=>f(u);let s,o,a,u,c,l;if(e==null)r.push(t.map(n));else for(s={},o=0,a=t.length;o<a;++o)u=t[o],c=e.map(i),l=s[c],l||(s[c]=l=[],l.dims=c,r.push(l)),l.push(n(u));return r}const _Z="bin";function $6(t){z.call(this,null,t)}$6.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:_Z}]};const lCt=(t,e)=>Yy(ea(t,e))/30;tt($6,z,{transform(t,e){if(this.value&&!(t.modified()||e.changed()))return e;const n=e.materialize(e.SOURCE).source,r=A6(e.source,t.groupby,Er),i=t.smooth||!1,s=t.field,o=t.step||lCt(n,s),a=ld((p,g)=>s(p)-s(g)),u=t.as||_Z,c=r.length;let l=1/0,f=-1/0,d=0,h;for(;d<c;++d){const p=r[d].sort(a);h=-1;for(const g of rZ(p,o,i,s))g<l&&(l=g),g>f&&(f=g),p[++h][u]=g}return this.value={start:l,stop:f,step:o},e.reflow(!0).modifies(u)}});function SZ(t){$e.call(this,null,fCt,t),this.modified(!0)}tt(SZ,$e);function fCt(t){const e=t.expr;return this.value&&!t.modified("expr")?this.value:yi(n=>e(n,t),yr(e),rn(e))}function T6(t){z.call(this,[void 0,void 0],t)}T6.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};tt(T6,z,{transform(t,e){const n=this.value,r=t.field,i=e.changed()||e.modified(r.fields)||t.modified("field");let s=n[0],o=n[1];if((i||s==null)&&(s=1/0,o=-1/0),e.visit(i?e.SOURCE:e.ADD,a=>{const u=pr(r(a));u!=null&&(u<s&&(s=u),u>o&&(o=u))}),!Number.isFinite(s)||!Number.isFinite(o)){let a=rn(r);a&&(a=` for field "${a}"`),e.dataflow.warn(`Infinite extent${a}: [${s}, ${o}]`),s=o=void 0}this.value=[s,o]}});function k6(t,e){$e.call(this,t),this.parent=e,this.count=0}tt(k6,$e,{connect(t){return this.detachSubflow=t.detachSubflow,this.targets().add(t),t.source=this},add(t){this.count+=1,this.value.add.push(t)},rem(t){this.count-=1,this.value.rem.push(t)},mod(t){this.value.mod.push(t)},init(t){this.value.init(t,t.NO_SOURCE)},evaluate(){return this.value}});function iS(t){z.call(this,{},t),this._keys=hg();const e=this._targets=[];e.active=0,e.forEach=n=>{for(let r=0,i=e.active;r<i;++r)n(e[r],r,e)}}tt(iS,z,{activate(t){this._targets[this._targets.active++]=t},subflow(t,e,n,r){const i=this.value;let s=ft(i,t)&&i[t],o,a;return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(a=r||(a=this._group[t])&&a.tuple,o=n.dataflow,s=new k6(n.fork(n.NO_SOURCE),this),o.add(s).connect(e(o,t,a)),i[t]=s,this.activate(s)),s},clean(){const t=this.value;let e=0;for(const n in t)if(t[n].count===0){const r=t[n].detachSubflow;r&&r(),delete t[n],++e}if(e){const n=this._targets.filter(r=>r&&r.count>0);this.initTargets(n)}},initTargets(t){const e=this._targets,n=e.length,r=t?t.length:0;let i=0;for(;i<r;++i)e[i]=t[i];for(;i<n&&e[i]!=null;++i)e[i]=null;e.active=r},transform(t,e){const n=e.dataflow,r=t.key,i=t.subflow,s=this._keys,o=t.modified("key"),a=u=>this.subflow(u,i,e);return this._group=t.group||{},this.initTargets(),e.visit(e.REM,u=>{const c=vt(u),l=s.get(c);l!==void 0&&(s.delete(c),a(l).rem(u))}),e.visit(e.ADD,u=>{const c=r(u);s.set(vt(u),c),a(c).add(u)}),o||e.modified(r.fields)?e.visit(e.MOD,u=>{const c=vt(u),l=s.get(c),f=r(u);l===f?a(f).mod(u):(s.set(c,f),a(l).rem(u),a(f).add(u))}):e.changed(e.MOD)&&e.visit(e.MOD,u=>{a(s.get(vt(u))).mod(u)}),o&&e.visit(e.REFLOW,u=>{const c=vt(u),l=s.get(c),f=r(u);l!==f&&(s.set(c,f),a(l).rem(u),a(f).add(u))}),e.clean()?n.runAfter(()=>{this.clean(),s.clean()}):s.empty>n.cleanThreshold&&n.runAfter(s.clean),e}});function EZ(t){$e.call(this,null,dCt,t)}tt(EZ,$e);function dCt(t){return this.value&&!t.modified()?this.value:W(t.name)?ot(t.name).map(e=>ys(e)):ys(t.name,t.as)}function M6(t){z.call(this,hg(),t)}M6.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};tt(M6,z,{transform(t,e){const n=e.dataflow,r=this.value,i=e.fork(),s=i.add,o=i.rem,a=i.mod,u=t.expr;let c=!0;e.visit(e.REM,f=>{const d=vt(f);r.has(d)?r.delete(d):o.push(f)}),e.visit(e.ADD,f=>{u(f,t)?s.push(f):r.set(vt(f),1)});function l(f){const d=vt(f),h=u(f,t),p=r.get(d);h&&p?(r.delete(d),s.push(f)):!h&&!p?(r.set(d,1),o.push(f)):c&&h&&!p&&a.push(f)}return e.visit(e.MOD,l),t.modified()&&(c=!1,e.visit(e.REFLOW,l)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}});function C6(t){z.call(this,[],t)}C6.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};tt(C6,z,{transform(t,e){const n=e.fork(e.NO_SOURCE),r=t.fields,i=xZ(r,t.as||[]),s=t.index||null,o=i.length;return n.rem=this.value,e.visit(e.SOURCE,a=>{const u=r.map(p=>p(a)),c=u.reduce((p,g)=>Math.max(p,g.length),0);let l=0,f,d,h;for(;l<c;++l){for(d=ZF(a),f=0;f<o;++f)d[i[f]]=(h=u[f][l])==null?null:h;s&&(d[s]=l),n.add.push(d)}}),this.value=n.source=n.add,s&&n.modifies(s),n.modifies(i)}});function I6(t){z.call(this,[],t)}I6.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};tt(I6,z,{transform(t,e){const n=e.fork(e.NO_SOURCE),r=t.fields,i=r.map(rn),s=t.as||["key","value"],o=s[0],a=s[1],u=r.length;return n.rem=this.value,e.visit(e.SOURCE,c=>{for(let l=0,f;l<u;++l)f=ZF(c),f[o]=i[l],f[a]=r[l](c),n.add.push(f)}),this.value=n.source=n.add,n.modifies(s)}});function F6(t){z.call(this,null,t)}F6.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};tt(F6,z,{transform(t,e){const n=t.expr,r=t.as,i=t.modified(),s=t.initonly?e.ADD:i?e.SOURCE:e.modified(n.fields)||e.modified(r)?e.ADD_MOD:e.ADD;return i&&(e=e.materialize().reflow(!0)),t.initonly||e.modifies(r),e.visit(s,o=>o[r]=n(o,t))}});function AZ(t){z.call(this,[],t)}tt(AZ,z,{transform(t,e){const n=e.fork(e.ALL),r=t.generator;let i=this.value,s=t.size-i.length,o,a,u;if(s>0){for(o=[];--s>=0;)o.push(u=le(r(t))),i.push(u);n.add=n.add.length?n.materialize(n.ADD).add.concat(o):o}else a=i.slice(0,-s),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,i=i.slice(-s);return n.source=this.value=i,n}});const vb={value:"value",median:Mf,mean:wy,min:wn,max:Be},hCt=[];function N6(t){z.call(this,[],t)}N6.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function pCt(t){var e=t.method||vb.value,n;if(vb[e]==null)j("Unrecognized imputation method: "+e);else return e===vb.value?(n=t.value!==void 0?t.value:0,()=>n):vb[e]}function gCt(t){const e=t.field;return n=>n?e(n):NaN}tt(N6,z,{transform(t,e){var n=e.fork(e.ALL),r=pCt(t),i=gCt(t),s=rn(t.field),o=rn(t.key),a=(t.groupby||[]).map(rn),u=mCt(e.source,t.groupby,t.key,t.keyvals),c=[],l=this.value,f=u.domain.length,d,h,p,g,m,y,b,w,v,x;for(m=0,w=u.length;m<w;++m)for(d=u[m],p=d.values,h=NaN,b=0;b<f;++b)if(d[b]==null){for(g=u.domain[b],x={_impute:!0},y=0,v=p.length;y<v;++y)x[a[y]]=p[y];x[o]=g,x[s]=Number.isNaN(h)?h=r(d,i):h,c.push(le(x))}return c.length&&(n.add=n.materialize(n.ADD).add.concat(c)),l.length&&(n.rem=n.materialize(n.REM).rem.concat(l)),this.value=c,n}});function mCt(t,e,n,r){var i=y=>y(m),s=[],o=r?r.slice():[],a={},u={},c,l,f,d,h,p,g,m;for(o.forEach((y,b)=>a[y]=b+1),d=0,g=t.length;d<g;++d)m=t[d],p=n(m),h=a[p]||(a[p]=o.push(p)),l=(c=e?e.map(i):hCt)+"",(f=u[l])||(f=u[l]=[],s.push(f),f.values=c),f[h-1]=m;return s.domain=o,s}function O6(t){Xc.call(this,t)}O6.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Ky},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};tt(O6,Xc,{transform(t,e){const n=this,r=t.modified();let i;return n.value&&(r||e.modified(n._inputs,!0))?(i=n.value=r?n.init(t):{},e.visit(e.SOURCE,s=>n.add(s))):(i=n.value=n.value||this.init(t),e.visit(e.REM,s=>n.rem(s)),e.visit(e.ADD,s=>n.add(s))),n.changes(),e.visit(e.SOURCE,s=>{Pt(s,i[n.cellkey(s)].tuple)}),e.reflow(r).modifies(this._outputs)},changes(){const t=this._adds,e=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(t[n]),t[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(e[n]),e[n]=null;this._alen=this._mlen=0}});function R6(t){z.call(this,null,t)}R6.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};tt(R6,z,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const r=e.materialize(e.SOURCE).source,i=A6(r,t.groupby,t.field),s=(t.groupby||[]).map(rn),o=t.bandwidth,a=t.cumulative?"cdf":"pdf",u=t.as||["value","density"],c=[];let l=t.extent,f=t.steps||t.minsteps||25,d=t.steps||t.maxsteps||200;a!=="pdf"&&a!=="cdf"&&j("Invalid density method: "+a),t.resolve==="shared"&&(l||(l=ea(r,t.field)),f=d=t.steps||d),i.forEach(h=>{const p=a6(h,o)[a],g=t.counts?h.length:1,m=l||ea(h);rS(p,m,f,d).forEach(y=>{const b={};for(let w=0;w<s.length;++w)b[s[w]]=h.dims[w];b[u[0]]=y[0],b[u[1]]=y[1]*g,c.push(le(b))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});function $Z(t){$e.call(this,null,yCt,t)}tt($Z,$e);function yCt(t){return this.value&&!t.modified()?this.value:jF(t.fields,t.flat)}function TZ(t){z.call(this,[],t),this._pending=null}tt(TZ,z,{transform(t,e){const n=e.dataflow;return this._pending?XA(this,e,this._pending):bCt(t)?e.StopPropagation:t.values?XA(this,e,n.parse(t.values,t.format)):t.async?{async:n.request(t.url,t.format).then(i=>(this._pending=ot(i.data),s=>s.touch(this)))}:n.request(t.url,t.format).then(r=>XA(this,e,ot(r.data)))}});function bCt(t){return t.modified("async")&&!(t.modified("values")||t.modified("url")||t.modified("format"))}function XA(t,e,n){n.forEach(le);const r=e.fork(e.NO_FIELDS&e.NO_SOURCE);return r.rem=t.value,t.value=r.source=r.add=n,t._pending=null,r.rem.length&&r.clean(!0),r}function D6(t){z.call(this,{},t)}D6.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};tt(D6,z,{transform(t,e){const n=t.fields,r=t.index,i=t.values,s=t.default==null?null:t.default,o=t.modified(),a=n.length;let u=o?e.SOURCE:e.ADD,c=e,l=t.as,f,d,h;return i?(d=i.length,a>1&&!l&&j('Multi-field lookup requires explicit "as" parameter.'),l&&l.length!==a*d&&j('The "as" parameter has too few output field names.'),l=l||i.map(rn),f=function(p){for(var g=0,m=0,y,b;g<a;++g)if(b=r.get(n[g](p)),b==null)for(y=0;y<d;++y,++m)p[l[m]]=s;else for(y=0;y<d;++y,++m)p[l[m]]=i[y](b)}):(l||j("Missing output field names."),f=function(p){for(var g=0,m;g<a;++g)m=r.get(n[g](p)),p[l[g]]=m??s}),o?c=e.reflow(!0):(h=n.some(p=>e.modified(p.fields)),u|=h?e.MOD:0),e.visit(u,f),c.modifies(l)}});function kZ(t){$e.call(this,null,vCt,t)}tt(kZ,$e);function vCt(t){if(this.value&&!t.modified())return this.value;const e=t.extents,n=e.length;let r=1/0,i=-1/0,s,o;for(s=0;s<n;++s)o=e[s],o[0]<r&&(r=o[0]),o[1]>i&&(i=o[1]);return[r,i]}function MZ(t){$e.call(this,null,wCt,t)}tt(MZ,$e);function wCt(t){return this.value&&!t.modified()?this.value:t.values.reduce((e,n)=>e.concat(n),[])}function CZ(t){z.call(this,null,t)}tt(CZ,z,{transform(t,e){return this.modified(t.modified()),this.value=t,e.fork(e.NO_SOURCE|e.NO_FIELDS)}});function L6(t){Xc.call(this,t)}L6.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Ky,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};tt(L6,Xc,{_transform:Xc.prototype.transform,transform(t,e){return this._transform(xCt(t,e),e)}});function xCt(t,e){const n=t.field,r=t.value,i=(t.op==="count"?"__count__":t.op)||"sum",s=yr(n).concat(yr(r)),o=SCt(n,t.limit||0,e);return e.changed()&&t.set("__pivot__",null,null,!0),{key:t.key,groupby:t.groupby,ops:o.map(()=>i),fields:o.map(a=>_Ct(a,n,r,s)),as:o.map(a=>a+""),modified:t.modified.bind(t)}}function _Ct(t,e,n,r){return yi(i=>e(i)===t?n(i):NaN,r,t+"")}function SCt(t,e,n){const r={},i=[];return n.visit(n.SOURCE,s=>{const o=t(s);r[o]||(r[o]=1,i.push(o))}),i.sort(Gy),e?i.slice(0,e):i}function IZ(t){iS.call(this,t)}tt(IZ,iS,{transform(t,e){const n=t.subflow,r=t.field,i=s=>this.subflow(vt(s),n,e,s);return(t.modified("field")||r&&e.modified(yr(r)))&&j("PreFacet does not support field modification."),this.initTargets(),r?(e.visit(e.MOD,s=>{const o=i(s);r(s).forEach(a=>o.mod(a))}),e.visit(e.ADD,s=>{const o=i(s);r(s).forEach(a=>o.add(le(a)))}),e.visit(e.REM,s=>{const o=i(s);r(s).forEach(a=>o.rem(a))})):(e.visit(e.MOD,s=>i(s).mod(s)),e.visit(e.ADD,s=>i(s).add(s)),e.visit(e.REM,s=>i(s).rem(s))),e.clean()&&e.runAfter(()=>this.clean()),e}});function B6(t){z.call(this,null,t)}B6.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};tt(B6,z,{transform(t,e){const n=e.fork(e.NO_SOURCE),r=t.fields,i=xZ(t.fields,t.as||[]),s=r?(a,u)=>ECt(a,u,r,i):K_;let o;return this.value?o=this.value:(e=e.addAll(),o=this.value={}),e.visit(e.REM,a=>{const u=vt(a);n.rem.push(o[u]),o[u]=null}),e.visit(e.ADD,a=>{const u=s(a,le({}));o[vt(a)]=u,n.add.push(u)}),e.visit(e.MOD,a=>{n.mod.push(s(a,o[vt(a)]))}),n}});function ECt(t,e,n,r){for(let i=0,s=n.length;i<s;++i)e[r[i]]=n[i](t);return e}function FZ(t){z.call(this,null,t)}tt(FZ,z,{transform(t,e){return this.value=t.value,t.modified("value")?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}});function P6(t){z.call(this,null,t)}P6.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};const ACt=1e-14;tt(P6,z,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=t.as||["prob","value"];if(this.value&&!t.modified()&&!e.changed())return n.source=this.value,n;const i=e.materialize(e.SOURCE).source,s=A6(i,t.groupby,t.field),o=(t.groupby||[]).map(rn),a=[],u=t.step||.01,c=t.probs||xn(u/2,1-ACt,u),l=c.length;return s.forEach(f=>{const d=n6(f,c);for(let h=0;h<l;++h){const p={};for(let g=0;g<o.length;++g)p[o[g]]=f.dims[g];p[r[0]]=c[h],p[r[1]]=d[h],a.push(le(p))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=a,n}});function NZ(t){z.call(this,null,t)}tt(NZ,z,{transform(t,e){let n,r;return this.value?r=this.value:(n=e=e.addAll(),r=this.value={}),t.derive&&(n=e.fork(e.NO_SOURCE),e.visit(e.REM,i=>{const s=vt(i);n.rem.push(r[s]),r[s]=null}),e.visit(e.ADD,i=>{const s=ZF(i);r[vt(i)]=s,n.add.push(s)}),e.visit(e.MOD,i=>{const s=r[vt(i)];for(const o in i)s[o]=i[o],n.modifies(o);n.mod.push(s)})),n}});function z6(t){z.call(this,[],t),this.count=0}z6.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};tt(z6,z,{transform(t,e){const n=e.fork(e.NO_SOURCE),r=t.modified("size"),i=t.size,s=this.value.reduce((l,f)=>(l[vt(f)]=1,l),{});let o=this.value,a=this.count,u=0;function c(l){let f,d;o.length<i?o.push(l):(d=~~((a+1)*ws()),d<o.length&&d>=u&&(f=o[d],s[vt(f)]&&n.rem.push(f),o[d]=l)),++a}if(e.rem.length&&(e.visit(e.REM,l=>{const f=vt(l);s[f]&&(s[f]=-1,n.rem.push(l)),--a}),o=o.filter(l=>s[vt(l)]!==-1)),(e.rem.length||r)&&o.length<i&&e.source&&(u=a=o.length,e.visit(e.SOURCE,l=>{s[vt(l)]||c(l)}),u=-1),r&&o.length>i){const l=o.length-i;for(let f=0;f<l;++f)s[vt(o[f])]=-1,n.rem.push(o[f]);o=o.slice(l)}return e.mod.length&&e.visit(e.MOD,l=>{s[vt(l)]&&n.mod.push(l)}),e.add.length&&e.visit(e.ADD,c),(e.add.length||u<0)&&(n.add=o.filter(l=>!s[vt(l)])),this.count=a,this.value=n.source=o,n}});function U6(t){z.call(this,null,t)}U6.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};tt(U6,z,{transform(t,e){if(this.value&&!t.modified())return;const n=e.materialize().fork(e.MOD),r=t.as||"data";return n.rem=this.value?e.rem.concat(this.value):e.rem,this.value=xn(t.start,t.stop,t.step||1).map(i=>{const s={};return s[r]=i,le(s)}),n.add=e.add.concat(this.value),n}});function OZ(t){z.call(this,null,t),this.modified(!0)}tt(OZ,z,{transform(t,e){return this.value=e.source,e.changed()?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}});function j6(t){z.call(this,null,t)}const RZ=["unit0","unit1"];j6.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:GF,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:RZ}]};tt(j6,z,{transform(t,e){const n=t.field,r=t.interval!==!1,i=t.timezone==="utc",s=this._floor(t,e),o=(i?gg:pg)(s.unit).offset,a=t.as||RZ,u=a[0],c=a[1],l=s.step;let f=s.start||1/0,d=s.stop||-1/0,h=e.ADD;return(t.modified()||e.changed(e.REM)||e.modified(yr(n)))&&(e=e.reflow(!0),h=e.SOURCE,f=1/0,d=-1/0),e.visit(h,p=>{const g=n(p);let m,y;g==null?(p[u]=null,r&&(p[c]=null)):(p[u]=m=y=s(g),r&&(p[c]=y=o(m,l)),m<f&&(f=m),y>d&&(d=y))}),s.start=f,s.stop=d,e.modifies(r?a:u)},_floor(t,e){const n=t.timezone==="utc",{units:r,step:i}=t.units?{units:t.units,step:t.step||1}:FJ({extent:t.extent||ea(e.materialize(e.SOURCE).source,t.field),maxbins:t.maxbins}),s=YF(r),o=this.value||{},a=(n?SJ:_J)(s,i);return a.unit=te(s),a.units=s,a.step=i,a.start=o.start,a.stop=o.stop,this.value=a}});function DZ(t){z.call(this,hg(),t)}tt(DZ,z,{transform(t,e){const n=e.dataflow,r=t.field,i=this.value,s=a=>i.set(r(a),a);let o=!0;return t.modified("field")||e.modified(r.fields)?(i.clear(),e.visit(e.SOURCE,s)):e.changed()?(e.visit(e.REM,a=>i.delete(r(a))),e.visit(e.ADD,s)):o=!1,this.modified(o),i.empty>n.cleanThreshold&&n.runAfter(i.clean),e.fork()}});function LZ(t){z.call(this,null,t)}tt(LZ,z,{transform(t,e){(!this.value||t.modified("field")||t.modified("sort")||e.changed()||t.sort&&e.modified(t.sort.fields))&&(this.value=(t.sort?e.source.slice().sort(ld(t.sort)):e.source).map(t.field))}});function $Ct(t,e,n,r){const i=G0[t](e,n);return{init:i.init||uc,update:function(s,o){o[r]=i.next(s)}}}const G0={row_number:function(){return{next:t=>t.index+1}},rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,r=e.data;return n&&e.compare(r[n-1],r[n])?t=n+1:t}}},dense_rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,r=e.data;return n&&e.compare(r[n-1],r[n])?++t:t}}},percent_rank:function(){const t=G0.rank(),e=t.next;return{init:t.init,next:n=>(e(n)-1)/(n.data.length-1)}},cume_dist:function(){let t;return{init:()=>t=0,next:e=>{const n=e.data,r=e.compare;let i=e.index;if(t<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;t=i}return(1+t)/n.length}}},ntile:function(t,e){e=+e,e>0||j("ntile num must be greater than zero.");const n=G0.cume_dist(),r=n.next;return{init:n.init,next:i=>Math.ceil(e*r(i))}},lag:function(t,e){return e=+e||1,{next:n=>{const r=n.index-e;return r>=0?t(n.data[r]):null}}},lead:function(t,e){return e=+e||1,{next:n=>{const r=n.index+e,i=n.data;return r<i.length?t(i[r]):null}}},first_value:function(t){return{next:e=>t(e.data[e.i0])}},last_value:function(t){return{next:e=>t(e.data[e.i1-1])}},nth_value:function(t,e){return e=+e,e>0||j("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(e-1);return r<n.i1?t(n.data[r]):null}}},prev_value:function(t){let e;return{init:()=>e=null,next:n=>{const r=t(n.data[n.index]);return r!=null?e=r:e}}},next_value:function(t){let e,n;return{init:()=>(e=null,n=-1),next:r=>{const i=r.data;return r.index<=n?e:(n=TCt(t,i,r.index))<0?(n=i.length,e=null):e=t(i[n])}}}};function TCt(t,e,n){for(let r=e.length;n<r;++n)if(t(e[n])!=null)return n;return-1}const kCt=Object.keys(G0);function BZ(t){const e=ot(t.ops),n=ot(t.fields),r=ot(t.params),i=ot(t.aggregate_params),s=ot(t.as),o=this.outputs=[],a=this.windows=[],u={},c={},l=[],f=[];let d=!0;function h(p){ot(yr(p)).forEach(g=>u[g]=1)}h(t.sort),e.forEach((p,g)=>{const m=n[g],y=r[g],b=i[g]||null,w=rn(m),v=hZ(p,w,s[g]);if(h(m),o.push(v),ft(G0,p))a.push($Ct(p,m,y,v));else{if(m==null&&p!=="count"&&j("Null aggregate field specified."),p==="count"){l.push(v);return}d=!1;let x=c[w];x||(x=c[w]=[],x.field=m,f.push(x)),x.push(pZ(p,b,v))}}),(l.length||f.length)&&(this.cell=MCt(f,l,d)),this.inputs=Object.keys(u)}const PZ=BZ.prototype;PZ.init=function(){this.windows.forEach(t=>t.init()),this.cell&&this.cell.init()};PZ.update=function(t,e){const n=this.cell,r=this.windows,i=t.data,s=r&&r.length;let o;if(n){for(o=t.p0;o<t.i0;++o)n.rem(i[o]);for(o=t.p1;o<t.i1;++o)n.add(i[o]);n.set(e)}for(o=0;o<s;++o)r[o].update(t,e)};function MCt(t,e,n){t=t.map(u=>mZ(u,u.field));const r={num:0,agg:null,store:!1,count:e};if(!n)for(var i=t.length,s=r.agg=Array(i),o=0;o<i;++o)s[o]=new t[o](r);if(r.store)var a=r.data=new v6;return r.add=function(u){if(r.num+=1,!n){a&&a.add(u);for(let c=0;c<i;++c)s[c].add(s[c].get(u),u)}},r.rem=function(u){if(r.num-=1,!n){a&&a.rem(u);for(let c=0;c<i;++c)s[c].rem(s[c].get(u),u)}},r.set=function(u){let c,l;for(a&&a.values(),c=0,l=e.length;c<l;++c)u[e[c]]=r.num;if(!n)for(c=0,l=s.length;c<l;++c)s[c].set(u)},r.init=function(){r.num=0,a&&a.reset();for(let u=0;u<i;++u)s[u].init()},r}function q6(t){z.call(this,{},t),this._mlen=0,this._mods=[]}q6.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:kCt.concat(Ky)},{name:"params",type:"number",null:!0,array:!0},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};tt(q6,z,{transform(t,e){this.stamp=e.stamp;const n=t.modified(),r=ld(t.sort),i=rk(t.groupby),s=a=>this.group(i(a));let o=this.state;(!o||n)&&(o=this.state=new BZ(t)),n||e.modified(o.inputs)?(this.value={},e.visit(e.SOURCE,a=>s(a).add(a))):(e.visit(e.REM,a=>s(a).remove(a)),e.visit(e.ADD,a=>s(a).add(a)));for(let a=0,u=this._mlen;a<u;++a)CCt(this._mods[a],o,r,t);return this._mlen=0,this._mods=[],e.reflow(n).modifies(o.outputs)},group(t){let e=this.value[t];return e||(e=this.value[t]=yZ(vt),e.stamp=-1),e.stamp<this.stamp&&(e.stamp=this.stamp,this._mods[this._mlen++]=e),e}});function CCt(t,e,n,r){const i=r.sort,s=i&&!r.ignorePeers,o=r.frame||[null,0],a=t.data(n),u=a.length,c=s?rd(i):null,l={i0:0,i1:0,p0:0,p1:0,index:0,data:a,compare:i||Ar(-1)};e.init();for(let f=0;f<u;++f)ICt(l,o,f,u),s&&FCt(l,c),e.update(l,a[f])}function ICt(t,e,n,r){t.p0=t.i0,t.p1=t.i1,t.i0=e[0]==null?0:Math.max(0,n-Math.abs(e[0])),t.i1=e[1]==null?r:Math.min(r,n+Math.abs(e[1])+1),t.index=n}function FCt(t,e){const n=t.i0,r=t.i1-1,i=t.compare,s=t.data,o=s.length-1;n>0&&!i(s[n],s[n-1])&&(t.i0=e.left(s,s[n])),r<o&&!i(s[r],s[r+1])&&(t.i1=e.right(s,s[r]))}const NCt=Object.freeze(Object.defineProperty({__proto__:null,aggregate:Xc,bin:w6,collect:x6,compare:bZ,countpattern:_6,cross:S6,density:E6,dotbin:$6,expression:SZ,extent:T6,facet:iS,field:EZ,filter:M6,flatten:C6,fold:I6,formula:F6,generate:AZ,impute:N6,joinaggregate:O6,kde:R6,key:$Z,load:TZ,lookup:D6,multiextent:kZ,multivalues:MZ,params:CZ,pivot:L6,prefacet:IZ,project:B6,proxy:FZ,quantile:P6,relay:NZ,sample:z6,sequence:U6,sieve:OZ,subflow:k6,timeunit:j6,tupleindex:DZ,values:LZ,window:q6},Symbol.toStringTag,{value:"Module"}));function $c(t,e){if(typeof document<"u"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=t,n.height=e,n}return null}const OCt=()=>typeof Image<"u"?Image:null;function W6(t,e,n){const r=t-e+n*2;return t?r>0?r:1:0}const RCt="identity",mp="linear",wu="log",Qy="pow",Jy="sqrt",sS="symlog",Pf="time",zf="utc",jo="sequential",yg="diverging",yp="quantile",oS="quantize",aS="threshold",V6="ordinal",ik="point",zZ="band",G6="bin-ordinal",$n="continuous",Zy="discrete",t1="discretizing",Es="interpolating",Y6="temporal";function DCt(t){return function(e){let n=e[0],r=e[1],i;return r<n&&(i=n,n=r,r=i),[t.invert(n),t.invert(r)]}}function LCt(t){return function(e){const n=t.range();let r=e[0],i=e[1],s=-1,o,a,u,c;for(i<r&&(a=r,r=i,i=a),u=0,c=n.length;u<c;++u)n[u]>=r&&n[u]<=i&&(s<0&&(s=u),o=u);if(!(s<0))return r=t.invertExtent(n[s]),i=t.invertExtent(n[o]),[r[0]===void 0?r[1]:r[0],i[1]===void 0?i[0]:i[1]]}}function H6(){const t=ky().unknown(void 0),e=t.domain,n=t.range;let r=[0,1],i,s,o=!1,a=0,u=0,c=.5;delete t.unknown;function l(){const f=e().length,d=r[1]<r[0],h=r[1-d],p=W6(f,a,u);let g=r[d-0];i=(h-g)/(p||1),o&&(i=Math.floor(i)),g+=(h-g-i*(f-a))*c,s=i*(1-a),o&&(g=Math.round(g),s=Math.round(s));const m=xn(f).map(y=>g+i*y);return n(d?m.reverse():m)}return t.domain=function(f){return arguments.length?(e(f),l()):e()},t.range=function(f){return arguments.length?(r=[+f[0],+f[1]],l()):r.slice()},t.rangeRound=function(f){return r=[+f[0],+f[1]],o=!0,l()},t.bandwidth=function(){return s},t.step=function(){return i},t.round=function(f){return arguments.length?(o=!!f,l()):o},t.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,l()):a},t.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),l()):a},t.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),l()):u},t.align=function(f){return arguments.length?(c=Math.max(0,Math.min(1,f)),l()):c},t.invertRange=function(f){if(f[0]==null||f[1]==null)return;const d=r[1]<r[0],h=d?n().reverse():n(),p=h.length-1;let g=+f[0],m=+f[1],y,b,w;if(!(g!==g||m!==m)&&(m<g&&(w=g,g=m,m=w),!(m<h[0]||g>r[1-d])))return y=Math.max(0,hu(h,g)-1),b=g===m?y:hu(h,m)-1,g-h[y]>s+1e-10&&++y,d&&(w=y,y=p-b,b=p-w),y>b?void 0:e().slice(y,b+1)},t.invert=function(f){const d=t.invertRange([f,f]);return d&&d[0]},t.copy=function(){return H6().domain(e()).range(r).round(o).paddingInner(a).paddingOuter(u).align(c)},l()}function UZ(t){const e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return UZ(e())},t}function BCt(){return UZ(H6().paddingInner(1))}var PCt=Array.prototype.map;function zCt(t){return PCt.call(t,pr)}const UCt=Array.prototype.slice;function jZ(){let t=[],e=[];function n(r){return r==null||r!==r?void 0:e[(hu(t,r)-1)%e.length]}return n.domain=function(r){return arguments.length?(t=zCt(r),n):t.slice()},n.range=function(r){return arguments.length?(e=UCt.call(r),n):e.slice()},n.tickFormat=function(r,i){return bV(t[0],te(t),r??10,i)},n.copy=function(){return jZ().domain(n.domain()).range(n.range())},n}const Cx=new Map,qZ=Symbol("vega_scale");function WZ(t){return t[qZ]=!0,t}function jCt(t){return t&&t[qZ]===!0}function qCt(t,e,n){const r=function(){const s=e();return s.invertRange||(s.invertRange=s.invert?DCt(s):s.invertExtent?LCt(s):void 0),s.type=t,WZ(s)};return r.metadata=Gs(ot(n)),r}function ce(t,e,n){return arguments.length>1?(Cx.set(t,qCt(t,e,n)),this):VZ(t)?Cx.get(t):void 0}ce(RCt,QC);ce(mp,J2,$n);ce(wu,ZC,[$n,wu]);ce(Qy,Z2,$n);ce(Jy,ywt,$n);ce(sS,eI,$n);ce(Pf,BV,[$n,Y6]);ce(zf,PV,[$n,Y6]);ce(jo,aI,[$n,Es]);ce(`${jo}-${mp}`,aI,[$n,Es]);ce(`${jo}-${wu}`,zV,[$n,Es,wu]);ce(`${jo}-${Qy}`,uI,[$n,Es]);ce(`${jo}-${Jy}`,Sxt,[$n,Es]);ce(`${jo}-${sS}`,UV,[$n,Es]);ce(`${yg}-${mp}`,cI,[$n,Es]);ce(`${yg}-${wu}`,lI,[$n,Es,wu]);ce(`${yg}-${Qy}`,i_,[$n,Es]);ce(`${yg}-${Jy}`,Ext,[$n,Es]);ce(`${yg}-${sS}`,fI,[$n,Es]);ce(yp,rI,[t1,yp]);ce(oS,wV,t1);ce(aS,iI,t1);ce(G6,jZ,[Zy,t1]);ce(V6,ky,Zy);ce(zZ,H6,Zy);ce(ik,BCt,Zy);function VZ(t){return Cx.has(t)}function dd(t,e){const n=Cx.get(t);return n&&n.metadata[e]}function X6(t){return dd(t,$n)}function bp(t){return dd(t,Zy)}function sk(t){return dd(t,t1)}function GZ(t){return dd(t,wu)}function WCt(t){return dd(t,Y6)}function YZ(t){return dd(t,Es)}function HZ(t){return dd(t,yp)}const VCt=["clamp","base","constant","exponent"];function XZ(t,e){const n=e[0],r=te(e)-n;return function(i){return t(n+i*r)}}function uS(t,e,n){return Yp(K6(e||"rgb",n),t)}function KZ(t,e){const n=new Array(e),r=e+1;for(let i=0;i<e;)n[i]=t(++i/r);return n}function QZ(t,e,n){const r=n-e;let i,s,o;return!r||!Number.isFinite(r)?Ar(.5):(i=(s=t.type).indexOf("-"),s=i<0?s:s.slice(i+1),o=ce(s)().domain([e,n]).range([0,1]),VCt.forEach(a=>t[a]?o[a](t[a]()):0),o)}function K6(t,e){const n=g0t[GCt(t)];return e!=null&&n&&n.gamma?n.gamma(e):n}function GCt(t){return"interpolate"+t.toLowerCase().split("-").map(e=>e[0].toUpperCase()+e.slice(1)).join("")}const YCt={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},HCt={accent:qV,category10:jV,category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",dark2:WV,observable10:VV,paired:GV,pastel1:YV,pastel2:HV,set1:XV,set2:KV,set3:QV,tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5"};function JZ(t){if(W(t))return t;const e=t.length/6|0,n=new Array(e);for(let r=0;r<e;)n[r]="#"+t.slice(r*6,++r*6);return n}function ZZ(t,e){for(const n in t)Q6(n,e(t[n]))}const ML={};ZZ(HCt,JZ);ZZ(YCt,t=>uS(JZ(t)));function Q6(t,e){return t=t&&t.toLowerCase(),arguments.length>1?(ML[t]=e,this):ML[t]}const mv="symbol",XCt="discrete",KCt="gradient",QCt=t=>W(t)?t.map(e=>String(e)):String(t),JCt=(t,e)=>t[1]-e[1],ZCt=(t,e)=>e[1]-t[1];function J6(t,e,n){let r;return ue(e)&&(t.bins&&(e=Math.max(e,t.bins.length)),n!=null&&(e=Math.min(e,Math.floor(Yy(t.domain())/n||1)+1))),st(e)&&(r=e.step,e=e.interval),at(e)&&(e=t.type===Pf?pg(e):t.type==zf?gg(e):j("Only time and utc scales accept interval strings."),r&&(e=e.every(r))),e}function ttt(t,e,n){let r=t.range(),i=r[0],s=te(r),o=JCt;if(i>s&&(r=s,s=i,i=r,o=ZCt),i=Math.floor(i),s=Math.ceil(s),e=e.map(a=>[a,t(a)]).filter(a=>i<=a[1]&&a[1]<=s).sort(o).map(a=>a[0]),n>0&&e.length>1){const a=[e[0],te(e)];for(;e.length>n&&e.length>=3;)e=e.filter((u,c)=>!(c%2));e.length<3&&(e=a)}return e}function Z6(t,e){return t.bins?ttt(t,t.bins,e):t.ticks?t.ticks(e):t.domain()}function ett(t,e,n,r,i,s){const o=e.type;let a=QCt;if(o===Pf||i===Pf)a=t.timeFormat(r);else if(o===zf||i===zf)a=t.utcFormat(r);else if(GZ(o)){const u=t.formatFloat(r);if(s||e.bins)a=u;else{const c=ntt(e,n,!1);a=l=>c(l)?u(l):""}}else if(e.tickFormat){const u=e.domain();a=t.formatSpan(u[0],u[u.length-1],n,r)}else r&&(a=t.format(r));return a}function ntt(t,e,n){const r=Z6(t,e),i=t.base(),s=Math.log(i),o=Math.max(1,i*e/r.length),a=u=>{let c=u/Math.pow(i,Math.round(Math.log(u)/s));return c*i<i-.5&&(c*=i),c<=o};return n?r.filter(a):a}const ok={[yp]:"quantiles",[oS]:"thresholds",[aS]:"domain"},rtt={[yp]:"quantiles",[oS]:"domain"};function itt(t,e){return t.bins?nIt(t.bins):t.type===wu?ntt(t,e,!0):ok[t.type]?eIt(t[ok[t.type]]()):Z6(t,e)}function tIt(t,e,n){const r=e[rtt[e.type]](),i=r.length;let s=i>1?r[1]-r[0]:r[0],o;for(o=1;o<i;++o)s=Math.min(s,r[o]-r[o-1]);return t.formatSpan(0,s,3*10,n)}function eIt(t){const e=[-1/0].concat(t);return e.max=1/0,e}function nIt(t){const e=t.slice(0,-1);return e.max=te(t),e}const rIt=t=>ok[t.type]||t.bins;function stt(t,e,n,r,i,s,o){const a=rtt[e.type]&&s!==Pf&&s!==zf?tIt(t,e,i):ett(t,e,n,i,s,o);return r===mv&&rIt(e)?iIt(a):r===XCt?sIt(a):oIt(a)}const iIt=t=>(e,n,r)=>{const i=CL(r[n+1],CL(r.max,1/0)),s=IL(e,t),o=IL(i,t);return s&&o?s+"  "+o:o?"< "+o:" "+s},CL=(t,e)=>t??e,sIt=t=>(e,n)=>n?t(e):null,oIt=t=>e=>t(e),IL=(t,e)=>Number.isFinite(t)?e(t):null;function aIt(t){const e=t.domain(),n=e.length-1;let r=+e[0],i=+te(e),s=i-r;if(t.type===aS){const o=n?s/n:.1;r-=o,i+=o,s=i-r}return o=>(o-r)/s}function uIt(t,e,n,r){const i=r||e.type;return at(n)&&WCt(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&i===Pf?t.timeFormat("%A, %d %B %Y, %X"):!n&&i===zf?t.utcFormat("%A, %d %B %Y, %X UTC"):stt(t,e,5,null,n,r,!0)}function ott(t,e,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=uIt(t,e,n.format,n.formatType);if(sk(e.type)){const s=itt(e).slice(1).map(i),o=s.length;return`${o} boundar${o===1?"y":"ies"}: ${s.join(", ")}`}else if(bp(e.type)){const s=e.domain(),o=s.length,a=o>r?s.slice(0,r-2).map(i).join(", ")+", ending with "+s.slice(-1).map(i):s.map(i).join(", ");return`${o} value${o===1?"":"s"}: ${a}`}else{const s=e.domain();return`values from ${i(s[0])} to ${i(te(s))}`}}let att=0;function cIt(){att=0}const Ix="p_";function tN(t){return t&&t.gradient}function utt(t,e,n){const r=t.gradient;let i=t.id,s=r==="radial"?Ix:"";return i||(i=t.id="gradient_"+att++,r==="radial"?(t.x1=mo(t.x1,.5),t.y1=mo(t.y1,.5),t.r1=mo(t.r1,0),t.x2=mo(t.x2,.5),t.y2=mo(t.y2,.5),t.r2=mo(t.r2,.5),s=Ix):(t.x1=mo(t.x1,0),t.y1=mo(t.y1,0),t.x2=mo(t.x2,1),t.y2=mo(t.y2,0))),e[i]=t,"url("+(n||"")+"#"+s+i+")"}function mo(t,e){return t??e}function ctt(t,e){var n=[],r;return r={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:n,stop:function(i,s){return n.push({offset:i,color:s}),r}}}const FL={basis:{curve:EY},"basis-closed":{curve:$Y},"basis-open":{curve:kY},bundle:{curve:CY,tension:"beta",value:.85},cardinal:{curve:IY,tension:"tension",value:0},"cardinal-open":{curve:NY,tension:"tension",value:0},"cardinal-closed":{curve:FY,tension:"tension",value:0},"catmull-rom":{curve:RY,tension:"alpha",value:.5},"catmull-rom-closed":{curve:LY,tension:"alpha",value:.5},"catmull-rom-open":{curve:PY,tension:"alpha",value:.5},linear:{curve:tg},"linear-closed":{curve:UY},monotone:{horizontal:VY,vertical:WY},natural:{curve:YY},step:{curve:HY},"step-after":{curve:KY},"step-before":{curve:XY}};function eN(t,e,n){var r=ft(FL,t)&&FL[t],i=null;return r&&(i=r.curve||r[e||"vertical"],r.tension&&n!=null&&(i=i[r.tension](n))),i}const lIt={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},fIt=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,dIt=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,hIt=/^((\s+,?\s*)|(,\s*))/,pIt=/^[01]/;function vp(t){const e=[];return(t.match(fIt)||[]).forEach(r=>{let i=r[0];const s=i.toLowerCase(),o=lIt[s],a=gIt(s,o,r.slice(1).trim()),u=a.length;if(u<o||u&&u%o!==0)throw Error("Invalid SVG path, incorrect parameter count");if(e.push([i,...a.slice(0,o)]),u!==o){s==="m"&&(i=i==="M"?"L":"l");for(let c=o;c<u;c+=o)e.push([i,...a.slice(c,c+o)])}}),e}function gIt(t,e,n){const r=[];for(let i=0;e&&i<n.length;)for(let s=0;s<e;++s){const o=t==="a"&&(s===3||s===4)?pIt:dIt,a=n.slice(i).match(o);if(a===null)throw Error("Invalid SVG path, incorrect parameter type");i+=a[0].length,r.push(+a[0]);const u=n.slice(i).match(hIt);u!==null&&(i+=u[0].length)}return r}const Kc=Math.PI/180,mIt=1e-14,Xl=Math.PI/2,No=Math.PI*2,Ud=Math.sqrt(3)/2;var KA={},QA={},ltt=[].join;function yIt(t,e,n,r,i,s,o,a,u){const c=ltt.call(arguments);if(KA[c])return KA[c];const l=o*Kc,f=Math.sin(l),d=Math.cos(l);n=Math.abs(n),r=Math.abs(r);const h=d*(a-t)*.5+f*(u-e)*.5,p=d*(u-e)*.5-f*(a-t)*.5;let g=h*h/(n*n)+p*p/(r*r);g>1&&(g=Math.sqrt(g),n*=g,r*=g);const m=d/n,y=f/n,b=-f/r,w=d/r,v=m*a+y*u,x=b*a+w*u,S=m*t+y*e,_=b*t+w*e;let A=1/((S-v)*(S-v)+(_-x)*(_-x))-.25;A<0&&(A=0);let $=Math.sqrt(A);s==i&&($=-$);const T=.5*(v+S)-$*(_-x),C=.5*(x+_)+$*(S-v),F=Math.atan2(x-C,v-T);let k=Math.atan2(_-C,S-T)-F;k<0&&s===1?k+=No:k>0&&s===0&&(k-=No);const I=Math.ceil(Math.abs(k/(Xl+.001))),N=[];for(let R=0;R<I;++R){const D=F+R*k/I,L=F+(R+1)*k/I;N[R]=[T,C,D,L,n,r,f,d]}return KA[c]=N}function bIt(t){const e=ltt.call(t);if(QA[e])return QA[e];var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],c=t[7];const l=c*o,f=-u*a,d=u*o,h=c*a,p=Math.cos(i),g=Math.sin(i),m=Math.cos(s),y=Math.sin(s),b=.5*(s-i),w=Math.sin(b*.5),v=8/3*w*w/Math.sin(b),x=n+p-v*g,S=r+g+v*p,_=n+m,E=r+y,A=_+v*y,$=E-v*m;return QA[e]=[l*x+f*S,d*x+h*S,l*A+f*$,d*A+h*$,l*_+f*E,d*_+h*E]}const qi=["l",0,0,0,0,0,0,0];function vIt(t,e,n){const r=qi[0]=t[0];if(r==="a"||r==="A")qi[1]=e*t[1],qi[2]=n*t[2],qi[3]=t[3],qi[4]=t[4],qi[5]=t[5],qi[6]=e*t[6],qi[7]=n*t[7];else if(r==="h"||r==="H")qi[1]=e*t[1];else if(r==="v"||r==="V")qi[1]=n*t[1];else for(var i=1,s=t.length;i<s;++i)qi[i]=(i%2==1?e:n)*t[i];return qi}function Y0(t,e,n,r,i,s){var o,a=null,u=0,c=0,l=0,f=0,d,h,p,g,m=0,y=0;n==null&&(n=0),r==null&&(r=0),i==null&&(i=1),s==null&&(s=i),t.beginPath&&t.beginPath();for(var b=0,w=e.length;b<w;++b){switch(o=e[b],(i!==1||s!==1)&&(o=vIt(o,i,s)),o[0]){case"l":u+=o[1],c+=o[2],t.lineTo(u+n,c+r);break;case"L":u=o[1],c=o[2],t.lineTo(u+n,c+r);break;case"h":u+=o[1],t.lineTo(u+n,c+r);break;case"H":u=o[1],t.lineTo(u+n,c+r);break;case"v":c+=o[1],t.lineTo(u+n,c+r);break;case"V":c=o[1],t.lineTo(u+n,c+r);break;case"m":u+=o[1],c+=o[2],m=u,y=c,t.moveTo(u+n,c+r);break;case"M":u=o[1],c=o[2],m=u,y=c,t.moveTo(u+n,c+r);break;case"c":d=u+o[5],h=c+o[6],l=u+o[3],f=c+o[4],t.bezierCurveTo(u+o[1]+n,c+o[2]+r,l+n,f+r,d+n,h+r),u=d,c=h;break;case"C":u=o[5],c=o[6],l=o[3],f=o[4],t.bezierCurveTo(o[1]+n,o[2]+r,l+n,f+r,u+n,c+r);break;case"s":d=u+o[3],h=c+o[4],l=2*u-l,f=2*c-f,t.bezierCurveTo(l+n,f+r,u+o[1]+n,c+o[2]+r,d+n,h+r),l=u+o[1],f=c+o[2],u=d,c=h;break;case"S":d=o[3],h=o[4],l=2*u-l,f=2*c-f,t.bezierCurveTo(l+n,f+r,o[1]+n,o[2]+r,d+n,h+r),u=d,c=h,l=o[1],f=o[2];break;case"q":d=u+o[3],h=c+o[4],l=u+o[1],f=c+o[2],t.quadraticCurveTo(l+n,f+r,d+n,h+r),u=d,c=h;break;case"Q":d=o[3],h=o[4],t.quadraticCurveTo(o[1]+n,o[2]+r,d+n,h+r),u=d,c=h,l=o[1],f=o[2];break;case"t":d=u+o[1],h=c+o[2],a[0].match(/[QqTt]/)===null?(l=u,f=c):a[0]==="t"?(l=2*u-p,f=2*c-g):a[0]==="q"&&(l=2*u-l,f=2*c-f),p=l,g=f,t.quadraticCurveTo(l+n,f+r,d+n,h+r),u=d,c=h,l=u+o[1],f=c+o[2];break;case"T":d=o[1],h=o[2],l=2*u-l,f=2*c-f,t.quadraticCurveTo(l+n,f+r,d+n,h+r),u=d,c=h;break;case"a":NL(t,u+n,c+r,[o[1],o[2],o[3],o[4],o[5],o[6]+u+n,o[7]+c+r]),u+=o[6],c+=o[7];break;case"A":NL(t,u+n,c+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),u=o[6],c=o[7];break;case"z":case"Z":u=m,c=y,t.closePath();break}a=o}}function NL(t,e,n,r){const i=yIt(r[5],r[6],r[0],r[1],r[3],r[4],r[2],e,n);for(let s=0;s<i.length;++s){const o=bIt(i[s]);t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}const OL=.5773502691896257,RL={circle:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(n,0),t.arc(0,0,n,0,No)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,r=n/2.5;t.moveTo(-n,-r),t.lineTo(-n,r),t.lineTo(-r,r),t.lineTo(-r,n),t.lineTo(r,n),t.lineTo(r,r),t.lineTo(n,r),t.lineTo(n,-r),t.lineTo(r,-r),t.lineTo(r,-n),t.lineTo(-r,-n),t.lineTo(-r,-r),t.closePath()}},diamond:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),r=-n/2;t.rect(r,r,n,n)}},arrow:{draw:function(t,e){var n=Math.sqrt(e)/2,r=n/7,i=n/2.5,s=n/8;t.moveTo(-r,n),t.lineTo(r,n),t.lineTo(r,-s),t.lineTo(i,-s),t.lineTo(0,-n),t.lineTo(-i,-s),t.lineTo(-r,-s),t.closePath()}},wedge:{draw:function(t,e){var n=Math.sqrt(e)/2,r=Ud*n,i=r-n*OL,s=n/4;t.moveTo(0,-r-i),t.lineTo(-s,r-i),t.lineTo(s,r-i),t.closePath()}},triangle:{draw:function(t,e){var n=Math.sqrt(e)/2,r=Ud*n,i=r-n*OL;t.moveTo(0,-r-i),t.lineTo(-n,r-i),t.lineTo(n,r-i),t.closePath()}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,r=Ud*n;t.moveTo(0,-r),t.lineTo(-n,r),t.lineTo(n,r),t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,r=Ud*n;t.moveTo(0,r),t.lineTo(-n,-r),t.lineTo(n,-r),t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,r=Ud*n;t.moveTo(r,0),t.lineTo(-r,-n),t.lineTo(-r,n),t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,r=Ud*n;t.moveTo(-r,0),t.lineTo(r,-n),t.lineTo(r,n),t.closePath()}},stroke:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(n,0)}}};function ftt(t){return ft(RL,t)?RL[t]:wIt(t)}var JA={};function wIt(t){if(!ft(JA,t)){const e=vp(t);JA[t]={draw:function(n,r){Y0(n,e,0,0,Math.sqrt(r)/2)}}}return JA[t]}const Vu=.448084975506;function xIt(t){return t.x}function _It(t){return t.y}function SIt(t){return t.width}function EIt(t){return t.height}function Fa(t){return typeof t=="function"?t:()=>+t}function wb(t,e,n){return Math.max(e,Math.min(t,n))}function dtt(){var t=xIt,e=_It,n=SIt,r=EIt,i=Fa(0),s=i,o=i,a=i,u=null;function c(l,f,d){var h,p=f??+t.call(this,l),g=d??+e.call(this,l),m=+n.call(this,l),y=+r.call(this,l),b=Math.min(m,y)/2,w=wb(+i.call(this,l),0,b),v=wb(+s.call(this,l),0,b),x=wb(+o.call(this,l),0,b),S=wb(+a.call(this,l),0,b);if(u||(u=h=G2()),w<=0&&v<=0&&x<=0&&S<=0)u.rect(p,g,m,y);else{var _=p+m,E=g+y;u.moveTo(p+w,g),u.lineTo(_-v,g),u.bezierCurveTo(_-Vu*v,g,_,g+Vu*v,_,g+v),u.lineTo(_,E-S),u.bezierCurveTo(_,E-Vu*S,_-Vu*S,E,_-S,E),u.lineTo(p+x,E),u.bezierCurveTo(p+Vu*x,E,p,E-Vu*x,p,E-x),u.lineTo(p,g+w),u.bezierCurveTo(p,g+Vu*w,p+Vu*w,g,p+w,g),u.closePath()}if(h)return u=null,h+""||null}return c.x=function(l){return arguments.length?(t=Fa(l),c):t},c.y=function(l){return arguments.length?(e=Fa(l),c):e},c.width=function(l){return arguments.length?(n=Fa(l),c):n},c.height=function(l){return arguments.length?(r=Fa(l),c):r},c.cornerRadius=function(l,f,d,h){return arguments.length?(i=Fa(l),s=f!=null?Fa(f):i,a=d!=null?Fa(d):i,o=h!=null?Fa(h):s,c):i},c.context=function(l){return arguments.length?(u=l??null,c):u},c}function htt(){var t,e,n,r,i=null,s,o,a,u;function c(f,d,h){const p=h/2;if(s){var g=a-d,m=f-o;if(g||m){var y=Math.hypot(g,m),b=(g/=y)*u,w=(m/=y)*u,v=Math.atan2(m,g);i.moveTo(o-b,a-w),i.lineTo(f-g*p,d-m*p),i.arc(f,d,p,v-Math.PI,v),i.lineTo(o+b,a+w),i.arc(o,a,u,v,v+Math.PI)}else i.arc(f,d,p,0,No);i.closePath()}else s=1;o=f,a=d,u=p}function l(f){var d,h=f.length,p,g=!1,m;for(i==null&&(i=m=G2()),d=0;d<=h;++d)!(d<h&&r(p=f[d],d,f))===g&&(g=!g)&&(s=0),g&&c(+t(p,d,f),+e(p,d,f),+n(p,d,f));if(m)return i=null,m+""||null}return l.x=function(f){return arguments.length?(t=f,l):t},l.y=function(f){return arguments.length?(e=f,l):e},l.size=function(f){return arguments.length?(n=f,l):n},l.defined=function(f){return arguments.length?(r=f,l):r},l.context=function(f){return arguments.length?(f==null?i=null:i=f,l):i},l}function e1(t,e){return t??e}const n1=t=>t.x||0,r1=t=>t.y||0,AIt=t=>t.width||0,$It=t=>t.height||0,TIt=t=>(t.x||0)+(t.width||0),kIt=t=>(t.y||0)+(t.height||0),MIt=t=>t.startAngle||0,CIt=t=>t.endAngle||0,IIt=t=>t.padAngle||0,FIt=t=>t.innerRadius||0,NIt=t=>t.outerRadius||0,OIt=t=>t.cornerRadius||0,RIt=t=>e1(t.cornerRadiusTopLeft,t.cornerRadius)||0,DIt=t=>e1(t.cornerRadiusTopRight,t.cornerRadius)||0,LIt=t=>e1(t.cornerRadiusBottomRight,t.cornerRadius)||0,BIt=t=>e1(t.cornerRadiusBottomLeft,t.cornerRadius)||0,PIt=t=>e1(t.size,64),zIt=t=>t.size||1,cS=t=>t.defined!==!1,UIt=t=>ftt(t.shape||"circle"),jIt=Dxt().startAngle(MIt).endAngle(CIt).padAngle(IIt).innerRadius(FIt).outerRadius(NIt).cornerRadius(OIt),qIt=Iy().x(n1).y1(r1).y0(kIt).defined(cS),WIt=Iy().y(r1).x1(n1).x0(TIt).defined(cS),VIt=dI().x(n1).y(r1).defined(cS),GIt=dtt().x(n1).y(r1).width(AIt).height($It).cornerRadius(RIt,DIt,LIt,BIt),YIt=Hxt().type(UIt).size(PIt),HIt=htt().x(n1).y(r1).defined(cS).size(zIt);function nN(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function XIt(t,e){return jIt.context(t)(e)}function KIt(t,e){const n=e[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?WIt:qIt).curve(eN(r,n.orient,n.tension)).context(t)(e)}function QIt(t,e){const n=e[0],r=n.interpolate||"linear";return VIt.curve(eN(r,n.orient,n.tension)).context(t)(e)}function bg(t,e,n,r){return GIt.context(t)(e,n,r)}function JIt(t,e){return(e.mark.shape||e.shape).context(t)(e)}function ZIt(t,e){return YIt.context(t)(e)}function tFt(t,e){return HIt.context(t)(e)}var ptt=1;function gtt(){ptt=1}function rN(t,e,n){var r=e.clip,i=t._defs,s=e.clip_id||(e.clip_id="clip"+ptt++),o=i.clipping[s]||(i.clipping[s]={id:s});return jt(r)?o.path=r(null):nN(n)?o.path=bg(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+s+")"}function gn(t){this.clear(),t&&this.union(t)}gn.prototype={clone(){return new gn(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},set(t,e,n,r){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this},add(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},expand(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(t){return this.x1*=t,this.y1*=t,this.x2*=t,this.y2*=t,this},translate(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},rotate(t,e,n){const r=this.rotatedPoints(t,e,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(t,e,n){var{x1:r,y1:i,x2:s,y2:o}=this,a=Math.cos(t),u=Math.sin(t),c=e-e*a+n*u,l=n-e*u-n*a;return[a*r-u*i+c,u*r+a*i+l,a*r-u*o+c,u*r+a*o+l,a*s-u*i+c,u*s+a*i+l,a*s-u*o+c,u*s+a*o+l]},union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},alignsWith(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},contains(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function lS(t){this.mark=t,this.bounds=this.bounds||new gn}function fS(t){lS.call(this,t),this.items=this.items||[]}tt(fS,lS);class mtt{constructor(e){this._pending=0,this._loader=e||Y_()}pending(){return this._pending}sanitizeURL(e){const n=this;return DL(n),n._loader.sanitize(e,{context:"href"}).then(r=>(Xg(n),r)).catch(()=>(Xg(n),null))}loadImage(e){const n=this,r=OCt();return DL(n),n._loader.sanitize(e,{context:"image"}).then(i=>{const s=i.href;if(!s||!r)throw{url:s};const o=new r,a=ft(i,"crossOrigin")?i.crossOrigin:"anonymous";return a!=null&&(o.crossOrigin=a),o.onload=()=>Xg(n),o.onerror=()=>Xg(n),o.src=s,o}).catch(i=>(Xg(n),{complete:!1,width:0,height:0,src:i&&i.url||""}))}ready(){const e=this;return new Promise(n=>{function r(i){e.pending()?setTimeout(()=>{r(!0)},10):n(i)}r(!1)})}}function DL(t){t._pending+=1}function Xg(t){t._pending-=1}function Ou(t,e,n){if(e.stroke&&e.opacity!==0&&e.strokeOpacity!==0){const r=e.strokeWidth!=null?+e.strokeWidth:1;t.expand(r+(n?eFt(e,r):0))}return t}function eFt(t,e){return t.strokeJoin&&t.strokeJoin!=="miter"?0:e}const nFt=No-1e-8;let dS,yv,bv,of,ak,vv,uk,ck;const pc=(t,e)=>dS.add(t,e),wv=(t,e)=>pc(yv=t,bv=e),LL=t=>pc(t,dS.y1),BL=t=>pc(dS.x1,t),Kl=(t,e)=>ak*t+uk*e,Ql=(t,e)=>vv*t+ck*e,ZA=(t,e)=>pc(Kl(t,e),Ql(t,e)),t$=(t,e)=>wv(Kl(t,e),Ql(t,e));function i1(t,e){return dS=t,e?(of=e*Kc,ak=ck=Math.cos(of),vv=Math.sin(of),uk=-vv):(ak=ck=1,of=vv=uk=0),rFt}const rFt={beginPath(){},closePath(){},moveTo:t$,lineTo:t$,rect(t,e,n,r){of?(ZA(t+n,e),ZA(t+n,e+r),ZA(t,e+r),t$(t,e)):(pc(t+n,e+r),wv(t,e))},quadraticCurveTo(t,e,n,r){const i=Kl(t,e),s=Ql(t,e),o=Kl(n,r),a=Ql(n,r);PL(yv,i,o,LL),PL(bv,s,a,BL),wv(o,a)},bezierCurveTo(t,e,n,r,i,s){const o=Kl(t,e),a=Ql(t,e),u=Kl(n,r),c=Ql(n,r),l=Kl(i,s),f=Ql(i,s);zL(yv,o,u,l,LL),zL(bv,a,c,f,BL),wv(l,f)},arc(t,e,n,r,i,s){if(r+=of,i+=of,yv=n*Math.cos(i)+t,bv=n*Math.sin(i)+e,Math.abs(i-r)>nFt)pc(t-n,e-n),pc(t+n,e+n);else{const o=c=>pc(n*Math.cos(c)+t,n*Math.sin(c)+e);let a,u;if(o(r),o(i),i!==r)if(r=r%No,r<0&&(r+=No),i=i%No,i<0&&(i+=No),i<r&&(s=!s,a=r,r=i,i=a),s)for(i-=No,a=r-r%Xl,u=0;u<4&&a>i;++u,a-=Xl)o(a);else for(a=r-r%Xl+Xl,u=0;u<4&&a<i;++u,a=a+Xl)o(a)}}};function PL(t,e,n,r){const i=(t-e)/(t+n-2*e);0<i&&i<1&&r(t+(e-t)*i)}function zL(t,e,n,r,i){const s=r-t+3*e-3*n,o=t+n-2*e,a=t-e;let u=0,c=0,l;Math.abs(s)>mIt?(l=o*o+a*s,l>=0&&(l=Math.sqrt(l),u=(-o+l)/s,c=(-o-l)/s)):u=.5*a/o,0<u&&u<1&&i(UL(u,t,e,n,r)),0<c&&c<1&&i(UL(c,t,e,n,r))}function UL(t,e,n,r,i){const s=1-t,o=s*s,a=t*t;return o*s*e+3*o*t*n+3*s*a*r+a*t*i}var Tc=(Tc=$c(1,1))?Tc.getContext("2d"):null;const lk=new gn;function iN(t){return function(e,n){if(!Tc)return!0;t(Tc,e),lk.clear().union(e.bounds).intersect(n).round();const{x1:r,y1:i,x2:s,y2:o}=lk;for(let a=i;a<=o;++a)for(let u=r;u<=s;++u)if(Tc.isPointInPath(u,a))return!0;return!1}}function sN(t,e){return e.contains(t.x||0,t.y||0)}function ytt(t,e){const n=t.x||0,r=t.y||0,i=t.width||0,s=t.height||0;return e.intersects(lk.set(n,r,n+i,r+s))}function btt(t,e){const n=t.x||0,r=t.y||0,i=t.x2!=null?t.x2:n,s=t.y2!=null?t.y2:r;return bh(e,n,r,i,s)}function bh(t,e,n,r,i){const{x1:s,y1:o,x2:a,y2:u}=t,c=r-e,l=i-n;let f=0,d=1,h,p,g,m;for(m=0;m<4;++m){if(m===0&&(h=-c,p=-(s-e)),m===1&&(h=c,p=a-e),m===2&&(h=-l,p=-(o-n)),m===3&&(h=l,p=u-n),Math.abs(h)<1e-10&&p<0)return!1;if(g=p/h,h<0){if(g>d)return!1;g>f&&(f=g)}else if(h>0){if(g<f)return!1;g<d&&(d=g)}}return!0}function wp(t,e){t.globalCompositeOperation=e.blend||"source-over"}function Ms(t,e){return t??e}function jL(t,e){const n=e.length;for(let r=0;r<n;++r)t.addColorStop(e[r].offset,e[r].color);return t}function iFt(t,e,n){const r=n.width(),i=n.height();let s;if(e.gradient==="radial")s=t.createRadialGradient(n.x1+Ms(e.x1,.5)*r,n.y1+Ms(e.y1,.5)*i,Math.max(r,i)*Ms(e.r1,0),n.x1+Ms(e.x2,.5)*r,n.y1+Ms(e.y2,.5)*i,Math.max(r,i)*Ms(e.r2,.5));else{const o=Ms(e.x1,0),a=Ms(e.y1,0),u=Ms(e.x2,1),c=Ms(e.y2,0);if(o===u||a===c||r===i)s=t.createLinearGradient(n.x1+o*r,n.y1+a*i,n.x1+u*r,n.y1+c*i);else{const l=$c(Math.ceil(r),Math.ceil(i)),f=l.getContext("2d");return f.scale(r,i),f.fillStyle=jL(f.createLinearGradient(o,a,u,c),e.stops),f.fillRect(0,0,r,i),t.createPattern(l,"no-repeat")}}return jL(s,e.stops)}function vtt(t,e,n){return tN(n)?iFt(t,n,e.bounds):n}function Fx(t,e,n){return n*=e.fillOpacity==null?1:e.fillOpacity,n>0?(t.globalAlpha=n,t.fillStyle=vtt(t,e,e.fill),!0):!1}var sFt=[];function xp(t,e,n){var r=(r=e.strokeWidth)!=null?r:1;return r<=0?!1:(n*=e.strokeOpacity==null?1:e.strokeOpacity,n>0?(t.globalAlpha=n,t.strokeStyle=vtt(t,e,e.stroke),t.lineWidth=r,t.lineCap=e.strokeCap||"butt",t.lineJoin=e.strokeJoin||"miter",t.miterLimit=e.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(e.strokeDash||sFt),t.lineDashOffset=e.strokeDashOffset||0),!0):!1)}function oFt(t,e){return t.zindex-e.zindex||t.index-e.index}function oN(t){if(!t.zdirty)return t.zitems;var e=t.items,n=[],r,i,s;for(i=0,s=e.length;i<s;++i)r=e[i],r.index=i,r.zindex&&n.push(r);return t.zdirty=!1,t.zitems=n.sort(oFt)}function Hs(t,e){var n=t.items,r,i;if(!n||!n.length)return;const s=oN(t);if(s&&s.length){for(r=0,i=n.length;r<i;++r)n[r].zindex||e(n[r]);n=s}for(r=0,i=n.length;r<i;++r)e(n[r])}function Nx(t,e){var n=t.items,r,i;if(!n||!n.length)return null;const s=oN(t);for(s&&s.length&&(n=s),i=n.length;--i>=0;)if(r=e(n[i]))return r;if(n===s){for(n=t.items,i=n.length;--i>=0;)if(!n[i].zindex&&(r=e(n[i])))return r}return null}function aN(t){return function(e,n,r){Hs(n,i=>{(!r||r.intersects(i.bounds))&&wtt(t,e,i,i)})}}function aFt(t){return function(e,n,r){n.items.length&&(!r||r.intersects(n.bounds))&&wtt(t,e,n.items[0],n.items)}}function wtt(t,e,n,r){var i=n.opacity==null?1:n.opacity;i!==0&&(t(e,r)||(wp(e,n),n.fill&&Fx(e,n,i)&&e.fill(),n.stroke&&xp(e,n,i)&&e.stroke()))}function hS(t){return t=t||bs,function(e,n,r,i,s,o){return r*=e.pixelRatio,i*=e.pixelRatio,Nx(n,a=>{const u=a.bounds;if(!(u&&!u.contains(s,o)||!u)&&t(e,a,r,i,s,o))return a})}}function s1(t,e){return function(n,r,i,s){var o=Array.isArray(r)?r[0]:r,a=e??o.fill,u=o.stroke&&n.isPointInStroke,c,l;return u&&(c=o.strokeWidth,l=o.strokeCap,n.lineWidth=c??1,n.lineCap=l??"butt"),t(n,r)?!1:a&&n.isPointInPath(i,s)||u&&n.isPointInStroke(i,s)}}function uN(t){return hS(s1(t))}function yf(t,e){return"translate("+t+","+e+")"}function cN(t){return"rotate("+t+")"}function uFt(t,e){return"scale("+t+","+e+")"}function xtt(t){return yf(t.x||0,t.y||0)}function cFt(t){return yf(t.x||0,t.y||0)+(t.angle?" "+cN(t.angle):"")}function lFt(t){return yf(t.x||0,t.y||0)+(t.angle?" "+cN(t.angle):"")+(t.scaleX||t.scaleY?" "+uFt(t.scaleX||1,t.scaleY||1):"")}function lN(t,e,n){function r(o,a){o("transform",cFt(a)),o("d",e(null,a))}function i(o,a){return e(i1(o,a.angle),a),Ou(o,a).translate(a.x||0,a.y||0)}function s(o,a){var u=a.x||0,c=a.y||0,l=a.angle||0;o.translate(u,c),l&&o.rotate(l*=Kc),o.beginPath(),e(o,a),l&&o.rotate(-l),o.translate(-u,-c)}return{type:t,tag:"path",nested:!1,attr:r,bound:i,draw:aN(s),pick:uN(s),isect:n||iN(s)}}var fFt=lN("arc",XIt);function dFt(t,e){for(var n=t[0].orient==="horizontal"?e[1]:e[0],r=t[0].orient==="horizontal"?"y":"x",i=t.length,s=1/0,o,a;--i>=0;)t[i].defined!==!1&&(a=Math.abs(t[i][r]-n),a<s&&(s=a,o=t[i]));return o}function hFt(t,e){for(var n=Math.pow(t[0].strokeWidth||1,2),r=t.length,i,s,o;--r>=0;)if(t[r].defined!==!1&&(i=t[r].x-e[0],s=t[r].y-e[1],o=i*i+s*s,o<n))return t[r];return null}function pFt(t,e){for(var n=t.length,r,i,s;--n>=0;)if(t[n].defined!==!1&&(r=t[n].x-e[0],i=t[n].y-e[1],s=r*r+i*i,r=t[n].size||1,s<r*r))return t[n];return null}function fN(t,e,n){function r(u,c){var l=c.mark.items;l.length&&u("d",e(null,l))}function i(u,c){var l=c.items;return l.length===0?u:(e(i1(u),l),Ou(u,l[0]))}function s(u,c){u.beginPath(),e(u,c)}const o=s1(s);function a(u,c,l,f,d,h){var p=c.items,g=c.bounds;return!p||!p.length||g&&!g.contains(d,h)?null:(l*=u.pixelRatio,f*=u.pixelRatio,o(u,p,l,f)?p[0]:null)}return{type:t,tag:"path",nested:!0,attr:r,bound:i,draw:aFt(s),pick:a,isect:sN,tip:n}}var gFt=fN("area",KIt,dFt);function mFt(t,e){var n=e.clip;t.save(),jt(n)?(t.beginPath(),n(t),t.clip()):_tt(t,e.group)}function _tt(t,e){t.beginPath(),nN(e)?bg(t,e,0,0):t.rect(0,0,e.width||0,e.height||0),t.clip()}function Stt(t){const e=Ms(t.strokeWidth,1);return t.strokeOffset!=null?t.strokeOffset:t.stroke&&e>.5&&e<1.5?.5-Math.abs(e-1):0}function yFt(t,e){t("transform",xtt(e))}function Ett(t,e){const n=Stt(e);t("d",bg(null,e,n,n))}function bFt(t,e){t("class","background"),t("aria-hidden",!0),Ett(t,e)}function vFt(t,e){t("class","foreground"),t("aria-hidden",!0),e.strokeForeground?Ett(t,e):t("d","")}function wFt(t,e,n){const r=e.clip?rN(n,e,e):null;t("clip-path",r)}function xFt(t,e){if(!e.clip&&e.items){const n=e.items,r=n.length;for(let i=0;i<r;++i)t.union(n[i].bounds)}return(e.clip||e.width||e.height)&&!e.noBound&&t.add(0,0).add(e.width||0,e.height||0),Ou(t,e),t.translate(e.x||0,e.y||0)}function H0(t,e,n,r){const i=Stt(e);t.beginPath(),bg(t,e,(n||0)+i,(r||0)+i)}const _Ft=s1(H0),SFt=s1(H0,!1),EFt=s1(H0,!0);function AFt(t,e,n,r){Hs(e,i=>{const s=i.x||0,o=i.y||0,a=i.strokeForeground,u=i.opacity==null?1:i.opacity;(i.stroke||i.fill)&&u&&(H0(t,i,s,o),wp(t,i),i.fill&&Fx(t,i,u)&&t.fill(),i.stroke&&!a&&xp(t,i,u)&&t.stroke()),t.save(),t.translate(s,o),i.clip&&_tt(t,i),n&&n.translate(-s,-o),Hs(i,c=>{(c.marktype==="group"||r==null||r.includes(c.marktype))&&this.draw(t,c,n,r)}),n&&n.translate(s,o),t.restore(),a&&i.stroke&&u&&(H0(t,i,s,o),wp(t,i),xp(t,i,u)&&t.stroke())})}function $Ft(t,e,n,r,i,s){if(e.bounds&&!e.bounds.contains(i,s)||!e.items)return null;const o=n*t.pixelRatio,a=r*t.pixelRatio;return Nx(e,u=>{let c,l,f;const d=u.bounds;if(d&&!d.contains(i,s))return;l=u.x||0,f=u.y||0;const h=l+(u.width||0),p=f+(u.height||0),g=u.clip;if(g&&(i<l||i>h||s<f||s>p))return;if(t.save(),t.translate(l,f),l=i-l,f=s-f,g&&nN(u)&&!EFt(t,u,o,a))return t.restore(),null;const m=u.strokeForeground,y=e.interactive!==!1;return y&&m&&u.stroke&&SFt(t,u,o,a)?(t.restore(),u):(c=Nx(u,b=>TFt(b,l,f)?this.pick(b,n,r,l,f):null),!c&&y&&(u.fill||!m&&u.stroke)&&_Ft(t,u,o,a)&&(c=u),t.restore(),c||null)})}function TFt(t,e,n){return(t.interactive!==!1||t.marktype==="group")&&t.bounds&&t.bounds.contains(e,n)}var kFt={type:"group",tag:"g",nested:!1,attr:yFt,bound:xFt,draw:AFt,pick:$Ft,isect:ytt,content:wFt,background:bFt,foreground:vFt},X0={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function dN(t,e){var n=t.image;return(!n||t.url&&t.url!==n.url)&&(n={complete:!1,width:0,height:0},e.loadImage(t.url).then(r=>{t.image=r,t.image.url=t.url})),n}function hN(t,e){return t.width!=null?t.width:!e||!e.width?0:t.aspect!==!1&&t.height?t.height*e.width/e.height:e.width}function pN(t,e){return t.height!=null?t.height:!e||!e.height?0:t.aspect!==!1&&t.width?t.width*e.height/e.width:e.height}function pS(t,e){return t==="center"?e/2:t==="right"?e:0}function gS(t,e){return t==="middle"?e/2:t==="bottom"?e:0}function MFt(t,e,n){const r=dN(e,n),i=hN(e,r),s=pN(e,r),o=(e.x||0)-pS(e.align,i),a=(e.y||0)-gS(e.baseline,s),u=!r.src&&r.toDataURL?r.toDataURL():r.src||"";t("href",u,X0["xmlns:xlink"],"xlink:href"),t("transform",yf(o,a)),t("width",i),t("height",s),t("preserveAspectRatio",e.aspect===!1?"none":"xMidYMid")}function CFt(t,e){const n=e.image,r=hN(e,n),i=pN(e,n),s=(e.x||0)-pS(e.align,r),o=(e.y||0)-gS(e.baseline,i);return t.set(s,o,s+r,o+i)}function IFt(t,e,n){Hs(e,r=>{if(n&&!n.intersects(r.bounds))return;const i=dN(r,this);let s=hN(r,i),o=pN(r,i);if(s===0||o===0)return;let a=(r.x||0)-pS(r.align,s),u=(r.y||0)-gS(r.baseline,o),c,l,f,d;r.aspect!==!1&&(l=i.width/i.height,f=r.width/r.height,l===l&&f===f&&l!==f&&(f<l?(d=s/l,u+=(o-d)/2,o=d):(d=o*l,a+=(s-d)/2,s=d))),(i.complete||i.toDataURL)&&(wp(t,r),t.globalAlpha=(c=r.opacity)!=null?c:1,t.imageSmoothingEnabled=r.smooth!==!1,t.drawImage(i,a,u,s,o))})}var FFt={type:"image",tag:"image",nested:!1,attr:MFt,bound:CFt,draw:IFt,pick:hS(),isect:bs,get:dN,xOffset:pS,yOffset:gS},NFt=fN("line",QIt,hFt);function OFt(t,e){var n=e.scaleX||1,r=e.scaleY||1;(n!==1||r!==1)&&t("vector-effect","non-scaling-stroke"),t("transform",lFt(e)),t("d",e.path)}function xv(t,e){var n=e.path;if(n==null)return!0;var r=e.x||0,i=e.y||0,s=e.scaleX||1,o=e.scaleY||1,a=(e.angle||0)*Kc,u=e.pathCache;(!u||u.path!==n)&&((e.pathCache=u=vp(n)).path=n),a&&t.rotate&&t.translate?(t.translate(r,i),t.rotate(a),Y0(t,u,0,0,s,o),t.rotate(-a),t.translate(-r,-i)):Y0(t,u,r,i,s,o)}function RFt(t,e){return xv(i1(t,e.angle),e)?t.set(0,0,0,0):Ou(t,e,!0)}var DFt={type:"path",tag:"path",nested:!1,attr:OFt,bound:RFt,draw:aN(xv),pick:uN(xv),isect:iN(xv)};function LFt(t,e){t("d",bg(null,e))}function BFt(t,e){var n,r;return Ou(t.set(n=e.x||0,r=e.y||0,n+e.width||0,r+e.height||0),e)}function qL(t,e){t.beginPath(),bg(t,e)}var PFt={type:"rect",tag:"path",nested:!1,attr:LFt,bound:BFt,draw:aN(qL),pick:uN(qL),isect:ytt};function zFt(t,e){t("transform",xtt(e)),t("x2",e.x2!=null?e.x2-(e.x||0):0),t("y2",e.y2!=null?e.y2-(e.y||0):0)}function UFt(t,e){var n,r;return Ou(t.set(n=e.x||0,r=e.y||0,e.x2!=null?e.x2:n,e.y2!=null?e.y2:r),e)}function Att(t,e,n){var r,i,s,o;return e.stroke&&xp(t,e,n)?(r=e.x||0,i=e.y||0,s=e.x2!=null?e.x2:r,o=e.y2!=null?e.y2:i,t.beginPath(),t.moveTo(r,i),t.lineTo(s,o),!0):!1}function jFt(t,e,n){Hs(e,r=>{if(!(n&&!n.intersects(r.bounds))){var i=r.opacity==null?1:r.opacity;i&&Att(t,r,i)&&(wp(t,r),t.stroke())}})}function qFt(t,e,n,r){return t.isPointInStroke?Att(t,e,1)&&t.isPointInStroke(n,r):!1}var WFt={type:"rule",tag:"line",nested:!1,attr:zFt,bound:UFt,draw:jFt,pick:hS(qFt),isect:btt},VFt=lN("shape",JIt),GFt=lN("symbol",ZIt,sN);const WL=cJ();var Ci={height:ma,measureWidth:gN,estimateWidth:Ox,width:Ox,canvas:$tt};$tt(!0);function $tt(t){Ci.width=t&&Tc?gN:Ox}function Ox(t,e){return Ttt(Jc(t,e),ma(t))}function Ttt(t,e){return~~(.8*t.length*e)}function gN(t,e){return ma(t)<=0||!(e=Jc(t,e))?0:ktt(e,mS(t))}function ktt(t,e){const n=`(${e}) ${t}`;let r=WL.get(n);return r===void 0&&(Tc.font=e,r=Tc.measureText(t).width,WL.set(n,r)),r}function ma(t){return t.fontSize!=null?+t.fontSize||0:11}function Qc(t){return t.lineHeight!=null?t.lineHeight:ma(t)+2}function YFt(t){return W(t)?t.length>1?t:t[0]:t}function o1(t){return YFt(t.lineBreak&&t.text&&!W(t.text)?t.text.split(t.lineBreak):t.text)}function mN(t){const e=o1(t);return(W(e)?e.length-1:0)*Qc(t)}function Jc(t,e){const n=e==null?"":(e+"").trim();return t.limit>0&&n.length?XFt(t,n):n}function HFt(t){if(Ci.width===gN){const e=mS(t);return n=>ktt(n,e)}else if(Ci.width===Ox){const e=ma(t);return n=>Ttt(n,e)}else return e=>Ci.width(t,e)}function XFt(t,e){var n=+t.limit,r=HFt(t);if(r(e)<n)return e;var i=t.ellipsis||"",s=t.dir==="rtl",o=0,a=e.length,u;if(n-=r(i),s){for(;o<a;)u=o+a>>>1,r(e.slice(u))>n?o=u+1:a=u;return i+e.slice(o)}else{for(;o<a;)u=1+(o+a>>>1),r(e.slice(0,u))<n?o=u:a=u-1;return e.slice(0,o)+i}}function a1(t,e){var n=t.font;return(e&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function mS(t,e){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+ma(t)+"px "+a1(t,e)}function yN(t){var e=t.baseline,n=ma(t);return Math.round(e==="top"?.79*n:e==="middle"?.3*n:e==="bottom"?-.21*n:e==="line-top"?.29*n+.5*Qc(t):e==="line-bottom"?.29*n-.5*Qc(t):0)}const KFt={left:"start",center:"middle",right:"end"},e0=new gn;function yS(t){var e=t.x||0,n=t.y||0,r=t.radius||0,i;return r&&(i=(t.theta||0)-Xl,e+=r*Math.cos(i),n+=r*Math.sin(i)),e0.x1=e,e0.y1=n,e0}function QFt(t,e){var n=e.dx||0,r=(e.dy||0)+yN(e),i=yS(e),s=i.x1,o=i.y1,a=e.angle||0,u;t("text-anchor",KFt[e.align]||"start"),a?(u=yf(s,o)+" "+cN(a),(n||r)&&(u+=" "+yf(n,r))):u=yf(s+n,o+r),t("transform",u)}function bN(t,e,n){var r=Ci.height(e),i=e.align,s=yS(e),o=s.x1,a=s.y1,u=e.dx||0,c=(e.dy||0)+yN(e)-Math.round(.8*r),l=o1(e),f;if(W(l)?(r+=Qc(e)*(l.length-1),f=l.reduce((d,h)=>Math.max(d,Ci.width(e,h)),0)):f=Ci.width(e,l),i==="center"?u-=f/2:i==="right"&&(u-=f),t.set(u+=o,c+=a,u+f,c+r),e.angle&&!n)t.rotate(e.angle*Kc,o,a);else if(n===2)return t.rotatedPoints(e.angle*Kc,o,a);return t}function JFt(t,e,n){Hs(e,r=>{var i=r.opacity==null?1:r.opacity,s,o,a,u,c,l,f;if(!(n&&!n.intersects(r.bounds)||i===0||r.fontSize<=0||r.text==null||r.text.length===0)){if(t.font=mS(r),t.textAlign=r.align||"left",s=yS(r),o=s.x1,a=s.y1,r.angle&&(t.save(),t.translate(o,a),t.rotate(r.angle*Kc),o=a=0),o+=r.dx||0,a+=(r.dy||0)+yN(r),l=o1(r),wp(t,r),W(l))for(c=Qc(r),u=0;u<l.length;++u)f=Jc(r,l[u]),r.fill&&Fx(t,r,i)&&t.fillText(f,o,a),r.stroke&&xp(t,r,i)&&t.strokeText(f,o,a),a+=c;else f=Jc(r,l),r.fill&&Fx(t,r,i)&&t.fillText(f,o,a),r.stroke&&xp(t,r,i)&&t.strokeText(f,o,a);r.angle&&t.restore()}})}function ZFt(t,e,n,r,i,s){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var o=yS(e),a=o.x1,u=o.y1,c=bN(e0,e,1),l=-e.angle*Kc,f=Math.cos(l),d=Math.sin(l),h=f*i-d*s+(a-f*a+d*u),p=d*i+f*s+(u-d*a-f*u);return c.contains(h,p)}function t6t(t,e){const n=bN(e0,t,2);return bh(e,n[0],n[1],n[2],n[3])||bh(e,n[0],n[1],n[4],n[5])||bh(e,n[4],n[5],n[6],n[7])||bh(e,n[2],n[3],n[6],n[7])}var e6t={type:"text",tag:"text",nested:!1,attr:QFt,bound:bN,draw:JFt,pick:hS(ZFt),isect:t6t},n6t=fN("trail",tFt,pFt),Bi={arc:fFt,area:gFt,group:kFt,image:FFt,line:NFt,path:DFt,rect:PFt,rule:WFt,shape:VFt,symbol:GFt,text:e6t,trail:n6t};function fk(t,e,n){var r=Bi[t.mark.marktype],i=e||r.bound;return r.nested&&(t=t.mark),i(t.bounds||(t.bounds=new gn),t,n)}var VL={mark:null};function Mtt(t,e,n){var r=Bi[t.marktype],i=r.bound,s=t.items,o=s&&s.length,a,u,c,l;if(r.nested)return o?c=s[0]:(VL.mark=t,c=VL),l=fk(c,i,n),e=e&&e.union(l)||l,e;if(e=e||t.bounds&&t.bounds.clear()||new gn,o)for(a=0,u=s.length;a<u;++a)e.union(fk(s[a],i,n));return t.bounds=e}const r6t=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Ctt(t,e){return JSON.stringify(t,r6t,e)}function Itt(t){const e=typeof t=="string"?JSON.parse(t):t;return Ftt(e)}function Ftt(t){var e=t.marktype,n=t.items,r,i,s;if(n)for(i=0,s=n.length;i<s;++i)r=e?"mark":"group",n[i][r]=t,n[i].zindex&&(n[i][r].zdirty=!0),(e||r)==="group"&&Ftt(n[i]);return e&&Mtt(t),t}class Ntt{constructor(e){arguments.length?this.root=Itt(e):(this.root=GL({marktype:"group",name:"root",role:"frame"}),this.root.items=[new fS(this.root)])}toJSON(e){return Ctt(this.root,e||0)}mark(e,n,r){n=n||this.root.items[0];const i=GL(e,n);return n.items[r]=i,i.zindex&&(i.group.zdirty=!0),i}}function GL(t,e){const n={bounds:new gn,clip:!!t.clip,group:e,interactive:t.interactive!==!1,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0};return t.aria!=null&&(n.aria=t.aria),t.description&&(n.description=t.description),n}function gc(t,e,n){return!t&&typeof document<"u"&&document.createElement&&(t=document),t?n?t.createElementNS(n,e):t.createElement(e):null}function vN(t,e){e=e.toLowerCase();for(var n=t.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===e)return n[r]}function vn(t,e,n,r){var i=t.childNodes[e],s;return(!i||i.tagName.toLowerCase()!==n.toLowerCase())&&(s=i||null,i=gc(t.ownerDocument,n,r),t.insertBefore(i,s)),i}function Ki(t,e){for(var n=t.childNodes,r=n.length;r>e;)t.removeChild(n[--r]);return t}function Ott(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function bS(t,e){const n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]}function i6t(t,e,n,r){var i=t&&t.mark,s,o;if(i&&(s=Bi[i.marktype]).tip){for(o=bS(e,n),o[0]-=r[0],o[1]-=r[1];t=t.mark.group;)o[0]-=t.x||0,o[1]-=t.y||0;t=s.tip(i.items,o)}return t}let wN=class{constructor(e,n){this._active=null,this._handlers={},this._loader=e||Y_(),this._tooltip=n||s6t}initialize(e,n,r){return this._el=e,this._obj=r||null,this.origin(n)}element(){return this._el}canvas(){return this._el&&this._el.firstChild}origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()}scene(e){return arguments.length?(this._scene=e,this):this._scene}on(){}off(){}_handlerIndex(e,n,r){for(let i=e?e.length:0;--i>=0;)if(e[i].type===n&&(!r||e[i].handler===r))return i;return-1}handlers(e){const n=this._handlers,r=[];if(e)r.push(...n[this.eventName(e)]);else for(const i in n)r.push(...n[i]);return r}eventName(e){const n=e.indexOf(".");return n<0?e:e.slice(0,n)}handleHref(e,n,r){this._loader.sanitize(r,{context:"href"}).then(i=>{const s=new MouseEvent(e.type,e),o=gc(null,"a");for(const a in i)o.setAttribute(a,i[a]);o.dispatchEvent(s)}).catch(()=>{})}handleTooltip(e,n,r){if(n&&n.tooltip!=null){n=i6t(n,e,this.canvas(),this._origin);const i=r&&n&&n.tooltip||null;this._tooltip.call(this._obj,this,e,n,i)}}getItemBoundingClientRect(e){const n=this.canvas();if(!n)return;const r=n.getBoundingClientRect(),i=this._origin,s=e.bounds,o=s.width(),a=s.height();let u=s.x1+i[0]+r.left,c=s.y1+i[1]+r.top;for(;e.mark&&(e=e.mark.group);)u+=e.x||0,c+=e.y||0;return{x:u,y:c,width:o,height:a,left:u,top:c,right:u+o,bottom:c+a}}};function s6t(t,e,n,r){t.element().setAttribute("title",r||"")}class u1{constructor(e){this._el=null,this._bgcolor=null,this._loader=new mtt(e)}initialize(e,n,r,i,s){return this._el=e,this.resize(n,r,i,s)}element(){return this._el}canvas(){return this._el&&this._el.firstChild}background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)}resize(e,n,r,i){return this._width=e,this._height=n,this._origin=r||[0,0],this._scale=i||1,this}dirty(){}render(e,n){const r=this;return r._call=function(){r._render(e,n)},r._call(),r._call=null,r}_render(){}renderAsync(e,n){const r=this.render(e,n);return this._ready?this._ready.then(()=>r):Promise.resolve(r)}_load(e,n){var r=this,i=r._loader[e](n);if(!r._ready){const s=r._call;r._ready=r._loader.ready().then(o=>{o&&s(),r._ready=null})}return i}sanitizeURL(e){return this._load("sanitizeURL",e)}loadImage(e){return this._load("loadImage",e)}}const o6t="keydown",a6t="keypress",u6t="keyup",Rtt="dragenter",_v="dragleave",Dtt="dragover",dk="pointerdown",c6t="pointerup",Rx="pointermove",Sv="pointerout",Ltt="pointerover",hk="mousedown",l6t="mouseup",Btt="mousemove",Dx="mouseout",Ptt="mouseover",Lx="click",f6t="dblclick",d6t="wheel",ztt="mousewheel",Bx="touchstart",Px="touchmove",zx="touchend",h6t=[o6t,a6t,u6t,Rtt,_v,Dtt,dk,c6t,Rx,Sv,Ltt,hk,l6t,Btt,Dx,Ptt,Lx,f6t,d6t,ztt,Bx,Px,zx],pk=Rx,n0=Dx,gk=Lx;class c1 extends wN{constructor(e,n){super(e,n),this._down=null,this._touch=null,this._first=!0,this._events={},this.events=h6t,this.pointermove=HL([Rx,Btt],[Ltt,Ptt],[Sv,Dx]),this.dragover=HL([Dtt],[Rtt],[_v]),this.pointerout=XL([Sv,Dx]),this.dragleave=XL([_v])}initialize(e,n,r){return this._canvas=e&&vN(e,"canvas"),[Lx,hk,dk,Rx,Sv,_v].forEach(i=>YL(this,i)),super.initialize(e,n,r)}canvas(){return this._canvas}context(){return this._canvas.getContext("2d")}DOMMouseScroll(e){this.fire(ztt,e)}pointerdown(e){this._down=this._active,this.fire(dk,e)}mousedown(e){this._down=this._active,this.fire(hk,e)}click(e){this._down===this._active&&(this.fire(Lx,e),this._down=null)}touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(Bx,e,!0)}touchmove(e){this.fire(Px,e,!0)}touchend(e){this.fire(zx,e,!0),this._touch=null}fire(e,n,r){const i=r?this._touch:this._active,s=this._handlers[e];if(n.vegaType=e,e===gk&&i&&i.href?this.handleHref(n,i,i.href):(e===pk||e===n0)&&this.handleTooltip(n,i,e!==n0),s)for(let o=0,a=s.length;o<a;++o)s[o].handler.call(this._obj,n,i)}on(e,n){const r=this.eventName(e),i=this._handlers;return this._handlerIndex(i[r],e,n)<0&&(YL(this,e),(i[r]||(i[r]=[])).push({type:e,handler:n})),this}off(e,n){const r=this.eventName(e),i=this._handlers[r],s=this._handlerIndex(i,e,n);return s>=0&&i.splice(s,1),this}pickEvent(e){const n=bS(e,this._canvas),r=this._origin;return this.pick(this._scene,n[0],n[1],n[0]-r[0],n[1]-r[1])}pick(e,n,r,i,s){const o=this.context();return Bi[e.marktype].pick.call(this,o,e,n,r,i,s)}}const p6t=t=>t===Bx||t===Px||t===zx?[Bx,Px,zx]:[t];function YL(t,e){p6t(e).forEach(n=>g6t(t,n))}function g6t(t,e){const n=t.canvas();n&&!t._events[e]&&(t._events[e]=1,n.addEventListener(e,t[e]?r=>t[e](r):r=>t.fire(e,r)))}function Lm(t,e,n){e.forEach(r=>t.fire(r,n))}function HL(t,e,n){return function(r){const i=this._active,s=this.pickEvent(r);s===i?Lm(this,t,r):((!i||!i.exit)&&Lm(this,n,r),this._active=s,Lm(this,e,r),Lm(this,t,r))}}function XL(t){return function(e){Lm(this,t,e),this._active=null}}function m6t(){return typeof window<"u"&&window.devicePixelRatio||1}function y6t(t,e,n,r,i,s){const o=typeof HTMLElement<"u"&&t instanceof HTMLElement&&t.parentNode!=null,a=t.getContext("2d"),u=o?m6t():i;t.width=e*u,t.height=n*u;for(const c in s)a[c]=s[c];return o&&u!==1&&(t.style.width=e+"px",t.style.height=n+"px"),a.pixelRatio=u,a.setTransform(u,0,0,u,u*r[0],u*r[1]),t}class Ux extends u1{constructor(e){super(e),this._options={},this._redraw=!1,this._dirty=new gn,this._tempb=new gn}initialize(e,n,r,i,s,o){return this._options=o||{},this._canvas=this._options.externalContext?null:$c(1,1,this._options.type),e&&this._canvas&&(Ki(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),super.initialize(e,n,r,i,s)}resize(e,n,r,i){if(super.resize(e,n,r,i),this._canvas)y6t(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const s=this._options.externalContext;s||j("CanvasRenderer is missing a valid canvas or context"),s.scale(this._scale,this._scale),s.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this}canvas(){return this._canvas}context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)}dirty(e){const n=this._tempb.clear().union(e.bounds);let r=e.mark.group;for(;r;)n.translate(r.x||0,r.y||0),r=r.mark.group;this._dirty.union(n)}_render(e,n){const r=this.context(),i=this._origin,s=this._width,o=this._height,a=this._dirty,u=b6t(i,s,o);r.save();const c=this._redraw||a.empty()?(this._redraw=!1,u.expand(1)):v6t(r,u.intersect(a),i);return this.clear(-i[0],-i[1],s,o),this.draw(r,e,c,n),r.restore(),a.clear(),this}draw(e,n,r,i){if(n.marktype!=="group"&&i!=null&&!i.includes(n.marktype))return;const s=Bi[n.marktype];n.clip&&mFt(e,n),s.draw.call(this,e,n,r,i),n.clip&&e.restore()}clear(e,n,r,i){const s=this._options,o=this.context();s.type!=="pdf"&&!s.externalContext&&o.clearRect(e,n,r,i),this._bgcolor!=null&&(o.fillStyle=this._bgcolor,o.fillRect(e,n,r,i))}}const b6t=(t,e,n)=>new gn().set(0,0,e,n).translate(-t[0],-t[1]);function v6t(t,e,n){return e.expand(1).round(),t.pixelRatio%1&&e.scale(t.pixelRatio).round().scale(1/t.pixelRatio),e.translate(-(n[0]%1),-(n[1]%1)),t.beginPath(),t.rect(e.x1,e.y1,e.width(),e.height()),t.clip(),e}class Utt extends wN{constructor(e,n){super(e,n);const r=this;r._hrefHandler=e$(r,(i,s)=>{s&&s.href&&r.handleHref(i,s,s.href)}),r._tooltipHandler=e$(r,(i,s)=>{r.handleTooltip(i,s,i.type!==n0)})}initialize(e,n,r){let i=this._svg;return i&&(i.removeEventListener(gk,this._hrefHandler),i.removeEventListener(pk,this._tooltipHandler),i.removeEventListener(n0,this._tooltipHandler)),this._svg=i=e&&vN(e,"svg"),i&&(i.addEventListener(gk,this._hrefHandler),i.addEventListener(pk,this._tooltipHandler),i.addEventListener(n0,this._tooltipHandler)),super.initialize(e,n,r)}canvas(){return this._svg}on(e,n){const r=this.eventName(e),i=this._handlers;if(this._handlerIndex(i[r],e,n)<0){const o={type:e,handler:n,listener:e$(this,n)};(i[r]||(i[r]=[])).push(o),this._svg&&this._svg.addEventListener(r,o.listener)}return this}off(e,n){const r=this.eventName(e),i=this._handlers[r],s=this._handlerIndex(i,e,n);return s>=0&&(this._svg&&this._svg.removeEventListener(r,i[s].listener),i.splice(s,1)),this}}const e$=(t,e)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,e.call(t._obj,n,r)},jtt="aria-hidden",xN="aria-label",_N="role",SN="aria-roledescription",qtt="graphics-object",EN="graphics-symbol",Wtt=(t,e,n)=>({[_N]:t,[SN]:e,[xN]:n||void 0}),w6t=Gs(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),KL={axis:{desc:"axis",caption:S6t},legend:{desc:"legend",caption:E6t},"title-text":{desc:"title",caption:t=>`Title text '${JL(t)}'`},"title-subtitle":{desc:"subtitle",caption:t=>`Subtitle text '${JL(t)}'`}},QL={ariaRole:_N,ariaRoleDescription:SN,description:xN};function Vtt(t,e){const n=e.aria===!1;if(t(jtt,n||void 0),n||e.description==null)for(const r in QL)t(QL[r],void 0);else{const r=e.mark.marktype;t(xN,e.description),t(_N,e.ariaRole||(r==="group"?qtt:EN)),t(SN,e.ariaRoleDescription||`${r} mark`)}}function Gtt(t){return t.aria===!1?{[jtt]:!0}:w6t[t.role]?null:KL[t.role]?_6t(t,KL[t.role]):x6t(t)}function x6t(t){const e=t.marktype,n=e==="group"||e==="text"||t.items.some(r=>r.description!=null&&r.aria!==!1);return Wtt(n?qtt:EN,`${e} mark container`,t.description)}function _6t(t,e){try{const n=t.items[0],r=e.caption||(()=>"");return Wtt(e.role||EN,e.desc,n.description||r(n))}catch{return null}}function JL(t){return ot(t.text).join(" ")}function S6t(t){const e=t.datum,n=t.orient,r=e.title?Ytt(t):null,i=t.context,s=i.scales[e.scale].value,o=i.dataflow.locale(),a=s.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(r?` titled '${r}'`:"")+` for a ${bp(a)?"discrete":a} scale with ${ott(o,s,t)}`}function E6t(t){const e=t.datum,n=e.title?Ytt(t):null,r=`${e.type||""} legend`.trim(),i=e.scales,s=Object.keys(i),o=t.context,a=o.scales[i[s[0]]].value,u=o.dataflow.locale();return $6t(r)+(n?` titled '${n}'`:"")+` for ${A6t(s)} with ${ott(u,a,t)}`}function Ytt(t){try{return ot(te(t.items).items[0].text).join(" ")}catch{return null}}function A6t(t){return t=t.map(e=>e+(e==="fill"||e==="stroke"?" color":"")),t.length<2?t[0]:t.slice(0,-1).join(", ")+" and "+te(t)}function $6t(t){return t.length?t[0].toUpperCase()+t.slice(1):t}const Htt=t=>(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),T6t=t=>Htt(t).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function AN(){let t="",e="",n="";const r=[],i=()=>e=n="",s=u=>{e&&(t+=`${e}>${n}`,i()),r.push(u)},o=(u,c)=>(c!=null&&(e+=` ${u}="${T6t(c)}"`),a),a={open(u){s(u),e="<"+u;for(var c=arguments.length,l=new Array(c>1?c-1:0),f=1;f<c;f++)l[f-1]=arguments[f];for(const d of l)for(const h in d)o(h,d[h]);return a},close(){const u=r.pop();return e?t+=e+(n?`>${n}</${u}>`:"/>"):t+=`</${u}>`,i(),a},attr:o,text:u=>(n+=Htt(u),a),toString:()=>t};return a}const Xtt=t=>Ktt(AN(),t)+"";function Ktt(t,e){if(t.open(e.tagName),e.hasAttributes()){const n=e.attributes,r=n.length;for(let i=0;i<r;++i)t.attr(n[i].name,n[i].value)}if(e.hasChildNodes()){const n=e.childNodes;for(const r of n)r.nodeType===3?t.text(r.nodeValue):Ktt(t,r)}return t.close()}const jx={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},qx={blend:"mix-blend-mode"},Qtt={fill:"none","stroke-miterlimit":10},Kg=0,ZL="http://www.w3.org/2000/xmlns/",bn=X0.xmlns;class $N extends u1{constructor(e){super(e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}initialize(e,n,r,i,s){return this._defs={},this._clearDefs(),e&&(this._svg=vn(e,0,"svg",bn),this._svg.setAttributeNS(ZL,"xmlns",bn),this._svg.setAttributeNS(ZL,"xmlns:xlink",X0["xmlns:xlink"]),this._svg.setAttribute("version",X0.version),this._svg.setAttribute("class","marks"),Ki(e,1),this._root=vn(this._svg,Kg,"g",bn),mc(this._root,Qtt),Ki(this._svg,Kg+1)),this.background(this._bgcolor),super.initialize(e,n,r,i,s)}background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),super.background(...arguments)}resize(e,n,r,i){return super.resize(e,n,r,i),this._svg&&(mc(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this}canvas(){return this._svg}svg(){const e=this._svg,n=this._bgcolor;if(!e)return null;let r;n&&(e.removeAttribute("style"),r=vn(e,Kg,"rect",bn),mc(r,{width:this._width,height:this._height,fill:n}));const i=Xtt(e);return n&&(e.removeChild(r),this._svg.style.setProperty("background-color",n)),i}_render(e,n){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e,void 0,n),Ki(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this}dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))}isDirty(e){return this._dirtyAll||!e._svg||!e._svg.ownerSVGElement||e.dirty===this._dirtyID}_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const n=++this._dirtyID;let r,i,s,o,a,u,c;for(a=0,u=e.length;a<u;++a)if(r=e[a],i=r.mark,i.marktype!==s&&(s=i.marktype,o=Bi[s]),i.zdirty&&i.dirty!==n&&(this._dirtyAll=!1,t7(r,n),i.items.forEach(l=>{l.dirty=n})),!i.zdirty){if(r.exit){o.nested&&i.items.length?(c=i.items[0],c._svg&&this._update(o,c._svg,c)):r._svg&&(c=r._svg.parentNode,c&&c.removeChild(r._svg)),r._svg=null;continue}r=o.nested?i.items[0]:r,r._update!==n&&(!r._svg||!r._svg.ownerSVGElement?(this._dirtyAll=!1,t7(r,n)):this._update(o,r._svg,r),r._update=n)}return!this._dirtyAll}mark(e,n,r,i){if(!this.isDirty(n))return n._svg;const s=this._svg,o=n.marktype,a=Bi[o],u=n.interactive===!1?"none":null,c=a.tag==="g",l=e7(n,e,r,"g",s);if(o!=="group"&&i!=null&&!i.includes(o))return Ki(l,0),n._svg;l.setAttribute("class",Ott(n));const f=Gtt(n);for(const g in f)kr(l,g,f[g]);c||kr(l,"pointer-events",u),kr(l,"clip-path",n.clip?rN(this,n,n.group):null);let d=null,h=0;const p=g=>{const m=this.isDirty(g),y=e7(g,l,d,a.tag,s);m&&(this._update(a,y,g),c&&C6t(this,y,g,i)),d=y,++h};return a.nested?n.items.length&&p(n.items[0]):Hs(n,p),Ki(l,h),l}_update(e,n,r){eu=n,lr=n.__values__,Vtt(r0,r),e.attr(r0,r,this);const i=F6t[e.type];i&&i.call(this,e,n,r),eu&&this.style(eu,r)}style(e,n){if(n!=null){for(const r in jx){let i=r==="font"?a1(n):n[r];if(i===lr[r])continue;const s=jx[r];i==null?e.removeAttribute(s):(tN(i)&&(i=utt(i,this._defs.gradient,Jtt())),e.setAttribute(s,i+"")),lr[r]=i}for(const r in qx)Ev(e,qx[r],n[r])}}defs(){const e=this._svg,n=this._defs;let r=n.el,i=0;for(const s in n.gradient)r||(n.el=r=vn(e,Kg+1,"defs",bn)),i=k6t(r,n.gradient[s],i);for(const s in n.clipping)r||(n.el=r=vn(e,Kg+1,"defs",bn)),i=M6t(r,n.clipping[s],i);r&&(i===0?(e.removeChild(r),n.el=null):Ki(r,i))}_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}}function t7(t,e){for(;t&&t.dirty!==e;t=t.mark.group)if(t.dirty=e,t.mark&&t.mark.dirty!==e)t.mark.dirty=e;else return}function k6t(t,e,n){let r,i,s;if(e.gradient==="radial"){let o=vn(t,n++,"pattern",bn);mc(o,{id:Ix+e.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),o=vn(o,0,"rect",bn),mc(o,{width:1,height:1,fill:`url(${Jtt()}#${e.id})`}),t=vn(t,n++,"radialGradient",bn),mc(t,{id:e.id,fx:e.x1,fy:e.y1,fr:e.r1,cx:e.x2,cy:e.y2,r:e.r2})}else t=vn(t,n++,"linearGradient",bn),mc(t,{id:e.id,x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2});for(r=0,i=e.stops.length;r<i;++r)s=vn(t,r,"stop",bn),s.setAttribute("offset",e.stops[r].offset),s.setAttribute("stop-color",e.stops[r].color);return Ki(t,r),n}function M6t(t,e,n){let r;return t=vn(t,n,"clipPath",bn),t.setAttribute("id",e.id),e.path?(r=vn(t,0,"path",bn),r.setAttribute("d",e.path)):(r=vn(t,0,"rect",bn),mc(r,{x:0,y:0,width:e.width,height:e.height})),Ki(t,1),n+1}function C6t(t,e,n,r){e=e.lastChild.previousSibling;let i,s=0;Hs(n,o=>{i=t.mark(e,o,i,r),++s}),Ki(e,1+s)}function e7(t,e,n,r,i){let s=t._svg,o;if(!s&&(o=e.ownerDocument,s=gc(o,r,bn),t._svg=s,t.mark&&(s.__data__=t,s.__values__={fill:"default"},r==="g"))){const a=gc(o,"path",bn);s.appendChild(a),a.__data__=t;const u=gc(o,"g",bn);s.appendChild(u),u.__data__=t;const c=gc(o,"path",bn);s.appendChild(c),c.__data__=t,c.__values__={fill:"default"}}return(s.ownerSVGElement!==i||I6t(s,n))&&e.insertBefore(s,n?n.nextSibling:e.firstChild),s}function I6t(t,e){return t.parentNode&&t.parentNode.childNodes.length>1&&t.previousSibling!=e}let eu=null,lr=null;const F6t={group(t,e,n){const r=eu=e.childNodes[2];lr=r.__values__,t.foreground(r0,n,this),lr=e.__values__,eu=e.childNodes[1],t.content(r0,n,this);const i=eu=e.childNodes[0];t.background(r0,n,this);const s=n.mark.interactive===!1?"none":null;if(s!==lr.events&&(kr(r,"pointer-events",s),kr(i,"pointer-events",s),lr.events=s),n.strokeForeground&&n.stroke){const o=n.fill;kr(r,"display",null),this.style(i,n),kr(i,"stroke",null),o&&(n.fill=null),lr=r.__values__,this.style(r,n),o&&(n.fill=o),eu=null}else kr(r,"display","none")},image(t,e,n){n.smooth===!1?(Ev(e,"image-rendering","optimizeSpeed"),Ev(e,"image-rendering","pixelated")):Ev(e,"image-rendering",null)},text(t,e,n){const r=o1(n);let i,s,o,a;W(r)?(s=r.map(u=>Jc(n,u)),i=s.join(`
`),i!==lr.text&&(Ki(e,0),o=e.ownerDocument,a=Qc(n),s.forEach((u,c)=>{const l=gc(o,"tspan",bn);l.__data__=n,l.textContent=u,c&&(l.setAttribute("x",0),l.setAttribute("dy",a)),e.appendChild(l)}),lr.text=i)):(s=Jc(n,r),s!==lr.text&&(e.textContent=s,lr.text=s)),kr(e,"font-family",a1(n)),kr(e,"font-size",ma(n)+"px"),kr(e,"font-style",n.fontStyle),kr(e,"font-variant",n.fontVariant),kr(e,"font-weight",n.fontWeight)}};function r0(t,e,n){e!==lr[t]&&(n?N6t(eu,t,e,n):kr(eu,t,e),lr[t]=e)}function Ev(t,e,n){n!==lr[e]&&(n==null?t.style.removeProperty(e):t.style.setProperty(e,n+""),lr[e]=n)}function mc(t,e){for(const n in e)kr(t,n,e[n])}function kr(t,e,n){n!=null?t.setAttribute(e,n):t.removeAttribute(e)}function N6t(t,e,n,r){n!=null?t.setAttributeNS(r,e,n):t.removeAttributeNS(r,e)}function Jtt(){let t;return typeof window>"u"?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}class Ztt extends u1{constructor(e){super(e),this._text=null,this._defs={gradient:{},clipping:{}}}svg(){return this._text}_render(e){const n=AN();n.open("svg",Pt({},X0,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const r=this._bgcolor;return r&&r!=="transparent"&&r!=="none"&&n.open("rect",{width:this._width,height:this._height,fill:r}).close(),n.open("g",Qtt,{transform:"translate("+this._origin+")"}),this.mark(n,e),n.close(),this.defs(n),this._text=n.close()+"",this}mark(e,n){const r=Bi[n.marktype],i=r.tag,s=[Vtt,r.attr];e.open("g",{class:Ott(n),"clip-path":n.clip?rN(this,n,n.group):null},Gtt(n),{"pointer-events":i!=="g"&&n.interactive===!1?"none":null});const o=a=>{const u=this.href(a);if(u&&e.open("a",u),e.open(i,this.attr(n,a,s,i!=="g"?i:null)),i==="text"){const c=o1(a);if(W(c)){const l={x:0,dy:Qc(a)};for(let f=0;f<c.length;++f)e.open("tspan",f?l:null).text(Jc(a,c[f])).close()}else e.text(Jc(a,c))}else if(i==="g"){const c=a.strokeForeground,l=a.fill,f=a.stroke;c&&f&&(a.stroke=null),e.open("path",this.attr(n,a,r.background,"bgrect")).close(),e.open("g",this.attr(n,a,r.content)),Hs(a,d=>this.mark(e,d)),e.close(),c&&f?(l&&(a.fill=null),a.stroke=f,e.open("path",this.attr(n,a,r.foreground,"bgrect")).close(),l&&(a.fill=l)):e.open("path",this.attr(n,a,r.foreground,"bgfore")).close()}e.close(),u&&e.close()};return r.nested?n.items&&n.items.length&&o(n.items[0]):Hs(n,o),e.close()}href(e){const n=e.href;let r;if(n){if(r=this._hrefs&&this._hrefs[n])return r;this.sanitizeURL(n).then(i=>{i["xlink:href"]=i.href,i.href=null,(this._hrefs||(this._hrefs={}))[n]=i})}return null}attr(e,n,r,i){const s={},o=(a,u,c,l)=>{s[l||a]=u};return Array.isArray(r)?r.forEach(a=>a(o,n,this)):r(o,n,this),i&&O6t(s,n,e,i,this._defs),s}defs(e){const n=this._defs.gradient,r=this._defs.clipping;if(Object.keys(n).length+Object.keys(r).length!==0){e.open("defs");for(const s in n){const o=n[s],a=o.stops;o.gradient==="radial"?(e.open("pattern",{id:Ix+s,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+s+")"}).close(),e.close(),e.open("radialGradient",{id:s,fx:o.x1,fy:o.y1,fr:o.r1,cx:o.x2,cy:o.y2,r:o.r2})):e.open("linearGradient",{id:s,x1:o.x1,x2:o.x2,y1:o.y1,y2:o.y2});for(let u=0;u<a.length;++u)e.open("stop",{offset:a[u].offset,"stop-color":a[u].color}).close();e.close()}for(const s in r){const o=r[s];e.open("clipPath",{id:s}),o.path?e.open("path",{d:o.path}).close():e.open("rect",{x:0,y:0,width:o.width,height:o.height}).close(),e.close()}e.close()}}}function O6t(t,e,n,r,i){let s;if(e==null||(r==="bgrect"&&n.interactive===!1&&(t["pointer-events"]="none"),r==="bgfore"&&(n.interactive===!1&&(t["pointer-events"]="none"),t.display="none",e.fill!==null)))return t;r==="image"&&e.smooth===!1&&(s=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]),r==="text"&&(t["font-family"]=a1(e),t["font-size"]=ma(e)+"px",t["font-style"]=e.fontStyle,t["font-variant"]=e.fontVariant,t["font-weight"]=e.fontWeight);for(const o in jx){let a=e[o];const u=jx[o];a==="transparent"&&(u==="fill"||u==="stroke")||a!=null&&(tN(a)&&(a=utt(a,i.gradient,"")),t[u]=a)}for(const o in qx){const a=e[o];a!=null&&(s=s||[],s.push(`${qx[o]}: ${a};`))}return s&&(t.style=s.join(" ")),t}const Fs={svgMarkTypes:["text"],svgOnTop:!0,debug:!1};function R6t(t){Fs.svgMarkTypes=t.svgMarkTypes??["text"],Fs.svgOnTop=t.svgOnTop??!0,Fs.debug=t.debug??!1}class mk extends u1{constructor(e){super(e),this._svgRenderer=new $N(e),this._canvasRenderer=new Ux(e)}initialize(e,n,r,i,s){this._root_el=vn(e,0,"div");const o=vn(this._root_el,0,"div"),a=vn(this._root_el,1,"div");return this._root_el.style.position="relative",Fs.debug||(o.style.height="100%",a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.height="100%",a.style.width="100%"),this._svgEl=Fs.svgOnTop?a:o,this._canvasEl=Fs.svgOnTop?o:a,this._svgEl.style.pointerEvents="none",this._canvasRenderer.initialize(this._canvasEl,n,r,i,s),this._svgRenderer.initialize(this._svgEl,n,r,i,s),super.initialize(e,n,r,i,s)}dirty(e){return Fs.svgMarkTypes.includes(e.mark.marktype)?this._svgRenderer.dirty(e):this._canvasRenderer.dirty(e),this}_render(e,n){const i=(n??["arc","area","image","line","path","rect","rule","shape","symbol","text","trail"]).filter(s=>!Fs.svgMarkTypes.includes(s));this._svgRenderer.render(e,Fs.svgMarkTypes),this._canvasRenderer.render(e,i)}resize(e,n,r,i){return super.resize(e,n,r,i),this._svgRenderer.resize(e,n,r,i),this._canvasRenderer.resize(e,n,r,i),this}background(e){return Fs.svgOnTop?this._canvasRenderer.background(e):this._svgRenderer.background(e),this}}class tet extends c1{constructor(e,n){super(e,n)}initialize(e,n,r){const i=vn(vn(e,0,"div"),Fs.svgOnTop?0:1,"div");return super.initialize(i,n,r)}}const eet="canvas",D6t="hybrid",net="png",ret="svg",L6t="none",yc={Canvas:eet,PNG:net,SVG:ret},Uf={};Uf[eet]=Uf[net]={renderer:Ux,headless:Ux,handler:c1};Uf[ret]={renderer:$N,headless:Ztt,handler:Utt};Uf[D6t]={renderer:mk,headless:mk,handler:tet};Uf[L6t]={};function vS(t,e){return t=String(t||"").toLowerCase(),arguments.length>1?(Uf[t]=e,this):Uf[t]}function iet(t,e,n){const r=[],i=new gn().union(e),s=t.marktype;return s?set(t,i,n,r):s==="group"?oet(t,i,n,r):j("Intersect scene must be mark node or group item.")}function set(t,e,n,r){if(B6t(t,e,n)){const i=t.items,s=t.marktype,o=i.length;let a=0;if(s==="group")for(;a<o;++a)oet(i[a],e,n,r);else for(const u=Bi[s].isect;a<o;++a){const c=i[a];aet(c,e,u)&&r.push(c)}}return r}function B6t(t,e,n){return t.bounds&&e.intersects(t.bounds)&&(t.marktype==="group"||t.interactive!==!1&&(!n||n(t)))}function oet(t,e,n,r){n&&n(t.mark)&&aet(t,e,Bi.group.isect)&&r.push(t);const i=t.items,s=i&&i.length;if(s){const o=t.x||0,a=t.y||0;e.translate(-o,-a);for(let u=0;u<s;++u)set(i[u],e,n,r);e.translate(o,a)}return r}function aet(t,e,n){const r=t.bounds;return e.encloses(r)||e.intersects(r)&&n(t,e)}const n$=new gn;function uet(t){const e=t.clip;if(jt(e))e(i1(n$.clear()));else if(e)n$.set(0,0,t.group.width,t.group.height);else return;t.bounds.intersect(n$)}const P6t=1e-9;function TN(t,e,n){return t===e?!0:n==="path"?cet(t,e):t instanceof Date&&e instanceof Date?+t==+e:ue(t)&&ue(e)?Math.abs(t-e)<=P6t:!t||!e||!st(t)&&!st(e)?t==e:z6t(t,e)}function cet(t,e){return TN(vp(t),vp(e))}function z6t(t,e){var n=Object.keys(t),r=Object.keys(e),i,s;if(n.length!==r.length)return!1;for(n.sort(),r.sort(),s=n.length-1;s>=0;s--)if(n[s]!=r[s])return!1;for(s=n.length-1;s>=0;s--)if(i=n[s],!TN(t[i],e[i],i))return!1;return typeof t==typeof e}function U6t(){gtt(),cIt()}const _p="top",Ds="left",Bs="right",Zc="bottom",j6t="top-left",q6t="top-right",W6t="bottom-left",V6t="bottom-right",kN="start",yk="middle",Mr="end",G6t="x",Y6t="y",wS="group",MN="axis",CN="title",H6t="frame",X6t="scope",IN="legend",fet="row-header",det="row-footer",het="row-title",pet="column-header",get="column-footer",met="column-title",K6t="padding",Q6t="symbol",yet="fit",bet="fit-x",vet="fit-y",J6t="pad",FN="none",xb="all",bk="each",NN="flush",bc="column",vc="row";function wet(t){z.call(this,null,t)}tt(wet,z,{transform(t,e){const n=e.dataflow,r=t.mark,i=r.marktype,s=Bi[i],o=s.bound;let a=r.bounds,u;if(s.nested)r.items.length&&n.dirty(r.items[0]),a=_b(r,o),r.items.forEach(c=>{c.bounds.clear().union(a)});else if(i===wS||t.modified())switch(e.visit(e.MOD,c=>n.dirty(c)),a.clear(),r.items.forEach(c=>a.union(_b(c,o))),r.role){case MN:case IN:case CN:e.reflow()}else u=e.changed(e.REM),e.visit(e.ADD,c=>{a.union(_b(c,o))}),e.visit(e.MOD,c=>{u=u||a.alignsWith(c.bounds),n.dirty(c),a.union(_b(c,o))}),u&&(a.clear(),r.items.forEach(c=>a.union(c.bounds)));return uet(r),e.modifies("bounds")}});function _b(t,e,n){return e(t.bounds.clear(),t,n)}const n7=":vega_identifier:";function ON(t){z.call(this,0,t)}ON.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};tt(ON,z,{transform(t,e){const n=Z6t(e.dataflow),r=t.as;let i=n.value;return e.visit(e.ADD,s=>s[r]=s[r]||++i),n.set(this.value=i),e}});function Z6t(t){return t._signals[n7]||(t._signals[n7]=t.add(0))}function xet(t){z.call(this,null,t)}tt(xet,z,{transform(t,e){let n=this.value;n||(n=e.dataflow.scenegraph().mark(t.markdef,tNt(t),t.index),n.group.context=t.context,t.context.group||(t.context.group=n.group),n.source=this.source,n.clip=t.clip,n.interactive=t.interactive,this.value=n);const r=n.marktype===wS?fS:lS;return e.visit(e.ADD,i=>r.call(i,n)),(t.modified("clip")||t.modified("interactive"))&&(n.clip=t.clip,n.interactive=!!t.interactive,n.zdirty=!0,e.reflow()),n.items=e.source,e}});function tNt(t){const e=t.groups,n=t.parent;return e&&e.size===1?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}function _et(t){z.call(this,null,t)}const r7={parity:t=>t.filter((e,n)=>n%2?e.opacity=0:1),greedy:(t,e)=>{let n;return t.filter((r,i)=>!i||!Eet(n.bounds,r.bounds,e)?(n=r,1):r.opacity=0)}},Eet=(t,e,n)=>n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2),i7=(t,e)=>{for(var n=1,r=t.length,i=t[0].bounds,s;n<r;i=s,++n)if(Eet(i,s=t[n].bounds,e))return!0},eNt=t=>{const e=t.bounds;return e.width()>1&&e.height()>1},nNt=(t,e,n)=>{var r=t.range(),i=new gn;return e===_p||e===Zc?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),s=>i.encloses(s.bounds)},s7=t=>(t.forEach(e=>e.opacity=1),t),o7=(t,e)=>t.reflow(e.modified()).modifies("opacity");tt(_et,z,{transform(t,e){const n=r7[t.method]||r7.parity,r=t.separation||0;let i=e.materialize(e.SOURCE).source,s,o;if(!i||!i.length)return;if(!t.method)return t.modified("method")&&(s7(i),e=o7(e,t)),e;if(i=i.filter(eNt),!i.length)return;if(t.sort&&(i=i.slice().sort(t.sort)),s=s7(i),e=o7(e,t),s.length>=3&&i7(s,r)){do s=n(s,r);while(s.length>=3&&i7(s,r));s.length<3&&!te(i).opacity&&(s.length>1&&(te(s).opacity=0),te(i).opacity=1)}t.boundScale&&t.boundTolerance>=0&&(o=nNt(t.boundScale,t.boundOrient,+t.boundTolerance),i.forEach(u=>{o(u)||(u.opacity=0)}));const a=s[0].mark.bounds.clear();return i.forEach(u=>{u.opacity&&a.union(u.bounds)}),e}});function Aet(t){z.call(this,null,t)}tt(Aet,z,{transform(t,e){const n=e.dataflow;if(e.visit(e.ALL,r=>n.dirty(r)),e.fields&&e.fields.zindex){const r=e.source&&e.source[0];r&&(r.mark.zdirty=!0)}}});const cr=new gn;function vh(t,e,n){return t[e]===n?0:(t[e]=n,1)}function rNt(t){var e=t.items[0].orient;return e===Ds||e===Bs}function iNt(t){let e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}function sNt(t,e,n,r){var i=e.items[0],s=i.datum,o=i.translate!=null?i.translate:.5,a=i.orient,u=iNt(s),c=i.range,l=i.offset,f=i.position,d=i.minExtent,h=i.maxExtent,p=s.title&&i.items[u[2]].items[0],g=i.titlePadding,m=i.bounds,y=p&&mN(p),b=0,w=0,v,x;switch(cr.clear().union(m),m.clear(),(v=u[0])>-1&&m.union(i.items[v].bounds),(v=u[1])>-1&&m.union(i.items[v].bounds),a){case _p:b=f||0,w=-l,x=Math.max(d,Math.min(h,-m.y1)),m.add(0,-x).add(c,0),p&&Sb(t,p,x,g,y,0,-1,m);break;case Ds:b=-l,w=f||0,x=Math.max(d,Math.min(h,-m.x1)),m.add(-x,0).add(0,c),p&&Sb(t,p,x,g,y,1,-1,m);break;case Bs:b=n+l,w=f||0,x=Math.max(d,Math.min(h,m.x2)),m.add(0,0).add(x,c),p&&Sb(t,p,x,g,y,1,1,m);break;case Zc:b=f||0,w=r+l,x=Math.max(d,Math.min(h,m.y2)),m.add(0,0).add(c,x),p&&Sb(t,p,x,g,0,0,1,m);break;default:b=i.x,w=i.y}return Ou(m.translate(b,w),i),vh(i,"x",b+o)|vh(i,"y",w+o)&&(i.bounds=cr,t.dirty(i),i.bounds=m,t.dirty(i)),i.mark.bounds.clear().union(m)}function Sb(t,e,n,r,i,s,o,a){const u=e.bounds;if(e.auto){const c=o*(n+i+r);let l=0,f=0;t.dirty(e),s?l=(e.x||0)-(e.x=c):f=(e.y||0)-(e.y=c),e.mark.bounds.clear().union(u.translate(-l,-f)),t.dirty(e)}a.union(u)}const a7=(t,e)=>Math.floor(Math.min(t,e)),u7=(t,e)=>Math.ceil(Math.max(t,e));function oNt(t){var e=t.items,n=e.length,r=0,i,s;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;r<n;++r)if(i=e[r],s=i.items,i.marktype===wS)switch(i.role){case MN:case IN:case CN:break;case fet:o.rowheaders.push(...s);break;case det:o.rowfooters.push(...s);break;case pet:o.colheaders.push(...s);break;case get:o.colfooters.push(...s);break;case het:o.rowtitle=s[0];break;case met:o.coltitle=s[0];break;default:o.marks.push(...s)}return o}function aNt(t){return new gn().set(0,0,t.width||0,t.height||0)}function uNt(t){const e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function ze(t,e,n){const r=st(t)?t[e]:t;return r??(n!==void 0?n:0)}function c7(t){return t<0?Math.ceil(-t):0}function $et(t,e,n){var r=!n.nodirty,i=n.bounds===NN?aNt:uNt,s=cr.set(0,0,0,0),o=ze(n.align,bc),a=ze(n.align,vc),u=ze(n.padding,bc),c=ze(n.padding,vc),l=n.columns||e.length,f=l<=0?1:Math.ceil(e.length/l),d=e.length,h=Array(d),p=Array(l),g=0,m=Array(d),y=Array(f),b=0,w=Array(d),v=Array(d),x=Array(d),S,_,E,A,$,T,C,F,M,k,I;for(_=0;_<l;++_)p[_]=0;for(_=0;_<f;++_)y[_]=0;for(_=0;_<d;++_)T=e[_],$=x[_]=i(T),T.x=T.x||0,w[_]=0,T.y=T.y||0,v[_]=0,E=_%l,A=~~(_/l),g=Math.max(g,C=Math.ceil($.x2)),b=Math.max(b,F=Math.ceil($.y2)),p[E]=Math.max(p[E],C),y[A]=Math.max(y[A],F),h[_]=u+c7($.x1),m[_]=c+c7($.y1),r&&t.dirty(e[_]);for(_=0;_<d;++_)_%l===0&&(h[_]=0),_<l&&(m[_]=0);if(o===bk)for(E=1;E<l;++E){for(I=0,_=E;_<d;_+=l)I<h[_]&&(I=h[_]);for(_=E;_<d;_+=l)h[_]=I+p[E-1]}else if(o===xb){for(I=0,_=0;_<d;++_)_%l&&I<h[_]&&(I=h[_]);for(_=0;_<d;++_)_%l&&(h[_]=I+g)}else for(o=!1,E=1;E<l;++E)for(_=E;_<d;_+=l)h[_]+=p[E-1];if(a===bk)for(A=1;A<f;++A){for(I=0,_=A*l,S=_+l;_<S;++_)I<m[_]&&(I=m[_]);for(_=A*l;_<S;++_)m[_]=I+y[A-1]}else if(a===xb){for(I=0,_=l;_<d;++_)I<m[_]&&(I=m[_]);for(_=l;_<d;++_)m[_]=I+b}else for(a=!1,A=1;A<f;++A)for(_=A*l,S=_+l;_<S;++_)m[_]+=y[A-1];for(M=0,_=0;_<d;++_)M=h[_]+(_%l?M:0),w[_]+=M-e[_].x;for(E=0;E<l;++E)for(k=0,_=E;_<d;_+=l)k+=m[_],v[_]+=k-e[_].y;if(o&&ze(n.center,bc)&&f>1)for(_=0;_<d;++_)$=o===xb?g:p[_%l],M=$-x[_].x2-e[_].x-w[_],M>0&&(w[_]+=M/2);if(a&&ze(n.center,vc)&&l!==1)for(_=0;_<d;++_)$=a===xb?b:y[~~(_/l)],k=$-x[_].y2-e[_].y-v[_],k>0&&(v[_]+=k/2);for(_=0;_<d;++_)s.union(x[_].translate(w[_],v[_]));switch(M=ze(n.anchor,G6t),k=ze(n.anchor,Y6t),ze(n.anchor,bc)){case Mr:M-=s.width();break;case yk:M-=s.width()/2}switch(ze(n.anchor,vc)){case Mr:k-=s.height();break;case yk:k-=s.height()/2}for(M=Math.round(M),k=Math.round(k),s.clear(),_=0;_<d;++_)e[_].mark.bounds.clear();for(_=0;_<d;++_)T=e[_],T.x+=w[_]+=M,T.y+=v[_]+=k,s.union(T.mark.bounds.union(T.bounds.translate(w[_],v[_]))),r&&t.dirty(T);return s}function cNt(t,e,n){var r=oNt(e),i=r.marks,s=n.bounds===NN?lNt:fNt,o=n.offset,a=n.columns||i.length,u=a<=0?1:Math.ceil(i.length/a),c=u*a,l,f,d,h,p,g,m;const y=$et(t,i,n);y.empty()&&y.set(0,0,0,0),r.rowheaders&&(g=ze(n.headerBand,vc,null),l=Eb(t,r.rowheaders,i,a,u,-ze(o,"rowHeader"),a7,0,s,"x1",0,a,1,g)),r.colheaders&&(g=ze(n.headerBand,bc,null),f=Eb(t,r.colheaders,i,a,a,-ze(o,"columnHeader"),a7,1,s,"y1",0,1,a,g)),r.rowfooters&&(g=ze(n.footerBand,vc,null),d=Eb(t,r.rowfooters,i,a,u,ze(o,"rowFooter"),u7,0,s,"x2",a-1,a,1,g)),r.colfooters&&(g=ze(n.footerBand,bc,null),h=Eb(t,r.colfooters,i,a,a,ze(o,"columnFooter"),u7,1,s,"y2",c-a,1,a,g)),r.rowtitle&&(p=ze(n.titleAnchor,vc),m=ze(o,"rowTitle"),m=p===Mr?d+m:l-m,g=ze(n.titleBand,vc,.5),l7(t,r.rowtitle,m,0,y,g)),r.coltitle&&(p=ze(n.titleAnchor,bc),m=ze(o,"columnTitle"),m=p===Mr?h+m:f-m,g=ze(n.titleBand,bc,.5),l7(t,r.coltitle,m,1,y,g))}function lNt(t,e){return e==="x1"?t.x||0:e==="y1"?t.y||0:e==="x2"?(t.x||0)+(t.width||0):e==="y2"?(t.y||0)+(t.height||0):void 0}function fNt(t,e){return t.bounds[e]}function Eb(t,e,n,r,i,s,o,a,u,c,l,f,d,h){var p=n.length,g=0,m=0,y,b,w,v,x,S,_,E,A;if(!p)return g;for(y=l;y<p;y+=f)n[y]&&(g=o(g,u(n[y],c)));if(!e.length)return g;for(e.length>i&&(t.warn("Grid headers exceed limit: "+i),e=e.slice(0,i)),g+=s,b=0,v=e.length;b<v;++b)t.dirty(e[b]),e[b].mark.bounds.clear();for(y=l,b=0,v=e.length;b<v;++b,y+=f){for(S=e[b],x=S.mark.bounds,w=y;w>=0&&(_=n[w])==null;w-=d);a?(E=h==null?_.x:Math.round(_.bounds.x1+h*_.bounds.width()),A=g):(E=g,A=h==null?_.y:Math.round(_.bounds.y1+h*_.bounds.height())),x.union(S.bounds.translate(E-(S.x||0),A-(S.y||0))),S.x=E,S.y=A,t.dirty(S),m=o(m,x[c])}return m}function l7(t,e,n,r,i,s){if(e){t.dirty(e);var o=n,a=n;r?o=Math.round(i.x1+s*i.width()):a=Math.round(i.y1+s*i.height()),e.bounds.translate(o-(e.x||0),a-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=o,e.y=a,t.dirty(e)}}function dNt(t,e){const n=t[e]||{};return(r,i)=>n[r]!=null?n[r]:t[r]!=null?t[r]:i}function hNt(t,e){let n=-1/0;return t.forEach(r=>{r.offset!=null&&(n=Math.max(n,r.offset))}),n>-1/0?n:e}function pNt(t,e,n,r,i,s,o){const a=dNt(n,e),u=hNt(t,a("offset",0)),c=a("anchor",kN),l=c===Mr?1:c===yk?.5:0,f={align:bk,bounds:a("bounds",NN),columns:a("direction")==="vertical"?1:t.length,padding:a("margin",8),center:a("center"),nodirty:!0};switch(e){case Ds:f.anchor={x:Math.floor(r.x1)-u,column:Mr,y:l*(o||r.height()+2*r.y1),row:c};break;case Bs:f.anchor={x:Math.ceil(r.x2)+u,y:l*(o||r.height()+2*r.y1),row:c};break;case _p:f.anchor={y:Math.floor(i.y1)-u,row:Mr,x:l*(s||i.width()+2*i.x1),column:c};break;case Zc:f.anchor={y:Math.ceil(i.y2)+u,x:l*(s||i.width()+2*i.x1),column:c};break;case j6t:f.anchor={x:u,y:u};break;case q6t:f.anchor={x:s-u,y:u,column:Mr};break;case W6t:f.anchor={x:u,y:o-u,row:Mr};break;case V6t:f.anchor={x:s-u,y:o-u,column:Mr,row:Mr};break}return f}function gNt(t,e){var n=e.items[0],r=n.datum,i=n.orient,s=n.bounds,o=n.x,a=n.y,u,c;return n._bounds?n._bounds.clear().union(s):n._bounds=s.clone(),s.clear(),yNt(t,n,n.items[0].items[0]),s=mNt(n,s),u=2*n.padding,c=2*n.padding,s.empty()||(u=Math.ceil(s.width()+u),c=Math.ceil(s.height()+c)),r.type===Q6t&&bNt(n.items[0].items[0].items[0].items),i!==FN&&(n.x=o=0,n.y=a=0),n.width=u,n.height=c,Ou(s.set(o,a,o+u,a+c),n),n.mark.bounds.clear().union(s),n}function mNt(t,e){return t.items.forEach(n=>e.union(n.bounds)),e.x1=t.padding,e.y1=t.padding,e}function yNt(t,e,n){var r=e.padding,i=r-n.x,s=r-n.y;if(!e.datum.title)(i||s)&&Qg(t,n,i,s);else{var o=e.items[1].items[0],a=o.anchor,u=e.titlePadding||0,c=r-o.x,l=r-o.y;switch(o.orient){case Ds:i+=Math.ceil(o.bounds.width())+u;break;case Bs:case Zc:break;default:s+=o.bounds.height()+u}switch((i||s)&&Qg(t,n,i,s),o.orient){case Ds:l+=jd(e,n,o,a,1,1);break;case Bs:c+=jd(e,n,o,Mr,0,0)+u,l+=jd(e,n,o,a,1,1);break;case Zc:c+=jd(e,n,o,a,0,0),l+=jd(e,n,o,Mr,-1,0,1)+u;break;default:c+=jd(e,n,o,a,0,0)}(c||l)&&Qg(t,o,c,l),(c=Math.round(o.bounds.x1-r))<0&&(Qg(t,n,-c,0),Qg(t,o,-c,0))}}function jd(t,e,n,r,i,s,o){const a=t.datum.type!=="symbol",u=n.datum.vgrad,c=a&&(s||!u)&&!o?e.items[0]:e,l=c.bounds[i?"y2":"x2"]-t.padding,f=u&&s?l:0,d=u&&s?0:l,h=i<=0?0:mN(n);return Math.round(r===kN?f:r===Mr?d-h:.5*(l-h))}function Qg(t,e,n,r){e.x+=n,e.y+=r,e.bounds.translate(n,r),e.mark.bounds.translate(n,r),t.dirty(e)}function bNt(t){const e=t.reduce((n,r)=>(n[r.column]=Math.max(r.bounds.x2-r.x,n[r.column]||0),n),{});t.forEach(n=>{n.width=e[n.column],n.height=n.bounds.y2-n.y})}function vNt(t,e,n,r,i){var s=e.items[0],o=s.frame,a=s.orient,u=s.anchor,c=s.offset,l=s.padding,f=s.items[0].items[0],d=s.items[1]&&s.items[1].items[0],h=a===Ds||a===Bs?r:n,p=0,g=0,m=0,y=0,b=0,w;if(o!==wS?a===Ds?(p=i.y2,h=i.y1):a===Bs?(p=i.y1,h=i.y2):(p=i.x1,h=i.x2):a===Ds&&(p=r,h=0),w=u===kN?p:u===Mr?h:(p+h)/2,d&&d.text){switch(a){case _p:case Zc:b=f.bounds.height()+l;break;case Ds:y=f.bounds.width()+l;break;case Bs:y=-f.bounds.width()-l;break}cr.clear().union(d.bounds),cr.translate(y-(d.x||0),b-(d.y||0)),vh(d,"x",y)|vh(d,"y",b)&&(t.dirty(d),d.bounds.clear().union(cr),d.mark.bounds.clear().union(cr),t.dirty(d)),cr.clear().union(d.bounds)}else cr.clear();switch(cr.union(f.bounds),a){case _p:g=w,m=i.y1-cr.height()-c;break;case Ds:g=i.x1-cr.width()-c,m=w;break;case Bs:g=i.x2+cr.width()+c,m=w;break;case Zc:g=w,m=i.y2+c;break;default:g=s.x,m=s.y}return vh(s,"x",g)|vh(s,"y",m)&&(cr.translate(g,m),t.dirty(s),s.bounds.clear().union(cr),e.bounds.clear().union(cr),t.dirty(s)),s.bounds}function Tet(t){z.call(this,null,t)}tt(Tet,z,{transform(t,e){const n=e.dataflow;return t.mark.items.forEach(r=>{t.layout&&cNt(n,r,t.layout),xNt(n,r,t)}),wNt(t.mark.group)?e.reflow():e}});function wNt(t){return t&&t.mark.role!=="legend-entry"}function xNt(t,e,n){var r=e.items,i=Math.max(0,e.width||0),s=Math.max(0,e.height||0),o=new gn().set(0,0,i,s),a=o.clone(),u=o.clone(),c=[],l,f,d,h,p,g;for(p=0,g=r.length;p<g;++p)switch(f=r[p],f.role){case MN:h=rNt(f)?a:u,h.union(sNt(t,f,i,s));break;case CN:l=f;break;case IN:c.push(gNt(t,f));break;case H6t:case X6t:case fet:case det:case het:case pet:case get:case met:a.union(f.bounds),u.union(f.bounds);break;default:o.union(f.bounds)}if(c.length){const m={};c.forEach(y=>{d=y.orient||Bs,d!==FN&&(m[d]||(m[d]=[])).push(y)});for(const y in m){const b=m[y];$et(t,b,pNt(b,y,n.legends,a,u,i,s))}c.forEach(y=>{const b=y.bounds;if(b.equals(y._bounds)||(y.bounds=y._bounds,t.dirty(y),y.bounds=b,t.dirty(y)),n.autosize&&(n.autosize.type===yet||n.autosize.type===bet||n.autosize.type===vet))switch(y.orient){case Ds:case Bs:o.add(b.x1,0).add(b.x2,0);break;case _p:case Zc:o.add(0,b.y1).add(0,b.y2)}else o.union(b)})}o.union(a).union(u),l&&o.union(vNt(t,l,i,s,o)),e.clip&&o.set(0,0,e.width||0,e.height||0),_Nt(t,e,o,n)}function _Nt(t,e,n,r){const i=r.autosize||{},s=i.type;if(t._autosize<1||!s)return;let o=t._width,a=t._height,u=Math.max(0,e.width||0),c=Math.max(0,Math.ceil(-n.x1)),l=Math.max(0,e.height||0),f=Math.max(0,Math.ceil(-n.y1));const d=Math.max(0,Math.ceil(n.x2-u)),h=Math.max(0,Math.ceil(n.y2-l));if(i.contains===K6t){const p=t.padding();o-=p.left+p.right,a-=p.top+p.bottom}s===FN?(c=0,f=0,u=o,l=a):s===yet?(u=Math.max(0,o-c-d),l=Math.max(0,a-f-h)):s===bet?(u=Math.max(0,o-c-d),a=l+f+h):s===vet?(o=u+c+d,l=Math.max(0,a-f-h)):s===J6t&&(o=u+c+d,a=l+f+h),t._resizeView(o,a,u,l,[c,f],i.resize)}const SNt=Object.freeze(Object.defineProperty({__proto__:null,bound:wet,identifier:ON,mark:xet,overlap:_et,render:Aet,viewlayout:Tet},Symbol.toStringTag,{value:"Module"}));function ket(t){z.call(this,null,t)}tt(ket,z,{transform(t,e){if(this.value&&!t.modified())return e.StopPropagation;var n=e.dataflow.locale(),r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=this.value,s=t.scale,o=t.count==null?t.values?t.values.length:10:t.count,a=J6(s,o,t.minstep),u=t.format||ett(n,s,a,t.formatSpecifier,t.formatType,!!t.values),c=t.values?ttt(s,t.values,a):Z6(s,a);return i&&(r.rem=i),i=c.map((l,f)=>le({index:f/(c.length-1||1),value:l,label:u(l)})),t.extra&&i.length&&i.push(le({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}});function Met(t){z.call(this,null,t)}function ENt(){return le({})}function ANt(t){const e=hg().test(n=>n.exit);return e.lookup=n=>e.get(t(n)),e}tt(Met,z,{transform(t,e){var n=e.dataflow,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.item||ENt,s=t.key||vt,o=this.value;return W(r.encode)&&(r.encode=null),o&&(t.modified("key")||e.modified(s))&&j("DataJoin does not support modified key function or fields."),o||(e=e.addAll(),this.value=o=ANt(s)),e.visit(e.ADD,a=>{const u=s(a);let c=o.get(u);c?c.exit?(o.empty--,r.add.push(c)):r.mod.push(c):(c=i(a),o.set(u,c),r.add.push(c)),c.datum=a,c.exit=!1}),e.visit(e.MOD,a=>{const u=s(a),c=o.get(u);c&&(c.datum=a,r.mod.push(c))}),e.visit(e.REM,a=>{const u=s(a),c=o.get(u);a===c.datum&&!c.exit&&(r.rem.push(c),c.exit=!0,++o.empty)}),e.changed(e.ADD_MOD)&&r.modifies("datum"),(e.clean()||t.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r}});function Cet(t){z.call(this,null,t)}tt(Cet,z,{transform(t,e){var n=e.fork(e.ADD_REM),r=t.mod||!1,i=t.encoders,s=e.encode;if(W(s))if(n.changed()||s.every(f=>i[f]))s=s[0],n.encode=null;else return e.StopPropagation;var o=s==="enter",a=i.update||Hu,u=i.enter||Hu,c=i.exit||Hu,l=(s&&!o?i[s]:a)||Hu;if(e.changed(e.ADD)&&(e.visit(e.ADD,f=>{u(f,t),a(f,t)}),n.modifies(u.output),n.modifies(a.output),l!==Hu&&l!==a&&(e.visit(e.ADD,f=>{l(f,t)}),n.modifies(l.output))),e.changed(e.REM)&&c!==Hu&&(e.visit(e.REM,f=>{c(f,t)}),n.modifies(c.output)),o||l!==Hu){const f=e.MOD|(t.modified()?e.REFLOW:0);o?(e.visit(f,d=>{const h=u(d,t)||r;(l(d,t)||h)&&n.mod.push(d)}),n.mod.length&&n.modifies(u.output)):e.visit(f,d=>{(l(d,t)||r)&&n.mod.push(d)}),n.mod.length&&n.modifies(l.output)}return n.changed()?n:e.StopPropagation}});function Iet(t){z.call(this,[],t)}tt(Iet,z,{transform(t,e){if(this.value!=null&&!t.modified())return e.StopPropagation;var n=e.dataflow.locale(),r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=this.value,s=t.type||mv,o=t.scale,a=+t.limit,u=J6(o,t.count==null?5:t.count,t.minstep),c=!!t.values||s===mv,l=t.format||stt(n,o,u,s,t.formatSpecifier,t.formatType,c),f=t.values||itt(o,u),d,h,p,g,m;return i&&(r.rem=i),s===mv?(a&&f.length>a?(e.dataflow.warn("Symbol legend count exceeds limit, filtering items."),i=f.slice(0,a-1),m=!0):i=f,jt(p=t.size)?(!t.values&&o(i[0])===0&&(i=i.slice(1)),g=i.reduce((y,b)=>Math.max(y,p(b,t)),0)):p=Ar(g=p||8),i=i.map((y,b)=>le({index:b,label:l(y,b,i),value:y,offset:g,size:p(y,t)})),m&&(m=f[i.length],i.push(le({index:i.length,label:`${f.length-i.length} entries`,value:m,offset:g,size:p(m,t)})))):s===KCt?(d=o.domain(),h=QZ(o,d[0],te(d)),f.length<3&&!t.values&&d[0]!==te(d)&&(f=[d[0],te(d)]),i=f.map((y,b)=>le({index:b,label:l(y,b,f),value:y,perc:h(y)}))):(p=f.length-1,h=aIt(o),i=f.map((y,b)=>le({index:b,label:l(y,b,f),value:y,perc:b?h(y):0,perc2:b===p?1:h(f[b+1])}))),r.source=i,r.add=i,this.value=i,r}});const $Nt=t=>t.source.x,TNt=t=>t.source.y,kNt=t=>t.target.x,MNt=t=>t.target.y;function RN(t){z.call(this,{},t)}RN.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};tt(RN,z,{transform(t,e){var n=t.sourceX||$Nt,r=t.sourceY||TNt,i=t.targetX||kNt,s=t.targetY||MNt,o=t.as||"path",a=t.orient||"vertical",u=t.shape||"line",c=f7.get(u+"-"+a)||f7.get(u);return c||j("LinkPath unsupported type: "+t.shape+(t.orient?"-"+t.orient:"")),e.visit(e.SOURCE,l=>{l[o]=c(n(l),r(l),i(l),s(l))}),e.reflow(t.modified()).modifies(o)}});const Fet=(t,e,n,r)=>"M"+t+","+e+"L"+n+","+r,CNt=(t,e,n,r)=>Fet(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n)),Net=(t,e,n,r)=>{var i=n-t,s=r-e,o=Math.hypot(i,s)/2,a=180*Math.atan2(s,i)/Math.PI;return"M"+t+","+e+"A"+o+","+o+" "+a+" 0 1 "+n+","+r},INt=(t,e,n,r)=>Net(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n)),Oet=(t,e,n,r)=>{const i=n-t,s=r-e,o=.2*(i+s),a=.2*(s-i);return"M"+t+","+e+"C"+(t+o)+","+(e+a)+" "+(n+a)+","+(r-o)+" "+n+","+r},FNt=(t,e,n,r)=>Oet(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n)),NNt=(t,e,n,r)=>"M"+t+","+e+"V"+r+"H"+n,ONt=(t,e,n,r)=>"M"+t+","+e+"H"+n+"V"+r,RNt=(t,e,n,r)=>{const i=Math.cos(t),s=Math.sin(t),o=Math.cos(n),a=Math.sin(n),u=Math.abs(n-t)>Math.PI?n<=t:n>t;return"M"+e*i+","+e*s+"A"+e+","+e+" 0 0,"+(u?1:0)+" "+e*o+","+e*a+"L"+r*o+","+r*a},DNt=(t,e,n,r)=>{const i=(t+n)/2;return"M"+t+","+e+"C"+i+","+e+" "+i+","+r+" "+n+","+r},LNt=(t,e,n,r)=>{const i=(e+r)/2;return"M"+t+","+e+"C"+t+","+i+" "+n+","+i+" "+n+","+r},BNt=(t,e,n,r)=>{const i=Math.cos(t),s=Math.sin(t),o=Math.cos(n),a=Math.sin(n),u=(e+r)/2;return"M"+e*i+","+e*s+"C"+u*i+","+u*s+" "+u*o+","+u*a+" "+r*o+","+r*a},f7=hg({line:Fet,"line-radial":CNt,arc:Net,"arc-radial":INt,curve:Oet,"curve-radial":FNt,"orthogonal-horizontal":NNt,"orthogonal-vertical":ONt,"orthogonal-radial":RNt,"diagonal-horizontal":DNt,"diagonal-vertical":LNt,"diagonal-radial":BNt});function DN(t){z.call(this,null,t)}DN.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};tt(DN,z,{transform(t,e){var n=t.as||["startAngle","endAngle"],r=n[0],i=n[1],s=t.field||lg,o=t.startAngle||0,a=t.endAngle!=null?t.endAngle:2*Math.PI,u=e.source,c=u.map(s),l=c.length,f=o,d=(a-o)/ls(c),h=xn(l),p,g,m;for(t.sort&&h.sort((y,b)=>c[y]-c[b]),p=0;p<l;++p)m=c[h[p]],g=u[h[p]],g[r]=f,g[i]=f+=m*d;return this.value=c,e.reflow(t.modified()).modifies(n)}});const PNt=5;function zNt(t){const e=t.type;return!t.bins&&(e===mp||e===Qy||e===Jy)}function Ret(t){return X6(t)&&t!==jo}const UNt=Gs(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function Det(t){z.call(this,null,t),this.modified(!0)}tt(Det,z,{transform(t,e){var n=e.dataflow,r=this.value,i=jNt(t);(!r||i!==r.type)&&(this.value=r=ce(i)());for(i in t)if(!UNt[i]){if(i==="padding"&&Ret(r.type))continue;jt(r[i])?r[i](t[i]):n.warn("Unsupported scale property: "+i)}return HNt(r,t,YNt(r,t,WNt(r,t,n))),e.fork(e.NO_SOURCE|e.NO_FIELDS)}});function jNt(t){var e=t.type,n="",r;return e===jo?jo+"-"+mp:(qNt(t)&&(r=t.rawDomain?t.rawDomain.length:t.domain?t.domain.length+ +(t.domainMid!=null):0,n=r===2?jo+"-":r===3?yg+"-":""),(n+e||mp).toLowerCase())}function qNt(t){const e=t.type;return X6(e)&&e!==Pf&&e!==zf&&(t.scheme||t.range&&t.range.length&&t.range.every(at))}function WNt(t,e,n){const r=VNt(t,e.domainRaw,n);if(r>-1)return r;var i=e.domain,s=t.type,o=e.zero||e.zero===void 0&&zNt(t),a,u;if(!i)return 0;if((o||e.domainMin!=null||e.domainMax!=null||e.domainMid!=null)&&(a=(i=i.slice()).length-1||1,o&&(i[0]>0&&(i[0]=0),i[a]<0&&(i[a]=0)),e.domainMin!=null&&(i[0]=e.domainMin),e.domainMax!=null&&(i[a]=e.domainMax),e.domainMid!=null)){u=e.domainMid;const c=u>i[a]?a+1:u<i[0]?0:a;c!==a&&n.warn("Scale domainMid exceeds domain min or max.",u),i.splice(c,0,u)}return Ret(s)&&e.padding&&i[0]!==te(i)&&(i=GNt(s,i,e.range,e.padding,e.exponent,e.constant)),t.domain(Let(s,i,n)),s===V6&&t.unknown(e.domainImplicit?ix:void 0),e.nice&&t.nice&&t.nice(e.nice!==!0&&J6(t,e.nice)||null),i.length}function VNt(t,e,n){return e?(t.domain(Let(t.type,e,n)),e.length):-1}function GNt(t,e,n,r,i,s){var o=Math.abs(te(n)-n[0]),a=o/(o-2*r),u=t===wu?BF(e,null,a):t===Jy?Tx(e,null,a,.5):t===Qy?Tx(e,null,a,i||1):t===sS?PF(e,null,a,s||1):LF(e,null,a);return e=e.slice(),e[0]=u[0],e[e.length-1]=u[1],e}function Let(t,e,n){if(GZ(t)){var r=Math.abs(e.reduce((i,s)=>i+(s<0?-1:s>0?1:0),0));r!==e.length&&n.warn("Log scale domain includes zero: "+J(e))}return e}function YNt(t,e,n){let r=e.bins;if(r&&!W(r)){const i=t.domain(),s=i[0],o=te(i),a=r.step;let u=r.start==null?s:r.start,c=r.stop==null?o:r.stop;a||j("Scale bins parameter missing step property."),u<s&&(u=a*Math.ceil(s/a)),c>o&&(c=a*Math.floor(o/a)),r=xn(u,c+a/2,a)}return r?t.bins=r:t.bins&&delete t.bins,t.type===G6&&(r?!e.domain&&!e.domainRaw&&(t.domain(r),n=r.length):t.bins=t.domain()),n}function HNt(t,e,n){var r=t.type,i=e.round||!1,s=e.range;if(e.rangeStep!=null)s=XNt(r,e,n);else if(e.scheme&&(s=KNt(r,e,n),jt(s))){if(t.interpolator)return t.interpolator(s);j(`Scale type ${r} does not support interpolating color schemes.`)}if(s&&YZ(r))return t.interpolator(uS(vk(s,e.reverse),e.interpolate,e.interpolateGamma));s&&e.interpolate&&t.interpolate?t.interpolate(K6(e.interpolate,e.interpolateGamma)):jt(t.round)?t.round(i):jt(t.rangeRound)&&t.interpolate(i?Gp:ku),s&&t.range(vk(s,e.reverse))}function XNt(t,e,n){t!==zZ&&t!==ik&&j("Only band and point scales support rangeStep.");var r=(e.paddingOuter!=null?e.paddingOuter:e.padding)||0,i=t===ik?1:(e.paddingInner!=null?e.paddingInner:e.padding)||0;return[0,e.rangeStep*W6(n,i,r)]}function KNt(t,e,n){var r=e.schemeExtent,i,s;return W(e.scheme)?s=uS(e.scheme,e.interpolate,e.interpolateGamma):(i=e.scheme.toLowerCase(),s=Q6(i),s||j(`Unrecognized scheme name: ${e.scheme}`)),n=t===aS?n+1:t===G6?n-1:t===yp||t===oS?+e.schemeCount||PNt:n,YZ(t)?d7(s,r,e.reverse):jt(s)?KZ(d7(s,r),n):t===V6?s:s.slice(0,n)}function d7(t,e,n){return jt(t)&&(e||n)?XZ(t,vk(e||[0,1],n)):t}function vk(t,e){return e?t.slice().reverse():t}function Bet(t){z.call(this,null,t)}tt(Bet,z,{transform(t,e){const n=t.modified("sort")||e.changed(e.ADD)||e.modified(t.sort.fields)||e.modified("datum");return n&&e.source.sort(ld(t.sort)),this.modified(n),e}});const h7="zero",Pet="center",zet="normalize",Uet=["y0","y1"];function LN(t){z.call(this,null,t)}LN.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:h7,values:[h7,Pet,zet]},{name:"as",type:"string",array:!0,length:2,default:Uet}]};tt(LN,z,{transform(t,e){var n=t.as||Uet,r=n[0],i=n[1],s=ld(t.sort),o=t.field||lg,a=t.offset===Pet?QNt:t.offset===zet?JNt:ZNt,u,c,l,f;for(u=tOt(e.source,t.groupby,s,o),c=0,l=u.length,f=u.max;c<l;++c)a(u[c],f,o,r,i);return e.reflow(t.modified()).modifies(n)}});function QNt(t,e,n,r,i){for(var s=(e-t.sum)/2,o=t.length,a=0,u;a<o;++a)u=t[a],u[r]=s,u[i]=s+=Math.abs(n(u))}function JNt(t,e,n,r,i){for(var s=1/t.sum,o=0,a=t.length,u=0,c=0,l;u<a;++u)l=t[u],l[r]=o,l[i]=o=s*(c+=Math.abs(n(l)))}function ZNt(t,e,n,r,i){for(var s=0,o=0,a=t.length,u=0,c,l;u<a;++u)l=t[u],c=+n(l),c<0?(l[r]=o,l[i]=o+=c):(l[r]=s,l[i]=s+=c)}function tOt(t,e,n,r){var i=[],s=g=>g(l),o,a,u,c,l,f,d,h,p;if(e==null)i.push(t.slice());else for(o={},a=0,u=t.length;a<u;++a)l=t[a],f=e.map(s),d=o[f],d||(o[f]=d=[],i.push(d)),d.push(l);for(f=0,p=0,c=i.length;f<c;++f){for(d=i[f],a=0,h=0,u=d.length;a<u;++a)h+=Math.abs(r(d[a]));d.sum=h,h>p&&(p=h),n&&d.sort(n)}return i.max=p,i}const eOt=Object.freeze(Object.defineProperty({__proto__:null,axisticks:ket,datajoin:Met,encode:Cet,legendentries:Iet,linkpath:RN,pie:DN,scale:Det,sortitems:Bet,stack:LN},Symbol.toStringTag,{value:"Module"}));var nOt=Math.abs,wk=Math.cos,Wx=Math.sin,rOt=1e-6,jet=Math.PI,xk=jet/2,p7=iOt(2);function g7(t){return t>1?xk:t<-1?-xk:Math.asin(t)}function iOt(t){return t>0?Math.sqrt(t):0}function sOt(t,e){var n=t*Wx(e),r=30,i;do e-=i=(e+Wx(e)-n)/(1+wk(e));while(nOt(i)>rOt&&--r>0);return e/2}function oOt(t,e,n){function r(i,s){return[t*i*wk(s=sOt(n,s)),e*Wx(s)]}return r.invert=function(i,s){return s=g7(s/e),[i/(t*wk(s)),g7((2*s+Wx(2*s))/n)]},r}var aOt=oOt(p7/xk,p7,jet);function uOt(){return da(aOt).scale(169.529)}const cOt=eo(),_k=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function lOt(t,e){return function n(){const r=e();return r.type=t,r.path=eo().projection(r),r.copy=r.copy||function(){const i=n();return _k.forEach(s=>{r[s]&&i[s](r[s]())}),i.path.pointRadius(r.path.pointRadius()),i},WZ(r)}}function BN(t,e){if(!t||typeof t!="string")throw new Error("Projection type must be a name string.");return t=t.toLowerCase(),arguments.length>1?(Vx[t]=lOt(t,e),this):Vx[t]||null}function qet(t){return t&&t.path||cOt}const Vx={albers:YC,albersusa:zW,azimuthalequalarea:qW,azimuthalequidistant:VW,conicconformal:HW,conicequalarea:M0,conicequidistant:KW,equalEarth:JW,equirectangular:XW,gnomonic:tV,identity:rvt,mercator:GW,mollweide:uOt,naturalEarth1:ivt,orthographic:rV,stereographic:sV,transversemercator:aV};for(const t in Vx)BN(t,Vx[t]);function fOt(){}const Na=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function Wet(){var t=1,e=1,n=a;function r(u,c){return c.map(l=>i(u,l))}function i(u,c){var l=[],f=[];return s(u,c,d=>{n(d,u,c),dOt(d)>0?l.push([d]):f.push(d)}),f.forEach(d=>{for(var h=0,p=l.length,g;h<p;++h)if(hOt((g=l[h])[0],d)!==-1){g.push(d);return}}),{type:"MultiPolygon",value:c,coordinates:l}}function s(u,c,l){var f=[],d=[],h,p,g,m,y,b;for(h=p=-1,m=u[0]>=c,Na[m<<1].forEach(w);++h<t-1;)g=m,m=u[h+1]>=c,Na[g|m<<1].forEach(w);for(Na[m<<0].forEach(w);++p<e-1;){for(h=-1,m=u[p*t+t]>=c,y=u[p*t]>=c,Na[m<<1|y<<2].forEach(w);++h<t-1;)g=m,m=u[p*t+t+h+1]>=c,b=y,y=u[p*t+h+1]>=c,Na[g|m<<1|y<<2|b<<3].forEach(w);Na[m|y<<3].forEach(w)}for(h=-1,y=u[p*t]>=c,Na[y<<2].forEach(w);++h<t-1;)b=y,y=u[p*t+h+1]>=c,Na[y<<2|b<<3].forEach(w);Na[y<<3].forEach(w);function w(v){var x=[v[0][0]+h,v[0][1]+p],S=[v[1][0]+h,v[1][1]+p],_=o(x),E=o(S),A,$;(A=d[_])?($=f[E])?(delete d[A.end],delete f[$.start],A===$?(A.ring.push(S),l(A.ring)):f[A.start]=d[$.end]={start:A.start,end:$.end,ring:A.ring.concat($.ring)}):(delete d[A.end],A.ring.push(S),d[A.end=E]=A):(A=f[E])?($=d[_])?(delete f[A.start],delete d[$.end],A===$?(A.ring.push(S),l(A.ring)):f[$.start]=d[A.end]={start:$.start,end:A.end,ring:$.ring.concat(A.ring)}):(delete f[A.start],A.ring.unshift(x),f[A.start=_]=A):f[_]=d[E]={start:_,end:E,ring:[x,S]}}}function o(u){return u[0]*2+u[1]*(t+1)*4}function a(u,c,l){u.forEach(f=>{var d=f[0],h=f[1],p=d|0,g=h|0,m,y=c[g*t+p];d>0&&d<t&&p===d&&(m=c[g*t+p-1],f[0]=d+(l-m)/(y-m)-.5),h>0&&h<e&&g===h&&(m=c[(g-1)*t+p],f[1]=h+(l-m)/(y-m)-.5)})}return r.contour=i,r.size=function(u){if(!arguments.length)return[t,e];var c=Math.floor(u[0]),l=Math.floor(u[1]);return c>=0&&l>=0||j("invalid size"),t=c,e=l,r},r.smooth=function(u){return arguments.length?(n=u?a:fOt,r):n===a},r}function dOt(t){for(var e=0,n=t.length,r=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)r+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return r}function hOt(t,e){for(var n=-1,r=e.length,i;++n<r;)if(i=pOt(t,e[n]))return i;return 0}function pOt(t,e){for(var n=e[0],r=e[1],i=-1,s=0,o=t.length,a=o-1;s<o;a=s++){var u=t[s],c=u[0],l=u[1],f=t[a],d=f[0],h=f[1];if(gOt(u,f,e))return 0;l>r!=h>r&&n<(d-c)*(r-l)/(h-l)+c&&(i=-i)}return i}function gOt(t,e,n){var r;return mOt(t,e,n)&&yOt(t[r=+(t[0]===e[0])],n[r],e[r])}function mOt(t,e,n){return(e[0]-t[0])*(n[1]-t[1])===(n[0]-t[0])*(e[1]-t[1])}function yOt(t,e,n){return t<=e&&e<=n||n<=e&&e<=t}function Vet(t,e,n){return function(r){var i=ea(r),s=n?Math.min(i[0],0):i[0],o=i[1],a=o-s,u=e?Bc(s,o,t):a/(t+1);return xn(s+u,o,u)}}function PN(t){z.call(this,null,t)}PN.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};tt(PN,z,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=e.materialize(e.SOURCE).source,i=t.field||Er,s=Wet().smooth(t.smooth!==!1),o=t.thresholds||bOt(r,i,t),a=t.as===null?null:t.as||"contour",u=[];return r.forEach(c=>{const l=i(c),f=s.size([l.width,l.height])(l.values,W(o)?o:o(l.values));vOt(f,l,c,t),f.forEach(d=>{u.push(K_(c,le(a!=null?{[a]:d}:d)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function bOt(t,e,n){const r=Vet(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?r:r(t.map(i=>Be(e(i).values)))}function vOt(t,e,n,r){let i=r.scale||e.scale,s=r.translate||e.translate;if(jt(i)&&(i=i(n,r)),jt(s)&&(s=s(n,r)),(i===1||i==null)&&!s)return;const o=(ue(i)?i:i[0])||1,a=(ue(i)?i:i[1])||1,u=s&&s[0]||0,c=s&&s[1]||0;t.forEach(Get(e,o,a,u,c))}function Get(t,e,n,r,i){const s=t.x1||0,o=t.y1||0,a=e*n<0;function u(f){f.forEach(c)}function c(f){a&&f.reverse(),f.forEach(l)}function l(f){f[0]=(f[0]-s)*e+r,f[1]=(f[1]-o)*n+i}return function(f){return f.coordinates.forEach(u),f}}function m7(t,e,n){const r=t>=0?t:i6(e,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function r$(t){return jt(t)?t:Ar(+t)}function Yet(){var t=u=>u[0],e=u=>u[1],n=lg,r=[-1,-1],i=960,s=500,o=2;function a(u,c){const l=m7(r[0],u,t)>>o,f=m7(r[1],u,e)>>o,d=l?l+2:0,h=f?f+2:0,p=2*d+(i>>o),g=2*h+(s>>o),m=new Float32Array(p*g),y=new Float32Array(p*g);let b=m;u.forEach(v=>{const x=d+(+t(v)>>o),S=h+(+e(v)>>o);x>=0&&x<p&&S>=0&&S<g&&(m[x+S*p]+=+n(v))}),l>0&&f>0?(qd(p,g,m,y,l),Wd(p,g,y,m,f),qd(p,g,m,y,l),Wd(p,g,y,m,f),qd(p,g,m,y,l),Wd(p,g,y,m,f)):l>0?(qd(p,g,m,y,l),qd(p,g,y,m,l),qd(p,g,m,y,l),b=y):f>0&&(Wd(p,g,m,y,f),Wd(p,g,y,m,f),Wd(p,g,m,y,f),b=y);const w=c?Math.pow(2,-2*o):1/ls(b);for(let v=0,x=p*g;v<x;++v)b[v]*=w;return{values:b,scale:1<<o,width:p,height:g,x1:d,y1:h,x2:d+(i>>o),y2:h+(s>>o)}}return a.x=function(u){return arguments.length?(t=r$(u),a):t},a.y=function(u){return arguments.length?(e=r$(u),a):e},a.weight=function(u){return arguments.length?(n=r$(u),a):n},a.size=function(u){if(!arguments.length)return[i,s];var c=+u[0],l=+u[1];return c>=0&&l>=0||j("invalid size"),i=c,s=l,a},a.cellSize=function(u){return arguments.length?((u=+u)>=1||j("invalid cell size"),o=Math.floor(Math.log(u)/Math.LN2),a):1<<o},a.bandwidth=function(u){return arguments.length?(u=ot(u),u.length===1&&(u=[+u[0],+u[0]]),u.length!==2&&j("invalid bandwidth"),r=u,a):r},a}function qd(t,e,n,r,i){const s=(i<<1)+1;for(let o=0;o<e;++o)for(let a=0,u=0;a<t+i;++a)a<t&&(u+=n[a+o*t]),a>=i&&(a>=s&&(u-=n[a-s+o*t]),r[a-i+o*t]=u/Math.min(a+1,t-1+s-a,s))}function Wd(t,e,n,r,i){const s=(i<<1)+1;for(let o=0;o<t;++o)for(let a=0,u=0;a<e+i;++a)a<e&&(u+=n[o+a*t]),a>=i&&(a>=s&&(u-=n[o+(a-s)*t]),r[o+(a-i)*t]=u/Math.min(a+1,e-1+s-a,s))}function zN(t){z.call(this,null,t)}zN.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const wOt=["x","y","weight","size","cellSize","bandwidth"];function Het(t,e){return wOt.forEach(n=>e[n]!=null?t[n](e[n]):0),t}tt(zN,z,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=e.materialize(e.SOURCE).source,i=xOt(r,t.groupby),s=(t.groupby||[]).map(rn),o=Het(Yet(),t),a=t.as||"grid",u=[];function c(l,f){for(let d=0;d<s.length;++d)l[s[d]]=f[d];return l}return u=i.map(l=>le(c({[a]:o(l,t.counts)},l.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function xOt(t,e){var n=[],r=l=>l(a),i,s,o,a,u,c;if(e==null)n.push(t);else for(i={},s=0,o=t.length;s<o;++s)a=t[s],u=e.map(r),c=i[u],c||(i[u]=c=[],c.dims=u,n.push(c)),c.push(a);return n}function UN(t){z.call(this,null,t)}UN.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};tt(UN,z,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=Wet().smooth(t.smooth!==!1),i=t.values,s=t.thresholds||Vet(t.count||10,t.nice,!!i),o=t.size,a,u;return i||(i=e.materialize(e.SOURCE).source,a=Het(Yet(),t)(i,!0),u=Get(a,a.scale||1,a.scale||1,0,0),o=[a.width,a.height],i=a.values),s=W(s)?s:s(i),i=r.size(o)(i,s),u&&i.forEach(u),this.value&&(n.rem=this.value),this.value=n.source=n.add=(i||[]).map(le),n}});const Sk="Feature",jN="FeatureCollection",_Ot="MultiPoint";function qN(t){z.call(this,null,t)}qN.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};tt(qN,z,{transform(t,e){var n=this._features,r=this._points,i=t.fields,s=i&&i[0],o=i&&i[1],a=t.geojson||!i&&Er,u=e.ADD,c;c=t.modified()||e.changed(e.REM)||e.modified(yr(a))||s&&e.modified(yr(s))||o&&e.modified(yr(o)),(!this.value||c)&&(u=e.SOURCE,this._features=n=[],this._points=r=[]),a&&e.visit(u,l=>n.push(a(l))),s&&o&&(e.visit(u,l=>{var f=s(l),d=o(l);f!=null&&d!=null&&(f=+f)===f&&(d=+d)===d&&r.push([f,d])}),n=n.concat({type:Sk,geometry:{type:_Ot,coordinates:r}})),this.value={type:jN,features:n}}});function WN(t){z.call(this,null,t)}WN.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};tt(WN,z,{transform(t,e){var n=e.fork(e.ALL),r=this.value,i=t.field||Er,s=t.as||"path",o=n.SOURCE;!r||t.modified()?(this.value=r=qet(t.projection),n.materialize().reflow()):o=i===Er||e.modified(i.fields)?n.ADD_MOD:n.ADD;const a=SOt(r,t.pointRadius);return n.visit(o,u=>u[s]=r(i(u))),r.pointRadius(a),n.modifies(s)}});function SOt(t,e){const n=t.pointRadius();return t.context(null),e!=null&&t.pointRadius(e),n}function VN(t){z.call(this,null,t)}VN.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};tt(VN,z,{transform(t,e){var n=t.projection,r=t.fields[0],i=t.fields[1],s=t.as||["x","y"],o=s[0],a=s[1],u;function c(l){const f=n([r(l),i(l)]);f?(l[o]=f[0],l[a]=f[1]):(l[o]=void 0,l[a]=void 0)}return t.modified()?e=e.materialize().reflow(!0).visit(e.SOURCE,c):(u=e.modified(r.fields)||e.modified(i.fields),e.visit(u?e.ADD_MOD:e.ADD,c)),e.modifies(s)}});function GN(t){z.call(this,null,t)}GN.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};tt(GN,z,{transform(t,e){var n=e.fork(e.ALL),r=this.value,i=t.as||"shape",s=n.ADD;return(!r||t.modified())&&(this.value=r=EOt(qet(t.projection),t.field||ys("datum"),t.pointRadius),n.materialize().reflow(),s=n.SOURCE),n.visit(s,o=>o[i]=r),n.modifies(i)}});function EOt(t,e,n){const r=n==null?i=>t(e(i)):i=>{var s=t.pointRadius(),o=t.pointRadius(n)(e(i));return t.pointRadius(s),o};return r.context=i=>(t.context(i),r),r}function YN(t){z.call(this,[],t),this.generator=TW()}YN.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};tt(YN,z,{transform(t,e){var n=this.value,r=this.generator,i;if(!n.length||t.modified())for(const s in t)jt(r[s])&&r[s](t[s]);return i=r(),n.length?e.mod.push(HJ(n[0],i)):e.add.push(le(i)),n[0]=i,e}});function HN(t){z.call(this,null,t)}HN.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};tt(HN,z,{transform(t,e){if(!e.changed()&&!t.modified())return e.StopPropagation;var n=e.materialize(e.SOURCE).source,r=t.resolve==="shared",i=t.field||Er,s=$Ot(t.opacity,t),o=AOt(t.color,t),a=t.as||"image",u={$x:0,$y:0,$value:0,$max:r?Be(n.map(c=>Be(i(c).values))):0};return n.forEach(c=>{const l=i(c),f=Pt({},c,u);r||(f.$max=Be(l.values||[])),c[a]=TOt(l,f,o.dep?o:Ar(o(f)),s.dep?s:Ar(s(f)))}),e.reflow(!0).modifies(a)}});function AOt(t,e){let n;return jt(t)?(n=r=>li(t(r,e)),n.dep=Xet(t)):n=Ar(li(t||"#888")),n}function $Ot(t,e){let n;return jt(t)?(n=r=>t(r,e),n.dep=Xet(t)):t?n=Ar(t):(n=r=>r.$value/r.$max||0,n.dep=!0),n}function Xet(t){if(!jt(t))return!1;const e=Gs(yr(t));return e.$x||e.$y||e.$value||e.$max}function TOt(t,e,n,r){const i=t.width,s=t.height,o=t.x1||0,a=t.y1||0,u=t.x2||i,c=t.y2||s,l=t.values,f=l?m=>l[m]:uc,d=$c(u-o,c-a),h=d.getContext("2d"),p=h.getImageData(0,0,u-o,c-a),g=p.data;for(let m=a,y=0;m<c;++m){e.$y=m-a;for(let b=o,w=m*i;b<u;++b,y+=4){e.$x=b-o,e.$value=f(b+w);const v=n(e);g[y+0]=v.r,g[y+1]=v.g,g[y+2]=v.b,g[y+3]=~~(255*r(e))}}return h.putImageData(p,0,0),d}function Ket(t){z.call(this,null,t),this.modified(!0)}tt(Ket,z,{transform(t,e){let n=this.value;return!n||t.modified("type")?(this.value=n=MOt(t.type),_k.forEach(r=>{t[r]!=null&&y7(n,r,t[r])})):_k.forEach(r=>{t.modified(r)&&y7(n,r,t[r])}),t.pointRadius!=null&&n.path.pointRadius(t.pointRadius),t.fit&&kOt(n,t),e.fork(e.NO_SOURCE|e.NO_FIELDS)}});function kOt(t,e){const n=COt(e.fit);e.extent?t.fitExtent(e.extent,n):e.size&&t.fitSize(e.size,n)}function MOt(t){const e=BN((t||"mercator").toLowerCase());return e||j("Unrecognized projection type: "+t),e()}function y7(t,e,n){jt(t[e])&&t[e](n)}function COt(t){return t=ot(t),t.length===1?t[0]:{type:jN,features:t.reduce((e,n)=>e.concat(IOt(n)),[])}}function IOt(t){return t.type===jN?t.features:ot(t).filter(e=>e!=null).map(e=>e.type===Sk?e:{type:Sk,geometry:e})}const FOt=Object.freeze(Object.defineProperty({__proto__:null,contour:UN,geojson:qN,geopath:WN,geopoint:VN,geoshape:GN,graticule:YN,heatmap:HN,isocontour:PN,kde2d:zN,projection:Ket},Symbol.toStringTag,{value:"Module"})),b7={center:E1t,collide:q1t,nbody:tbt,link:V1t,x:ebt,y:nbt},Bm="forces",Ek=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],NOt=["static","iterations"],Qet=["x","y","vx","vy"];function XN(t){z.call(this,null,t)}XN.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30,expr:!0},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:Qet}]};tt(XN,z,{transform(t,e){var n=this.value,r=e.changed(e.ADD_REM),i=t.modified(Ek),s=t.iterations||300;if(n?(r&&(e.modifies("index"),n.nodes(e.source)),(i||e.changed(e.MOD))&&Jet(n,t,0,e)):(this.value=n=ROt(e.source,t),n.on("tick",OOt(e.dataflow,this)),t.static||(r=!0,n.tick()),e.modifies("index")),i||r||t.modified(NOt)||e.changed()&&t.restart){if(n.alpha(Math.max(n.alpha(),t.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/s)),t.static)for(n.stop();--s>=0;)n.tick();else if(n.stopped()&&n.restart(),!r)return e.StopPropagation}return this.finish(t,e)},finish(t,e){const n=e.dataflow;for(let a=this._argops,u=0,c=a.length,l;u<c;++u)if(l=a[u],!(l.name!==Bm||l.op._argval.force!=="link")){for(var r=l.op._argops,i=0,s=r.length,o;i<s;++i)if(r[i].name==="links"&&(o=r[i].op.source)){n.pulse(o,n.changeset().reflow());break}}return e.reflow(t.modified()).modifies(Qet)}});function OOt(t,e){return()=>t.touch(e).run()}function ROt(t,e){const n=Z1t(t),r=n.stop,i=n.restart;let s=!1;return n.stopped=()=>s,n.restart=()=>(s=!1,i()),n.stop=()=>(s=!0,r()),Jet(n,e,!0).on("end",()=>s=!0)}function Jet(t,e,n,r){var i=ot(e.forces),s,o,a,u;for(s=0,o=Ek.length;s<o;++s)a=Ek[s],a!==Bm&&e.modified(a)&&t[a](e[a]);for(s=0,o=i.length;s<o;++s)u=Bm+s,a=n||e.modified(Bm,s)?LOt(i[s]):r&&DOt(i[s],r)?t.force(u):null,a&&t.force(u,a);for(o=t.numForces||0;s<o;++s)t.force(Bm+s,null);return t.numForces=i.length,t}function DOt(t,e){var n,r;for(n in t)if(jt(r=t[n])&&e.modified(yr(r)))return 1;return 0}function LOt(t){var e,n;ft(b7,t.force)||j("Unrecognized force: "+t.force),e=b7[t.force]();for(n in t)jt(e[n])&&BOt(e[n],t[n],t);return e}function BOt(t,e,n){t(jt(e)?r=>e(r,n):e)}const POt=Object.freeze(Object.defineProperty({__proto__:null,force:XN},Symbol.toStringTag,{value:"Module"}));function Ak(t,e,n){const r={};return t.each(i=>{const s=i.data;n(s)&&(r[e(s)]=i)}),t.lookup=r,t}function KN(t){z.call(this,null,t)}KN.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const zOt=t=>t.values;tt(KN,z,{transform(t,e){e.source||j("Nest transform requires an upstream data source.");var n=t.generate,r=t.modified(),i=e.clone(),s=this.value;return(!s||r||e.changed())&&(s&&s.each(o=>{o.children&&X_(o.data)&&i.rem.push(o.data)}),this.value=s=XC({values:ot(t.keys).reduce((o,a)=>(o.key(a),o),UOt()).entries(i.source)},zOt),n&&s.each(o=>{o.children&&(o=le(o.data),i.add.push(o),i.source.push(o))}),Ak(s,vt,vt)),i.source.root=s,i}});function UOt(){const t=[],e={entries:i=>r(n(i,0),0),key:i=>(t.push(i),e)};function n(i,s){if(s>=t.length)return i;const o=i.length,a=t[s++],u={},c={};let l=-1,f,d,h;for(;++l<o;)f=a(d=i[l])+"",(h=u[f])?h.push(d):u[f]=[d];for(f in u)c[f]=n(u[f],s);return c}function r(i,s){if(++s>t.length)return i;const o=[];for(const a in i)o.push({key:a,values:r(i[a],s)});return o}return e}function Ru(t){z.call(this,null,t)}const jOt=(t,e)=>t.parent===e.parent?1:2;tt(Ru,z,{transform(t,e){(!e.source||!e.source.root)&&j(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(t.method),r=this.fields,i=e.source.root,s=t.as||r;t.field?i.sum(t.field):i.count(),t.sort&&i.sort(ld(t.sort,o=>o.data)),qOt(n,this.params,t),n.separation&&n.separation(t.separation!==!1?jOt:lg);try{this.value=n(i)}catch(o){j(o)}return i.each(o=>WOt(o,r,s)),e.reflow(t.modified()).modifies(s).modifies("leaf")}});function qOt(t,e,n){for(let r,i=0,s=e.length;i<s;++i)r=e[i],r in n&&t[r](n[r])}function WOt(t,e,n){const r=t.data,i=e.length-1;for(let s=0;s<i;++s)r[n[s]]=t[e[s]];r[n[i]]=t.children?t.children.length:0}const $k=["x","y","r","depth","children"];function QN(t){Ru.call(this,t)}QN.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:$k.length,default:$k}]};tt(QN,Ru,{layout:jvt,params:["radius","size","padding"],fields:$k});const Tk=["x0","y0","x1","y1","depth","children"];function JN(t){Ru.call(this,t)}JN.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Tk.length,default:Tk}]};tt(JN,Ru,{layout:qvt,params:["size","round","padding"],fields:Tk});function ZN(t){z.call(this,null,t)}ZN.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};tt(ZN,z,{transform(t,e){e.source||j("Stratify transform requires an upstream data source.");let n=this.value;const r=t.modified(),i=e.fork(e.ALL).materialize(e.SOURCE),s=!n||r||e.changed(e.ADD_REM)||e.modified(t.key.fields)||e.modified(t.parentKey.fields);return i.source=i.source.slice(),s&&(n=i.source.length?Ak(rx().id(t.key).parentId(t.parentKey)(i.source),t.key,bs):Ak(rx()([{}]),t.key,t.key)),i.source.root=this.value=n,i}});const v7={tidy:C0,cluster:HC},kk=["x","y","depth","children"];function tO(t){Ru.call(this,t)}tO.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:kk.length,default:kk}]};tt(tO,Ru,{layout(t){const e=t||"tidy";if(ft(v7,e))return v7[e]();j("Unrecognized Tree layout method: "+e)},params:["size","nodeSize"],fields:kk});function eO(t){z.call(this,[],t)}eO.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};tt(eO,z,{transform(t,e){const n=this.value,r=e.source&&e.source.root,i=e.fork(e.NO_SOURCE),s={};return r||j("TreeLinks transform requires a tree data source."),e.changed(e.ADD_REM)?(i.rem=n,e.visit(e.SOURCE,o=>s[vt(o)]=1),r.each(o=>{const a=o.data,u=o.parent&&o.parent.data;u&&s[vt(a)]&&s[vt(u)]&&i.add.push(le({source:u,target:a}))}),this.value=i.add):e.changed(e.MOD)&&(e.visit(e.MOD,o=>s[vt(o)]=1),n.forEach(o=>{(s[vt(o.source)]||s[vt(o.target)])&&i.mod.push(o)})),i}});const w7={binary:twt,dice:Ty,slice:X2,slicedice:ewt,squarify:gV,resquarify:nwt},Mk=["x0","y0","x1","y1","depth","children"];function nO(t){Ru.call(this,t)}nO.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Mk.length,default:Mk}]};tt(nO,Ru,{layout(){const t=Zvt();return t.ratio=e=>{const n=t.tile();n.ratio&&t.tile(n.ratio(e))},t.method=e=>{ft(w7,e)?t.tile(w7[e]):j("Unrecognized Treemap layout method: "+e)},t},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:Mk});const VOt=Object.freeze(Object.defineProperty({__proto__:null,nest:KN,pack:QN,partition:JN,stratify:ZN,tree:tO,treelinks:eO,treemap:nO},Symbol.toStringTag,{value:"Module"})),i$=4278190080;function GOt(t,e){const n=t.bitmap();return(e||[]).forEach(r=>n.set(t(r.boundary[0]),t(r.boundary[3]))),[n,void 0]}function YOt(t,e,n,r,i){const s=t.width,o=t.height,a=r||i,u=$c(s,o).getContext("2d"),c=$c(s,o).getContext("2d"),l=a&&$c(s,o).getContext("2d");n.forEach(E=>Av(u,E,!1)),Av(c,e,!1),a&&Av(l,e,!0);const f=s$(u,s,o),d=s$(c,s,o),h=a&&s$(l,s,o),p=t.bitmap(),g=a&&t.bitmap();let m,y,b,w,v,x,S,_;for(y=0;y<o;++y)for(m=0;m<s;++m)v=y*s+m,x=f[v]&i$,_=d[v]&i$,S=a&&h[v]&i$,(x||S||_)&&(b=t(m),w=t(y),!i&&(x||_)&&p.set(b,w),a&&(x||S)&&g.set(b,w));return[p,g]}function s$(t,e,n){return new Uint32Array(t.getImageData(0,0,e,n).data.buffer)}function Av(t,e,n){if(!e.length)return;const r=e[0].mark.marktype;r==="group"?e.forEach(i=>{i.items.forEach(s=>Av(t,s.items,n))}):Bi[r].draw(t,{items:n?e.map(HOt):e})}function HOt(t){const e=K_(t,{});return e.stroke&&e.strokeOpacity!==0||e.fill&&e.fillOpacity!==0?{...e,strokeOpacity:1,stroke:"#000",fillOpacity:0}:e}const Oa=5,Tr=31,K0=32,ic=new Uint32Array(K0+1),Os=new Uint32Array(K0+1);Os[0]=0;ic[0]=~Os[0];for(let t=1;t<=K0;++t)Os[t]=Os[t-1]<<1|1,ic[t]=~Os[t];function XOt(t,e){const n=new Uint32Array(~~((t*e+K0)/K0));function r(s,o){n[s]|=o}function i(s,o){n[s]&=o}return{array:n,get:(s,o)=>{const a=o*t+s;return n[a>>>Oa]&1<<(a&Tr)},set:(s,o)=>{const a=o*t+s;r(a>>>Oa,1<<(a&Tr))},clear:(s,o)=>{const a=o*t+s;i(a>>>Oa,~(1<<(a&Tr)))},getRange:(s,o,a,u)=>{let c=u,l,f,d,h;for(;c>=o;--c)if(l=c*t+s,f=c*t+a,d=l>>>Oa,h=f>>>Oa,d===h){if(n[d]&ic[l&Tr]&Os[(f&Tr)+1])return!0}else{if(n[d]&ic[l&Tr]||n[h]&Os[(f&Tr)+1])return!0;for(let p=d+1;p<h;++p)if(n[p])return!0}return!1},setRange:(s,o,a,u)=>{let c,l,f,d,h;for(;o<=u;++o)if(c=o*t+s,l=o*t+a,f=c>>>Oa,d=l>>>Oa,f===d)r(f,ic[c&Tr]&Os[(l&Tr)+1]);else for(r(f,ic[c&Tr]),r(d,Os[(l&Tr)+1]),h=f+1;h<d;++h)r(h,4294967295)},clearRange:(s,o,a,u)=>{let c,l,f,d,h;for(;o<=u;++o)if(c=o*t+s,l=o*t+a,f=c>>>Oa,d=l>>>Oa,f===d)i(f,Os[c&Tr]|ic[(l&Tr)+1]);else for(i(f,Os[c&Tr]),i(d,ic[(l&Tr)+1]),h=f+1;h<d;++h)i(h,0)},outOfBounds:(s,o,a,u)=>s<0||o<0||u>=e||a>=t}}function KOt(t,e,n){const r=Math.max(1,Math.sqrt(t*e/1e6)),i=~~((t+2*n+r)/r),s=~~((e+2*n+r)/r),o=a=>~~((a+n)/r);return o.invert=a=>a*r-n,o.bitmap=()=>XOt(i,s),o.ratio=r,o.padding=n,o.width=t,o.height=e,o}function QOt(t,e,n,r){const i=t.width,s=t.height;return function(o){const a=o.datum.datum.items[r].items,u=a.length,c=o.datum.fontSize,l=Ci.width(o.datum,o.datum.text);let f=0,d,h,p,g,m,y,b;for(let w=0;w<u;++w)d=a[w].x,p=a[w].y,h=a[w].x2===void 0?d:a[w].x2,g=a[w].y2===void 0?p:a[w].y2,m=(d+h)/2,y=(p+g)/2,b=Math.abs(h-d+g-p),b>=f&&(f=b,o.x=m,o.y=y);return m=l/2,y=c/2,d=o.x-m,h=o.x+m,p=o.y-y,g=o.y+y,o.align="center",d<0&&h<=i?o.align="left":0<=d&&i<h&&(o.align="right"),o.baseline="middle",p<0&&g<=s?o.baseline="top":0<=p&&s<g&&(o.baseline="bottom"),!0}}function Gx(t,e,n,r,i,s){let o=n/2;return t-o<0||t+o>i||e-(o=r/2)<0||e+o>s}function wc(t,e,n,r,i,s,o,a){const u=i*s/(r*2),c=t(e-u),l=t(e+u),f=t(n-(s=s/2)),d=t(n+s);return o.outOfBounds(c,f,l,d)||o.getRange(c,f,l,d)||a&&a.getRange(c,f,l,d)}function JOt(t,e,n,r){const i=t.width,s=t.height,o=e[0],a=e[1];function u(c,l,f,d,h){const p=t.invert(c),g=t.invert(l);let m=f,y=s,b;if(!Gx(p,g,d,h,i,s)&&!wc(t,p,g,h,d,m,o,a)&&!wc(t,p,g,h,d,h,o,null)){for(;y-m>=1;)b=(m+y)/2,wc(t,p,g,h,d,b,o,a)?y=b:m=b;if(m>f)return[p,g,m,!0]}}return function(c){const l=c.datum.datum.items[r].items,f=l.length,d=c.datum.fontSize,h=Ci.width(c.datum,c.datum.text);let p=n?d:0,g=!1,m=!1,y=0,b,w,v,x,S,_,E,A,$,T,C,F,M,k,I,N,R;for(let D=0;D<f;++D){for(b=l[D].x,v=l[D].y,w=l[D].x2===void 0?b:l[D].x2,x=l[D].y2===void 0?v:l[D].y2,b>w&&(R=b,b=w,w=R),v>x&&(R=v,v=x,x=R),$=t(b),C=t(w),T=~~(($+C)/2),F=t(v),k=t(x),M=~~((F+k)/2),E=T;E>=$;--E)for(A=M;A>=F;--A)N=u(E,A,p,h,d),N&&([c.x,c.y,p,g]=N);for(E=T;E<=C;++E)for(A=M;A<=k;++A)N=u(E,A,p,h,d),N&&([c.x,c.y,p,g]=N);!g&&!n&&(I=Math.abs(w-b+x-v),S=(b+w)/2,_=(v+x)/2,I>=y&&!Gx(S,_,h,d,i,s)&&!wc(t,S,_,d,h,d,o,null)&&(y=I,c.x=S,c.y=_,m=!0))}return g||m?(S=h/2,_=d/2,o.setRange(t(c.x-S),t(c.y-_),t(c.x+S),t(c.y+_)),c.align="center",c.baseline="middle",!0):!1}}const ZOt=[-1,-1,1,1],tRt=[-1,1,-1,1];function eRt(t,e,n,r){const i=t.width,s=t.height,o=e[0],a=e[1],u=t.bitmap();return function(c){const l=c.datum.datum.items[r].items,f=l.length,d=c.datum.fontSize,h=Ci.width(c.datum,c.datum.text),p=[];let g=n?d:0,m=!1,y=!1,b=0,w,v,x,S,_,E,A,$,T,C,F,M;for(let k=0;k<f;++k){for(w=l[k].x,x=l[k].y,v=l[k].x2===void 0?w:l[k].x2,S=l[k].y2===void 0?x:l[k].y2,p.push([t((w+v)/2),t((x+S)/2)]);p.length;)if([A,$]=p.pop(),!(o.get(A,$)||a.get(A,$)||u.get(A,$))){u.set(A,$);for(let I=0;I<4;++I)_=A+ZOt[I],E=$+tRt[I],u.outOfBounds(_,E,_,E)||p.push([_,E]);if(_=t.invert(A),E=t.invert($),T=g,C=s,!Gx(_,E,h,d,i,s)&&!wc(t,_,E,d,h,T,o,a)&&!wc(t,_,E,d,h,d,o,null)){for(;C-T>=1;)F=(T+C)/2,wc(t,_,E,d,h,F,o,a)?C=F:T=F;T>g&&(c.x=_,c.y=E,g=T,m=!0)}}!m&&!n&&(M=Math.abs(v-w+S-x),_=(w+v)/2,E=(x+S)/2,M>=b&&!Gx(_,E,h,d,i,s)&&!wc(t,_,E,d,h,d,o,null)&&(b=M,c.x=_,c.y=E,y=!0))}return m||y?(_=h/2,E=d/2,o.setRange(t(c.x-_),t(c.y-E),t(c.x+_),t(c.y+E)),c.align="center",c.baseline="middle",!0):!1}}const nRt=["right","center","left"],rRt=["bottom","middle","top"];function iRt(t,e,n,r){const i=t.width,s=t.height,o=e[0],a=e[1],u=r.length;return function(c){const l=c.boundary,f=c.datum.fontSize;if(l[2]<0||l[5]<0||l[0]>i||l[3]>s)return!1;let d=c.textWidth??0,h,p,g,m,y,b,w,v,x,S,_,E,A,$,T;for(let C=0;C<u;++C){if(h=(n[C]&3)-1,p=(n[C]>>>2&3)-1,g=h===0&&p===0||r[C]<0,m=h&&p?Math.SQRT1_2:1,y=r[C]<0?-1:1,b=l[1+h]+r[C]*h*m,_=l[4+p]+y*f*p/2+r[C]*p*m,v=_-f/2,x=_+f/2,E=t(b),$=t(v),T=t(x),!d)if(x7(E,E,$,T,o,a,b,b,v,x,l,g))d=Ci.width(c.datum,c.datum.text);else continue;if(S=b+y*d*h/2,b=S-d/2,w=S+d/2,E=t(b),A=t(w),x7(E,A,$,T,o,a,b,w,v,x,l,g))return c.x=h?h*y<0?w:b:S,c.y=p?p*y<0?x:v:_,c.align=nRt[h*y+1],c.baseline=rRt[p*y+1],o.setRange(E,$,A,T),!0}return!1}}function x7(t,e,n,r,i,s,o,a,u,c,l,f){return!(i.outOfBounds(t,n,e,r)||(f&&s||i).getRange(t,n,e,r))}const o$=0,a$=4,u$=8,c$=0,l$=1,f$=2,sRt={"top-left":o$+c$,top:o$+l$,"top-right":o$+f$,left:a$+c$,middle:a$+l$,right:a$+f$,"bottom-left":u$+c$,bottom:u$+l$,"bottom-right":u$+f$},oRt={naive:QOt,"reduced-search":JOt,floodfill:eRt};function aRt(t,e,n,r,i,s,o,a,u,c,l){if(!t.length)return t;const f=Math.max(r.length,i.length),d=uRt(r,f),h=cRt(i,f),p=lRt(t[0].datum),g=p==="group"&&t[0].datum.items[u].marktype,m=g==="area",y=fRt(p,g,a,u),b=c===null||c===1/0,w=m&&l==="naive";let v=-1,x=-1;const S=t.map($=>{const T=b?Ci.width($,$.text):void 0;return v=Math.max(v,T),x=Math.max(x,$.fontSize),{datum:$,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y($),textWidth:T}});c=c===null||c===1/0?Math.max(v,x)+Math.max(...r):c;const _=KOt(e[0],e[1],c);let E;if(!w){n&&S.sort((C,F)=>n(C.datum,F.datum));let $=!1;for(let C=0;C<h.length&&!$;++C)$=h[C]===5||d[C]<0;const T=(p&&o||m)&&t.map(C=>C.datum);E=s.length||T?YOt(_,T||[],s,$,m):GOt(_,o&&S)}const A=m?oRt[l](_,E,o,u):iRt(_,E,h,d);return S.forEach($=>$.opacity=+A($)),S}function uRt(t,e){const n=new Float64Array(e),r=t.length;for(let i=0;i<r;++i)n[i]=t[i]||0;for(let i=r;i<e;++i)n[i]=n[r-1];return n}function cRt(t,e){const n=new Int8Array(e),r=t.length;for(let i=0;i<r;++i)n[i]|=sRt[t[i]];for(let i=r;i<e;++i)n[i]=n[r-1];return n}function lRt(t){return t&&t.mark&&t.mark.marktype}function fRt(t,e,n,r){const i=s=>[s.x,s.x,s.x,s.y,s.y,s.y];return t?t==="line"||t==="area"?s=>i(s.datum):e==="line"?s=>{const o=s.datum.items[r].items;return i(o.length?o[n==="start"?0:o.length-1]:{x:NaN,y:NaN})}:s=>{const o=s.datum.bounds;return[o.x1,(o.x1+o.x2)/2,o.x2,o.y1,(o.y1+o.y2)/2,o.y2]}:i}const Ck=["x","y","opacity","align","baseline"],Zet=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function rO(t){z.call(this,null,t)}rO.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:Zet},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0,null:!0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:Ck.length,default:Ck}]};tt(rO,z,{transform(t,e){function n(s){const o=t[s];return jt(o)&&e.modified(o.fields)}const r=t.modified();if(!(r||e.changed(e.ADD_REM)||n("sort")))return;(!t.size||t.size.length!==2)&&j("Size parameter should be specified as a [width, height] array.");const i=t.as||Ck;return aRt(e.materialize(e.SOURCE).source||[],t.size,t.sort,ot(t.offset==null?1:t.offset),ot(t.anchor||Zet),t.avoidMarks||[],t.avoidBaseMark!==!1,t.lineAnchor||"end",t.markIndex||0,t.padding===void 0?0:t.padding,t.method||"naive").forEach(s=>{const o=s.datum;o[i[0]]=s.x,o[i[1]]=s.y,o[i[2]]=s.opacity,o[i[3]]=s.align,o[i[4]]=s.baseline}),e.reflow(r).modifies(i)}});const dRt=Object.freeze(Object.defineProperty({__proto__:null,label:rO},Symbol.toStringTag,{value:"Module"}));function tnt(t,e){var n=[],r=function(l){return l(a)},i,s,o,a,u,c;if(e==null)n.push(t);else for(i={},s=0,o=t.length;s<o;++s)a=t[s],u=e.map(r),c=i[u],c||(i[u]=c=[],c.dims=u,n.push(c)),c.push(a);return n}function iO(t){z.call(this,null,t)}iO.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};tt(iO,z,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const r=e.materialize(e.SOURCE).source,i=tnt(r,t.groupby),s=(t.groupby||[]).map(rn),o=s.length,a=t.as||[rn(t.x),rn(t.y)],u=[];i.forEach(c=>{dZ(c,t.x,t.y,t.bandwidth||.3).forEach(l=>{const f={};for(let d=0;d<o;++d)f[s[d]]=c.dims[d];f[a[0]]=l[0],f[a[1]]=l[1],u.push(le(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}});const Ik={constant:m6,linear:y6,log:uZ,exp:cZ,pow:lZ,quad:b6,poly:fZ},hRt=(t,e)=>t==="poly"?e:t==="quad"?2:1;function sO(t){z.call(this,null,t)}sO.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(Ik)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};tt(sO,z,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const r=e.materialize(e.SOURCE).source,i=tnt(r,t.groupby),s=(t.groupby||[]).map(rn),o=t.method||"linear",a=t.order==null?3:t.order,u=hRt(o,a),c=t.as||[rn(t.x),rn(t.y)],l=Ik[o],f=[];let d=t.extent;ft(Ik,o)||j("Invalid regression method: "+o),d!=null&&o==="log"&&d[0]<=0&&(e.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),i.forEach(h=>{if(h.length<=u){e.dataflow.warn("Skipping regression with more parameters than data points.");return}const g=l(h,t.x,t.y,a);if(t.params){f.push(le({keys:h.dims,coef:g.coef,rSquared:g.rSquared}));return}const m=d||ea(h,t.x),y=b=>{const w={};for(let v=0;v<s.length;++v)w[s[v]]=h.dims[v];w[c[0]]=b[0],w[c[1]]=b[1],f.push(le(w))};o==="linear"||o==="constant"?m.forEach(b=>y([b,g.predict(b)])):rS(g.predict,m,25,200).forEach(y)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n}});const pRt=Object.freeze(Object.defineProperty({__proto__:null,loess:iO,regression:sO},Symbol.toStringTag,{value:"Module"}));function oO(t){z.call(this,null,t)}oO.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const gRt=[-1e5,-1e5,1e5,1e5];tt(oO,z,{transform(t,e){const n=t.as||"path",r=e.source;if(!r||!r.length)return e;let i=t.size;i=i?[0,0,i[0],i[1]]:(i=t.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:gRt;const s=this.value=Mu.from(r,t.x,t.y).voronoi(i);for(let o=0,a=r.length;o<a;++o){const u=s.cellPolygon(o);r[o][n]=u&&!yRt(u)?mRt(u):null}return e.reflow(t.modified()).modifies(n)}});function mRt(t){const e=t[0][0],n=t[0][1];let r=t.length-1;for(;t[r][0]===e&&t[r][1]===n;--r);return"M"+t.slice(0,r+1).join("L")+"Z"}function yRt(t){return t.length===2&&t[0][0]===t[1][0]&&t[0][1]===t[1][1]}const bRt=Object.freeze(Object.defineProperty({__proto__:null,voronoi:oO},Symbol.toStringTag,{value:"Module"}));var d$=Math.PI/180,Pm=64,$v=2048;function vRt(){var t=[256,256],e,n,r,i,s,o,a,u=ent,c=[],l=Math.random,f={};f.layout=function(){for(var p=d($c()),g=ARt((t[0]>>5)*t[1]),m=null,y=c.length,b=-1,w=[],v=c.map(S=>({text:e(S),font:n(S),style:i(S),weight:s(S),rotate:o(S),size:~~(r(S)+1e-14),padding:a(S),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:S})).sort((S,_)=>_.size-S.size);++b<y;){var x=v[b];x.x=t[0]*(l()+.5)>>1,x.y=t[1]*(l()+.5)>>1,wRt(p,x,v,b),x.hasText&&h(g,x,m)&&(w.push(x),m?_Rt(m,x):m=[{x:x.x+x.x0,y:x.y+x.y0},{x:x.x+x.x1,y:x.y+x.y1}],x.x-=t[0]>>1,x.y-=t[1]>>1)}return w};function d(p){p.width=p.height=1;var g=Math.sqrt(p.getContext("2d").getImageData(0,0,1,1).data.length>>2);p.width=(Pm<<5)/g,p.height=$v/g;var m=p.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:g}}function h(p,g,m){for(var y=g.x,b=g.y,w=Math.hypot(t[0],t[1]),v=u(t),x=l()<.5?1:-1,S=-x,_,E,A;(_=v(S+=x))&&(E=~~_[0],A=~~_[1],!(Math.min(Math.abs(E),Math.abs(A))>=w));)if(g.x=y+E,g.y=b+A,!(g.x+g.x0<0||g.y+g.y0<0||g.x+g.x1>t[0]||g.y+g.y1>t[1])&&(!m||!xRt(g,p,t[0]))&&(!m||SRt(g,m))){for(var $=g.sprite,T=g.width>>5,C=t[0]>>5,F=g.x-(T<<4),M=F&127,k=32-M,I=g.y1-g.y0,N=(g.y+g.y0)*C+(F>>5),R,D=0;D<I;D++){R=0;for(var L=0;L<=T;L++)p[N+L]|=R<<k|(L<T?(R=$[D*T+L])>>>M:0);N+=C}return g.sprite=null,!0}return!1}return f.words=function(p){return arguments.length?(c=p,f):c},f.size=function(p){return arguments.length?(t=[+p[0],+p[1]],f):t},f.font=function(p){return arguments.length?(n=kl(p),f):n},f.fontStyle=function(p){return arguments.length?(i=kl(p),f):i},f.fontWeight=function(p){return arguments.length?(s=kl(p),f):s},f.rotate=function(p){return arguments.length?(o=kl(p),f):o},f.text=function(p){return arguments.length?(e=kl(p),f):e},f.spiral=function(p){return arguments.length?(u=$Rt[p]||p,f):u},f.fontSize=function(p){return arguments.length?(r=kl(p),f):r},f.padding=function(p){return arguments.length?(a=kl(p),f):a},f.random=function(p){return arguments.length?(l=p,f):l},f}function wRt(t,e,n,r){if(!e.sprite){var i=t.context,s=t.ratio;i.clearRect(0,0,(Pm<<5)/s,$v/s);var o=0,a=0,u=0,c=n.length,l,f,d,h,p;for(--r;++r<c;){if(e=n[r],i.save(),i.font=e.style+" "+e.weight+" "+~~((e.size+1)/s)+"px "+e.font,l=i.measureText(e.text+"m").width*s,d=e.size<<1,e.rotate){var g=Math.sin(e.rotate*d$),m=Math.cos(e.rotate*d$),y=l*m,b=l*g,w=d*m,v=d*g;l=Math.max(Math.abs(y+v),Math.abs(y-v))+31>>5<<5,d=~~Math.max(Math.abs(b+w),Math.abs(b-w))}else l=l+31>>5<<5;if(d>u&&(u=d),o+l>=Pm<<5&&(o=0,a+=u,u=0),a+d>=$v)break;i.translate((o+(l>>1))/s,(a+(d>>1))/s),e.rotate&&i.rotate(e.rotate*d$),i.fillText(e.text,0,0),e.padding&&(i.lineWidth=2*e.padding,i.strokeText(e.text,0,0)),i.restore(),e.width=l,e.height=d,e.xoff=o,e.yoff=a,e.x1=l>>1,e.y1=d>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,o+=l}for(var x=i.getImageData(0,0,(Pm<<5)/s,$v/s).data,S=[];--r>=0;)if(e=n[r],!!e.hasText){for(l=e.width,f=l>>5,d=e.y1-e.y0,h=0;h<d*f;h++)S[h]=0;if(o=e.xoff,o==null)return;a=e.yoff;var _=0,E=-1;for(p=0;p<d;p++){for(h=0;h<l;h++){var A=f*p+(h>>5),$=x[(a+p)*(Pm<<5)+(o+h)<<2]?1<<31-h%32:0;S[A]|=$,_|=$}_?E=p:(e.y0++,d--,p--,a++)}e.y1=e.y0+E,e.sprite=S.slice(0,(e.y1-e.y0)*f)}}}function xRt(t,e,n){n>>=5;for(var r=t.sprite,i=t.width>>5,s=t.x-(i<<4),o=s&127,a=32-o,u=t.y1-t.y0,c=(t.y+t.y0)*n+(s>>5),l,f=0;f<u;f++){l=0;for(var d=0;d<=i;d++)if((l<<a|(d<i?(l=r[f*i+d])>>>o:0))&e[c+d])return!0;c+=n}return!1}function _Rt(t,e){var n=t[0],r=t[1];e.x+e.x0<n.x&&(n.x=e.x+e.x0),e.y+e.y0<n.y&&(n.y=e.y+e.y0),e.x+e.x1>r.x&&(r.x=e.x+e.x1),e.y+e.y1>r.y&&(r.y=e.y+e.y1)}function SRt(t,e){return t.x+t.x1>e[0].x&&t.x+t.x0<e[1].x&&t.y+t.y1>e[0].y&&t.y+t.y0<e[1].y}function ent(t){var e=t[0]/t[1];return function(n){return[e*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function ERt(t){var e=4,n=e*t[0]/t[1],r=0,i=0;return function(s){var o=s<0?-1:1;switch(Math.sqrt(1+4*o*s)-o&3){case 0:r+=n;break;case 1:i+=e;break;case 2:r-=n;break;default:i-=e;break}return[r,i]}}function ARt(t){for(var e=[],n=-1;++n<t;)e[n]=0;return e}function kl(t){return typeof t=="function"?t:function(){return t}}var $Rt={archimedean:ent,rectangular:ERt};const nnt=["x","y","font","fontSize","fontStyle","fontWeight","angle"],TRt=["text","font","rotate","fontSize","fontStyle","fontWeight"];function aO(t){z.call(this,vRt(),t)}aO.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:nnt}]};tt(aO,z,{transform(t,e){t.size&&!(t.size[0]&&t.size[1])&&j("Wordcloud size dimensions must be non-zero.");function n(p){const g=t[p];return jt(g)&&e.modified(g.fields)}const r=t.modified();if(!(r||e.changed(e.ADD_REM)||TRt.some(n)))return;const i=e.materialize(e.SOURCE).source,s=this.value,o=t.as||nnt;let a=t.fontSize||14,u;if(jt(a)?u=t.fontSizeRange:a=Ar(a),u){const p=a,g=ce("sqrt")().domain(ea(i,p)).range(u);a=m=>g(p(m))}i.forEach(p=>{p[o[0]]=NaN,p[o[1]]=NaN,p[o[3]]=0});const c=s.words(i).text(t.text).size(t.size||[500,500]).padding(t.padding||1).spiral(t.spiral||"archimedean").rotate(t.rotate||0).font(t.font||"sans-serif").fontStyle(t.fontStyle||"normal").fontWeight(t.fontWeight||"normal").fontSize(a).random(ws).layout(),l=s.size(),f=l[0]>>1,d=l[1]>>1,h=c.length;for(let p=0,g,m;p<h;++p)g=c[p],m=g.datum,m[o[0]]=g.x+f,m[o[1]]=g.y+d,m[o[2]]=g.font,m[o[3]]=g.size,m[o[4]]=g.style,m[o[5]]=g.weight,m[o[6]]=g.rotate;return e.reflow(r).modifies(o)}});const kRt=Object.freeze(Object.defineProperty({__proto__:null,wordcloud:aO},Symbol.toStringTag,{value:"Module"})),MRt=t=>new Uint8Array(t),CRt=t=>new Uint16Array(t),i0=t=>new Uint32Array(t);function IRt(){let t=8,e=[],n=i0(0),r=Ab(0,t),i=Ab(0,t);return{data:()=>e,seen:()=>n=FRt(n,e.length),add(s){for(let o=0,a=e.length,u=s.length,c;o<u;++o)c=s[o],c._index=a++,e.push(c)},remove(s,o){const a=e.length,u=Array(a-s),c=e;let l,f,d;for(f=0;!o[f]&&f<a;++f)u[f]=e[f],c[f]=f;for(d=f;f<a;++f)l=e[f],o[f]?c[f]=-1:(c[f]=d,r[d]=r[f],i[d]=i[f],u[d]=l,l._index=d++),r[f]=0;return e=u,c},size:()=>e.length,curr:()=>r,prev:()=>i,reset:s=>i[s]=r[s],all:()=>t<257?255:t<65537?65535:4294967295,set(s,o){r[s]|=o},clear(s,o){r[s]&=~o},resize(s,o){const a=r.length;(s>a||o>t)&&(t=Math.max(o,t),r=Ab(s,t,r),i=Ab(s,t))}}}function FRt(t,e,n){return t.length>=e?t:(n=n||new t.constructor(e),n.set(t),n)}function Ab(t,e,n){const r=(e<257?MRt:e<65537?CRt:i0)(t);return n&&r.set(n),r}function _7(t,e,n){const r=1<<e;return{one:r,zero:~r,range:n.slice(),bisect:t.bisect,index:t.index,size:t.size,onAdd(i,s){const o=this,a=o.bisect(o.range,i.value),u=i.index,c=a[0],l=a[1],f=u.length;let d;for(d=0;d<c;++d)s[u[d]]|=r;for(d=l;d<f;++d)s[u[d]]|=r;return o}}}function S7(){let t=i0(0),e=[],n=0;function r(a,u,c){if(!u.length)return[];const l=n,f=u.length,d=i0(f);let h=Array(f),p,g,m;for(m=0;m<f;++m)h[m]=a(u[m]),d[m]=m;if(h=NRt(h,d),l)p=e,g=t,e=Array(l+f),t=i0(l+f),ORt(c,p,g,l,h,d,f,e,t);else{if(c>0)for(m=0;m<f;++m)d[m]+=c;e=h,t=d}return n=l+f,{index:d,value:h}}function i(a,u){const c=n;let l,f,d;for(f=0;!u[t[f]]&&f<c;++f);for(d=f;f<c;++f)u[l=t[f]]||(t[d]=l,e[d]=e[f],++d);n=c-a}function s(a){for(let u=0,c=n;u<c;++u)t[u]=a[t[u]]}function o(a,u){let c;return u?c=u.length:(u=e,c=n),[Spt(u,a[0],0,c),hu(u,a[1],0,c)]}return{insert:r,remove:i,bisect:o,reindex:s,index:()=>t,size:()=>n}}function NRt(t,e){return t.sort.call(e,(n,r)=>{const i=t[n],s=t[r];return i<s?-1:i>s?1:0}),Jj(t,e)}function ORt(t,e,n,r,i,s,o,a,u){let c=0,l=0,f;for(f=0;c<r&&l<o;++f)e[c]<i[l]?(a[f]=e[c],u[f]=n[c++]):(a[f]=i[l],u[f]=s[l++]+t);for(;c<r;++c,++f)a[f]=e[c],u[f]=n[c];for(;l<o;++l,++f)a[f]=i[l],u[f]=s[l]+t}function uO(t){z.call(this,IRt(),t),this._indices=null,this._dims=null}uO.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};tt(uO,z,{transform(t,e){if(this._dims){var n=t.modified("fields")||t.fields.some(r=>e.modified(r.fields));return n?this.reinit(t,e):this.eval(t,e)}else return this.init(t,e)},init(t,e){const n=t.fields,r=t.query,i=this._indices={},s=this._dims=[],o=r.length;let a=0,u,c;for(;a<o;++a)u=n[a].fname,c=i[u]||(i[u]=S7()),s.push(_7(c,a,r[a]));return this.eval(t,e)},reinit(t,e){const n=e.materialize().fork(),r=t.fields,i=t.query,s=this._indices,o=this._dims,a=this.value,u=a.curr(),c=a.prev(),l=a.all(),f=n.rem=n.add,d=n.mod,h=i.length,p={};let g,m,y,b,w,v,x,S,_;if(c.set(u),e.rem.length&&(w=this.remove(t,e,n)),e.add.length&&a.add(e.add),e.mod.length)for(v={},b=e.mod,x=0,S=b.length;x<S;++x)v[b[x]._index]=1;for(x=0;x<h;++x)_=r[x],(!o[x]||t.modified("fields",x)||e.modified(_.fields))&&(y=_.fname,(g=p[y])||(s[y]=m=S7(),p[y]=g=m.insert(_,e.source,0)),o[x]=_7(m,x,i[x]).onAdd(g,u));for(x=0,S=a.data().length;x<S;++x)w[x]||(c[x]!==u[x]?f.push(x):v[x]&&u[x]!==l&&d.push(x));return a.mask=(1<<h)-1,n},eval(t,e){const n=e.materialize().fork(),r=this._dims.length;let i=0;return e.rem.length&&(this.remove(t,e,n),i|=(1<<r)-1),t.modified("query")&&!t.modified("fields")&&(i|=this.update(t,e,n)),e.add.length&&(this.insert(t,e,n),i|=(1<<r)-1),e.mod.length&&(this.modify(e,n),i|=(1<<r)-1),this.value.mask=i,n},insert(t,e,n){const r=e.add,i=this.value,s=this._dims,o=this._indices,a=t.fields,u={},c=n.add,l=i.size()+r.length,f=s.length;let d=i.size(),h,p,g;i.resize(l,f),i.add(r);const m=i.curr(),y=i.prev(),b=i.all();for(h=0;h<f;++h)p=a[h].fname,g=u[p]||(u[p]=o[p].insert(a[h],r,d)),s[h].onAdd(g,m);for(;d<l;++d)y[d]=b,m[d]!==b&&c.push(d)},modify(t,e){const n=e.mod,r=this.value,i=r.curr(),s=r.all(),o=t.mod;let a,u,c;for(a=0,u=o.length;a<u;++a)c=o[a]._index,i[c]!==s&&n.push(c)},remove(t,e,n){const r=this._indices,i=this.value,s=i.curr(),o=i.prev(),a=i.all(),u={},c=n.rem,l=e.rem;let f,d,h,p;for(f=0,d=l.length;f<d;++f)h=l[f]._index,u[h]=1,o[h]=p=s[h],s[h]=a,p!==a&&c.push(h);for(h in r)r[h].remove(d,u);return this.reindex(e,d,u),u},reindex(t,e,n){const r=this._indices,i=this.value;t.runAfter(()=>{const s=i.remove(e,n);for(const o in r)r[o].reindex(s)})},update(t,e,n){const r=this._dims,i=t.query,s=e.stamp,o=r.length;let a=0,u,c;for(n.filters=0,c=0;c<o;++c)t.modified("query",c)&&(u=c,++a);if(a===1)a=r[u].one,this.incrementOne(r[u],i[u],n.add,n.rem);else for(c=0,a=0;c<o;++c)t.modified("query",c)&&(a|=r[c].one,this.incrementAll(r[c],i[c],s,n.add),n.rem=n.add);return a},incrementAll(t,e,n,r){const i=this.value,s=i.seen(),o=i.curr(),a=i.prev(),u=t.index(),c=t.bisect(t.range),l=t.bisect(e),f=l[0],d=l[1],h=c[0],p=c[1],g=t.one;let m,y,b;if(f<h)for(m=f,y=Math.min(h,d);m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=g;else if(f>h)for(m=h,y=Math.min(f,p);m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=g;if(d>p)for(m=Math.max(f,p),y=d;m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=g;else if(d<p)for(m=Math.max(h,d),y=p;m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=g;t.range=e.slice()},incrementOne(t,e,n,r){const i=this.value,s=i.curr(),o=t.index(),a=t.bisect(t.range),u=t.bisect(e),c=u[0],l=u[1],f=a[0],d=a[1],h=t.one;let p,g,m;if(c<f)for(p=c,g=Math.min(f,l);p<g;++p)m=o[p],s[m]^=h,n.push(m);else if(c>f)for(p=f,g=Math.min(c,d);p<g;++p)m=o[p],s[m]^=h,r.push(m);if(l>d)for(p=Math.max(c,d),g=l;p<g;++p)m=o[p],s[m]^=h,n.push(m);else if(l<d)for(p=Math.max(f,l),g=d;p<g;++p)m=o[p],s[m]^=h,r.push(m);t.range=e.slice()}});function cO(t){z.call(this,null,t)}cO.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};tt(cO,z,{transform(t,e){const n=~(t.ignore||0),r=t.filter,i=r.mask;if(!(i&n))return e.StopPropagation;const s=e.fork(e.ALL),o=r.data(),a=r.curr(),u=r.prev(),c=l=>a[l]&n?null:o[l];return s.filter(s.MOD,c),i&i-1?(s.filter(s.ADD,l=>{const f=a[l]&n;return!f&&f^u[l]&n?o[l]:null}),s.filter(s.REM,l=>{const f=a[l]&n;return f&&!(f^(f^u[l]&n))?o[l]:null})):(s.filter(s.ADD,c),s.filter(s.REM,l=>(a[l]&n)===i?o[l]:null)),s.filter(s.SOURCE,l=>c(l._index))}});const RRt=Object.freeze(Object.defineProperty({__proto__:null,crossfilter:uO,resolvefilter:cO},Symbol.toStringTag,{value:"Module"})),DRt="RawCode",jf="Literal",LRt="Property",BRt="Identifier",PRt="ArrayExpression",zRt="BinaryExpression",rnt="CallExpression",URt="ConditionalExpression",jRt="LogicalExpression",qRt="MemberExpression",WRt="ObjectExpression",VRt="UnaryExpression";function so(t){this.type=t}so.prototype.visit=function(t){let e,n,r;if(t(this))return 1;for(e=GRt(this),n=0,r=e.length;n<r;++n)if(e[n].visit(t))return 1};function GRt(t){switch(t.type){case PRt:return t.elements;case zRt:case jRt:return[t.left,t.right];case rnt:return[t.callee].concat(t.arguments);case URt:return[t.test,t.consequent,t.alternate];case qRt:return[t.object,t.property];case WRt:return t.properties;case LRt:return[t.key,t.value];case VRt:return[t.argument];case BRt:case jf:case DRt:default:return[]}}var ya,pt,U,vr,be,xS=1,l1=2,qf=3,ml=4,_S=5,hd=6,ti=7,f1=8,YRt=9;ya={};ya[xS]="Boolean";ya[l1]="<end>";ya[qf]="Identifier";ya[ml]="Keyword";ya[_S]="Null";ya[hd]="Numeric";ya[ti]="Punctuator";ya[f1]="String";ya[YRt]="RegularExpression";var HRt="ArrayExpression",XRt="BinaryExpression",KRt="CallExpression",QRt="ConditionalExpression",int="Identifier",JRt="Literal",ZRt="LogicalExpression",tDt="MemberExpression",eDt="ObjectExpression",nDt="Property",rDt="UnaryExpression",Fn="Unexpected token %0",iDt="Unexpected number",sDt="Unexpected string",oDt="Unexpected identifier",aDt="Unexpected reserved word",uDt="Unexpected end of input",Fk="Invalid regular expression",h$="Invalid regular expression: missing /",snt="Octal literals are not allowed in strict mode.",cDt="Duplicate data property in object literal not allowed in strict mode",Kn="ILLEGAL",Q0="Disabled.",lDt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),fDt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function SS(t,e){if(!t)throw new Error("ASSERT: "+e)}function Ga(t){return t>=48&&t<=57}function lO(t){return"0123456789abcdefABCDEF".includes(t)}function s0(t){return"01234567".includes(t)}function dDt(t){return t===32||t===9||t===11||t===12||t===160||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].includes(t)}function J0(t){return t===10||t===13||t===8232||t===8233}function d1(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t===92||t>=128&&lDt.test(String.fromCharCode(t))}function Yx(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t===92||t>=128&&fDt.test(String.fromCharCode(t))}const hDt={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function ont(){for(;U<vr;){const t=pt.charCodeAt(U);if(dDt(t)||J0(t))++U;else break}}function Nk(t){var e,n,r,i=0;for(n=t==="u"?4:2,e=0;e<n;++e)U<vr&&lO(pt[U])?(r=pt[U++],i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())):oe({},Fn,Kn);return String.fromCharCode(i)}function pDt(){var t,e,n,r;for(t=pt[U],e=0,t==="}"&&oe({},Fn,Kn);U<vr&&(t=pt[U++],!!lO(t));)e=e*16+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||t!=="}")&&oe({},Fn,Kn),e<=65535?String.fromCharCode(e):(n=(e-65536>>10)+55296,r=(e-65536&1023)+56320,String.fromCharCode(n,r))}function ant(){var t,e;for(t=pt.charCodeAt(U++),e=String.fromCharCode(t),t===92&&(pt.charCodeAt(U)!==117&&oe({},Fn,Kn),++U,t=Nk("u"),(!t||t==="\\"||!d1(t.charCodeAt(0)))&&oe({},Fn,Kn),e=t);U<vr&&(t=pt.charCodeAt(U),!!Yx(t));)++U,e+=String.fromCharCode(t),t===92&&(e=e.substr(0,e.length-1),pt.charCodeAt(U)!==117&&oe({},Fn,Kn),++U,t=Nk("u"),(!t||t==="\\"||!Yx(t.charCodeAt(0)))&&oe({},Fn,Kn),e+=t);return e}function gDt(){var t,e;for(t=U++;U<vr;){if(e=pt.charCodeAt(U),e===92)return U=t,ant();if(Yx(e))++U;else break}return pt.slice(t,U)}function mDt(){var t,e,n;return t=U,e=pt.charCodeAt(U)===92?ant():gDt(),e.length===1?n=qf:hDt.hasOwnProperty(e)?n=ml:e==="null"?n=_S:e==="true"||e==="false"?n=xS:n=qf,{type:n,value:e,start:t,end:U}}function p$(){var t=U,e=pt.charCodeAt(U),n,r=pt[U],i,s,o;switch(e){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++U,{type:ti,value:String.fromCharCode(e),start:t,end:U};default:if(n=pt.charCodeAt(U+1),n===61)switch(e){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return U+=2,{type:ti,value:String.fromCharCode(e)+String.fromCharCode(n),start:t,end:U};case 33:case 61:return U+=2,pt.charCodeAt(U)===61&&++U,{type:ti,value:pt.slice(t,U),start:t,end:U}}}if(o=pt.substr(U,4),o===">>>=")return U+=4,{type:ti,value:o,start:t,end:U};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return U+=3,{type:ti,value:s,start:t,end:U};if(i=s.substr(0,2),r===i[1]&&"+-<>&|".includes(r)||i==="=>")return U+=2,{type:ti,value:i,start:t,end:U};if(i==="//"&&oe({},Fn,Kn),"<>=!+-*%&|^/".includes(r))return++U,{type:ti,value:r,start:t,end:U};oe({},Fn,Kn)}function yDt(t){let e="";for(;U<vr&&lO(pt[U]);)e+=pt[U++];return e.length===0&&oe({},Fn,Kn),d1(pt.charCodeAt(U))&&oe({},Fn,Kn),{type:hd,value:parseInt("0x"+e,16),start:t,end:U}}function bDt(t){let e="0"+pt[U++];for(;U<vr&&s0(pt[U]);)e+=pt[U++];return(d1(pt.charCodeAt(U))||Ga(pt.charCodeAt(U)))&&oe({},Fn,Kn),{type:hd,value:parseInt(e,8),octal:!0,start:t,end:U}}function E7(){var t,e,n;if(n=pt[U],SS(Ga(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),e=U,t="",n!=="."){if(t=pt[U++],n=pt[U],t==="0"){if(n==="x"||n==="X")return++U,yDt(e);if(s0(n))return bDt(e);n&&Ga(n.charCodeAt(0))&&oe({},Fn,Kn)}for(;Ga(pt.charCodeAt(U));)t+=pt[U++];n=pt[U]}if(n==="."){for(t+=pt[U++];Ga(pt.charCodeAt(U));)t+=pt[U++];n=pt[U]}if(n==="e"||n==="E")if(t+=pt[U++],n=pt[U],(n==="+"||n==="-")&&(t+=pt[U++]),Ga(pt.charCodeAt(U)))for(;Ga(pt.charCodeAt(U));)t+=pt[U++];else oe({},Fn,Kn);return d1(pt.charCodeAt(U))&&oe({},Fn,Kn),{type:hd,value:parseFloat(t),start:e,end:U}}function vDt(){var t="",e,n,r,i,s=!1;for(e=pt[U],SS(e==="'"||e==='"',"String literal must starts with a quote"),n=U,++U;U<vr;)if(r=pt[U++],r===e){e="";break}else if(r==="\\")if(r=pt[U++],!r||!J0(r.charCodeAt(0)))switch(r){case"u":case"x":pt[U]==="{"?(++U,t+=pDt()):t+=Nk(r);break;case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:s0(r)?(i="01234567".indexOf(r),i!==0&&(s=!0),U<vr&&s0(pt[U])&&(s=!0,i=i*8+"01234567".indexOf(pt[U++]),"0123".includes(r)&&U<vr&&s0(pt[U])&&(i=i*8+"01234567".indexOf(pt[U++]))),t+=String.fromCharCode(i)):t+=r;break}else r==="\r"&&pt[U]===`
`&&++U;else{if(J0(r.charCodeAt(0)))break;t+=r}return e!==""&&oe({},Fn,Kn),{type:f1,value:t,octal:s,start:n,end:U}}function wDt(t,e){let n=t;e.includes("u")&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(r,i)=>{if(parseInt(i,16)<=1114111)return"x";oe({},Fk)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{oe({},Fk)}try{return new RegExp(t,e)}catch{return null}}function xDt(){var t,e,n,r,i;for(t=pt[U],SS(t==="/","Regular expression literal must start with a slash"),e=pt[U++],n=!1,r=!1;U<vr;)if(t=pt[U++],e+=t,t==="\\")t=pt[U++],J0(t.charCodeAt(0))&&oe({},h$),e+=t;else if(J0(t.charCodeAt(0)))oe({},h$);else if(n)t==="]"&&(n=!1);else if(t==="/"){r=!0;break}else t==="["&&(n=!0);return r||oe({},h$),i=e.substr(1,e.length-2),{value:i,literal:e}}function _Dt(){var t,e,n;for(e="",n="";U<vr&&(t=pt[U],!!Yx(t.charCodeAt(0)));)++U,t==="\\"&&U<vr?oe({},Fn,Kn):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&oe({},Fk,n),{value:n,literal:e}}function SDt(){var t,e,n,r;return be=null,ont(),t=U,e=xDt(),n=_Dt(),r=wDt(e.value,n.value),{literal:e.literal+n.literal,value:r,regex:{pattern:e.value,flags:n.value},start:t,end:U}}function EDt(t){return t.type===qf||t.type===ml||t.type===xS||t.type===_S}function unt(){if(ont(),U>=vr)return{type:l1,start:U,end:U};const t=pt.charCodeAt(U);return d1(t)?mDt():t===40||t===41||t===59?p$():t===39||t===34?vDt():t===46?Ga(pt.charCodeAt(U+1))?E7():p$():Ga(t)?E7():p$()}function ri(){const t=be;return U=t.end,be=unt(),U=t.end,t}function cnt(){const t=U;be=unt(),U=t}function ADt(t){const e=new so(HRt);return e.elements=t,e}function A7(t,e,n){const r=new so(t==="||"||t==="&&"?ZRt:XRt);return r.operator=t,r.left=e,r.right=n,r}function $Dt(t,e){const n=new so(KRt);return n.callee=t,n.arguments=e,n}function TDt(t,e,n){const r=new so(QRt);return r.test=t,r.consequent=e,r.alternate=n,r}function fO(t){const e=new so(int);return e.name=t,e}function zm(t){const e=new so(JRt);return e.value=t.value,e.raw=pt.slice(t.start,t.end),t.regex&&(e.raw==="//"&&(e.raw="/(?:)/"),e.regex=t.regex),e}function $7(t,e,n){const r=new so(tDt);return r.computed=t==="[",r.object=e,r.property=n,r.computed||(n.member=!0),r}function kDt(t){const e=new so(eDt);return e.properties=t,e}function T7(t,e,n){const r=new so(nDt);return r.key=e,r.value=n,r.kind=t,r}function MDt(t,e){const n=new so(rDt);return n.operator=t,n.argument=e,n.prefix=!0,n}function oe(t,e){var n,r=Array.prototype.slice.call(arguments,2),i=e.replace(/%(\d)/g,(s,o)=>(SS(o<r.length,"Message reference must be in range"),r[o]));throw n=new Error(i),n.index=U,n.description=i,n}function ES(t){t.type===l1&&oe(t,uDt),t.type===hd&&oe(t,iDt),t.type===f1&&oe(t,sDt),t.type===qf&&oe(t,oDt),t.type===ml&&oe(t,aDt),oe(t,Fn,t.value)}function wr(t){const e=ri();(e.type!==ti||e.value!==t)&&ES(e)}function Oe(t){return be.type===ti&&be.value===t}function g$(t){return be.type===ml&&be.value===t}function CDt(){const t=[];for(U=be.start,wr("[");!Oe("]");)Oe(",")?(ri(),t.push(null)):(t.push(Wf()),Oe("]")||wr(","));return ri(),ADt(t)}function k7(){U=be.start;const t=ri();return t.type===f1||t.type===hd?(t.octal&&oe(t,snt),zm(t)):fO(t.value)}function IDt(){var t,e,n,r;if(U=be.start,t=be,t.type===qf)return n=k7(),wr(":"),r=Wf(),T7("init",n,r);if(t.type===l1||t.type===ti)ES(t);else return e=k7(),wr(":"),r=Wf(),T7("init",e,r)}function FDt(){var t=[],e,n,r,i={},s=String;for(U=be.start,wr("{");!Oe("}");)e=IDt(),e.key.type===int?n=e.key.name:n=s(e.key.value),r="$"+n,Object.prototype.hasOwnProperty.call(i,r)?oe({},cDt):i[r]=!0,t.push(e),Oe("}")||wr(",");return wr("}"),kDt(t)}function NDt(){wr("(");const t=dO();return wr(")"),t}const ODt={if:1};function RDt(){var t,e,n;if(Oe("("))return NDt();if(Oe("["))return CDt();if(Oe("{"))return FDt();if(t=be.type,U=be.start,t===qf||ODt[be.value])n=fO(ri().value);else if(t===f1||t===hd)be.octal&&oe(be,snt),n=zm(ri());else{if(t===ml)throw new Error(Q0);t===xS?(e=ri(),e.value=e.value==="true",n=zm(e)):t===_S?(e=ri(),e.value=null,n=zm(e)):Oe("/")||Oe("/=")?(n=zm(SDt()),cnt()):ES(ri())}return n}function DDt(){const t=[];if(wr("("),!Oe(")"))for(;U<vr&&(t.push(Wf()),!Oe(")"));)wr(",");return wr(")"),t}function LDt(){U=be.start;const t=ri();return EDt(t)||ES(t),fO(t.value)}function BDt(){return wr("."),LDt()}function PDt(){wr("[");const t=dO();return wr("]"),t}function zDt(){var t,e,n;for(t=RDt();;)if(Oe("."))n=BDt(),t=$7(".",t,n);else if(Oe("("))e=DDt(),t=$Dt(t,e);else if(Oe("["))n=PDt(),t=$7("[",t,n);else break;return t}function M7(){const t=zDt();if(be.type===ti&&(Oe("++")||Oe("--")))throw new Error(Q0);return t}function Tv(){var t,e;if(be.type!==ti&&be.type!==ml)e=M7();else{if(Oe("++")||Oe("--"))throw new Error(Q0);if(Oe("+")||Oe("-")||Oe("~")||Oe("!"))t=ri(),e=Tv(),e=MDt(t.value,e);else{if(g$("delete")||g$("void")||g$("typeof"))throw new Error(Q0);e=M7()}}return e}function C7(t){let e=0;if(t.type!==ti&&t.type!==ml)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11;break}return e}function UDt(){var t,e,n,r,i,s,o,a,u,c;if(t=be,u=Tv(),r=be,i=C7(r),i===0)return u;for(r.prec=i,ri(),e=[t,be],o=Tv(),s=[u,r,o];(i=C7(be))>0;){for(;s.length>2&&i<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),e.pop(),n=A7(a,u,o),s.push(n);r=ri(),r.prec=i,s.push(r),e.push(be),n=Tv(),s.push(n)}for(c=s.length-1,n=s[c],e.pop();c>1;)e.pop(),n=A7(s[c-1].value,s[c-2],n),c-=2;return n}function Wf(){var t,e,n;return t=UDt(),Oe("?")&&(ri(),e=Wf(),wr(":"),n=Wf(),t=TDt(t,e,n)),t}function dO(){const t=Wf();if(Oe(","))throw new Error(Q0);return t}function hO(t){pt=t,U=0,vr=pt.length,be=null,cnt();const e=dO();if(be.type!==l1)throw new Error("Unexpect token after expression.");return e}var lnt={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function fnt(t){function e(o,a,u,c){let l=t(a[0]);return u&&(l=u+"("+l+")",u.lastIndexOf("new ",0)===0&&(l="("+l+")")),l+"."+o+(c<0?"":c===0?"()":"("+a.slice(1).map(t).join(",")+")")}function n(o,a,u){return c=>e(o,c,a,u)}const r="new Date",i="String",s="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&j("Missing arguments to clamp function."),o.length>3&&j("Too many arguments to clamp function.");const a=o.map(t);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:r,date:n("getDate",r,0),day:n("getDay",r,0),year:n("getFullYear",r,0),month:n("getMonth",r,0),hours:n("getHours",r,0),minutes:n("getMinutes",r,0),seconds:n("getSeconds",r,0),milliseconds:n("getMilliseconds",r,0),time:n("getTime",r,0),timezoneoffset:n("getTimezoneOffset",r,0),utcdate:n("getUTCDate",r,0),utcday:n("getUTCDay",r,0),utcyear:n("getUTCFullYear",r,0),utcmonth:n("getUTCMonth",r,0),utchours:n("getUTCHours",r,0),utcminutes:n("getUTCMinutes",r,0),utcseconds:n("getUTCSeconds",r,0),utcmilliseconds:n("getUTCMilliseconds",r,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",i,0),lower:n("toLowerCase",i,0),substring:n("substring",i),split:n("split",i),trim:n("trim",i,0),regexp:s,test:n("test",s),if:function(o){o.length<3&&j("Missing arguments to if function."),o.length>3&&j("Too many arguments to if function.");const a=o.map(t);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function jDt(t){const e=t&&t.length-1;return e&&(t[0]==='"'&&t[e]==='"'||t[0]==="'"&&t[e]==="'")?t.slice(1,-1):t}function dnt(t){t=t||{};const e=t.allowed?Gs(t.allowed):{},n=t.forbidden?Gs(t.forbidden):{},r=t.constants||lnt,i=(t.functions||fnt)(f),s=t.globalvar,o=t.fieldvar,a=jt(s)?s:p=>`${s}["${p}"]`;let u={},c={},l=0;function f(p){if(at(p))return p;const g=d[p.type];return g==null&&j("Unsupported type: "+p.type),g(p)}const d={Literal:p=>p.raw,Identifier:p=>{const g=p.name;return l>0?g:ft(n,g)?j("Illegal identifier: "+g):ft(r,g)?r[g]:ft(e,g)?g:(u[g]=1,a(g))},MemberExpression:p=>{const g=!p.computed,m=f(p.object);g&&(l+=1);const y=f(p.property);return m===o&&(c[jDt(y)]=1),g&&(l-=1),m+(g?"."+y:"["+y+"]")},CallExpression:p=>{p.callee.type!=="Identifier"&&j("Illegal callee type: "+p.callee.type);const g=p.callee.name,m=p.arguments,y=ft(i,g)&&i[g];return y||j("Unrecognized function: "+g),jt(y)?y(m):y+"("+m.map(f).join(",")+")"},ArrayExpression:p=>"["+p.elements.map(f).join(",")+"]",BinaryExpression:p=>"("+f(p.left)+" "+p.operator+" "+f(p.right)+")",UnaryExpression:p=>"("+p.operator+f(p.argument)+")",ConditionalExpression:p=>"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")",LogicalExpression:p=>"("+f(p.left)+p.operator+f(p.right)+")",ObjectExpression:p=>"{"+p.properties.map(f).join(",")+"}",Property:p=>{l+=1;const g=f(p.key);return l-=1,g+":"+f(p.value)}};function h(p){const g={code:f(p),globals:Object.keys(u),fields:Object.keys(c)};return u={},c={},g}return h.functions=i,h.constants=r,h}const I7=Symbol("vega_selection_getter");function hnt(t){return(!t.getter||!t.getter[I7])&&(t.getter=ys(t.field),t.getter[I7]=!0),t.getter}const pO="intersect",F7="union",qDt="vlMulti",WDt="vlPoint",N7="or",VDt="and",$o="_vgsid_",Z0=ys($o),GDt="E",YDt="R",HDt="R-E",XDt="R-LE",KDt="R-RE",QDt="E-LT",JDt="E-LTE",ZDt="E-GT",t5t="E-GTE",e5t="E-VALID",n5t="E-ONE",Hx="index:unit";function O7(t,e){for(var n=e.fields,r=e.values,i=n.length,s=0,o,a;s<i;++s)if(a=n[s],o=hnt(a)(t),Ec(o)&&(o=pr(o)),Ec(r[s])&&(r[s]=pr(r[s])),W(r[s])&&Ec(r[s][0])&&(r[s]=r[s].map(pr)),a.type===GDt){if(W(r[s])?!r[s].includes(o):o!==r[s])return!1}else if(a.type===YDt){if(!yh(o,r[s]))return!1}else if(a.type===KDt){if(!yh(o,r[s],!0,!1))return!1}else if(a.type===HDt){if(!yh(o,r[s],!1,!1))return!1}else if(a.type===XDt){if(!yh(o,r[s],!1,!0))return!1}else if(a.type===QDt){if(o>=r[s])return!1}else if(a.type===JDt){if(o>r[s])return!1}else if(a.type===ZDt){if(o<=r[s])return!1}else if(a.type===t5t){if(o<r[s])return!1}else if(a.type===e5t){if(o===null||isNaN(o))return!1}else if(a.type===n5t&&r[s].indexOf(o)===-1)return!1;return!0}function r5t(t,e,n){for(var r=this.context.data[t],i=r?r.values.value:[],s=r?r[Hx]&&r[Hx].value:void 0,o=n===pO,a=i.length,u=0,c,l,f,d,h;u<a;++u)if(c=i[u],s&&o){if(l=l||{},f=l[d=c.unit]||0,f===-1)continue;if(h=O7(e,c),l[d]=h?-1:++f,h&&s.size===1)return!0;if(!h&&f===s.get(d).count)return!1}else if(h=O7(e,c),o^h)return h;return a&&o}const pnt=rd(Z0),i5t=pnt.left,s5t=pnt.right;function o5t(t,e,n){const r=this.context.data[t],i=r?r.values.value:[],s=r?r[Hx]&&r[Hx].value:void 0,o=n===pO,a=Z0(e),u=i5t(i,a);if(u===i.length||Z0(i[u])!==a)return!1;if(s&&o){if(s.size===1)return!0;if(s5t(i,a)-u<s.size)return!1}return!0}function a5t(t,e){return t.map(n=>Pt(e.fields?{values:e.fields.map(r=>hnt(r)(n.datum))}:{[$o]:Z0(n.datum)},e))}function u5t(t,e,n,r){for(var i=this.context.data[t],s=i?i.values.value:[],o={},a={},u={},c,l,f,d,h,p,g,m,y,b,w=s.length,v=0,x,S;v<w;++v)if(c=s[v],d=c.unit,l=c.fields,f=c.values,l&&f){for(x=0,S=l.length;x<S;++x)h=l[x],g=o[h.field]||(o[h.field]={}),m=g[d]||(g[d]=[]),u[h.field]=y=h.type.charAt(0),b=m$[`${y}_union`],g[d]=b(m,ot(f[x]));n&&(m=a[d]||(a[d]=[]),m.push(ot(f).reduce((_,E,A)=>(_[l[A].field]=E,_),{})))}else h=$o,p=Z0(c),g=o[h]||(o[h]={}),m=g[d]||(g[d]=[]),m.push(p),n&&(m=a[d]||(a[d]=[]),m.push({[$o]:p}));if(e=e||F7,o[$o]?o[$o]=m$[`${$o}_${e}`](...Object.values(o[$o])):Object.keys(o).forEach(_=>{o[_]=Object.keys(o[_]).map(E=>o[_][E]).reduce((E,A)=>E===void 0?A:m$[`${u[_]}_${e}`](E,A))}),s=Object.keys(a),n&&s.length){const _=r?WDt:qDt;o[_]=e===F7?{[N7]:s.reduce((E,A)=>(E.push(...a[A]),E),[])}:{[VDt]:s.map(E=>({[N7]:a[E]}))}}return o}var m$={[`${$o}_union`]:Gpt,[`${$o}_intersect`]:Wpt,E_union:function(t,e){if(!t.length)return e;for(var n=0,r=e.length;n<r;++n)t.includes(e[n])||t.push(e[n]);return t},E_intersect:function(t,e){return t.length?t.filter(n=>e.includes(n)):e},R_union:function(t,e){var n=pr(e[0]),r=pr(e[1]);return n>r&&(n=e[1],r=e[0]),t.length?(t[0]>n&&(t[0]=n),t[1]<r&&(t[1]=r),t):[n,r]},R_intersect:function(t,e){var n=pr(e[0]),r=pr(e[1]);return n>r&&(n=e[1],r=e[0]),t.length?r<t[0]||t[1]<n?[]:(t[0]<n&&(t[0]=n),t[1]>r&&(t[1]=r),t):[n,r]}};const c5t=":",l5t="@";function gO(t,e,n,r){e[0].type!==jf&&j("First argument to selection functions must be a string literal.");const i=e[0].value,s=e.length>=2&&te(e).value,o="unit",a=l5t+o,u=c5t+i;s===pO&&!ft(r,a)&&(r[a]=n.getData(i).indataRef(n,o)),ft(r,u)||(r[u]=n.getData(i).tuplesRef())}function gnt(t){const e=this.context.data[t];return e?e.values.value:[]}function f5t(t,e,n){const r=this.context.data[t]["index:"+e],i=r?r.value.get(n):void 0;return i&&i.count}function d5t(t,e){const n=this.context.dataflow,r=this.context.data[t],i=r.input;return n.pulse(i,n.changeset().remove(bs).insert(e)),1}function h5t(t,e,n){if(t){const r=this.context.dataflow,i=t.mark.source;r.pulse(i,r.changeset().encode(t,e))}return n!==void 0?n:t}const h1=t=>function(e,n){const r=this.context.dataflow.locale();return e===null?"null":r[t](n)(e)},p5t=h1("format"),mnt=h1("timeFormat"),g5t=h1("utcFormat"),m5t=h1("timeParse"),y5t=h1("utcParse"),$b=new Date(2e3,0,1);function AS(t,e,n){return!Number.isInteger(t)||!Number.isInteger(e)?"":($b.setYear(2e3),$b.setMonth(t),$b.setDate(e),mnt.call(this,$b,n))}function b5t(t){return AS.call(this,t,1,"%B")}function v5t(t){return AS.call(this,t,1,"%b")}function w5t(t){return AS.call(this,0,2+t,"%A")}function x5t(t){return AS.call(this,0,2+t,"%a")}const _5t=":",S5t="@",Ok="%",ynt="$";function mO(t,e,n,r){e[0].type!==jf&&j("First argument to data functions must be a string literal.");const i=e[0].value,s=_5t+i;if(!ft(s,r))try{r[s]=n.getData(i).tuplesRef()}catch{}}function E5t(t,e,n,r){e[0].type!==jf&&j("First argument to indata must be a string literal."),e[1].type!==jf&&j("Second argument to indata must be a string literal.");const i=e[0].value,s=e[1].value,o=S5t+s;ft(o,r)||(r[o]=n.getData(i).indataRef(n,s))}function zr(t,e,n,r){if(e[0].type===jf)R7(n,r,e[0].value);else for(t in n.scales)R7(n,r,t)}function R7(t,e,n){const r=Ok+n;if(!ft(e,r))try{e[r]=t.scaleRef(n)}catch{}}function ba(t,e){if(at(t)){const n=e.scales[t];return n&&jCt(n.value)?n.value:void 0}}function A5t(t,e,n){e.__bandwidth=i=>i&&i.bandwidth?i.bandwidth():0,n._bandwidth=zr,n._range=zr,n._scale=zr;const r=i=>"_["+(i.type===jf?J(Ok+i.value):J(Ok)+"+"+t(i))+"]";return{_bandwidth:i=>`this.__bandwidth(${r(i[0])})`,_range:i=>`${r(i[0])}.range()`,_scale:i=>`${r(i[0])}(${t(i[1])})`}}function yO(t,e){return function(n,r,i){if(n){const s=ba(n,(i||this).context);return s&&s.path[t](r)}else return e(r)}}const $5t=yO("area",hbt),T5t=yO("bounds",ybt),k5t=yO("centroid",_W);function M5t(t,e){const n=ba(t,(e||this).context);return n&&n.scale()}function C5t(t){const e=this.context.group;let n=!1;if(e)for(;t;){if(t===e){n=!0;break}t=t.mark.group}return n}function bO(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(r){t.warn(r)}return n[n.length-1]}function I5t(){return bO(this.context.dataflow,"warn",arguments)}function F5t(){return bO(this.context.dataflow,"info",arguments)}function N5t(){return bO(this.context.dataflow,"debug",arguments)}function y$(t){const e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Rk(t){const e=li(t),n=y$(e.r),r=y$(e.g),i=y$(e.b);return .2126*n+.7152*r+.0722*i}function O5t(t,e){const n=Rk(t),r=Rk(e),i=Math.max(n,r),s=Math.min(n,r);return(i+.05)/(s+.05)}function R5t(){const t=[].slice.call(arguments);return t.unshift({}),Pt(...t)}function bnt(t,e){return t===e||t!==t&&e!==e?!0:W(t)?W(e)&&t.length===e.length?D5t(t,e):!1:st(t)&&st(e)?vnt(t,e):!1}function D5t(t,e){for(let n=0,r=t.length;n<r;++n)if(!bnt(t[n],e[n]))return!1;return!0}function vnt(t,e){for(const n in t)if(!bnt(t[n],e[n]))return!1;return!0}function D7(t){return e=>vnt(t,e)}function L5t(t,e,n,r,i,s){const o=this.context.dataflow,a=this.context.data[t],u=a.input,c=o.stamp();let l=a.changes,f,d;if(o._trigger===!1||!(u.value.length||e||r))return 0;if((!l||l.stamp<c)&&(a.changes=l=o.changeset(),l.stamp=c,o.runAfter(()=>{a.modified=!0,o.pulse(u,l).run()},!0,1)),n&&(f=n===!0?bs:W(n)||X_(n)?n:D7(n),l.remove(f)),e&&l.insert(e),r&&(f=D7(r),u.value.some(f)?l.remove(f):l.insert(r)),i)for(d in s)l.modify(i,d,s[d]);return 1}function B5t(t){const e=t.touches,n=e[0].clientX-e[1].clientX,r=e[0].clientY-e[1].clientY;return Math.hypot(n,r)}function P5t(t){const e=t.touches;return Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)}const L7={};function z5t(t,e){const n=L7[e]||(L7[e]=ys(e));return W(t)?t.map(n):n(t)}function $S(t){return W(t)||ArrayBuffer.isView(t)?t:null}function vO(t){return $S(t)||(at(t)?t:null)}function U5t(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return $S(t).join(...n)}function j5t(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return vO(t).indexOf(...n)}function q5t(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return vO(t).lastIndexOf(...n)}function W5t(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return vO(t).slice(...n)}function V5t(t,e,n){return jt(n)&&j("Function argument passed to replace."),String(t).replace(e,n)}function G5t(t){return $S(t).slice().reverse()}function Y5t(t){return $S(t).slice().sort(Gy)}function H5t(t,e,n){return W6(t||0,e||0,n||0)}function X5t(t,e){const n=ba(t,(e||this).context);return n&&n.bandwidth?n.bandwidth():0}function K5t(t,e){const n=ba(t,(e||this).context);return n?n.copy():void 0}function Q5t(t,e){const n=ba(t,(e||this).context);return n?n.domain():[]}function J5t(t,e,n){const r=ba(t,(n||this).context);return r?W(e)?(r.invertRange||r.invert)(e):(r.invert||r.invertExtent)(e):void 0}function Z5t(t,e){const n=ba(t,(e||this).context);return n&&n.range?n.range():[]}function t8t(t,e,n){const r=ba(t,(n||this).context);return r?r(e):void 0}function e8t(t,e,n,r,i){let s=typeof t=="string"?ba(t,(i||this).context):t;const o=ctt(e,n);let a=s.domain(),u=a[0],c=te(a),l=Er;return c-u?l=QZ(s,u,c):s=(s.interpolator?ce("sequential")().interpolator(s.interpolator()):ce("linear")().interpolate(s.interpolate()).range(s.range())).domain([u=0,c=1]),s.ticks&&(a=s.ticks(+r||15),u!==a[0]&&a.unshift(u),c!==te(a)&&a.push(c)),a.forEach(f=>o.stop(l(f),s(f))),o}function n8t(t,e,n){const r=ba(t,(n||this).context);return function(i){return r?r.path.context(i)(e):""}}function r8t(t){let e=null;return function(n){return n?Y0(n,e=e||vp(t)):t}}const wnt=t=>t.data;function xnt(t,e){const n=gnt.call(e,t);return n.root&&n.root.lookup||{}}function i8t(t,e,n){const r=xnt(t,this),i=r[e],s=r[n];return i&&s?i.path(s).map(wnt):void 0}function s8t(t,e){const n=xnt(t,this)[e];return n?n.ancestors().map(wnt):void 0}const _nt=()=>typeof window<"u"&&window||null;function o8t(){const t=_nt();return t?t.screen:{}}function a8t(){const t=_nt();return t?[t.innerWidth,t.innerHeight]:[void 0,void 0]}function u8t(){const t=this.context.dataflow,e=t.container&&t.container();return e?[e.clientWidth,e.clientHeight]:[void 0,void 0]}function Snt(t,e,n){if(!t)return[];const[r,i]=t,s=new gn().set(r[0],r[1],i[0],i[1]),o=n||this.context.dataflow.scenegraph().root;return iet(o,s,c8t(e))}function c8t(t){let e=null;if(t){const n=ot(t.marktype),r=ot(t.markname);e=i=>(!n.length||n.some(s=>i.marktype===s))&&(!r.length||r.some(s=>i.name===s))}return e}function l8t(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5;t=ot(t);const i=t[t.length-1];return i===void 0||Math.hypot(i[0]-e,i[1]-n)>r?[...t,[e,n]]:t}function f8t(t){return ot(t).reduce((e,n,r)=>{let[i,s]=n;return e+=r==0?`M ${i},${s} `:r===t.length-1?" Z":`L ${i},${s} `},"")}function d8t(t,e,n){const{x:r,y:i,mark:s}=n,o=new gn().set(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(const[u,c]of e)u<o.x1&&(o.x1=u),u>o.x2&&(o.x2=u),c<o.y1&&(o.y1=c),c>o.y2&&(o.y2=c);return o.translate(r,i),Snt([[o.x1,o.y1],[o.x2,o.y2]],t,s).filter(u=>h8t(u.x,u.y,e))}function h8t(t,e,n){let r=0;for(let i=0,s=n.length-1;i<n.length;s=i++){const[o,a]=n[s],[u,c]=n[i];c>e!=a>e&&t<(o-u)*(e-c)/(a-c)+u&&r++}return r&1}const ty={random(){return ws()},cumulativeNormal:tS,cumulativeLogNormal:l6,cumulativeUniform:p6,densityNormal:s6,densityLogNormal:c6,densityUniform:h6,quantileNormal:eS,quantileLogNormal:f6,quantileUniform:g6,sampleNormal:Z_,sampleLogNormal:u6,sampleUniform:d6,isArray:W,isBoolean:gl,isDate:Ec,isDefined(t){return t!==void 0},isNumber:ue,isObject:st,isRegExp:aJ,isString:at,isTuple:X_,isValid(t){return t!=null&&t===t},toBoolean:qF,toDate(t){return WF(t)},toNumber:pr,toString:VF,indexof:j5t,join:U5t,lastindexof:q5t,replace:V5t,reverse:G5t,sort:Y5t,slice:W5t,flush:sJ,lerp:uJ,merge:R5t,pad:fJ,peek:te,pluck:z5t,span:Yy,inrange:yh,truncate:dJ,rgb:li,lab:Tw,hcl:kw,hsl:Aw,luminance:Rk,contrast:O5t,sequence:xn,format:p5t,utcFormat:g5t,utcParse:y5t,utcOffset:$J,utcSequence:MJ,timeFormat:mnt,timeParse:m5t,timeOffset:AJ,timeSequence:kJ,timeUnitSpecifier:pJ,monthFormat:b5t,monthAbbrevFormat:v5t,dayFormat:w5t,dayAbbrevFormat:x5t,quarter:eJ,utcquarter:nJ,week:mJ,utcweek:vJ,dayofyear:gJ,utcdayofyear:bJ,warn:I5t,info:F5t,debug:N5t,extent(t){return ea(t)},inScope:C5t,intersect:Snt,clampRange:rJ,pinchDistance:B5t,pinchAngle:P5t,screen:o8t,containerSize:u8t,windowSize:a8t,bandspace:H5t,setdata:d5t,pathShape:r8t,panLinear:QQ,panLog:JQ,panPow:ZQ,panSymlog:tJ,zoomLinear:LF,zoomLog:BF,zoomPow:Tx,zoomSymlog:PF,encode:h5t,modify:L5t,lassoAppend:l8t,lassoPath:f8t,intersectLasso:d8t},p8t=["view","item","group","xy","x","y"],g8t="event.vega.",Ent="this.",wO={},Ant={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:t=>`_[${J(ynt+t)}]`,functions:m8t,constants:lnt,visitors:wO},Dk=dnt(Ant);function m8t(t){const e=fnt(t);p8t.forEach(n=>e[n]=g8t+n);for(const n in ty)e[n]=Ent+n;return Pt(e,A5t(t,ty,wO)),e}function dn(t,e,n){return arguments.length===1?ty[t]:(ty[t]=e,n&&(wO[t]=n),Dk&&(Dk.functions[t]=Ent+t),this)}dn("bandwidth",X5t,zr);dn("copy",K5t,zr);dn("domain",Q5t,zr);dn("range",Z5t,zr);dn("invert",J5t,zr);dn("scale",t8t,zr);dn("gradient",e8t,zr);dn("geoArea",$5t,zr);dn("geoBounds",T5t,zr);dn("geoCentroid",k5t,zr);dn("geoShape",n8t,zr);dn("geoScale",M5t,zr);dn("indata",f5t,E5t);dn("data",gnt,mO);dn("treePath",i8t,mO);dn("treeAncestors",s8t,mO);dn("vlSelectionTest",r5t,gO);dn("vlSelectionIdTest",o5t,gO);dn("vlSelectionResolve",u5t,gO);dn("vlSelectionTuples",a5t);function ra(t,e){const n={};let r;try{t=at(t)?t:J(t)+"",r=hO(t)}catch{j("Expression parse error: "+t)}r.visit(s=>{if(s.type!==rnt)return;const o=s.callee.name,a=Ant.visitors[o];a&&a(o,s.arguments,e,n)});const i=Dk(r);return i.globals.forEach(s=>{const o=ynt+s;!ft(n,o)&&e.getSignal(s)&&(n[o]=e.signalRef(s))}),{$expr:Pt({code:i.code},e.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}function y8t(t){const e=this,n=t.operators||[];return t.background&&(e.background=t.background),t.eventConfig&&(e.eventConfig=t.eventConfig),t.locale&&(e.locale=t.locale),n.forEach(r=>e.parseOperator(r)),n.forEach(r=>e.parseOperatorParameters(r)),(t.streams||[]).forEach(r=>e.parseStream(r)),(t.updates||[]).forEach(r=>e.parseUpdate(r)),e.resolve()}const b8t=Gs(["rule"]),B7=Gs(["group","image","rect"]);function v8t(t,e){let n="";return b8t[e]||(t.x2&&(t.x?(B7[e]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),t.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),t.y2&&(t.y?(B7[e]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),t.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function xO(t){return(t+"").toLowerCase()}function w8t(t){return xO(t)==="operator"}function x8t(t){return xO(t)==="collect"}function Jg(t,e,n){n.endsWith(";")||(n="return("+n+");");const r=Function(...e.concat(n));return t&&t.functions?r.bind(t.functions):r}function _8t(t,e,n,r){return`((u = ${t}) < (v = ${e}) || u == null) && v != null ? ${n}
  : (u > v || v == null) && u != null ? ${r}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}
  : v !== v && u === u ? ${r} : `}var S8t={operator:(t,e)=>Jg(t,["_"],e.code),parameter:(t,e)=>Jg(t,["datum","_"],e.code),event:(t,e)=>Jg(t,["event"],e.code),handler:(t,e)=>{const n=`var datum=event.item&&event.item.datum;return ${e.code};`;return Jg(t,["_","event"],n)},encode:(t,e)=>{const{marktype:n,channels:r}=e;let i="var o=item,datum=o.datum,m=0,$;";for(const s in r){const o="o["+J(s)+"]";i+=`$=${r[s].code};if(${o}!==$)${o}=$,m=1;`}return i+=v8t(r,n),i+="return m;",Jg(t,["item","_"],i)},codegen:{get(t){const e=`[${t.map(J).join("][")}]`,n=Function("_",`return _${e};`);return n.path=e,n},comparator(t,e){let n;const r=(s,o)=>{const a=e[o];let u,c;return s.path?(u=`a${s.path}`,c=`b${s.path}`):((n=n||{})["f"+o]=s,u=`this.f${o}(a)`,c=`this.f${o}(b)`),_8t(u,c,-a,a)},i=Function("a","b","var u, v; return "+t.map(r).join("")+"0;");return n?i.bind(n):i}}};function E8t(t){const e=this;w8t(t.type)||!t.type?e.operator(t,t.update?e.operatorExpression(t.update):null):e.transform(t,t.type)}function A8t(t){const e=this;if(t.params){const n=e.get(t.id);n||j("Invalid operator id: "+t.id),e.dataflow.connect(n,n.parameters(e.parseParameters(t.params),t.react,t.initonly))}}function $8t(t,e){e=e||{};const n=this;for(const r in t){const i=t[r];e[r]=W(i)?i.map(s=>P7(s,n,e)):P7(i,n,e)}return e}function P7(t,e,n){if(!t||!st(t))return t;for(let r=0,i=z7.length,s;r<i;++r)if(s=z7[r],ft(t,s.key))return s.parse(t,e,n);return t}var z7=[{key:"$ref",parse:T8t},{key:"$key",parse:M8t},{key:"$expr",parse:k8t},{key:"$field",parse:C8t},{key:"$encode",parse:F8t},{key:"$compare",parse:I8t},{key:"$context",parse:N8t},{key:"$subflow",parse:O8t},{key:"$tupleid",parse:R8t}];function T8t(t,e){return e.get(t.$ref)||j("Operator not defined: "+t.$ref)}function k8t(t,e,n){t.$params&&e.parseParameters(t.$params,n);const r="e:"+t.$expr.code;return e.fn[r]||(e.fn[r]=yi(e.parameterExpression(t.$expr),t.$fields))}function M8t(t,e){const n="k:"+t.$key+"_"+!!t.$flat;return e.fn[n]||(e.fn[n]=jF(t.$key,t.$flat,e.expr.codegen))}function C8t(t,e){if(!t.$field)return null;const n="f:"+t.$field+"_"+t.$name;return e.fn[n]||(e.fn[n]=ys(t.$field,t.$name,e.expr.codegen))}function I8t(t,e){const n="c:"+t.$compare+"_"+t.$order,r=ot(t.$compare).map(i=>i&&i.$tupleid?vt:i);return e.fn[n]||(e.fn[n]=zF(r,t.$order,e.expr.codegen))}function F8t(t,e){const n=t.$encode,r={};for(const i in n){const s=n[i];r[i]=yi(e.encodeExpression(s.$expr),s.$fields),r[i].output=s.$output}return r}function N8t(t,e){return e}function O8t(t,e){const n=t.$subflow;return function(r,i,s){const o=e.fork().parse(n),a=o.get(n.operators[0].id),u=o.signals.parent;return u&&u.set(s),a.detachSubflow=()=>e.detach(o),a}}function R8t(){return vt}function D8t(t){var e=this,n=t.filter!=null?e.eventExpression(t.filter):void 0,r=t.stream!=null?e.get(t.stream):void 0,i;t.source?r=e.events(t.source,t.type,n):t.merge&&(i=t.merge.map(s=>e.get(s)),r=i[0].merge.apply(i[0],i.slice(1))),t.between&&(i=t.between.map(s=>e.get(s)),r=r.between(i[0],i[1])),t.filter&&(r=r.filter(n)),t.throttle!=null&&(r=r.throttle(+t.throttle)),t.debounce!=null&&(r=r.debounce(+t.debounce)),r==null&&j("Invalid stream definition: "+JSON.stringify(t)),t.consume&&r.consume(!0),e.stream(t,r)}function L8t(t){var e=this,n=st(n=t.source)?n.$ref:n,r=e.get(n),i=null,s=t.update,o=void 0;r||j("Source not defined: "+t.source),i=t.target&&t.target.$expr?e.eventExpression(t.target.$expr):e.get(t.target),s&&s.$expr&&(s.$params&&(o=e.parseParameters(s.$params)),s=e.handlerExpression(s.$expr)),e.update(t,r,i,s,o)}const B8t={skip:!0};function P8t(t){var e=this,n={};if(t.signals){var r=n.signals={};Object.keys(e.signals).forEach(s=>{const o=e.signals[s];t.signals(s,o)&&(r[s]=o.value)})}if(t.data){var i=n.data={};Object.keys(e.data).forEach(s=>{const o=e.data[s];t.data(s,o)&&(i[s]=o.input.value)})}return e.subcontext&&t.recurse!==!1&&(n.subcontext=e.subcontext.map(s=>s.getState(t))),n}function z8t(t){var e=this,n=e.dataflow,r=t.data,i=t.signals;Object.keys(i||{}).forEach(s=>{n.update(e.signals[s],i[s],B8t)}),Object.keys(r||{}).forEach(s=>{n.pulse(e.data[s].input,n.changeset().remove(bs).insert(r[s]))}),(t.subcontext||[]).forEach((s,o)=>{const a=e.subcontext[o];a&&a.setState(s)})}function $nt(t,e,n,r){return new Tnt(t,e,n,r)}function Tnt(t,e,n,r){this.dataflow=t,this.transforms=e,this.events=t.events.bind(t),this.expr=r||S8t,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function U7(t){this.dataflow=t.dataflow,this.transforms=t.transforms,this.events=t.events,this.expr=t.expr,this.signals=Object.create(t.signals),this.scales=Object.create(t.scales),this.nodes=Object.create(t.nodes),this.data=Object.create(t.data),this.fn=Object.create(t.fn),t.functions&&(this.functions=Object.create(t.functions),this.functions.context=this)}Tnt.prototype=U7.prototype={fork(){const t=new U7(this);return(this.subcontext||(this.subcontext=[])).push(t),t},detach(t){this.subcontext=this.subcontext.filter(n=>n!==t);const e=Object.keys(t.nodes);for(const n of e)t.nodes[n]._targets=null;for(const n of e)t.nodes[n].detach();t.nodes=null},get(t){return this.nodes[t]},set(t,e){return this.nodes[t]=e},add(t,e){const n=this,r=n.dataflow,i=t.value;if(n.set(t.id,e),x8t(t.type)&&i&&(i.$ingest?r.ingest(e,i.$ingest,i.$format):i.$request?r.preload(e,i.$request,i.$format):r.pulse(e,r.changeset().insert(i))),t.root&&(n.root=e),t.parent){let s=n.get(t.parent.$ref);s?(r.connect(s,[e]),e.targets().add(s)):(n.unresolved=n.unresolved||[]).push(()=>{s=n.get(t.parent.$ref),r.connect(s,[e]),e.targets().add(s)})}if(t.signal&&(n.signals[t.signal]=e),t.scale&&(n.scales[t.scale]=e),t.data)for(const s in t.data){const o=n.data[s]||(n.data[s]={});t.data[s].forEach(a=>o[a]=e)}},resolve(){return(this.unresolved||[]).forEach(t=>t()),delete this.unresolved,this},operator(t,e){this.add(t,this.dataflow.add(t.value,e))},transform(t,e){this.add(t,this.dataflow.add(this.transforms[xO(e)]))},stream(t,e){this.set(t.id,e)},update(t,e,n,r,i){this.dataflow.on(e,n,r,i,t.options)},operatorExpression(t){return this.expr.operator(this,t)},parameterExpression(t){return this.expr.parameter(this,t)},eventExpression(t){return this.expr.event(this,t)},handlerExpression(t){return this.expr.handler(this,t)},encodeExpression(t){return this.expr.encode(this,t)},parse:y8t,parseOperator:E8t,parseOperatorParameters:A8t,parseParameters:$8t,parseStream:D8t,parseUpdate:L8t,getState:P8t,setState:z8t};function U8t(t){const e=t.container();e&&(e.setAttribute("role","graphics-document"),e.setAttribute("aria-roleDescription","visualization"),knt(e,t.description()))}function knt(t,e){t&&(e==null?t.removeAttribute("aria-label"):t.setAttribute("aria-label",e))}function j8t(t){t.add(null,e=>(t._background=e.bg,t._resize=1,e.bg),{bg:t._signals.background})}const b$="default";function q8t(t){const e=t._signals.cursor||(t._signals.cursor=t.add({user:b$,item:null}));t.on(t.events("view","pointermove"),e,(n,r)=>{const i=e.value,s=i?at(i)?i:i.user:b$,o=r.item&&r.item.cursor||null;return i&&s===i.user&&o==i.item?i:{user:s,item:o}}),t.add(null,function(n){let r=n.cursor,i=this.value;return at(r)||(i=r.item,r=r.user),Lk(t,r&&r!==b$?r:i||r),i},{cursor:e})}function Lk(t,e){const n=t.globalCursor()?typeof document<"u"&&document.body:t.container();if(n)return e==null?n.style.removeProperty("cursor"):n.style.cursor=e}function Xx(t,e){var n=t._runtime.data;return ft(n,e)||j("Unrecognized data set: "+e),n[e]}function W8t(t,e){return arguments.length<2?Xx(this,t).values.value:TS.call(this,t,fd().remove(bs).insert(e))}function TS(t,e){XJ(e)||j("Second argument to changes must be a changeset.");const n=Xx(this,t);return n.modified=!0,this.pulse(n.input,e)}function V8t(t,e){return TS.call(this,t,fd().insert(e))}function G8t(t,e){return TS.call(this,t,fd().remove(e))}function Mnt(t){var e=t.padding();return Math.max(0,t._viewWidth+e.left+e.right)}function Cnt(t){var e=t.padding();return Math.max(0,t._viewHeight+e.top+e.bottom)}function kS(t){var e=t.padding(),n=t._origin;return[e.left+n[0],e.top+n[1]]}function Y8t(t){var e=kS(t),n=Mnt(t),r=Cnt(t);t._renderer.background(t.background()),t._renderer.resize(n,r,e),t._handler.origin(e),t._resizeListeners.forEach(i=>{try{i(n,r)}catch(s){t.error(s)}})}function H8t(t,e,n){var r=t._renderer,i=r&&r.canvas(),s,o,a;return i&&(a=kS(t),o=e.changedTouches?e.changedTouches[0]:e,s=bS(o,i),s[0]-=a[0],s[1]-=a[1]),e.dataflow=t,e.item=n,e.vega=X8t(t,n,s),e}function X8t(t,e,n){const r=e?e.mark.marktype==="group"?e:e.mark.group:null;function i(o){var a=r,u;if(o){for(u=e;u;u=u.mark.group)if(u.mark.name===o){a=u;break}}return a&&a.mark&&a.mark.interactive?a:{}}function s(o){if(!o)return n;at(o)&&(o=i(o));const a=n.slice();for(;o;)a[0]-=o.x||0,a[1]-=o.y||0,o=o.mark&&o.mark.group;return a}return{view:Ar(t),item:Ar(e||{}),group:i,xy:s,x:o=>s(o)[0],y:o=>s(o)[1]}}const j7="view",K8t="timer",Q8t="window",J8t={trap:!1};function Z8t(t){const e=Pt({defaults:{}},t),n=(r,i)=>{i.forEach(s=>{W(r[s])&&(r[s]=Gs(r[s]))})};return n(e.defaults,["prevent","allow"]),n(e,["view","window","selector"]),e}function Int(t,e,n,r){t._eventListeners.push({type:n,sources:ot(e),handler:r})}function t4t(t,e){var n=t._eventConfig.defaults,r=n.prevent,i=n.allow;return r===!1||i===!0?!1:r===!0||i===!1?!0:r?r[e]:i?!i[e]:t.preventDefault()}function Tb(t,e,n){const r=t._eventConfig&&t._eventConfig[e];return r===!1||st(r)&&!r[n]?(t.warn(`Blocked ${e} ${n} event listener.`),!1):!0}function e4t(t,e,n){var r=this,i=new J_(n),s=function(c,l){r.runAsync(null,()=>{t===j7&&t4t(r,e)&&c.preventDefault(),i.receive(H8t(r,c,l))})},o;if(t===K8t)Tb(r,"timer",e)&&r.timer(s,e);else if(t===j7)Tb(r,"view",e)&&r.addEventListener(e,s,J8t);else if(t===Q8t?Tb(r,"window",e)&&typeof window<"u"&&(o=[window]):typeof document<"u"&&Tb(r,"selector",e)&&(o=Array.from(document.querySelectorAll(t))),!o)r.warn("Can not resolve event source: "+t);else{for(var a=0,u=o.length;a<u;++a)o[a].addEventListener(e,s);Int(r,o,e,s)}return i}function q7(t){return t.item}function W7(t){return t.item.mark.source}function V7(t){return function(e,n){return n.vega.view().changeset().encode(n.item,t)}}function n4t(t,e){return t=[t||"hover"],e=[e||"update",t[0]],this.on(this.events("view","pointerover",q7),W7,V7(t)),this.on(this.events("view","pointerout",q7),W7,V7(e)),this}function r4t(){var t=this._tooltip,e=this._timers,n=this._handler.handlers(),r=this._eventListeners,i,s,o,a,u;for(i=e.length;--i>=0;)e[i].stop();for(i=r.length;--i>=0;)for(o=r[i],s=o.sources.length;--s>=0;)o.sources[s].removeEventListener(o.type,o.handler);for(t&&t.call(this,this._handler,null,null,null),i=n.length;--i>=0;)u=n[i].type,a=n[i].handler,this._handler.off(u,a);return this}function Ii(t,e,n){const r=document.createElement(t);for(const i in e)r.setAttribute(i,e[i]);return n!=null&&(r.textContent=n),r}const i4t="vega-bind",s4t="vega-bind-name",o4t="vega-bind-radio";function a4t(t,e,n){if(!e)return;const r=n.param;let i=n.state;return i||(i=n.state={elements:null,active:!1,set:null,update:o=>{o!=t.signal(r.signal)&&t.runAsync(null,()=>{i.source=!0,t.signal(r.signal,o)})}},r.debounce&&(i.update=UF(r.debounce,i.update))),(r.input==null&&r.element?u4t:l4t)(i,e,r,t),i.active||(t.on(t._signals[r.signal],null,()=>{i.source?i.source=!1:i.set(t.signal(r.signal))}),i.active=!0),i}function u4t(t,e,n,r){const i=n.event||"input",s=()=>t.update(e.value);r.signal(n.signal,e.value),e.addEventListener(i,s),Int(r,e,i,s),t.set=o=>{e.value=o,e.dispatchEvent(c4t(i))}}function c4t(t){return typeof Event<"u"?new Event(t):{type:t}}function l4t(t,e,n,r){const i=r.signal(n.signal),s=Ii("div",{class:i4t}),o=n.input==="radio"?s:s.appendChild(Ii("label"));o.appendChild(Ii("span",{class:s4t},n.name||n.signal)),e.appendChild(s);let a=f4t;switch(n.input){case"checkbox":a=d4t;break;case"select":a=h4t;break;case"radio":a=p4t;break;case"range":a=g4t;break}a(t,o,n,i)}function f4t(t,e,n,r){const i=Ii("input");for(const s in n)s!=="signal"&&s!=="element"&&i.setAttribute(s==="input"?"type":s,n[s]);i.setAttribute("name",n.signal),i.value=r,e.appendChild(i),i.addEventListener("input",()=>t.update(i.value)),t.elements=[i],t.set=s=>i.value=s}function d4t(t,e,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const s=Ii("input",i);e.appendChild(s),s.addEventListener("change",()=>t.update(s.checked)),t.elements=[s],t.set=o=>s.checked=!!o||null}function h4t(t,e,n,r){const i=Ii("select",{name:n.signal}),s=n.labels||[];n.options.forEach((o,a)=>{const u={value:o};Kx(o,r)&&(u.selected=!0),i.appendChild(Ii("option",u,(s[a]||o)+""))}),e.appendChild(i),i.addEventListener("change",()=>{t.update(n.options[i.selectedIndex])}),t.elements=[i],t.set=o=>{for(let a=0,u=n.options.length;a<u;++a)if(Kx(n.options[a],o)){i.selectedIndex=a;return}}}function p4t(t,e,n,r){const i=Ii("span",{class:o4t}),s=n.labels||[];e.appendChild(i),t.elements=n.options.map((o,a)=>{const u={type:"radio",name:n.signal,value:o};Kx(o,r)&&(u.checked=!0);const c=Ii("input",u);c.addEventListener("change",()=>t.update(o));const l=Ii("label",{},(s[a]||o)+"");return l.prepend(c),i.appendChild(l),c}),t.set=o=>{const a=t.elements,u=a.length;for(let c=0;c<u;++c)Kx(a[c].value,o)&&(a[c].checked=!0)}}function g4t(t,e,n,r){r=r!==void 0?r:(+n.max+ +n.min)/2;const i=n.max!=null?n.max:Math.max(100,+r)||100,s=n.min||Math.min(0,i,+r)||0,o=n.step||Bc(s,i,100),a=Ii("input",{type:"range",name:n.signal,min:s,max:i,step:o});a.value=r;const u=Ii("span",{},+r);e.appendChild(a),e.appendChild(u);const c=()=>{u.textContent=a.value,t.update(+a.value)};a.addEventListener("input",c),a.addEventListener("change",c),t.elements=[a],t.set=l=>{a.value=l,u.textContent=l}}function Kx(t,e){return t===e||t+""==e+""}function Fnt(t,e,n,r,i,s){return e=e||new r(t.loader()),e.initialize(n,Mnt(t),Cnt(t),kS(t),i,s).background(t.background())}function _O(t,e){return e?function(){try{e.apply(this,arguments)}catch(n){t.error(n)}}:null}function m4t(t,e,n,r){const i=new r(t.loader(),_O(t,t.tooltip())).scene(t.scenegraph().root).initialize(n,kS(t),t);return e&&e.handlers().forEach(s=>{i.on(s.type,s.handler)}),i}function y4t(t,e){const n=this,r=n._renderType,i=n._eventConfig.bind,s=vS(r);t=n._el=t?v$(n,t,!0):null,U8t(n),s||n.error("Unrecognized renderer type: "+r);const o=s.handler||c1,a=t?s.renderer:s.headless;return n._renderer=a?Fnt(n,n._renderer,t,a):null,n._handler=m4t(n,n._handler,t,o),n._redraw=!0,t&&i!=="none"&&(e=e?n._elBind=v$(n,e,!0):t.appendChild(Ii("form",{class:"vega-bindings"})),n._bind.forEach(u=>{u.param.element&&i!=="container"&&(u.element=v$(n,u.param.element,!!u.param.input))}),n._bind.forEach(u=>{a4t(n,u.element||e,u)})),n}function v$(t,e,n){if(typeof e=="string")if(typeof document<"u"){if(e=document.querySelector(e),!e)return t.error("Signal bind element not found: "+e),null}else return t.error("DOM document instance not found."),null;if(e&&n)try{e.textContent=""}catch(r){e=null,t.error(r)}return e}const Zg=t=>+t||0,b4t=t=>({top:t,bottom:t,left:t,right:t});function G7(t){return st(t)?{top:Zg(t.top),bottom:Zg(t.bottom),left:Zg(t.left),right:Zg(t.right)}:b4t(Zg(t))}async function SO(t,e,n,r){const i=vS(e),s=i&&i.headless;return s||j("Unrecognized renderer type: "+e),await t.runAsync(),Fnt(t,null,null,s,n,r).renderAsync(t._scenegraph.root)}async function v4t(t,e){t!==yc.Canvas&&t!==yc.SVG&&t!==yc.PNG&&j("Unrecognized image type: "+t);const n=await SO(this,t,e);return t===yc.SVG?w4t(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function w4t(t,e){const n=new Blob([t],{type:e});return window.URL.createObjectURL(n)}async function x4t(t,e){return(await SO(this,yc.Canvas,t,e)).canvas()}async function _4t(t){return(await SO(this,yc.SVG,t)).svg()}function S4t(t,e,n){return $nt(t,gp,ty,n).parse(e)}function E4t(t){var e=this._runtime.scales;return ft(e,t)||j("Unrecognized scale or projection: "+t),e[t].value}var Nnt="width",Ont="height",EO="padding",Y7={skip:!0};function Rnt(t,e){var n=t.autosize(),r=t.padding();return e-(n&&n.contains===EO?r.left+r.right:0)}function Dnt(t,e){var n=t.autosize(),r=t.padding();return e-(n&&n.contains===EO?r.top+r.bottom:0)}function A4t(t){var e=t._signals,n=e[Nnt],r=e[Ont],i=e[EO];function s(){t._autosize=t._resize=1}t._resizeWidth=t.add(null,a=>{t._width=a.size,t._viewWidth=Rnt(t,a.size),s()},{size:n}),t._resizeHeight=t.add(null,a=>{t._height=a.size,t._viewHeight=Dnt(t,a.size),s()},{size:r});const o=t.add(null,s,{pad:i});t._resizeWidth.rank=n.rank+1,t._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}function $4t(t,e,n,r,i,s){this.runAfter(o=>{let a=0;o._autosize=0,o.width()!==n&&(a=1,o.signal(Nnt,n,Y7),o._resizeWidth.skip(!0)),o.height()!==r&&(a=1,o.signal(Ont,r,Y7),o._resizeHeight.skip(!0)),o._viewWidth!==t&&(o._resize=1,o._viewWidth=t),o._viewHeight!==e&&(o._resize=1,o._viewHeight=e),(o._origin[0]!==i[0]||o._origin[1]!==i[1])&&(o._resize=1,o._origin=i),a&&o.run("enter"),s&&o.runAfter(u=>u.resize())},!1,1)}function T4t(t){return this._runtime.getState(t||{data:k4t,signals:M4t,recurse:!0})}function k4t(t,e){return e.modified&&W(e.input.value)&&!t.startsWith("_:vega:_")}function M4t(t,e){return!(t==="parent"||e instanceof gp.proxy)}function C4t(t){return this.runAsync(null,e=>{e._trigger=!1,e._runtime.setState(t)},e=>{e._trigger=!0}),this}function I4t(t,e){function n(r){t({timestamp:Date.now(),elapsed:r})}this._timers.push(w0t(n,e))}function F4t(t,e,n,r){const i=t.element();i&&i.setAttribute("title",N4t(r))}function N4t(t){return t==null?"":W(t)?Lnt(t):st(t)&&!Ec(t)?O4t(t):t+""}function O4t(t){return Object.keys(t).map(e=>{const n=t[e];return e+": "+(W(n)?Lnt(n):Bnt(n))}).join(`
`)}function Lnt(t){return"["+t.map(Bnt).join(", ")+"]"}function Bnt(t){return W(t)?"[]":st(t)&&!Ec(t)?"{}":t}function R4t(){if(this.renderer()==="canvas"&&this._renderer._canvas){let t=null;const e=()=>{t!=null&&t();const n=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);n.addEventListener("change",e),t=()=>{n.removeEventListener("change",e)},this._renderer._canvas.getContext("2d").pixelRatio=window.devicePixelRatio||1,this._redraw=!0,this._resize=1,this.resize().runAsync()};e()}}function Pnt(t,e){const n=this;if(e=e||{},Rh.call(n),e.loader&&n.loader(e.loader),e.logger&&n.logger(e.logger),e.logLevel!=null&&n.logLevel(e.logLevel),e.locale||t.locale){const s=Pt({},t.locale,e.locale);n.locale(PJ(s.number,s.time))}n._el=null,n._elBind=null,n._renderType=e.renderer||yc.Canvas,n._scenegraph=new Ntt;const r=n._scenegraph.root;n._renderer=null,n._tooltip=e.tooltip||F4t,n._redraw=!0,n._handler=new c1().scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=Z8t(t.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=S4t(n,t,e.expr);n._runtime=i,n._signals=i.signals,n._bind=(t.bindings||[]).map(s=>({state:null,param:Pt({},s)})),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=Rnt(n,n._width),n._viewHeight=Dnt(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,A4t(n),j8t(n),q8t(n),n.description(t.description),e.hover&&n.hover(),e.container&&n.initialize(e.container,e.bind),e.watchPixelRatio&&n._watchPixelRatio()}function kb(t,e){return ft(t._signals,e)?t._signals[e]:j("Unrecognized signal name: "+J(e))}function znt(t,e){const n=(t._targets||[]).filter(r=>r._update&&r._update.handler===e);return n.length?n[0]:null}function H7(t,e,n,r){let i=znt(n,r);return i||(i=_O(t,()=>r(e,n.value)),i.handler=r,t.on(n,null,i)),t}function X7(t,e,n){const r=znt(e,n);return r&&e._targets.remove(r),t}tt(Pnt,Rh,{async evaluate(t,e,n){if(await Rh.prototype.evaluate.call(this,t,e),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,Y8t(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(r){this.error(r)}return n&&pv(this,n),this},dirty(t){this._redraw=!0,this._renderer&&this._renderer.dirty(t)},description(t){if(arguments.length){const e=t!=null?t+"":null;return e!==this._desc&&knt(this._el,this._desc=e),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(t,e,n){const r=kb(this,t);return arguments.length===1?r.value:this.update(r,e,n)},width(t){return arguments.length?this.signal("width",t):this.signal("width")},height(t){return arguments.length?this.signal("height",t):this.signal("height")},padding(t){return arguments.length?this.signal("padding",G7(t)):G7(this.signal("padding"))},autosize(t){return arguments.length?this.signal("autosize",t):this.signal("autosize")},background(t){return arguments.length?this.signal("background",t):this.signal("background")},renderer(t){return arguments.length?(vS(t)||j("Unrecognized renderer type: "+t),t!==this._renderType&&(this._renderType=t,this._resetRenderer()),this):this._renderType},tooltip(t){return arguments.length?(t!==this._tooltip&&(this._tooltip=t,this._resetRenderer()),this):this._tooltip},loader(t){return arguments.length?(t!==this._loader&&(Rh.prototype.loader.call(this,t),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(kb(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:$4t,addEventListener(t,e,n){let r=e;return n&&n.trap===!1||(r=_O(this,e),r.raw=e),this._handler.on(t,r),this},removeEventListener(t,e){for(var n=this._handler.handlers(t),r=n.length,i,s;--r>=0;)if(s=n[r].type,i=n[r].handler,t===s&&(e===i||e===i.raw)){this._handler.off(s,i);break}return this},addResizeListener(t){const e=this._resizeListeners;return e.includes(t)||e.push(t),this},removeResizeListener(t){var e=this._resizeListeners,n=e.indexOf(t);return n>=0&&e.splice(n,1),this},addSignalListener(t,e){return H7(this,t,kb(this,t),e)},removeSignalListener(t,e){return X7(this,kb(this,t),e)},addDataListener(t,e){return H7(this,t,Xx(this,t).values,e)},removeDataListener(t,e){return X7(this,Xx(this,t).values,e)},globalCursor(t){if(arguments.length){if(this._globalCursor!==!!t){const e=Lk(this,null);this._globalCursor=!!t,e&&Lk(this,e)}return this}else return this._globalCursor},preventDefault(t){return arguments.length?(this._preventDefault=t,this):this._preventDefault},timer:I4t,events:e4t,finalize:r4t,hover:n4t,data:W8t,change:TS,insert:V8t,remove:G8t,scale:E4t,initialize:y4t,toImageURL:v4t,toCanvas:x4t,toSVG:_4t,getState:T4t,setState:C4t,_watchPixelRatio:R4t});const D4t="view",Qx="[",Jx="]",Unt="{",jnt="}",L4t=":",qnt=",",B4t="@",P4t=">",z4t=/[[\]{}]/,U4t={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let Wnt,Vnt;function yl(t,e,n){return Wnt=e||D4t,Vnt=n||U4t,Gnt(t.trim()).map(Bk)}function j4t(t){return Vnt[t]}function o0(t,e,n,r,i){const s=t.length;let o=0,a;for(;e<s;++e){if(a=t[e],!o&&a===n)return e;i&&i.indexOf(a)>=0?--o:r&&r.indexOf(a)>=0&&++o}return e}function Gnt(t){const e=[],n=t.length;let r=0,i=0;for(;i<n;)i=o0(t,i,qnt,Qx+Unt,Jx+jnt),e.push(t.substring(r,i).trim()),r=++i;if(e.length===0)throw"Empty event selector: "+t;return e}function Bk(t){return t[0]==="["?q4t(t):W4t(t)}function q4t(t){const e=t.length;let n=1,r;if(n=o0(t,n,Jx,Qx,Jx),n===e)throw"Empty between selector: "+t;if(r=Gnt(t.substring(1,n)),r.length!==2)throw"Between selector must have two elements: "+t;if(t=t.slice(n+1).trim(),t[0]!==P4t)throw"Expected '>' after between selector: "+t;r=r.map(Bk);const i=Bk(t.slice(1).trim());return i.between?{between:r,stream:i}:(i.between=r,i)}function W4t(t){const e={source:Wnt},n=[];let r=[0,0],i=0,s=0,o=t.length,a=0,u,c;if(t[o-1]===jnt){if(a=t.lastIndexOf(Unt),a>=0){try{r=V4t(t.substring(a+1,o-1))}catch{throw"Invalid throttle specification: "+t}t=t.slice(0,a).trim(),o=t.length}else throw"Unmatched right brace: "+t;a=0}if(!o)throw t;if(t[0]===B4t&&(i=++a),u=o0(t,a,L4t),u<o&&(n.push(t.substring(s,u).trim()),s=a=++u),a=o0(t,a,Qx),a===o)n.push(t.substring(s,o).trim());else if(n.push(t.substring(s,a).trim()),c=[],s=++a,s===o)throw"Unmatched left bracket: "+t;for(;a<o;){if(a=o0(t,a,Jx),a===o)throw"Unmatched left bracket: "+t;if(c.push(t.substring(s,a).trim()),a<o-1&&t[++a]!==Qx)throw"Expected left bracket: "+t;s=++a}if(!(o=n.length)||z4t.test(n[o-1]))throw"Invalid event selector: "+t;return o>1?(e.type=n[1],i?e.markname=n[0].slice(1):j4t(n[0])?e.marktype=n[0]:e.source=n[0]):e.type=n[0],e.type.slice(-1)==="!"&&(e.consume=!0,e.type=e.type.slice(0,-1)),c!=null&&(e.filter=c),r[0]&&(e.throttle=r[0]),r[1]&&(e.debounce=r[1]),e}function V4t(t){const e=t.split(qnt);if(!t.length||e.length>2)throw t;return e.map(n=>{const r=+n;if(r!==r)throw t;return r})}function G4t(t){return st(t)?t:{type:t||"pad"}}const tm=t=>+t||0,Y4t=t=>({top:t,bottom:t,left:t,right:t});function H4t(t){return st(t)?t.signal?t:{top:tm(t.top),bottom:tm(t.bottom),left:tm(t.left),right:tm(t.right)}:Y4t(tm(t))}const Nn=t=>st(t)&&!W(t)?Pt({},t):{value:t};function K7(t,e,n,r){return n!=null?(st(n)&&!W(n)||W(n)&&n.length&&st(n[0])?t.update[e]=n:t[r||"enter"][e]={value:n},1):0}function er(t,e,n){for(const r in e)K7(t,r,e[r]);for(const r in n)K7(t,r,n[r],"update")}function vg(t,e,n){for(const r in e)n&&ft(n,r)||(t[r]=Pt(t[r]||{},e[r]));return t}function oh(t,e){return e&&(e.enter&&e.enter[t]||e.update&&e.update[t])}const AO="mark",$O="frame",TO="scope",X4t="axis",K4t="axis-domain",Q4t="axis-grid",J4t="axis-label",Z4t="axis-tick",tLt="axis-title",eLt="legend",nLt="legend-band",rLt="legend-entry",iLt="legend-gradient",Ynt="legend-label",sLt="legend-symbol",oLt="legend-title",aLt="title",uLt="title-text",cLt="title-subtitle";function lLt(t,e,n,r,i){const s={},o={};let a,u,c,l;u="lineBreak",e==="text"&&i[u]!=null&&!oh(u,t)&&w$(s,u,i[u]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),l=n===$O?i.group:n===AO?Pt({},i.mark,i[e]):null;for(u in l)c=oh(u,t)||(u==="fill"||u==="stroke")&&(oh("fill",t)||oh("stroke",t)),c||w$(s,u,l[u]);ot(r).forEach(f=>{const d=i.style&&i.style[f];for(const h in d)oh(h,t)||w$(s,h,d[h])}),t=Pt({},t);for(u in s)l=s[u],l.signal?(a=a||{})[u]=l:o[u]=l;return t.enter=Pt(o,t.enter),a&&(t.update=Pt(a,t.update)),t}function w$(t,e,n){t[e]=n&&n.signal?{signal:n.signal}:{value:n}}const Hnt=t=>at(t)?J(t):t.signal?`(${t.signal})`:Xnt(t);function MS(t){if(t.gradient!=null)return dLt(t);let e=t.signal?`(${t.signal})`:t.color?fLt(t.color):t.field!=null?Xnt(t.field):t.value!==void 0?J(t.value):void 0;return t.scale!=null&&(e=hLt(t,e)),e===void 0&&(e=null),t.exponent!=null&&(e=`pow(${e},${kv(t.exponent)})`),t.mult!=null&&(e+=`*${kv(t.mult)}`),t.offset!=null&&(e+=`+${kv(t.offset)}`),t.round&&(e=`round(${e})`),e}const Mb=(t,e,n,r)=>`(${t}(${[e,n,r].map(MS).join(",")})+'')`;function fLt(t){return t.c?Mb("hcl",t.h,t.c,t.l):t.h||t.s?Mb("hsl",t.h,t.s,t.l):t.l||t.a?Mb("lab",t.l,t.a,t.b):t.r||t.g||t.b?Mb("rgb",t.r,t.g,t.b):null}function dLt(t){const e=[t.start,t.stop,t.count].map(n=>n==null?null:J(n));for(;e.length&&te(e)==null;)e.pop();return e.unshift(Hnt(t.gradient)),`gradient(${e.join(",")})`}function kv(t){return st(t)?"("+MS(t)+")":t}function Xnt(t){return Knt(st(t)?t:{datum:t})}function Knt(t){let e,n,r;if(t.signal)e="datum",r=t.signal;else if(t.group||t.parent){for(n=Math.max(1,t.level||1),e="item";n-- >0;)e+=".mark.group";t.parent?(r=t.parent,e+=".datum"):r=t.group}else t.datum?(e="datum",r=t.datum):j("Invalid field reference: "+J(t));return t.signal||(r=at(r)?ga(r).map(J).join("]["):Knt(r)),e+"["+r+"]"}function hLt(t,e){const n=Hnt(t.scale);return t.range!=null?e=`lerp(_range(${n}), ${+t.range})`:(e!==void 0&&(e=`_scale(${n}, ${e})`),t.band&&(e=(e?e+"+":"")+`_bandwidth(${n})`+(+t.band==1?"":"*"+kv(t.band)),t.extra&&(e=`(datum.extra ? _scale(${n}, datum.extra.value) : ${e})`)),e==null&&(e="0")),e}function pLt(t){let e="";return t.forEach(n=>{const r=MS(n);e+=n.test?`(${n.test})?${r}:`:r}),te(e)===":"&&(e+="null"),e}function Qnt(t,e,n,r,i,s){const o={};s=s||{},s.encoders={$encode:o},t=lLt(t,e,n,r,i.config);for(const a in t)o[a]=gLt(t[a],e,s,i);return s}function gLt(t,e,n,r){const i={},s={};for(const o in t)t[o]!=null&&(i[o]=yLt(mLt(t[o]),r,n,s));return{$expr:{marktype:e,channels:i},$fields:Object.keys(s),$output:Object.keys(t)}}function mLt(t){return W(t)?pLt(t):MS(t)}function yLt(t,e,n,r){const i=ra(t,e);return i.$fields.forEach(s=>r[s]=1),Pt(n,i.$params),i.$expr}const bLt="outer",vLt=["value","update","init","react","bind"];function Q7(t,e){j(t+' for "outer" push: '+J(e))}function Jnt(t,e){const n=t.name;if(t.push===bLt)e.signals[n]||Q7("No prior signal definition",n),vLt.forEach(r=>{t[r]!==void 0&&Q7("Invalid property ",r)});else{const r=e.addSignal(n,t.value);t.react===!1&&(r.react=!1),t.bind&&e.addBinding(n,t.bind)}}function Pk(t,e,n,r){this.id=-1,this.type=t,this.value=e,this.params=n,r&&(this.parent=r)}function CS(t,e,n,r){return new Pk(t,e,n,r)}function Zx(t,e){return CS("operator",t,e)}function bt(t){const e={$ref:t.id};return t.id<0&&(t.refs=t.refs||[]).push(e),e}function ey(t,e){return e?{$field:t,$name:e}:{$field:t}}const zk=ey("key");function J7(t,e){return{$compare:t,$order:e}}function wLt(t,e){const n={$key:t};return e&&(n.$flat=!0),n}const xLt="ascending",_Lt="descending";function SLt(t){return st(t)?(t.order===_Lt?"-":"+")+IS(t.op,t.field):""}function IS(t,e){return(t&&t.signal?"$"+t.signal:t||"")+(t&&e?"_":"")+(e&&e.signal?"$"+e.signal:e||"")}const kO="scope",Uk="view";function En(t){return t&&t.signal}function ELt(t){return t&&t.expr}function Mv(t){if(En(t))return!0;if(st(t)){for(const e in t)if(Mv(t[e]))return!0}return!1}function Ns(t,e){return t??e}function bf(t){return t&&t.signal||t}const Z7="timer";function ny(t,e){return(t.merge?$Lt:t.stream?TLt:t.type?kLt:j("Invalid stream specification: "+J(t)))(t,e)}function ALt(t){return t===kO?Uk:t||Uk}function $Lt(t,e){const n=t.merge.map(i=>ny(i,e)),r=MO({merge:n},t,e);return e.addStream(r).id}function TLt(t,e){const n=ny(t.stream,e),r=MO({stream:n},t,e);return e.addStream(r).id}function kLt(t,e){let n;t.type===Z7?(n=e.event(Z7,t.throttle),t={between:t.between,filter:t.filter}):n=e.event(ALt(t.source),t.type);const r=MO({stream:n},t,e);return Object.keys(r).length===1?n:e.addStream(r).id}function MO(t,e,n){let r=e.between;return r&&(r.length!==2&&j('Stream "between" parameter must have 2 entries: '+J(e)),t.between=[ny(r[0],n),ny(r[1],n)]),r=e.filter?[].concat(e.filter):[],(e.marktype||e.markname||e.markrole)&&r.push(MLt(e.marktype,e.markname,e.markrole)),e.source===kO&&r.push("inScope(event.item)"),r.length&&(t.filter=ra("("+r.join(")&&(")+")",n).$expr),(r=e.throttle)!=null&&(t.throttle=+r),(r=e.debounce)!=null&&(t.debounce=+r),e.consume&&(t.consume=!0),t}function MLt(t,e,n){const r="event.item";return r+(t&&t!=="*"?"&&"+r+".mark.marktype==='"+t+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(e?"&&"+r+".mark.name==='"+e+"'":"")}const CLt={code:"_.$value",ast:{type:"Identifier",value:"value"}};function ILt(t,e,n){const r=t.encode,i={target:n};let s=t.events,o=t.update,a=[];s||j("Signal update missing events specification."),at(s)&&(s=yl(s,e.isSubscope()?kO:Uk)),s=ot(s).filter(u=>u.signal||u.scale?(a.push(u),0):1),a.length>1&&(a=[NLt(a)]),s.length&&a.push(s.length>1?{merge:s}:s[0]),r!=null&&(o&&j("Signal encode and update are mutually exclusive."),o="encode(item(),"+J(r)+")"),i.update=at(o)?ra(o,e):o.expr!=null?ra(o.expr,e):o.value!=null?o.value:o.signal!=null?{$expr:CLt,$params:{$value:e.signalRef(o.signal)}}:j("Invalid signal update specification."),t.force&&(i.options={force:!0}),a.forEach(u=>e.addUpdate(Pt(FLt(u,e),i)))}function FLt(t,e){return{source:t.signal?e.signalRef(t.signal):t.scale?e.scaleRef(t.scale):ny(t,e)}}function NLt(t){return{signal:"["+t.map(e=>e.scale?'scale("'+e.scale+'")':e.signal)+"]"}}function OLt(t,e){const n=e.getSignal(t.name);let r=t.update;t.init&&(r?j("Signals can not include both init and update expressions."):(r=t.init,n.initonly=!0)),r&&(r=ra(r,e),n.update=r.$expr,n.params=r.$params),t.on&&t.on.forEach(i=>ILt(i,e,n.id))}const Ee=t=>(e,n,r)=>CS(t,n,e||void 0,r),Znt=Ee("aggregate"),RLt=Ee("axisticks"),trt=Ee("bound"),oo=Ee("collect"),t9=Ee("compare"),DLt=Ee("datajoin"),ert=Ee("encode"),LLt=Ee("expression"),BLt=Ee("facet"),PLt=Ee("field"),zLt=Ee("key"),ULt=Ee("legendentries"),jLt=Ee("load"),qLt=Ee("mark"),WLt=Ee("multiextent"),VLt=Ee("multivalues"),GLt=Ee("overlap"),YLt=Ee("params"),nrt=Ee("prefacet"),HLt=Ee("projection"),XLt=Ee("proxy"),KLt=Ee("relay"),rrt=Ee("render"),QLt=Ee("scale"),pd=Ee("sieve"),JLt=Ee("sortitems"),irt=Ee("viewlayout"),ZLt=Ee("values");let t7t=0;const srt={min:"min",max:"max",count:"sum"};function e7t(t,e){const n=t.type||"linear";VZ(n)||j("Unrecognized scale type: "+J(n)),e.addScale(t.name,{type:n,domain:void 0})}function n7t(t,e){const n=e.getScale(t.name).params;let r;n.domain=ort(t.domain,t,e),t.range!=null&&(n.range=urt(t,e,n)),t.interpolate!=null&&d7t(t.interpolate,n),t.nice!=null&&(n.nice=f7t(t.nice,e)),t.bins!=null&&(n.bins=l7t(t.bins,e));for(r in t)ft(n,r)||r==="name"||(n[r]=ts(t[r],e))}function ts(t,e){return st(t)?t.signal?e.signalRef(t.signal):j("Unsupported object: "+J(t)):t}function Cv(t,e){return t.signal?e.signalRef(t.signal):t.map(n=>ts(n,e))}function FS(t){j("Can not find data set: "+J(t))}function ort(t,e,n){if(!t){(e.domainMin!=null||e.domainMax!=null)&&j("No scale domain defined for domainMin/domainMax to override.");return}return t.signal?n.signalRef(t.signal):(W(t)?r7t:t.fields?s7t:i7t)(t,e,n)}function r7t(t,e,n){return t.map(r=>ts(r,n))}function i7t(t,e,n){const r=n.getData(t.data);return r||FS(t.data),bp(e.type)?r.valuesRef(n,t.field,art(t.sort,!1)):HZ(e.type)?r.domainRef(n,t.field):r.extentRef(n,t.field)}function s7t(t,e,n){const r=t.data,i=t.fields.reduce((s,o)=>(o=at(o)?{data:r,field:o}:W(o)||o.signal?o7t(o,n):o,s.push(o),s),[]);return(bp(e.type)?a7t:HZ(e.type)?u7t:c7t)(t,n,i)}function o7t(t,e){const n="_:vega:_"+t7t++,r=oo({});if(W(t))r.value={$ingest:t};else if(t.signal){const i="setdata("+J(n)+","+t.signal+")";r.params.input=e.signalRef(i)}return e.addDataPipeline(n,[r,pd({})]),{data:n,field:"data"}}function a7t(t,e,n){const r=art(t.sort,!0);let i,s;const o=n.map(c=>{const l=e.getData(c.data);return l||FS(c.data),l.countsRef(e,c.field,r)}),a={groupby:zk,pulse:o};r&&(i=r.op||"count",s=r.field?IS(i,r.field):"count",a.ops=[srt[i]],a.fields=[e.fieldRef(s)],a.as=[s]),i=e.add(Znt(a));const u=e.add(oo({pulse:bt(i)}));return s=e.add(ZLt({field:zk,sort:e.sortRef(r),pulse:bt(u)})),bt(s)}function art(t,e){return t&&(!t.field&&!t.op?st(t)?t.field="key":t={field:"key"}:!t.field&&t.op!=="count"?j("No field provided for sort aggregate op: "+t.op):e&&t.field&&t.op&&!srt[t.op]&&j("Multiple domain scales can not be sorted using "+t.op)),t}function u7t(t,e,n){const r=n.map(i=>{const s=e.getData(i.data);return s||FS(i.data),s.domainRef(e,i.field)});return bt(e.add(VLt({values:r})))}function c7t(t,e,n){const r=n.map(i=>{const s=e.getData(i.data);return s||FS(i.data),s.extentRef(e,i.field)});return bt(e.add(WLt({extents:r})))}function l7t(t,e){return t.signal||W(t)?Cv(t,e):e.objectProperty(t)}function f7t(t,e){return t.signal?e.signalRef(t.signal):st(t)?{interval:ts(t.interval),step:ts(t.step)}:ts(t)}function d7t(t,e){e.interpolate=ts(t.type||t),t.gamma!=null&&(e.interpolateGamma=ts(t.gamma))}function urt(t,e,n){const r=e.config.range;let i=t.range;if(i.signal)return e.signalRef(i.signal);if(at(i)){if(r&&ft(r,i))return t=Pt({},t,{range:r[i]}),urt(t,e,n);i==="width"?i=[0,{signal:"width"}]:i==="height"?i=bp(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]:j("Unrecognized scale range value: "+J(i))}else if(i.scheme){n.scheme=W(i.scheme)?Cv(i.scheme,e):ts(i.scheme,e),i.extent&&(n.schemeExtent=Cv(i.extent,e)),i.count&&(n.schemeCount=ts(i.count,e));return}else if(i.step){n.rangeStep=ts(i.step,e);return}else{if(bp(t.type)&&!W(i))return ort(i,t,e);W(i)||j("Unsupported range type: "+J(i))}return i.map(s=>(W(s)?Cv:ts)(s,e))}function h7t(t,e){const n=e.config.projection||{},r={};for(const i in t)i!=="name"&&(r[i]=jk(t[i],i,e));for(const i in n)r[i]==null&&(r[i]=jk(n[i],i,e));e.addProjection(t.name,r)}function jk(t,e,n){return W(t)?t.map(r=>jk(r,e,n)):st(t)?t.signal?n.signalRef(t.signal):e==="fit"?t:j("Unsupported parameter object: "+J(t)):t}const ao="top",wg="left",xg="right",tl="bottom",crt="center",p7t="vertical",g7t="start",m7t="middle",y7t="end",qk="index",CO="label",b7t="offset",Sp="perc",v7t="perc2",is="value",p1="guide-label",IO="guide-title",w7t="group-title",x7t="group-subtitle",e9="symbol",Iv="gradient",Wk="discrete",Vk="size",_7t="shape",S7t="fill",E7t="stroke",A7t="strokeWidth",$7t="strokeDash",T7t="opacity",FO=[Vk,_7t,S7t,E7t,A7t,$7t,T7t],g1={name:1,style:1,interactive:1},ee={value:0},ss={value:1},NS="group",lrt="rect",NO="rule",k7t="symbol",gd="text";function ry(t){return t.type=NS,t.interactive=t.interactive||!1,t}function bi(t,e){const n=(r,i)=>Ns(t[r],Ns(e[r],i));return n.isVertical=r=>p7t===Ns(t.direction,e.direction||(r?e.symbolDirection:e.gradientDirection)),n.gradientLength=()=>Ns(t.gradientLength,e.gradientLength||e.gradientWidth),n.gradientThickness=()=>Ns(t.gradientThickness,e.gradientThickness||e.gradientHeight),n.entryColumns=()=>Ns(t.columns,Ns(e.columns,+n.isVertical(!0))),n}function frt(t,e){const n=e&&(e.update&&e.update[t]||e.enter&&e.enter[t]);return n&&n.signal?n:n?n.value:null}function M7t(t,e,n){const r=e.config.style[n];return r&&r[t]}function OS(t,e,n){return`item.anchor === '${g7t}' ? ${t} : item.anchor === '${y7t}' ? ${e} : ${n}`}const OO=OS(J(wg),J(xg),J(crt));function C7t(t){const e=t("tickBand");let n=t("tickOffset"),r,i;return e?e.signal?(r={signal:`(${e.signal}) === 'extent' ? 1 : 0.5`},i={signal:`(${e.signal}) === 'extent'`},st(n)||(n={signal:`(${e.signal}) === 'extent' ? 0 : ${n}`})):e==="extent"?(r=1,i=!0,n=0):(r=.5,i=!1):(r=t("bandPosition"),i=t("tickExtra")),{extra:i,band:r,offset:n}}function drt(t,e){return e?t?st(t)?Object.assign({},t,{offset:drt(t.offset,e)}):{value:t,offset:e}:e:t}function Pi(t,e){return e?(t.name=e.name,t.style=e.style||t.style,t.interactive=!!e.interactive,t.encode=vg(t.encode,e,g1)):t.interactive=!1,t}function I7t(t,e,n,r){const i=bi(t,n),s=i.isVertical(),o=i.gradientThickness(),a=i.gradientLength();let u,c,l,f,d;s?(c=[0,1],l=[0,0],f=o,d=a):(c=[0,0],l=[1,0],f=a,d=o);const h={enter:u={opacity:ee,x:ee,y:ee,width:Nn(f),height:Nn(d)},update:Pt({},u,{opacity:ss,fill:{gradient:e,start:c,stop:l}}),exit:{opacity:ee}};return er(h,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),Pi({type:lrt,role:iLt,encode:h},r)}function F7t(t,e,n,r,i){const s=bi(t,n),o=s.isVertical(),a=s.gradientThickness(),u=s.gradientLength();let c,l,f,d,h="";o?(c="y",f="y2",l="x",d="width",h="1-"):(c="x",f="x2",l="y",d="height");const p={opacity:ee,fill:{scale:e,field:is}};p[c]={signal:h+"datum."+Sp,mult:u},p[l]=ee,p[f]={signal:h+"datum."+v7t,mult:u},p[d]=Nn(a);const g={enter:p,update:Pt({},p,{opacity:ss}),exit:{opacity:ee}};return er(g,{stroke:s("gradientStrokeColor"),strokeWidth:s("gradientStrokeWidth")},{opacity:s("gradientOpacity")}),Pi({type:lrt,role:nLt,key:is,from:i,encode:g},r)}const N7t=`datum.${Sp}<=0?"${wg}":datum.${Sp}>=1?"${xg}":"${crt}"`,O7t=`datum.${Sp}<=0?"${tl}":datum.${Sp}>=1?"${ao}":"${m7t}"`;function n9(t,e,n,r){const i=bi(t,e),s=i.isVertical(),o=Nn(i.gradientThickness()),a=i.gradientLength();let u=i("labelOverlap"),c,l,f,d,h="";const p={enter:c={opacity:ee},update:l={opacity:ss,text:{field:CO}},exit:{opacity:ee}};return er(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:Ns(t.labelLimit,e.gradientLabelLimit)}),s?(c.align={value:"left"},c.baseline=l.baseline={signal:O7t},f="y",d="x",h="1-"):(c.align=l.align={signal:N7t},c.baseline={value:"top"},f="x",d="y"),c[f]=l[f]={signal:h+"datum."+Sp,mult:a},c[d]=l[d]=o,o.offset=Ns(t.labelOffset,e.gradientLabelOffset)||0,u=u?{separation:i("labelSeparation"),method:u,order:"datum."+qk}:void 0,Pi({type:gd,role:Ynt,style:p1,key:is,from:r,encode:p,overlap:u},n)}function R7t(t,e,n,r,i){const s=bi(t,e),o=n.entries,a=!!(o&&o.interactive),u=o?o.name:void 0,c=s("clipHeight"),l=s("symbolOffset"),f={data:"value"},d=`(${i}) ? datum.${b7t} : datum.${Vk}`,h=c?Nn(c):{field:Vk},p=`datum.${qk}`,g=`max(1, ${i})`;let m,y,b,w,v;h.mult=.5,m={enter:y={opacity:ee,x:{signal:d,mult:.5,offset:l},y:h},update:b={opacity:ss,x:y.x,y:y.y},exit:{opacity:ee}};let x=null,S=null;t.fill||(x=e.symbolBaseFillColor,S=e.symbolBaseStrokeColor),er(m,{fill:s("symbolFillColor",x),shape:s("symbolType"),size:s("symbolSize"),stroke:s("symbolStrokeColor",S),strokeDash:s("symbolDash"),strokeDashOffset:s("symbolDashOffset"),strokeWidth:s("symbolStrokeWidth")},{opacity:s("symbolOpacity")}),FO.forEach($=>{t[$]&&(b[$]=y[$]={scale:t[$],field:is})});const _=Pi({type:k7t,role:sLt,key:is,from:f,clip:c?!0:void 0,encode:m},n.symbols),E=Nn(l);E.offset=s("labelOffset"),m={enter:y={opacity:ee,x:{signal:d,offset:E},y:h},update:b={opacity:ss,text:{field:CO},x:y.x,y:y.y},exit:{opacity:ee}},er(m,{align:s("labelAlign"),baseline:s("labelBaseline"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontStyle:s("labelFontStyle"),fontWeight:s("labelFontWeight"),limit:s("labelLimit")});const A=Pi({type:gd,role:Ynt,style:p1,key:is,from:f,encode:m},n.labels);return m={enter:{noBound:{value:!c},width:ee,height:c?Nn(c):ee,opacity:ee},exit:{opacity:ee},update:b={opacity:ss,row:{signal:null},column:{signal:null}}},s.isVertical(!0)?(w=`ceil(item.mark.items.length / ${g})`,b.row.signal=`${p}%${w}`,b.column.signal=`floor(${p} / ${w})`,v={field:["row",p]}):(b.row.signal=`floor(${p} / ${g})`,b.column.signal=`${p} % ${g}`,v={field:p}),b.column.signal=`(${i})?${b.column.signal}:${p}`,r={facet:{data:r,name:"value",groupby:qk}},ry({role:TO,from:r,encode:vg(m,o,g1),marks:[_,A],name:u,interactive:a,sort:v})}function D7t(t,e){const n=bi(t,e);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const RO='item.orient === "left"',DO='item.orient === "right"',RS=`(${RO} || ${DO})`,L7t=`datum.vgrad && ${RS}`,B7t=OS('"top"','"bottom"','"middle"'),P7t=OS('"right"','"left"','"center"'),z7t=`datum.vgrad && ${DO} ? (${P7t}) : (${RS} && !(datum.vgrad && ${RO})) ? "left" : ${OO}`,U7t=`item._anchor || (${RS} ? "middle" : "start")`,j7t=`${L7t} ? (${RO} ? -90 : 90) : 0`,q7t=`${RS} ? (datum.vgrad ? (${DO} ? "bottom" : "top") : ${B7t}) : "top"`;function W7t(t,e,n,r){const i=bi(t,e),s={enter:{opacity:ee},update:{opacity:ss,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:ee}};return er(s,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:U7t},angle:{signal:j7t},align:{signal:z7t},baseline:{signal:q7t},text:t.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),Pi({type:gd,role:oLt,style:IO,from:r,encode:s},n)}function V7t(t,e){let n;return st(t)&&(t.signal?n=t.signal:t.path?n="pathShape("+r9(t.path)+")":t.sphere&&(n="geoShape("+r9(t.sphere)+', {type: "Sphere"})')),n?e.signalRef(n):!!t}function r9(t){return st(t)&&t.signal?t.signal:J(t)}function hrt(t){const e=t.role||"";return e.startsWith("axis")||e.startsWith("legend")||e.startsWith("title")?e:t.type===NS?TO:e||AO}function G7t(t){return{marktype:t.type,name:t.name||void 0,role:t.role||hrt(t),zindex:+t.zindex||void 0,aria:t.aria,description:t.description}}function Y7t(t,e){return t&&t.signal?e.signalRef(t.signal):t!==!1}function LO(t,e){const n=JJ(t.type);n||j("Unrecognized transform type: "+J(t.type));const r=CS(n.type.toLowerCase(),null,prt(n,t,e));return t.signal&&e.addSignal(t.signal,e.proxy(r)),r.metadata=n.metadata||{},r}function prt(t,e,n){const r={},i=t.params.length;for(let s=0;s<i;++s){const o=t.params[s];r[o.name]=H7t(o,e,n)}return r}function H7t(t,e,n){const r=t.type,i=e[t.name];if(r==="index")return X7t(t,e,n);if(i===void 0){t.required&&j("Missing required "+J(e.type)+" parameter: "+J(t.name));return}else{if(r==="param")return K7t(t,e,n);if(r==="projection")return n.projectionRef(e[t.name])}return t.array&&!En(i)?i.map(s=>i9(t,s,n)):i9(t,i,n)}function i9(t,e,n){const r=t.type;if(En(e))return o9(r)?j("Expression references can not be signals."):x$(r)?n.fieldRef(e):a9(r)?n.compareRef(e):n.signalRef(e.signal);{const i=t.expr||x$(r);return i&&Q7t(e)?n.exprRef(e.expr,e.as):i&&J7t(e)?ey(e.field,e.as):o9(r)?ra(e,n):Z7t(r)?bt(n.getData(e).values):x$(r)?ey(e):a9(r)?n.compareRef(e):e}}function X7t(t,e,n){return at(e.from)||j('Lookup "from" parameter must be a string literal.'),n.getData(e.from).lookupRef(n,e.key)}function K7t(t,e,n){const r=e[t.name];return t.array?(W(r)||j("Expected an array of sub-parameters. Instead: "+J(r)),r.map(i=>s9(t,i,n))):s9(t,r,n)}function s9(t,e,n){const r=t.params.length;let i;for(let o=0;o<r;++o){i=t.params[o];for(const a in i.key)if(i.key[a]!==e[a]){i=null;break}if(i)break}i||j("Unsupported parameter: "+J(e));const s=Pt(prt(i,e,n),i.key);return bt(n.add(YLt(s)))}const Q7t=t=>t&&t.expr,J7t=t=>t&&t.field,Z7t=t=>t==="data",o9=t=>t==="expr",x$=t=>t==="field",a9=t=>t==="compare";function t9t(t,e,n){let r,i,s,o,a;return t?(r=t.facet)&&(e||j("Only group marks can be faceted."),r.field!=null?o=a=Fv(r,n):(t.data?a=bt(n.getData(t.data).aggregate):(s=LO(Pt({type:"aggregate",groupby:ot(r.groupby)},r.aggregate),n),s.params.key=n.keyRef(r.groupby),s.params.pulse=Fv(r,n),o=a=bt(n.add(s))),i=n.keyRef(r.groupby,!0))):o=bt(n.add(oo(null,[{}]))),o||(o=Fv(t,n)),{key:i,pulse:o,parent:a}}function Fv(t,e){return t.$ref?t:t.data&&t.data.$ref?t.data:bt(e.getData(t.data).output)}function Vf(t,e,n,r,i){this.scope=t,this.input=e,this.output=n,this.values=r,this.aggregate=i,this.index={}}Vf.fromEntries=function(t,e){const n=e.length,r=e[n-1],i=e[n-2];let s=e[0],o=null,a=1;for(s&&s.type==="load"&&(s=e[1]),t.add(e[0]);a<n;++a)e[a].params.pulse=bt(e[a-1]),t.add(e[a]),e[a].type==="aggregate"&&(o=e[a]);return new Vf(t,s,i,r,o)};function grt(t){return at(t)?t:null}function u9(t,e,n){const r=IS(n.op,n.field);let i;if(e.ops){for(let s=0,o=e.as.length;s<o;++s)if(e.as[s]===r)return}else e.ops=["count"],e.fields=[null],e.as=["count"];n.op&&(e.ops.push((i=n.op.signal)?t.signalRef(i):n.op),e.fields.push(t.fieldRef(n.field)),e.as.push(r))}function em(t,e,n,r,i,s,o){const a=e[n]||(e[n]={}),u=SLt(s);let c=grt(i),l,f;if(c!=null&&(t=e.scope,c=c+(u?"|"+u:""),l=a[c]),!l){const d=s?{field:zk,pulse:e.countsRef(t,i,s)}:{field:t.fieldRef(i),pulse:bt(e.output)};u&&(d.sort=t.sortRef(s)),f=t.add(CS(r,void 0,d)),o&&(e.index[i]=f),l=bt(f),c!=null&&(a[c]=l)}return l}Vf.prototype={countsRef(t,e,n){const r=this,i=r.counts||(r.counts={}),s=grt(e);let o,a,u;return s!=null&&(t=r.scope,o=i[s]),o?n&&n.field&&u9(t,o.agg.params,n):(u={groupby:t.fieldRef(e,"key"),pulse:bt(r.output)},n&&n.field&&u9(t,u,n),a=t.add(Znt(u)),o=t.add(oo({pulse:bt(a)})),o={agg:a,ref:bt(o)},s!=null&&(i[s]=o)),o.ref},tuplesRef(){return bt(this.values)},extentRef(t,e){return em(t,this,"extent","extent",e,!1)},domainRef(t,e){return em(t,this,"domain","values",e,!1)},valuesRef(t,e,n){return em(t,this,"vals","values",e,n||!0)},lookupRef(t,e){return em(t,this,"lookup","tupleindex",e,!1)},indataRef(t,e){return em(t,this,"indata","tupleindex",e,!0,!0)}};function e9t(t,e,n){const r=t.from.facet,i=r.name,s=Fv(r,e);let o;r.name||j("Facet must have a name: "+J(r)),r.data||j("Facet must reference a data set: "+J(r)),r.field?o=e.add(nrt({field:e.fieldRef(r.field),pulse:s})):r.groupby?o=e.add(BLt({key:e.keyRef(r.groupby),group:bt(e.proxy(n.parent)),pulse:s})):j("Facet must specify groupby or field: "+J(r));const a=e.fork(),u=a.add(oo()),c=a.add(pd({pulse:bt(u)}));a.addData(i,new Vf(a,u,u,c)),a.addSignal("parent",null),o.params.subflow={$subflow:a.parse(t).toRuntime()}}function n9t(t,e,n){const r=e.add(nrt({pulse:n.pulse})),i=e.fork();i.add(pd()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(t).toRuntime()}}function mrt(t,e,n){const r=t.remove,i=t.insert,s=t.toggle,o=t.modify,a=t.values,u=e.add(Zx()),c="if("+t.trigger+',modify("'+n+'",'+[i,r,s,o,a].map(f=>f??"null").join(",")+"),0)",l=ra(c,e);u.update=l.$expr,u.params=l.$params}function DS(t,e){const n=hrt(t),r=t.type===NS,i=t.from&&t.from.facet,s=t.overlap;let o=t.layout||n===TO||n===$O,a,u,c,l,f,d,h;const p=n===AO||o||i,g=t9t(t.from,r,e);u=e.add(DLt({key:g.key||(t.key?ey(t.key):void 0),pulse:g.pulse,clean:!r}));const m=bt(u);u=c=e.add(oo({pulse:m})),u=e.add(qLt({markdef:G7t(t),interactive:Y7t(t.interactive,e),clip:V7t(t.clip,e),context:{$context:!0},groups:e.lookup(),parent:e.signals.parent?e.signalRef("parent"):null,index:e.markpath(),pulse:bt(u)}));const y=bt(u);u=l=e.add(ert(Qnt(t.encode,t.type,n,t.style,e,{mod:!1,pulse:y}))),u.params.parent=e.encode(),t.transform&&t.transform.forEach(S=>{const _=LO(S,e),E=_.metadata;(E.generates||E.changes)&&j("Mark transforms should not generate new data."),E.nomod||(l.params.mod=!0),_.params.pulse=bt(u),e.add(u=_)}),t.sort&&(u=e.add(JLt({sort:e.compareRef(t.sort),pulse:bt(u)})));const b=bt(u);(i||o)&&(o=e.add(irt({layout:e.objectProperty(t.layout),legends:e.legends,mark:y,pulse:b})),d=bt(o));const w=e.add(trt({mark:y,pulse:d||b}));h=bt(w),r&&(p&&(a=e.operators,a.pop(),o&&a.pop()),e.pushState(b,d||h,m),i?e9t(t,e,g):p?n9t(t,e,g):e.parse(t),e.popState(),p&&(o&&a.push(o),a.push(w))),s&&(h=r9t(s,h,e));const v=e.add(rrt({pulse:h})),x=e.add(pd({pulse:bt(v)},void 0,e.parent()));t.name!=null&&(f=t.name,e.addData(f,new Vf(e,c,v,x)),t.on&&t.on.forEach(S=>{(S.insert||S.remove||S.toggle)&&j("Marks only support modify triggers."),mrt(S,e,f)}))}function r9t(t,e,n){const r=t.method,i=t.bound,s=t.separation,o={separation:En(s)?n.signalRef(s.signal):s,method:En(r)?n.signalRef(r.signal):r,pulse:e};if(t.order&&(o.sort=n.compareRef({field:t.order})),i){const a=i.tolerance;o.boundTolerance=En(a)?n.signalRef(a.signal):+a,o.boundScale=n.scaleRef(i.scale),o.boundOrient=i.orient}return bt(n.add(GLt(o)))}function i9t(t,e){const n=e.config.legend,r=t.encode||{},i=bi(t,n),s=r.legend||{},o=s.name||void 0,a=s.interactive,u=s.style,c={};let l=0,f,d,h;FO.forEach(w=>t[w]?(c[w]=t[w],l=l||t[w]):0),l||j("Missing valid scale for legend.");const p=s9t(t,e.scaleType(l)),g={title:t.title!=null,scales:c,type:p,vgrad:p!=="symbol"&&i.isVertical()},m=bt(e.add(oo(null,[g]))),y={enter:{x:{value:0},y:{value:0}}},b=bt(e.add(ULt(d={type:p,scale:e.scaleRef(l),count:e.objectProperty(i("tickCount")),limit:e.property(i("symbolLimit")),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)})));return p===Iv?(h=[I7t(t,l,n,r.gradient),n9(t,n,r.labels,b)],d.count=d.count||e.signalRef(`max(2,2*floor((${bf(i.gradientLength())})/100))`)):p===Wk?h=[F7t(t,l,n,r.gradient,b),n9(t,n,r.labels,b)]:(f=D7t(t,n),h=[R7t(t,n,r,b,bf(f.columns))],d.size=u9t(t,e,h[0].marks)),h=[ry({role:rLt,from:m,encode:y,marks:h,layout:f,interactive:a})],g.title&&h.push(W7t(t,n,r.title,m)),DS(ry({role:eLt,from:m,encode:vg(a9t(i,t,n),s,g1),marks:h,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:a,style:u}),e)}function s9t(t,e){let n=t.type||e9;return!t.type&&o9t(t)===1&&(t.fill||t.stroke)&&(n=X6(e)?Iv:sk(e)?Wk:e9),n!==Iv?n:sk(e)?Wk:Iv}function o9t(t){return FO.reduce((e,n)=>e+(t[n]?1:0),0)}function a9t(t,e,n){const r={enter:{},update:{}};return er(r,{orient:t("orient"),offset:t("offset"),padding:t("padding"),titlePadding:t("titlePadding"),cornerRadius:t("cornerRadius"),fill:t("fillColor"),stroke:t("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:t("legendX"),y:t("legendY"),format:e.format,formatType:e.formatType}),r}function u9t(t,e,n){const r=bf(c9("size",t,n)),i=bf(c9("strokeWidth",t,n)),s=bf(c9t(n[1].encode,e,p1));return ra(`max(ceil(sqrt(${r})+${i}),${s})`,e)}function c9(t,e,n){return e[t]?`scale("${e[t]}",datum)`:frt(t,n[0].encode)}function c9t(t,e,n){return frt("fontSize",t)||M7t("fontSize",e,n)}const l9t=`item.orient==="${wg}"?-90:item.orient==="${xg}"?90:0`;function f9t(t,e){t=at(t)?{text:t}:t;const n=bi(t,e.config.title),r=t.encode||{},i=r.group||{},s=i.name||void 0,o=i.interactive,a=i.style,u=[],c={},l=bt(e.add(oo(null,[c])));return u.push(p9t(t,n,d9t(t),l)),t.subtitle&&u.push(g9t(t,n,r.subtitle,l)),DS(ry({role:aLt,from:l,encode:h9t(n,i),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:s,interactive:o,style:a}),e)}function d9t(t){const e=t.encode;return e&&e.title||Pt({name:t.name,interactive:t.interactive,style:t.style},e)}function h9t(t,e){const n={enter:{},update:{}};return er(n,{orient:t("orient"),anchor:t("anchor"),align:{signal:OO},angle:{signal:l9t},limit:t("limit"),frame:t("frame"),offset:t("offset")||0,padding:t("subtitlePadding")}),vg(n,e,g1)}function p9t(t,e,n,r){const i={value:0},s=t.text,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return er(o,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("color"),font:e("font"),fontSize:e("fontSize"),fontStyle:e("fontStyle"),fontWeight:e("fontWeight"),lineHeight:e("lineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),Pi({type:gd,role:uLt,style:w7t,from:r,encode:o},n)}function g9t(t,e,n,r){const i={value:0},s=t.subtitle,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return er(o,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("subtitleColor"),font:e("subtitleFont"),fontSize:e("subtitleFontSize"),fontStyle:e("subtitleFontStyle"),fontWeight:e("subtitleFontWeight"),lineHeight:e("subtitleLineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),Pi({type:gd,role:cLt,style:x7t,from:r,encode:o},n)}function m9t(t,e){const n=[];t.transform&&t.transform.forEach(r=>{n.push(LO(r,e))}),t.on&&t.on.forEach(r=>{mrt(r,e,t.name)}),e.addDataPipeline(t.name,y9t(t,e,n))}function y9t(t,e,n){const r=[];let i=null,s=!1,o=!1,a,u,c,l,f;for(t.values?En(t.values)||Mv(t.format)?(r.push(l9(e,t)),r.push(i=Ml())):r.push(i=Ml({$ingest:t.values,$format:t.format})):t.url?Mv(t.url)||Mv(t.format)?(r.push(l9(e,t)),r.push(i=Ml())):r.push(i=Ml({$request:t.url,$format:t.format})):t.source&&(i=a=ot(t.source).map(d=>bt(e.getData(d).output)),r.push(null)),u=0,c=n.length;u<c;++u)l=n[u],f=l.metadata,!i&&!f.source&&r.push(i=Ml()),r.push(l),f.generates&&(o=!0),f.modifies&&!o&&(s=!0),f.source?i=l:f.changes&&(i=null);return a&&(c=a.length-1,r[0]=KLt({derive:s,pulse:c?a:a[0]}),(s||c)&&r.splice(1,0,Ml())),i||r.push(Ml()),r.push(pd({})),r}function Ml(t){const e=oo({},t);return e.metadata={source:!0},e}function l9(t,e){return jLt({url:e.url?t.property(e.url):void 0,async:e.async?t.property(e.async):void 0,values:e.values?t.property(e.values):void 0,format:t.objectProperty(e.format)})}const yrt=t=>t===tl||t===ao,LS=(t,e,n)=>En(t)?x9t(t.signal,e,n):t===wg||t===ao?e:n,On=(t,e,n)=>En(t)?v9t(t.signal,e,n):yrt(t)?e:n,qs=(t,e,n)=>En(t)?w9t(t.signal,e,n):yrt(t)?n:e,brt=(t,e,n)=>En(t)?_9t(t.signal,e,n):t===ao?{value:e}:{value:n},b9t=(t,e,n)=>En(t)?S9t(t.signal,e,n):t===xg?{value:e}:{value:n},v9t=(t,e,n)=>vrt(`${t} === '${ao}' || ${t} === '${tl}'`,e,n),w9t=(t,e,n)=>vrt(`${t} !== '${ao}' && ${t} !== '${tl}'`,e,n),x9t=(t,e,n)=>BO(`${t} === '${wg}' || ${t} === '${ao}'`,e,n),_9t=(t,e,n)=>BO(`${t} === '${ao}'`,e,n),S9t=(t,e,n)=>BO(`${t} === '${xg}'`,e,n),vrt=(t,e,n)=>(e=e!=null?Nn(e):e,n=n!=null?Nn(n):n,f9(e)&&f9(n)?(e=e?e.signal||J(e.value):null,n=n?n.signal||J(n.value):null,{signal:`${t} ? (${e}) : (${n})`}):[Pt({test:t},e)].concat(n||[])),f9=t=>t==null||Object.keys(t).length===1,BO=(t,e,n)=>({signal:`${t} ? (${wh(e)}) : (${wh(n)})`}),E9t=(t,e,n,r,i)=>({signal:(r!=null?`${t} === '${wg}' ? (${wh(r)}) : `:"")+(n!=null?`${t} === '${tl}' ? (${wh(n)}) : `:"")+(i!=null?`${t} === '${xg}' ? (${wh(i)}) : `:"")+(e!=null?`${t} === '${ao}' ? (${wh(e)}) : `:"")+"(null)"}),wh=t=>En(t)?t.signal:t==null?null:J(t),A9t=(t,e)=>e===0?0:En(t)?{signal:`(${t.signal}) * ${e}`}:{value:t*e},Dh=(t,e)=>{const n=t.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+e.signal}:t};function Vd(t,e,n,r){let i;if(e&&ft(e,t))return e[t];if(ft(n,t))return n[t];if(t.startsWith("title")){switch(t){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=t[5].toLowerCase()+t.slice(6)}return r[IO][i]}else if(t.startsWith("label")){switch(t){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=t[5].toLowerCase()+t.slice(6)}return r[p1][i]}return null}function d9(t){const e={};for(const n of t)if(n)for(const r in n)e[r]=1;return Object.keys(e)}function $9t(t,e){var n=e.config,r=n.style,i=n.axis,s=e.scaleType(t.scale)==="band"&&n.axisBand,o=t.orient,a,u,c;if(En(o)){const f=d9([n.axisX,n.axisY]),d=d9([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);a={};for(c of f)a[c]=On(o,Vd(c,n.axisX,i,r),Vd(c,n.axisY,i,r));u={};for(c of d)u[c]=E9t(o.signal,Vd(c,n.axisTop,i,r),Vd(c,n.axisBottom,i,r),Vd(c,n.axisLeft,i,r),Vd(c,n.axisRight,i,r))}else a=o===ao||o===tl?n.axisX:n.axisY,u=n["axis"+o[0].toUpperCase()+o.slice(1)];return a||u||s?Pt({},i,a,u,s):i}function T9t(t,e,n,r){const i=bi(t,e),s=t.orient;let o,a;const u={enter:o={opacity:ee},update:a={opacity:ss},exit:{opacity:ee}};er(u,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const c=h9(t,0),l=h9(t,1);return o.x=a.x=On(s,c,ee),o.x2=a.x2=On(s,l),o.y=a.y=qs(s,c,ee),o.y2=a.y2=qs(s,l),Pi({type:NO,role:K4t,from:r,encode:u},n)}function h9(t,e){return{scale:t.scale,range:e}}function k9t(t,e,n,r,i){const s=bi(t,e),o=t.orient,a=t.gridScale,u=LS(o,1,-1),c=M9t(t.offset,u);let l,f,d;const h={enter:l={opacity:ee},update:d={opacity:ss},exit:f={opacity:ee}};er(h,{stroke:s("gridColor"),strokeCap:s("gridCap"),strokeDash:s("gridDash"),strokeDashOffset:s("gridDashOffset"),strokeOpacity:s("gridOpacity"),strokeWidth:s("gridWidth")});const p={scale:t.scale,field:is,band:i.band,extra:i.extra,offset:i.offset,round:s("tickRound")},g=On(o,{signal:"height"},{signal:"width"}),m=a?{scale:a,range:0,mult:u,offset:c}:{value:0,offset:c},y=a?{scale:a,range:1,mult:u,offset:c}:Pt(g,{mult:u,offset:c});return l.x=d.x=On(o,p,m),l.y=d.y=qs(o,p,m),l.x2=d.x2=qs(o,y),l.y2=d.y2=On(o,y),f.x=On(o,p),f.y=qs(o,p),Pi({type:NO,role:Q4t,key:is,from:r,encode:h},n)}function M9t(t,e){if(e!==1)if(!st(t))t=En(e)?{signal:`(${e.signal}) * (${t||0})`}:e*(t||0);else{let n=t=Pt({},t);for(;n.mult!=null;)if(st(n.mult))n=n.mult=Pt({},n.mult);else return n.mult=En(e)?{signal:`(${n.mult}) * (${e.signal})`}:n.mult*e,t;n.mult=e}return t}function C9t(t,e,n,r,i,s){const o=bi(t,e),a=t.orient,u=LS(a,-1,1);let c,l,f;const d={enter:c={opacity:ee},update:f={opacity:ss},exit:l={opacity:ee}};er(d,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const h=Nn(i);h.mult=u;const p={scale:t.scale,field:is,band:s.band,extra:s.extra,offset:s.offset,round:o("tickRound")};return f.y=c.y=On(a,ee,p),f.y2=c.y2=On(a,h),l.x=On(a,p),f.x=c.x=qs(a,ee,p),f.x2=c.x2=qs(a,h),l.y=qs(a,p),Pi({type:NO,role:Z4t,key:is,from:r,encode:d},n)}function _$(t,e,n,r,i){return{signal:'flush(range("'+t+'"), scale("'+t+'", datum.value), '+e+","+n+","+r+","+i+")"}}function I9t(t,e,n,r,i,s){const o=bi(t,e),a=t.orient,u=t.scale,c=LS(a,-1,1),l=bf(o("labelFlush")),f=bf(o("labelFlushOffset")),d=o("labelAlign"),h=o("labelBaseline");let p=l===0||!!l,g;const m=Nn(i);m.mult=c,m.offset=Nn(o("labelPadding")||0),m.offset.mult=c;const y={scale:u,field:is,band:.5,offset:drt(s.offset,o("labelOffset"))},b=On(a,p?_$(u,l,'"left"','"right"','"center"'):{value:"center"},b9t(a,"left","right")),w=On(a,brt(a,"bottom","top"),p?_$(u,l,'"top"','"bottom"','"middle"'):{value:"middle"}),v=_$(u,l,`-(${f})`,f,0);p=p&&f;const x={opacity:ee,x:On(a,y,m),y:qs(a,y,m)},S={enter:x,update:g={opacity:ss,text:{field:CO},x:x.x,y:x.y,align:b,baseline:w},exit:{opacity:ee,x:x.x,y:x.y}};er(S,{dx:!d&&p?On(a,v):null,dy:!h&&p?qs(a,v):null}),er(S,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:d,baseline:h});const _=o("labelBound");let E=o("labelOverlap");return E=E||_?{separation:o("labelSeparation"),method:E,order:"datum.index",bound:_?{scale:u,orient:a,tolerance:_}:null}:void 0,g.align!==b&&(g.align=Dh(g.align,b)),g.baseline!==w&&(g.baseline=Dh(g.baseline,w)),Pi({type:gd,role:J4t,style:p1,key:is,from:r,encode:S,overlap:E},n)}function F9t(t,e,n,r){const i=bi(t,e),s=t.orient,o=LS(s,-1,1);let a,u;const c={enter:a={opacity:ee,anchor:Nn(i("titleAnchor",null)),align:{signal:OO}},update:u=Pt({},a,{opacity:ss,text:Nn(t.title)}),exit:{opacity:ee}},l={signal:`lerp(range("${t.scale}"), ${OS(0,1,.5)})`};return u.x=On(s,l),u.y=qs(s,l),a.angle=On(s,ee,A9t(o,90)),a.baseline=On(s,brt(s,tl,ao),{value:tl}),u.angle=a.angle,u.baseline=a.baseline,er(c,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),N9t(i,s,c,n),c.update.align=Dh(c.update.align,a.align),c.update.angle=Dh(c.update.angle,a.angle),c.update.baseline=Dh(c.update.baseline,a.baseline),Pi({type:gd,role:tLt,style:IO,from:r,encode:c},n)}function N9t(t,e,n,r){const i=(a,u)=>a!=null?(n.update[u]=Dh(Nn(a),n.update[u]),!1):!oh(u,r),s=i(t("titleX"),"x"),o=i(t("titleY"),"y");n.enter.auto=o===s?Nn(o):On(e,Nn(o),Nn(s))}function O9t(t,e){const n=$9t(t,e),r=t.encode||{},i=r.axis||{},s=i.name||void 0,o=i.interactive,a=i.style,u=bi(t,n),c=C7t(u),l={scale:t.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:t.title!=null},f=bt(e.add(oo({},[l]))),d=bt(e.add(RLt({scale:e.scaleRef(t.scale),extra:e.property(c.extra),count:e.objectProperty(t.tickCount),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)}))),h=[];let p;return l.grid&&h.push(k9t(t,n,r.grid,d,c)),l.ticks&&(p=u("tickSize"),h.push(C9t(t,n,r.ticks,d,p,c))),l.labels&&(p=l.ticks?p:0,h.push(I9t(t,n,r.labels,d,p,c))),l.domain&&h.push(T9t(t,n,r.domain,f)),l.title&&h.push(F9t(t,n,r.title,f)),DS(ry({role:X4t,from:f,encode:vg(R9t(u,t),i,g1),marks:h,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:s,interactive:o,style:a}),e)}function R9t(t,e){const n={enter:{},update:{}};return er(n,{orient:t("orient"),offset:t("offset")||0,position:Ns(e.position,0),titlePadding:t("titlePadding"),minExtent:t("minExtent"),maxExtent:t("maxExtent"),range:{signal:`abs(span(range("${e.scale}")))`},translate:t("translate"),format:e.format,formatType:e.formatType}),n}function wrt(t,e,n){const r=ot(t.signals),i=ot(t.scales);return n||r.forEach(s=>Jnt(s,e)),ot(t.projections).forEach(s=>h7t(s,e)),i.forEach(s=>e7t(s,e)),ot(t.data).forEach(s=>m9t(s,e)),i.forEach(s=>n7t(s,e)),(n||r).forEach(s=>OLt(s,e)),ot(t.axes).forEach(s=>O9t(s,e)),ot(t.marks).forEach(s=>DS(s,e)),ot(t.legends).forEach(s=>i9t(s,e)),t.title&&f9t(t.title,e),e.parseLambdas(),e}const D9t=t=>vg({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},t);function L9t(t,e){const n=e.config,r=bt(e.root=e.add(Zx())),i=B9t(t,n);i.forEach(c=>Jnt(c,e)),e.description=t.description||n.description,e.eventConfig=n.events,e.legends=e.objectProperty(n.legend&&n.legend.layout),e.locale=n.locale;const s=e.add(oo()),o=e.add(ert(Qnt(D9t(t.encode),NS,$O,t.style,e,{pulse:bt(s)}))),a=e.add(irt({layout:e.objectProperty(t.layout),legends:e.legends,autosize:e.signalRef("autosize"),mark:r,pulse:bt(o)}));e.operators.pop(),e.pushState(bt(o),bt(a),null),wrt(t,e,i),e.operators.push(a);let u=e.add(trt({mark:r,pulse:bt(a)}));return u=e.add(rrt({pulse:bt(u)})),u=e.add(pd({pulse:bt(u)})),e.addData("root",new Vf(e,s,s,u)),e}function nm(t,e){return e&&e.signal?{name:t,update:e.signal}:{name:t,value:e}}function B9t(t,e){const n=o=>Ns(t[o],e[o]),r=[nm("background",n("background")),nm("autosize",G4t(n("autosize"))),nm("padding",H4t(n("padding"))),nm("width",n("width")||0),nm("height",n("height")||0)],i=r.reduce((o,a)=>(o[a.name]=a,o),{}),s={};return ot(t.signals).forEach(o=>{ft(i,o.name)?o=Pt(i[o.name],o):r.push(o),s[o.name]=o}),ot(e.signals).forEach(o=>{!ft(s,o.name)&&!ft(i,o.name)&&r.push(o)}),r}function xrt(t,e){this.config=t||{},this.options=e||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function p9(t){this.config=t.config,this.options=t.options,this.legends=t.legends,this.field=Object.create(t.field),this.signals=Object.create(t.signals),this.lambdas=Object.create(t.lambdas),this.scales=Object.create(t.scales),this.events=Object.create(t.events),this.data=Object.create(t.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++t._nextsub[0],this._nextsub=t._nextsub,this._parent=t._parent.slice(),this._encode=t._encode.slice(),this._lookup=t._lookup.slice(),this._markpath=t._markpath}xrt.prototype=p9.prototype={parse(t){return wrt(t,this)},fork(){return new p9(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(t){return this.operators.push(t),t.id=this.id(),t.refs&&(t.refs.forEach(e=>{e.$ref=t.id}),t.refs=null),t},proxy(t){const e=t instanceof Pk?bt(t):t;return this.add(XLt({value:e}))},addStream(t){return this.streams.push(t),t.id=this.id(),t},addUpdate(t){return this.updates.push(t),t},finish(){let t,e;this.root&&(this.root.root=!0);for(t in this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;function n(r,i,s){let o,a;r&&(o=r.data||(r.data={}),a=o[i]||(o[i]=[]),a.push(s))}for(t in this.data){e=this.data[t],n(e.input,t,"input"),n(e.output,t,"output"),n(e.values,t,"values");for(const r in e.index)n(e.index[r],t,"index:"+r)}return this},pushState(t,e,n){this._encode.push(bt(this.add(pd({pulse:t})))),this._parent.push(e),this._lookup.push(n?bt(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return te(this._parent)},encode(){return te(this._encode)},lookup(){return te(this._lookup)},markpath(){const t=this._markpath;return++t[t.length-1]},fieldRef(t,e){if(at(t))return ey(t,e);t.signal||j("Unsupported field reference: "+J(t));const n=t.signal;let r=this.field[n];if(!r){const i={name:this.signalRef(n)};e&&(i.as=e),this.field[n]=r=bt(this.add(PLt(i)))}return r},compareRef(t){let e=!1;const n=s=>En(s)?(e=!0,this.signalRef(s.signal)):ELt(s)?(e=!0,this.exprRef(s.expr)):s,r=ot(t.field).map(n),i=ot(t.order).map(n);return e?bt(this.add(t9({fields:r,orders:i}))):J7(r,i)},keyRef(t,e){let n=!1;const r=s=>En(s)?(n=!0,bt(i[s.signal])):s,i=this.signals;return t=ot(t).map(r),n?bt(this.add(zLt({fields:t,flat:e}))):wLt(t,e)},sortRef(t){if(!t)return t;const e=IS(t.op,t.field),n=t.order||xLt;return n.signal?bt(this.add(t9({fields:e,orders:this.signalRef(n.signal)}))):J7(e,n)},event(t,e){const n=t+":"+e;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:t,type:e}),this.events[n]=r}return this.events[n]},hasOwnSignal(t){return ft(this.signals,t)},addSignal(t,e){this.hasOwnSignal(t)&&j("Duplicate signal name: "+J(t));const n=e instanceof Pk?e:this.add(Zx(e));return this.signals[t]=n},getSignal(t){return this.signals[t]||j("Unrecognized signal name: "+J(t)),this.signals[t]},signalRef(t){return this.signals[t]?bt(this.signals[t]):(ft(this.lambdas,t)||(this.lambdas[t]=this.add(Zx(null))),bt(this.lambdas[t]))},parseLambdas(){const t=Object.keys(this.lambdas);for(let e=0,n=t.length;e<n;++e){const r=t[e],i=ra(r,this),s=this.lambdas[r];s.params=i.$params,s.update=i.$expr}},property(t){return t&&t.signal?this.signalRef(t.signal):t},objectProperty(t){return!t||!st(t)?t:this.signalRef(t.signal||PO(t))},exprRef(t,e){const n={expr:ra(t,this)};return e&&(n.expr.$name=e),bt(this.add(LLt(n)))},addBinding(t,e){this.bindings||j("Nested signals do not support binding: "+J(t)),this.bindings.push(Pt({signal:t},e))},addScaleProj(t,e){ft(this.scales,t)&&j("Duplicate scale or projection name: "+J(t)),this.scales[t]=this.add(e)},addScale(t,e){this.addScaleProj(t,QLt(e))},addProjection(t,e){this.addScaleProj(t,HLt(e))},getScale(t){return this.scales[t]||j("Unrecognized scale name: "+J(t)),this.scales[t]},scaleRef(t){return bt(this.getScale(t))},scaleType(t){return this.getScale(t).params.type},projectionRef(t){return this.scaleRef(t)},projectionType(t){return this.scaleType(t)},addData(t,e){return ft(this.data,t)&&j("Duplicate data set name: "+J(t)),this.data[t]=e},getData(t){return this.data[t]||j("Undefined data set name: "+J(t)),this.data[t]},addDataPipeline(t,e){return ft(this.data,t)&&j("Duplicate data set name: "+J(t)),this.addData(t,Vf.fromEntries(this,e))}};function PO(t){return(W(t)?P9t:z9t)(t)}function P9t(t){const e=t.length;let n="[";for(let r=0;r<e;++r){const i=t[r];n+=(r>0?",":"")+(st(i)?i.signal||PO(i):J(i))}return n+"]"}function z9t(t){let e="{",n=0,r,i;for(r in t)i=t[r],e+=(++n>1?",":"")+J(r)+":"+(st(i)?i.signal||PO(i):J(i));return e+"}"}function U9t(){const t="sans-serif",r="#4c78a8",i="#000",s="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:r},area:{fill:r},image:null,line:{stroke:r,strokeWidth:2},path:{stroke:r},rect:{fill:r},rule:{stroke:i},shape:{stroke:r},symbol:{fill:r,size:64},text:{fill:i,font:t,fontSize:11},trail:{fill:r,size:2},style:{"guide-label":{fill:i,font:t,fontSize:10},"guide-title":{fill:i,font:t,fontSize:11,fontWeight:"bold"},"group-title":{fill:i,font:t,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:i,font:t,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:o},view:{fill:"transparent"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:s,grid:!1,gridWidth:1,gridColor:o,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:s,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:s,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function j9t(t,e,n){return st(t)||j("Input Vega specification must be an object."),e=fg(U9t(),e,t.config),L9t(t,new xrt(e,n)).toRuntime()}var q9t="5.31.0";Pt(gp,NCt,SNt,eOt,FOt,POt,dRt,VOt,pRt,bRt,kRt,RRt);const W9t=Object.freeze(Object.defineProperty({__proto__:null,Bounds:gn,CanvasHandler:c1,CanvasRenderer:Ux,DATE:hi,DAY:hr,DAYOFYEAR:na,Dataflow:Rh,Debug:GQ,Error:OF,EventStream:J_,Gradient:ctt,GroupItem:fS,HOURS:Di,Handler:wN,HybridHandler:tet,HybridRenderer:mk,Info:VQ,Item:lS,MILLISECONDS:Ys,MINUTES:Li,MONTH:br,Marks:Bi,MultiPulse:t6,None:WQ,Operator:$e,Parameters:Q_,Pulse:Ac,QUARTER:di,RenderType:yc,Renderer:u1,ResourceLoader:mtt,SECONDS:vs,SVGHandler:Utt,SVGRenderer:$N,SVGStringRenderer:Ztt,Scenegraph:Ntt,TIME_UNITS:GF,Transform:z,View:Pnt,WEEK:_n,Warn:RF,YEAR:Jn,accessor:yi,accessorFields:yr,accessorName:rn,array:ot,ascending:Gy,bandwidthNRD:i6,bin:eZ,bootstrapCI:nZ,boundClip:uet,boundContext:i1,boundItem:fk,boundMark:Mtt,boundStroke:Ou,changeset:fd,clampRange:rJ,codegenExpression:dnt,compare:zF,constant:Ar,cumulativeLogNormal:l6,cumulativeNormal:tS,cumulativeUniform:p6,dayofyear:gJ,debounce:UF,defaultLocale:XF,definition:JJ,densityLogNormal:c6,densityNormal:s6,densityUniform:h6,domChild:vn,domClear:Ki,domCreate:gc,domFind:vN,dotbin:rZ,error:j,expressionFunction:dn,extend:Pt,extent:ea,extentIndex:iJ,falsy:Hu,fastmap:hg,field:ys,flush:sJ,font:mS,fontFamily:a1,fontSize:ma,format:hv,formatLocale:kx,formats:JF,hasOwnProperty:ft,id:Vy,identity:Er,inferType:UJ,inferTypes:jJ,ingest:le,inherits:tt,inrange:yh,interpolate:K6,interpolateColors:uS,interpolateRange:XZ,intersect:iet,intersectBoxLine:bh,intersectPath:iN,intersectPoint:sN,intersectRule:btt,isArray:W,isBoolean:gl,isDate:Ec,isFunction:jt,isIterable:oJ,isNumber:ue,isObject:st,isRegExp:aJ,isString:at,isTuple:X_,key:jF,lerp:uJ,lineHeight:Qc,loader:Y_,locale:PJ,logger:DF,lruCache:cJ,markup:AN,merge:lJ,mergeConfig:fg,multiLineOffset:mN,one:lg,pad:fJ,panLinear:QQ,panLog:JQ,panPow:ZQ,panSymlog:tJ,parse:j9t,parseExpression:hO,parseSelector:yl,path:G2,pathCurves:eN,pathEqual:cet,pathParse:vp,pathRectangle:dtt,pathRender:Y0,pathSymbols:ftt,pathTrail:htt,peek:te,point:bS,projection:BN,quantileLogNormal:f6,quantileNormal:eS,quantileUniform:g6,quantiles:n6,quantizeInterpolator:KZ,quarter:eJ,quartiles:r6,get random(){return ws},randomInteger:LMt,randomKDE:a6,randomLCG:DMt,randomLogNormal:sZ,randomMixture:oZ,randomNormal:o6,randomUniform:aZ,read:VJ,regressionConstant:m6,regressionExp:cZ,regressionLinear:y6,regressionLoess:dZ,regressionLog:uZ,regressionPoly:fZ,regressionPow:lZ,regressionQuad:b6,renderModule:vS,repeat:Mm,resetDefaultLocale:Nkt,resetSVGClipId:gtt,resetSVGDefIds:U6t,responseType:WJ,runtimeContext:$nt,sampleCurve:rS,sampleLogNormal:u6,sampleNormal:Z_,sampleUniform:d6,scale:ce,sceneEqual:TN,sceneFromJSON:Itt,scenePickVisit:Nx,sceneToJSON:Ctt,sceneVisit:Hs,sceneZOrder:oN,scheme:Q6,serializeXML:Xtt,setHybridRendererOptions:R6t,setRandom:OMt,span:Yy,splitAccessPath:ga,stringValue:J,textMetrics:Ci,timeBin:FJ,timeFloor:_J,timeFormatLocale:W0,timeInterval:pg,timeOffset:AJ,timeSequence:kJ,timeUnitSpecifier:pJ,timeUnits:YF,toBoolean:qF,toDate:WF,toNumber:pr,toSet:Gs,toString:VF,transform:ZJ,transforms:gp,truncate:dJ,truthy:bs,tupleid:vt,typeParsers:nk,utcFloor:SJ,utcInterval:gg,utcOffset:$J,utcSequence:MJ,utcdayofyear:bJ,utcquarter:nJ,utcweek:vJ,version:q9t,visitArray:nc,week:mJ,writeConfig:dg,zero:uc,zoomLinear:LF,zoomLog:BF,zoomPow:Tx,zoomSymlog:PF},Symbol.toStringTag,{value:"Module"}));function V9t(t,e,n){let r;e.x2&&(e.x?(n&&t.x>t.x2&&(r=t.x,t.x=t.x2,t.x2=r),t.width=t.x2-t.x):t.x=t.x2-(t.width||0)),e.xc&&(t.x=t.xc-(t.width||0)/2),e.y2&&(e.y?(n&&t.y>t.y2&&(r=t.y,t.y=t.y2,t.y2=r),t.height=t.y2-t.y):t.y=t.y2-(t.height||0)),e.yc&&(t.y=t.yc-(t.height||0)/2)}var G9t={NaN:NaN,E:Math.E,LN2:Math.LN2,LN10:Math.LN10,LOG2E:Math.LOG2E,LOG10E:Math.LOG10E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2,MIN_VALUE:Number.MIN_VALUE,MAX_VALUE:Number.MAX_VALUE},Y9t={"*":(t,e)=>t*e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,">":(t,e)=>t>e,"<":(t,e)=>t<e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e,"==":(t,e)=>t==e,"!=":(t,e)=>t!=e,"===":(t,e)=>t===e,"!==":(t,e)=>t!==e,"&":(t,e)=>t&e,"|":(t,e)=>t|e,"^":(t,e)=>t^e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e},H9t={"+":t=>+t,"-":t=>-t,"~":t=>~t,"!":t=>!t};const X9t=Array.prototype.slice,Cl=(t,e,n)=>{const r=n?n(e[0]):e[0];return r[t].apply(r,X9t.call(e,1))},K9t=(t,e,n,r,i,s,o)=>new Date(t,e||0,n??1,r||0,i||0,s||0,o||0);var Q9t={isNaN:Number.isNaN,isFinite:Number.isFinite,abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,atan2:Math.atan2,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,max:Math.max,min:Math.min,pow:Math.pow,random:Math.random,round:Math.round,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan,clamp:(t,e,n)=>Math.max(e,Math.min(n,t)),now:Date.now,utc:Date.UTC,datetime:K9t,date:t=>new Date(t).getDate(),day:t=>new Date(t).getDay(),year:t=>new Date(t).getFullYear(),month:t=>new Date(t).getMonth(),hours:t=>new Date(t).getHours(),minutes:t=>new Date(t).getMinutes(),seconds:t=>new Date(t).getSeconds(),milliseconds:t=>new Date(t).getMilliseconds(),time:t=>new Date(t).getTime(),timezoneoffset:t=>new Date(t).getTimezoneOffset(),utcdate:t=>new Date(t).getUTCDate(),utcday:t=>new Date(t).getUTCDay(),utcyear:t=>new Date(t).getUTCFullYear(),utcmonth:t=>new Date(t).getUTCMonth(),utchours:t=>new Date(t).getUTCHours(),utcminutes:t=>new Date(t).getUTCMinutes(),utcseconds:t=>new Date(t).getUTCSeconds(),utcmilliseconds:t=>new Date(t).getUTCMilliseconds(),length:t=>t.length,join:function(){return Cl("join",arguments)},indexof:function(){return Cl("indexOf",arguments)},lastindexof:function(){return Cl("lastIndexOf",arguments)},slice:function(){return Cl("slice",arguments)},reverse:t=>t.slice().reverse(),parseFloat,parseInt,upper:t=>String(t).toUpperCase(),lower:t=>String(t).toLowerCase(),substring:function(){return Cl("substring",arguments,String)},split:function(){return Cl("split",arguments,String)},replace:function(){return Cl("replace",arguments,String)},trim:t=>String(t).trim(),regexp:RegExp,test:(t,e)=>RegExp(t).test(e)};const J9t=["view","item","group","xy","x","y"],Gk=new Set([Function,eval,setTimeout,setInterval]);typeof setImmediate=="function"&&Gk.add(setImmediate);const Z9t={Literal:(t,e)=>e.value,Identifier:(t,e)=>{const n=e.name;return t.memberDepth>0?n:n==="datum"?t.datum:n==="event"?t.event:n==="item"?t.item:G9t[n]||t.params["$"+n]},MemberExpression:(t,e)=>{const n=!e.computed,r=t(e.object);n&&(t.memberDepth+=1);const i=t(e.property);if(n&&(t.memberDepth-=1),Gk.has(r[i])){console.error(`Prevented interpretation of member "${i}" which could lead to insecure code execution`);return}return r[i]},CallExpression:(t,e)=>{const n=e.arguments;let r=e.callee.name;return r.startsWith("_")&&(r=r.slice(1)),r==="if"?t(n[0])?t(n[1]):t(n[2]):(t.fn[r]||Q9t[r]).apply(t.fn,n.map(t))},ArrayExpression:(t,e)=>e.elements.map(t),BinaryExpression:(t,e)=>Y9t[e.operator](t(e.left),t(e.right)),UnaryExpression:(t,e)=>H9t[e.operator](t(e.argument)),ConditionalExpression:(t,e)=>t(e.test)?t(e.consequent):t(e.alternate),LogicalExpression:(t,e)=>e.operator==="&&"?t(e.left)&&t(e.right):t(e.left)||t(e.right),ObjectExpression:(t,e)=>e.properties.reduce((n,r)=>{t.memberDepth+=1;const i=t(r.key);return t.memberDepth-=1,Gk.has(t(r.value))?console.error(`Prevented interpretation of property "${i}" which could lead to insecure code execution`):n[i]=t(r.value),n},{})};function rm(t,e,n,r,i,s){const o=a=>Z9t[a.type](o,a);return o.memberDepth=0,o.fn=Object.create(e),o.params=n,o.datum=r,o.event=i,o.item=s,J9t.forEach(a=>o.fn[a]=function(){return i.vega[a](...arguments)}),o(t)}var tBt={operator(t,e){const n=e.ast,r=t.functions;return i=>rm(n,r,i)},parameter(t,e){const n=e.ast,r=t.functions;return(i,s)=>rm(n,r,s,i)},event(t,e){const n=e.ast,r=t.functions;return i=>rm(n,r,void 0,void 0,i)},handler(t,e){const n=e.ast,r=t.functions;return(i,s)=>{const o=s.item&&s.item.datum;return rm(n,r,i,o,s)}},encode(t,e){const{marktype:n,channels:r}=e,i=t.functions,s=n==="group"||n==="image"||n==="rect";return(o,a)=>{const u=o.datum;let c=0,l;for(const f in r)l=rm(r[f].ast,i,a,u,void 0,o),o[f]!==l&&(o[f]=l,c=1);return n!=="rule"&&V9t(o,r,s),c}}};const eBt="5.23.0",nBt={version:eBt};function zO(t){return X(t,"or")}function UO(t){return X(t,"and")}function jO(t){return X(t,"not")}function Nv(t,e){if(jO(t))Nv(t.not,e);else if(UO(t))for(const n of t.and)Nv(n,e);else if(zO(t))for(const n of t.or)Nv(n,e);else e(t)}function Lh(t,e){return jO(t)?{not:Lh(t.not,e)}:UO(t)?{and:t.and.map(n=>Lh(n,e))}:zO(t)?{or:t.or.map(n=>Lh(n,e))}:e(t)}const Rt=structuredClone;function _rt(t){throw new Error(t)}function Ep(t,e){const n={};for(const r of e)ft(t,r)&&(n[r]=t[r]);return n}function oi(t,e){const n={...t};for(const r of e)delete n[r];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(t=>_e(t)).join(",")})`};function Qt(t){if(ue(t))return t;const e=at(t)?t:_e(t);if(e.length<250)return e;let n=0;for(let r=0;r<e.length;r++){const i=e.charCodeAt(r);n=(n<<5)-n+i,n=n&n}return n}function Yk(t){return t===!1||t===null}function Xt(t,e){return t.includes(e)}function Ap(t,e){let n=0;for(const[r,i]of t.entries())if(e(i,r,n++))return!0;return!1}function qO(t,e){let n=0;for(const[r,i]of t.entries())if(!e(i,r,n++))return!1;return!0}function Srt(t,...e){for(const n of e)rBt(t,n??{});return t}function rBt(t,e){for(const n of H(e))dg(t,n,e[n],!0)}function Bo(t,e){const n=[],r={};let i;for(const s of t)i=e(s),!(i in r)&&(r[i]=1,n.push(s));return n}function iBt(t,e){const n=H(t),r=H(e);if(n.length!==r.length)return!1;for(const i of n)if(t[i]!==e[i])return!1;return!0}function Ert(t,e){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}function WO(t,e){for(const n of t)if(e.has(n))return!0;return!1}function Hk(t){const e=new Set;for(const n of t){const i=ga(n).map((o,a)=>a===0?o:`[${o}]`),s=i.map((o,a)=>i.slice(0,a+1).join(""));for(const o of s)e.add(o)}return e}function VO(t,e){return t===void 0||e===void 0?!0:WO(Hk(t),Hk(e))}function xe(t){return H(t).length===0}const H=Object.keys,Zn=Object.values,el=Object.entries;function iy(t){return t===!0||t===!1}function qe(t){const e=t.replace(/\W/g,"_");return(t.match(/^\d+/)?"_":"")+e}function a0(t,e){return jO(t)?`!(${a0(t.not,e)})`:UO(t)?`(${t.and.map(n=>a0(n,e)).join(") && (")})`:zO(t)?`(${t.or.map(n=>a0(n,e)).join(") || (")})`:e(t)}function t2(t,e){if(e.length===0)return!0;const n=e.shift();return n in t&&t2(t[n],e)&&delete t[n],xe(t)}function m1(t){return t.charAt(0).toUpperCase()+t.substr(1)}function GO(t,e="datum"){const n=ga(t),r=[];for(let i=1;i<=n.length;i++){const s=`[${n.slice(0,i).map(J).join("][")}]`;r.push(`${e}${s}`)}return r.join(" && ")}function Art(t,e="datum"){return`${e}[${J(ga(t).join("."))}]`}function ye(t){return`datum['${t.replaceAll("'","\\'")}']`}function sBt(t){return t.replace(/(\[|\]|\.|'|")/g,"\\$1")}function xs(t){return`${ga(t).map(sBt).join("\\.")}`}function Gf(t,e,n){return t.replace(new RegExp(e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function _g(t){return`${ga(t).join(".")}`}function $p(t){return t?ga(t).length:0}function ln(...t){return t.find(e=>e!==void 0)}let $rt=42;function Trt(t){const e=++$rt;return t?String(t)+e:e}function oBt(){$rt=42}function krt(t){return Mrt(t)?t:`__${t}`}function Mrt(t){return t.startsWith("__")}function sy(t){if(t!==void 0)return(t%360+360)%360}function BS(t){return ue(t)?!0:!isNaN(t)&&!isNaN(parseFloat(t))}const g9=Object.getPrototypeOf(structuredClone({}));function ki(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor.name!==e.constructor.name)return!1;let n,r;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!ki(t[r],e[r]))return!1;return!0}if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const s of t.entries())if(!e.has(s[0]))return!1;for(const s of t.entries())if(!ki(s[1],e.get(s[0])))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const s of t.entries())if(!e.has(s[0]))return!1;return!0}if(ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&t.valueOf!==g9.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&t.toString!==g9.toString)return t.toString()===e.toString();const i=Object.keys(t);if(n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;for(r=n;r--!==0;){const s=i[r];if(!ki(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function _e(t){const e=[];return function n(r){if(r&&r.toJSON&&typeof r.toJSON=="function"&&(r=r.toJSON()),r===void 0)return;if(typeof r=="number")return isFinite(r)?""+r:"null";if(typeof r!="object")return JSON.stringify(r);let i,s;if(Array.isArray(r)){for(s="[",i=0;i<r.length;i++)i&&(s+=","),s+=n(r[i])||"null";return s+"]"}if(r===null)return"null";if(e.includes(r))throw new TypeError("Converting circular structure to JSON");const o=e.push(r)-1,a=Object.keys(r).sort();for(s="",i=0;i<a.length;i++){const u=a[i],c=n(r[u]);c&&(s&&(s+=","),s+=JSON.stringify(u)+":"+c)}return e.splice(o,1),`{${s}}`}(t)}function X(t,e){return st(t)&&ft(t,e)&&t[e]!==void 0}const au="row",uu="column",PS="facet",We="x",zn="y",uo="x2",va="y2",bl="xOffset",Sg="yOffset",co="radius",Du="radius2",As="theta",Lu="theta2",lo="latitude",fo="longitude",ho="latitude2",_s="longitude2",vl="time",pi="color",wa="fill",xa="stroke",gi="shape",Bu="size",md="angle",Pu="opacity",wl="fillOpacity",xl="strokeOpacity",_l="strokeWidth",Sl="strokeDash",y1="text",Tp="order",b1="detail",zS="key",Yf="tooltip",US="href",jS="url",qS="description",aBt={x:1,y:1,x2:1,y2:1},Crt={theta:1,theta2:1,radius:1,radius2:1};function Irt(t){return ft(Crt,t)}const YO={longitude:1,longitude2:1,latitude:1,latitude2:1};function Frt(t){switch(t){case lo:return"y";case ho:return"y2";case fo:return"x";case _s:return"x2"}}function Nrt(t){return ft(YO,t)}const uBt=H(YO),HO={...aBt,...Crt,...YO,xOffset:1,yOffset:1,color:1,fill:1,stroke:1,time:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1};function Bh(t){return t===pi||t===wa||t===xa}const Ort={row:1,column:1,facet:1},es=H(Ort),XO={...HO,...Ort},cBt=H(XO),{order:UHt,detail:jHt,tooltip:qHt,...lBt}=XO,{row:WHt,column:VHt,facet:GHt,...fBt}=lBt;function dBt(t){return ft(fBt,t)}function Rrt(t){return ft(XO,t)}const hBt=[uo,va,ho,_s,Lu,Du];function Drt(t){return yd(t)!==t}function yd(t){switch(t){case uo:return We;case va:return zn;case ho:return lo;case _s:return fo;case Lu:return As;case Du:return co}return t}function nl(t){if(Irt(t))switch(t){case As:return"startAngle";case Lu:return"endAngle";case co:return"outerRadius";case Du:return"innerRadius"}return t}function _a(t){switch(t){case We:return uo;case zn:return va;case lo:return ho;case fo:return _s;case As:return Lu;case co:return Du}}function mi(t){switch(t){case We:case uo:return"width";case zn:case va:return"height"}}function Lrt(t){switch(t){case We:return"xOffset";case zn:return"yOffset";case uo:return"x2Offset";case va:return"y2Offset";case As:return"thetaOffset";case co:return"radiusOffset";case Lu:return"theta2Offset";case Du:return"radius2Offset"}}function KO(t){switch(t){case We:return"xOffset";case zn:return"yOffset"}}function pBt(t){switch(t){case"xOffset":return"x";case"yOffset":return"y"}}const gBt=H(HO),{x:YHt,y:HHt,x2:XHt,y2:KHt,xOffset:QHt,yOffset:JHt,latitude:ZHt,longitude:tXt,latitude2:eXt,longitude2:nXt,theta:rXt,theta2:iXt,radius:sXt,radius2:oXt,...QO}=HO,mBt=H(QO),JO={x:1,y:1},zu=H(JO);function fn(t){return ft(JO,t)}const ZO={theta:1,radius:1},yBt=H(ZO);function WS(t){return t==="width"?We:zn}const Brt={xOffset:1,yOffset:1};function v1(t){return ft(Brt,t)}const bBt={time:1};function S$(t){return t in bBt}const{text:aXt,tooltip:uXt,href:cXt,url:lXt,description:fXt,detail:dXt,key:hXt,order:pXt,...Prt}=QO,vBt=H(Prt);function wBt(t){return ft(QO,t)}function xBt(t){switch(t){case pi:case wa:case xa:case Bu:case gi:case Pu:case _l:case Sl:return!0;case wl:case xl:case md:case vl:return!1}}const zrt={...JO,...ZO,...Brt,...Prt},tR=H(zrt);function Sa(t){return ft(zrt,t)}function _Bt(t,e){return EBt(t)[e]}const Urt={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:gXt,...SBt}=Urt;function EBt(t){switch(t){case pi:case wa:case xa:case qS:case b1:case zS:case Yf:case US:case Tp:case Pu:case wl:case xl:case _l:case PS:case au:case uu:return Urt;case We:case zn:case bl:case Sg:case lo:case fo:case vl:return SBt;case uo:case va:case ho:case _s:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case Bu:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Sl:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case gi:return{point:"always",geoshape:"always"};case y1:return{text:"always"};case md:return{point:"always",square:"always",text:"always"};case jS:return{image:"always"};case As:return{text:"always",arc:"always"};case co:return{text:"always",arc:"always"};case Lu:case Du:return{arc:"always"}}}function E$(t){switch(t){case We:case zn:case As:case co:case bl:case Sg:case Bu:case md:case _l:case Pu:case wl:case xl:case vl:case uo:case va:case Lu:case Du:return;case PS:case au:case uu:case gi:case Sl:case y1:case Yf:case US:case jS:case qS:return"discrete";case pi:case wa:case xa:return"flexible";case lo:case fo:case ho:case _s:case b1:case zS:case Tp:return}}const ABt={argmax:1,argmin:1,average:1,count:1,distinct:1,exponential:1,exponentialb:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},$Bt={count:1,min:1,max:1};function xu(t){return X(t,"argmin")}function El(t){return X(t,"argmax")}function eR(t){return at(t)&&ft(ABt,t)}const TBt=new Set(["count","valid","missing","distinct"]);function VS(t){return at(t)&&TBt.has(t)}function kBt(t){return at(t)&&Xt(["min","max"],t)}const MBt=new Set(["count","sum","distinct","valid","missing"]),CBt=new Set(["mean","average","median","q1","q3","min","max"]);function jrt(t){return gl(t)&&(t=rE(t,void 0)),"bin"+H(t).map(e=>GS(t[e])?qe(`_${e}_${el(t[e])}`):qe(`_${e}_${t[e]}`)).join("")}function Ne(t){return t===!0||bd(t)&&!t.binned}function Un(t){return t==="binned"||bd(t)&&t.binned===!0}function bd(t){return st(t)}function GS(t){return X(t,"param")}function m9(t){switch(t){case au:case uu:case Bu:case pi:case wa:case xa:case _l:case Pu:case wl:case xl:case gi:return 6;case Sl:return 4;default:return 10}}function w1(t){return X(t,"expr")}function jn(t,{level:e}={level:0}){const n=H(t||{}),r={};for(const i of n)r[i]=e===0?Ai(t[i]):jn(t[i],{level:e-1});return r}function qrt(t){const{anchor:e,frame:n,offset:r,orient:i,angle:s,limit:o,color:a,subtitleColor:u,subtitleFont:c,subtitleFontSize:l,subtitleFontStyle:f,subtitleFontWeight:d,subtitleLineHeight:h,subtitlePadding:p,...g}=t,m={...g,...a?{fill:a}:{}},y={...e?{anchor:e}:{},...n?{frame:n}:{},...r?{offset:r}:{},...i?{orient:i}:{},...s!==void 0?{angle:s}:{},...o!==void 0?{limit:o}:{}},b={...u?{subtitleColor:u}:{},...c?{subtitleFont:c}:{},...l?{subtitleFontSize:l}:{},...f?{subtitleFontStyle:f}:{},...d?{subtitleFontWeight:d}:{},...h?{subtitleLineHeight:h}:{},...p?{subtitlePadding:p}:{}},w=Ep(t,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:m,subtitleMarkConfig:w,nonMarkTitleProperties:y,subtitle:b}}function sc(t){return at(t)||W(t)&&at(t[0])}function gt(t){return X(t,"signal")}function vd(t){return X(t,"step")}function IBt(t){return W(t)?!1:X(t,"fields")&&!X(t,"data")}function FBt(t){return W(t)?!1:X(t,"fields")&&X(t,"data")}function nu(t){return W(t)?!1:X(t,"field")&&X(t,"data")}const NBt={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},OBt=H(NBt),RBt={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Xk=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function Wrt(t){const e=W(t.condition)?t.condition.map(y9):y9(t.condition);return{...Ai(t),condition:e}}function Ai(t){if(w1(t)){const{expr:e,...n}=t;return{signal:e,...n}}return t}function y9(t){if(w1(t)){const{expr:e,...n}=t;return{signal:e,...n}}return t}function Re(t){if(w1(t)){const{expr:e,...n}=t;return{signal:e,...n}}return gt(t)?t:t!==void 0?{value:t}:void 0}function DBt(t){return gt(t)?t.signal:J(t)}function b9(t){return gt(t)?t.signal:J(t.value)}function Ps(t){return gt(t)?t.signal:t==null?null:J(t)}function LBt(t,e,n){for(const r of n){const i=ia(r,e.markDef,e.config);i!==void 0&&(t[r]=Re(i))}return t}function Vrt(t){return[].concat(t.type,t.style??[])}function we(t,e,n,r={}){const{vgChannel:i,ignoreVgConfig:s}=r;return i&&X(e,i)?e[i]:e[t]!==void 0?e[t]:s&&(!i||i===t)?void 0:ia(t,e,n,r)}function ia(t,e,n,{vgChannel:r}={}){const i=Kk(t,e,n.style);return ln(r?i:void 0,i,r?n[e.type][r]:void 0,n[e.type][t],r?n.mark[r]:n.mark[t])}function Kk(t,e,n){return Grt(t,Vrt(e),n)}function Grt(t,e,n){e=ot(e);let r;for(const i of e){const s=n[i];X(s,t)&&(r=s[t])}return r}function Yrt(t,e){return ot(t).reduce((n,r)=>(n.field.push(nt(r,e)),n.order.push(r.sort??"ascending"),n),{field:[],order:[]})}function Hrt(t,e){const n=[...t];return e.forEach(r=>{for(const i of n)if(ki(i,r))return;n.push(r)}),n}function Xrt(t,e){return ki(t,e)||!e?t:t?[...ot(t),...ot(e)].join(", "):e}function Krt(t,e){const n=t.value,r=e.value;if(n==null||r===null)return{explicit:t.explicit,value:null};if((sc(n)||gt(n))&&(sc(r)||gt(r)))return{explicit:t.explicit,value:Xrt(n,r)};if(sc(n)||gt(n))return{explicit:t.explicit,value:n};if(sc(r)||gt(r))return{explicit:t.explicit,value:r};if(!sc(n)&&!gt(n)&&!sc(r)&&!gt(r))return{explicit:t.explicit,value:Hrt(n,r)};throw new Error("It should never reach here")}function nR(t){return`Invalid specification ${_e(t)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const BBt='Autosize "fit" only works for single views and layered views.';function v9(t){return`${t=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function w9(t){const e=t=="width"?"Width":"Height",n=t=="width"?"x":"y";return`${e} "container" only works well with autosize "fit" or "fit-${n}".`}function x9(t){return t?`Dropping "fit-${t}" because spec has discrete ${mi(t)}.`:'Dropping "fit" because spec has discrete size.'}function rR(t){return`Unknown field for ${t}. Cannot calculate view size.`}function _9(t){return`Cannot project a selection on encoding channel "${t}", which has no field.`}function PBt(t,e){return`Cannot project a selection on encoding channel "${t}" as it uses an aggregate function ("${e}").`}function zBt(t){return`The "nearest" transform is not supported for ${t} marks.`}function Qrt(t){return`Selection not supported for ${t} yet.`}function UBt(t){return`Cannot find a selection named "${t}".`}const jBt="Scale bindings are currently only supported for scales with unbinned, continuous domains.",qBt="Sequntial scales are deprecated. The available quantitative scale type values are linear, log, pow, sqrt, symlog, time and utc",WBt="Legend bindings are only supported for selections over an individual field or encoding channel.";function VBt(t){return`Lookups can only be performed on selection parameters. "${t}" is a variable parameter.`}function GBt(t){return`Cannot define and lookup the "${t}" selection in the same view. Try moving the lookup into a second, layered view?`}const YBt="The same selection must be used to override scale domains in a layered view.",HBt='Interval selections should be initialized using "x", "y", "longitude", or "latitude" keys.';function XBt(t){return`Unknown repeated value "${t}".`}function S9(t){return`The "columns" property cannot be used when "${t}" has nested row/column.`}const KBt="Multiple timer selections in one unit spec are not supported. Ignoring all but the first.",iR="Animation involving facet, layer, or concat is currently unsupported.";function QBt(t){return`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${J(t)}.`}function JBt(t,e,n,r){return(t.length?"Multiple ":"No ")+`matching ${J(e)} encoding found for selection ${J(n.param)}. Using "field": ${J(r)}.`}const ZBt="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function tPt(t){return`Unrecognized parse "${t}".`}function E9(t,e,n){return`An ancestor parsed field "${t}" as ${n} but a child wants to parse the field as ${e}.`}const ePt="Attempt to add the same child twice.";function nPt(t){return`Ignoring an invalid transform: ${_e(t)}.`}const rPt='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function A9(t){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${t} are dropped.`}function iPt(t){const{parentProjection:e,projection:n}=t;return`Layer's shared projection ${_e(e)} is overridden by a child projection ${_e(n)}.`}const sPt="Arc marks uses theta channel rather than angle, replacing angle with theta.";function oPt(t){return`${t}Offset dropped because ${t} is continuous`}function aPt(t,e,n){return`Channel ${t} is a ${e}. Converted to {value: ${_e(n)}}.`}function Jrt(t){return`Invalid field type "${t}".`}function uPt(t,e){return`Invalid field type "${t}" for aggregate: "${e}", using "quantitative" instead.`}function cPt(t){return`Invalid aggregation operator "${t}".`}function Zrt(t,e){const{fill:n,stroke:r}=e;return`Dropping color ${t} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function lPt(t){return`Position range does not support relative band size for ${t}.`}function Qk(t,e){return`Dropping ${_e(t)} from channel "${e}" since it does not contain any data field, datum, value, or signal.`}const fPt="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function YS(t,e,n){return`${t} dropped as it is incompatible with "${e}".`}function dPt(t){return`${t}-encoding is dropped as ${t} is not a valid encoding channel.`}function hPt(t){return`${t} encoding should be discrete (ordinal / nominal / binned).`}function pPt(t){return`${t} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function gPt(t){return`Facet encoding dropped as ${t.join(" and ")} ${t.length>1?"are":"is"} also specified.`}function A$(t,e){return`Using discrete channel "${t}" to encode "${e}" field can be misleading as it does not encode ${e==="ordinal"?"order":"magnitude"}.`}function mPt(t){return`The ${t} for range marks cannot be an expression`}function yPt(t,e){return`Line mark is for continuous lines and thus cannot be used with ${t&&e?"x2 and y2":t?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function bPt(t,e){return`Specified orient "${t}" overridden with "${e}".`}function vPt(t){return`Cannot use the scale property "${t}" with non-color channel.`}function wPt(t){return`Cannot use the relative band size with ${t} scale.`}function xPt(t){return`Using unaggregated domain with raw field has no effect (${_e(t)}).`}function _Pt(t){return`Unaggregated domain not applicable for "${t}" since it produces values outside the origin domain of the source data.`}function SPt(t){return`Unaggregated domain is currently unsupported for log scale (${_e(t)}).`}function EPt(t){return`Cannot apply size to non-oriented mark "${t}".`}function APt(t,e,n){return`Channel "${t}" does not work with "${e}" scale. We are using "${n}" scale instead.`}function $Pt(t,e){return`FieldDef does not work with "${t}" scale. We are using "${e}" scale instead.`}function tit(t,e,n){return`${n}-scale's "${e}" is dropped as it does not work with ${t} scale.`}function eit(t){return`The step for "${t}" is dropped because the ${t==="width"?"x":"y"} is continuous.`}function TPt(t,e,n,r){return`Conflicting ${e.toString()} property "${t.toString()}" (${_e(n)} and ${_e(r)}). Using ${_e(n)}.`}function kPt(t,e,n,r){return`Conflicting ${e.toString()} property "${t.toString()}" (${_e(n)} and ${_e(r)}). Using the union of the two domains.`}function MPt(t){return`Setting the scale to be independent for "${t}" means we also have to set the guide (axis or legend) to be independent.`}function CPt(t){return`Dropping sort property ${_e(t)} as unioned domains only support boolean or op "count", "min", and "max".`}const $9="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",IPt="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",FPt="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",NPt="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function OPt(t){return`Cannot stack "${t}" if there is already "${t}2".`}function RPt(t){return`Stack is applied to a non-linear scale (${t}).`}function DPt(t){return`Stacking is applied even though the aggregate function is non-summative ("${t}").`}function e2(t,e){return`Invalid ${t}: ${_e(e)}.`}function LPt(t){return`Dropping day from datetime ${_e(t)} as day cannot be combined with other units.`}function BPt(t,e){return`${e?"extent ":""}${e&&t?"and ":""}${t?"center ":""}${e&&t?"are ":"is "}not needed when data are aggregated.`}function PPt(t,e,n){return`${t} is not usually used with ${e} for ${n}.`}function zPt(t,e){return`Continuous axis should not have customized aggregation function ${t}; ${e} already agregates the axis.`}function T9(t){return`1D error band does not support ${t}.`}function nit(t){return`Channel ${t} is required for "binned" bin.`}function UPt(t){return`Channel ${t} should not be used with "binned" bin.`}function jPt(t){return`Domain for ${t} is required for threshold scale.`}const rit=DF(RF);let Hf=rit;function qPt(t){return Hf=t,Hf}function WPt(){return Hf=rit,Hf}function sR(...t){Hf.error(...t)}function K(...t){Hf.warn(...t)}function VPt(...t){Hf.debug(...t)}function wd(t){if(t&&st(t)){for(const e of aR)if(X(t,e))return!0}return!1}const iit=["january","february","march","april","may","june","july","august","september","october","november","december"],GPt=iit.map(t=>t.substr(0,3)),sit=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],YPt=sit.map(t=>t.substr(0,3));function HPt(t){if(BS(t)&&(t=+t),ue(t))return t>4&&K(e2("quarter",t)),t-1;throw new Error(e2("quarter",t))}function XPt(t){if(BS(t)&&(t=+t),ue(t))return t-1;{const e=t.toLowerCase(),n=iit.indexOf(e);if(n!==-1)return n;const r=e.substr(0,3),i=GPt.indexOf(r);if(i!==-1)return i;throw new Error(e2("month",t))}}function KPt(t){if(BS(t)&&(t=+t),ue(t))return t%7;{const e=t.toLowerCase(),n=sit.indexOf(e);if(n!==-1)return n;const r=e.substr(0,3),i=YPt.indexOf(r);if(i!==-1)return i;throw new Error(e2("day",t))}}function oR(t,e){const n=[];if(e&&t.day!==void 0&&H(t).length>1&&(K(LPt(t)),t=Rt(t),delete t.day),t.year!==void 0?n.push(t.year):n.push(2012),t.month!==void 0){const r=e?XPt(t.month):t.month;n.push(r)}else if(t.quarter!==void 0){const r=e?HPt(t.quarter):t.quarter;n.push(ue(r)?r*3:`${r}*3`)}else n.push(0);if(t.date!==void 0)n.push(t.date);else if(t.day!==void 0){const r=e?KPt(t.day):t.day;n.push(ue(r)?r+1:`${r}+1`)}else n.push(1);for(const r of["hours","minutes","seconds","milliseconds"]){const i=t[r];n.push(typeof i>"u"?0:i)}return n}function Xf(t){const n=oR(t,!0).join(", ");return t.utc?`utc(${n})`:`datetime(${n})`}function QPt(t){const n=oR(t,!1).join(", ");return t.utc?`utc(${n})`:`datetime(${n})`}function JPt(t){const e=oR(t,!0);return t.utc?+new Date(Date.UTC(...e)):+new Date(...e)}const oit={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},aR=H(oit);function ZPt(t){return ft(oit,t)}function xd(t){return st(t)?t.binned:ait(t)}function ait(t){return t&&t.startsWith("binned")}function uR(t){return t.startsWith("utc")}function tzt(t){return t.substring(3)}const ezt={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function HS(t){return aR.filter(e=>cit(t,e))}function uit(t){const e=HS(t);return e[e.length-1]}function cit(t,e){const n=t.indexOf(e);return!(n<0||n>0&&e==="seconds"&&t.charAt(n-1)==="i"||t.length>n+3&&e==="day"&&t.charAt(n+3)==="o"||n>0&&e==="year"&&t.charAt(n-1)==="f")}function nzt(t,e,{end:n}={end:!1}){const r=GO(e),i=uR(t)?"utc":"";function s(u){return u==="quarter"?`(${i}quarter(${r})-1)`:`${i}${u}(${r})`}let o;const a={};for(const u of aR)cit(t,u)&&(a[u]=s(u),o=u);return n&&(a[o]+="+1"),QPt(a)}function lit(t){if(!t)return;const e=HS(t);return`timeUnitSpecifier(${_e(e)}, ${_e(ezt)})`}function rzt(t,e,n){if(!t)return;const r=lit(t);return`${n||uR(t)?"utc":"time"}Format(${e}, ${r})`}function Dn(t){if(!t)return;let e;return at(t)?ait(t)?e={unit:t.substring(6),binned:!0}:e={unit:t}:st(t)&&(e={...t,...t.unit?{unit:t.unit}:{}}),uR(e.unit)&&(e.utc=!0,e.unit=tzt(e.unit)),e}function izt(t){const{utc:e,...n}=Dn(t);return n.unit?(e?"utc":"")+H(n).map(r=>qe(`${r==="unit"?"":`_${r}_`}${n[r]}`)).join(""):(e?"utc":"")+"timeunit"+H(n).map(r=>qe(`_${r}_${n[r]}`)).join("")}function fit(t,e=n=>n){const n=Dn(t),r=uit(n.unit);if(r&&r!=="day"){const i={year:2001,month:1,date:1,hours:0,minutes:0,seconds:0,milliseconds:0},{step:s,part:o}=dit(r,n.step),a={...i,[o]:+i[o]+s};return`${e(Xf(a))} - ${e(Xf(i))}`}}const szt={year:1,month:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};function ozt(t){return ft(szt,t)}function dit(t,e=1){if(ozt(t))return{part:t,step:e};switch(t){case"day":case"dayofyear":return{part:"date",step:e};case"quarter":return{part:"month",step:e*3};case"week":return{part:"date",step:e*7}}}function azt(t){return X(t,"param")}function cR(t){return!!(t!=null&&t.field)&&t.equal!==void 0}function lR(t){return!!(t!=null&&t.field)&&t.lt!==void 0}function fR(t){return!!(t!=null&&t.field)&&t.lte!==void 0}function dR(t){return!!(t!=null&&t.field)&&t.gt!==void 0}function hR(t){return!!(t!=null&&t.field)&&t.gte!==void 0}function pR(t){if(t!=null&&t.field){if(W(t.range)&&t.range.length===2)return!0;if(gt(t.range))return!0}return!1}function gR(t){return!!(t!=null&&t.field)&&(W(t.oneOf)||W(t.in))}function uzt(t){return!!(t!=null&&t.field)&&t.valid!==void 0}function hit(t){return gR(t)||cR(t)||pR(t)||lR(t)||dR(t)||fR(t)||hR(t)}function bo(t,e){return iE(t,{timeUnit:e,wrapTime:!0})}function czt(t,e){return t.map(n=>bo(n,e))}function pit(t,e=!0){const{field:n}=t,r=Dn(t.timeUnit),{unit:i,binned:s}=r||{},o=nt(t,{expr:"datum"}),a=i?`time(${s?o:nzt(i,n)})`:o;if(cR(t))return`${a}===${bo(t.equal,i)}`;if(lR(t)){const u=t.lt;return`${a}<${bo(u,i)}`}else if(dR(t)){const u=t.gt;return`${a}>${bo(u,i)}`}else if(fR(t)){const u=t.lte;return`${a}<=${bo(u,i)}`}else if(hR(t)){const u=t.gte;return`${a}>=${bo(u,i)}`}else{if(gR(t))return`indexof([${czt(t.oneOf,i).join(",")}], ${a}) !== -1`;if(uzt(t))return XS(a,t.valid);if(pR(t)){const{range:u}=jn(t),c=gt(u)?{signal:`${u.signal}[0]`}:u[0],l=gt(u)?{signal:`${u.signal}[1]`}:u[1];if(c!==null&&l!==null&&e)return"inrange("+a+", ["+bo(c,i)+", "+bo(l,i)+"])";const f=[];return c!==null&&f.push(`${a} >= ${bo(c,i)}`),l!==null&&f.push(`${a} <= ${bo(l,i)}`),f.length>0?f.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${_e(t)}`)}function XS(t,e=!0){return e?`isValid(${t}) && isFinite(+${t})`:`!isValid(${t}) || !isFinite(+${t})`}function lzt(t){return hit(t)&&t.timeUnit?{...t,timeUnit:Dn(t.timeUnit)}:t}const x1={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function fzt(t){return t==="quantitative"||t==="temporal"}function git(t){return t==="ordinal"||t==="nominal"}const Kf=x1.quantitative,mR=x1.ordinal,kp=x1.temporal,yR=x1.nominal,Eg=x1.geojson;function dzt(t){if(t)switch(t=t.toLowerCase(),t){case"q":case Kf:return"quantitative";case"t":case kp:return"temporal";case"o":case mR:return"ordinal";case"n":case yR:return"nominal";case Eg:return"geojson"}}const Wn={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",TIME:"time",UTC:"utc",POINT:"point",BAND:"band"},Jk={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function hzt(t,e){const n=Jk[t],r=Jk[e];return n===r||n==="ordinal-position"&&r==="time"||r==="ordinal-position"&&n==="time"}const pzt={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function k9(t){return pzt[t]}const mit=new Set(["linear","log","pow","sqrt","symlog"]),yit=new Set([...mit,"time","utc"]);function bit(t){return mit.has(t)}const vit=new Set(["quantile","quantize","threshold"]),gzt=new Set([...yit,...vit,"sequential","identity"]),mzt=new Set(["ordinal","bin-ordinal","point","band"]);function Bn(t){return mzt.has(t)}function Xs(t){return gzt.has(t)}function Po(t){return yit.has(t)}function Mp(t){return vit.has(t)}const yzt={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,tickBandPaddingInner:.25,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:4,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4,zero:!0,framesPerSecond:2,animationDuration:5};function bzt(t){return!at(t)&&X(t,"name")}function wit(t){return X(t,"param")}function vzt(t){return X(t,"unionWith")}function wzt(t){return st(t)&&"field"in t}const xzt={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,domainRaw:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:mXt,domain:yXt,range:bXt,rangeMax:vXt,rangeMin:wXt,scheme:xXt,..._zt}=xzt,Szt=H(_zt);function Zk(t,e){switch(e){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(t);case"bins":return!["point","band","identity","ordinal"].includes(t);case"round":return Po(t)||t==="band"||t==="point";case"padding":case"rangeMin":case"rangeMax":return Po(t)||["point","band"].includes(t);case"paddingOuter":case"align":return["point","band"].includes(t);case"paddingInner":return t==="band";case"domainMax":case"domainMid":case"domainMin":case"domainRaw":case"clamp":return Po(t);case"nice":return Po(t)||t==="quantize"||t==="threshold";case"exponent":return t==="pow";case"base":return t==="log";case"constant":return t==="symlog";case"zero":return Xs(t)&&!Xt(["log","time","utc","threshold","quantile"],t)}}function xit(t,e){switch(e){case"interpolate":case"scheme":case"domainMid":return Bh(t)?void 0:vPt(e);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"domainRaw":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function Ezt(t,e){return Xt([mR,yR],e)?t===void 0||Bn(t):e===kp?Xt([Wn.TIME,Wn.UTC,void 0],t):e===Kf?bit(t)||Mp(t)||t===void 0:!0}function Azt(t,e,n=!1){if(!Sa(t))return!1;switch(t){case We:case zn:case bl:case Sg:case As:case co:return Po(e)||e==="band"?!0:e==="point"?!n:!1;case vl:return Xt(["linear","band"],e);case Bu:case _l:case Pu:case wl:case xl:case md:return Po(e)||Mp(e)||Xt(["band","point","ordinal"],e);case pi:case wa:case xa:return e!=="band";case Sl:case gi:return e==="ordinal"||Mp(e)}}function $zt(t){return st(t)&&"value"in t}const Xr={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},_it=Xr.arc,KS=Xr.area,QS=Xr.bar,Tzt=Xr.image,JS=Xr.line,ZS=Xr.point,kzt=Xr.rect,n2=Xr.rule,Sit=Xr.text,bR=Xr.tick,Mzt=Xr.trail,vR=Xr.circle,wR=Xr.square,Eit=Xr.geoshape;function Al(t){return["line","area","trail"].includes(t)}function oy(t){return["rect","bar","image","arc","tick"].includes(t)}const Czt=new Set(H(Xr));function sa(t){return X(t,"type")}const Izt=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],Fzt=["fill","fillOpacity"],Nzt=[...Izt,...Fzt],Ozt={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},M9=H(Ozt),$$=["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],Rzt={area:["line","point"],bar:$$,rect:$$,line:["point"],tick:["bandSize","thickness",...$$]},Dzt={color:"#4c78a8",invalid:"break-paths-show-path-domains",timeUnitBandSize:1},Lzt={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},Ait=H(Lzt);function Qf(t){return X(t,"band")}const Bzt={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},Pzt=5,xR={binSpacing:0,continuousBandSize:Pzt,minBandSize:.25,timeUnitBandPosition:.5},zzt={...xR,binSpacing:1},Uzt={...xR,thickness:1};function jzt(t){return sa(t)?t.type:t}function $it(t,{isPath:e}){return t===void 0||t==="break-paths-show-path-domains"?e?"break-paths-show-domains":"filter":t===null?"show":t}function _R({markDef:t,config:e,scaleChannel:n,scaleType:r,isCountAggregate:i}){var a,u;if(!r||!Xs(r)||i)return"always-valid";const s=$it(we("invalid",t,e),{isPath:Al(t.type)});return((u=(a=e.scale)==null?void 0:a.invalid)==null?void 0:u[n])!==void 0?"show":s}function qzt(t){return t==="break-paths-filter-domains"||t==="break-paths-show-domains"}function Tit({scaleName:t,scale:e,mode:n}){const r=`domain('${t}')`;if(!e||!t)return;const i=`${r}[0]`,s=`peek(${r})`,o=e.domainHasZero();return o==="definitely"?{scale:t,value:0}:o==="maybe"?{signal:`scale('${t}', inrange(0, ${r}) ? 0 : ${n==="zeroOrMin"?i:s})`}:{signal:`scale('${t}', ${n==="zeroOrMin"?i:s})`}}function kit({scaleChannel:t,channelDef:e,scale:n,scaleName:r,markDef:i,config:s}){var l;const o=n==null?void 0:n.get("type"),a=Qs(e),u=VS(a==null?void 0:a.aggregate),c=_R({scaleChannel:t,markDef:i,config:s,scaleType:o,isCountAggregate:u});if(a&&c==="show"){const f=((l=s.scale.invalid)==null?void 0:l[t])??"zero-or-min";return{test:XS(nt(a,{expr:"datum"}),!1),...Wzt(f,n,r)}}}function Wzt(t,e,n){if($zt(t)){const{value:r}=t;return gt(r)?{signal:r.signal}:{value:r}}return Tit({scale:e,scaleName:n,mode:"zeroOrMin"})}function SR(t){const{channel:e,channelDef:n,markDef:r,scale:i,scaleName:s,config:o}=t,a=yd(e),u=ER(t),c=kit({scaleChannel:a,channelDef:n,scale:i,scaleName:s,markDef:r,config:o});return c!==void 0?[c,u]:u}function Vzt(t){const{datum:e}=t;return wd(e)?Xf(e):`${_e(e)}`}function vf(t,e,n,r){const i={};if(e&&(i.scale=e),Ea(t)){const{datum:s}=t;wd(s)?i.signal=Xf(s):gt(s)?i.signal=s.signal:w1(s)?i.signal=s.expr:i.value=s}else i.field=nt(t,n);if(r){const{offset:s,band:o}=r;s&&(i.offset=s),o&&(i.band=o)}return i}function r2({scaleName:t,fieldOrDatumDef:e,fieldOrDatumDef2:n,offset:r,startSuffix:i,endSuffix:s="end",bandPosition:o=.5}){const a=!gt(o)&&0<o&&o<1?"datum":void 0,u=nt(e,{expr:a,suffix:i}),c=n!==void 0?nt(n,{expr:a}):nt(e,{suffix:s,expr:a}),l={};if(o===0||o===1){l.scale=t;const f=o===0?u:c;l.field=f}else{const f=gt(o)?`(1-${o.signal}) * ${u} + ${o.signal} * ${c}`:`${1-o} * ${u} + ${o} * ${c}`;l.signal=`scale("${t}", ${f})`}return r&&(l.offset=r),l}function Gzt({scaleName:t,fieldDef:e}){const n=nt(e,{expr:"datum"}),r=nt(e,{expr:"datum",suffix:"end"});return`abs(scale("${t}", ${r}) - scale("${t}", ${n}))`}function ER({channel:t,channelDef:e,channel2Def:n,markDef:r,config:i,scaleName:s,scale:o,stack:a,offset:u,defaultRef:c,bandPosition:l}){if(e){if(Bt(e)){const f=o==null?void 0:o.get("type");if(Gr(e)){l??(l=rl({fieldDef:e,fieldDef2:n,markDef:r,config:i}));const{bin:d,timeUnit:h,type:p}=e;if(Ne(d)||l&&h&&p===kp)return a!=null&&a.impute?vf(e,s,{binSuffix:"mid"},{offset:u}):l&&!Bn(f)?r2({scaleName:s,fieldOrDatumDef:e,bandPosition:l,offset:u}):vf(e,s,$1(e,t)?{binSuffix:"range"}:{},{offset:u});if(Un(d)){if(Q(n))return r2({scaleName:s,fieldOrDatumDef:e,fieldOrDatumDef2:n,bandPosition:l,offset:u});K(nit(t===We?uo:va))}}return vf(e,s,Bn(f)?{binSuffix:"range"}:{},{offset:u,band:f==="band"?l??e.bandPosition??.5:void 0})}else if(Ks(e)){const f=e.value,d=u?{offset:u}:{};return{...u0(t,f),...d}}}return jt(c)&&(c=c()),c&&{...c,...u?{offset:u}:{}}}function u0(t,e){return Xt(["x","x2"],t)&&e==="width"?{field:{group:"width"}}:Xt(["y","y2"],t)&&e==="height"?{field:{group:"height"}}:Re(e)}function Jf(t){return t&&t!=="number"&&t!=="time"}function Mit(t,e,n){return`${t}(${e}${n?`, ${_e(n)}`:""})`}const Yzt="  ";function AR({fieldOrDatumDef:t,format:e,formatType:n,expr:r,normalizeStack:i,config:s}){var u,c;if(Jf(n))return zs({fieldOrDatumDef:t,format:e,formatType:n,expr:r,config:s});const o=Cit(t,r,i),a=Cp(t);if(e===void 0&&n===void 0&&s.customFormatTypes){if(a==="quantitative"){if(i&&s.normalizedNumberFormatType)return zs({fieldOrDatumDef:t,format:s.normalizedNumberFormat,formatType:s.normalizedNumberFormatType,expr:r,config:s});if(s.numberFormatType)return zs({fieldOrDatumDef:t,format:s.numberFormat,formatType:s.numberFormatType,expr:r,config:s})}if(a==="temporal"&&s.timeFormatType&&Q(t)&&t.timeUnit===void 0)return zs({fieldOrDatumDef:t,format:s.timeFormat,formatType:s.timeFormatType,expr:r,config:s})}if(Fp(t)){const l=Xzt({field:o,timeUnit:Q(t)?(u=Dn(t.timeUnit))==null?void 0:u.unit:void 0,format:e,formatType:s.timeFormatType,rawTimeFormat:s.timeFormat,isUTCScale:_d(t)&&((c=t.scale)==null?void 0:c.type)===Wn.UTC});return l?{signal:l}:void 0}if(e=tM({type:a,specifiedFormat:e,config:s,normalizeStack:i}),Q(t)&&Ne(t.bin)){const l=nt(t,{expr:r,binSuffix:"end"});return{signal:_1(o,l,e,n,s)}}else return e||Cp(t)==="quantitative"?{signal:`${Nit(o,e)}`}:{signal:`isValid(${o}) ? ${o} : ""+${o}`}}function Cit(t,e,n){return Q(t)?n?`${nt(t,{expr:e,suffix:"end"})}-${nt(t,{expr:e,suffix:"start"})}`:nt(t,{expr:e}):Vzt(t)}function zs({fieldOrDatumDef:t,format:e,formatType:n,expr:r,normalizeStack:i,config:s,field:o}){if(o??(o=Cit(t,r,i)),o!=="datum.value"&&Q(t)&&Ne(t.bin)){const a=nt(t,{expr:r,binSuffix:"end"});return{signal:_1(o,a,e,n,s)}}return{signal:Mit(n,o,e)}}function Iit(t,e,n,r,i,s){var o;if(!(at(r)&&Jf(r))&&!(n===void 0&&r===void 0&&i.customFormatTypes&&Cp(t)==="quantitative"&&(i.normalizedNumberFormatType&&Ip(t)&&t.stack==="normalize"||i.numberFormatType))){if(Ip(t)&&t.stack==="normalize"&&i.normalizedNumberFormat)return tM({type:"quantitative",config:i,normalizeStack:!0});if(Fp(t)){const a=Q(t)?(o=Dn(t.timeUnit))==null?void 0:o.unit:void 0;return a===void 0&&i.customFormatTypes&&i.timeFormatType?void 0:Hzt({specifiedFormat:n,timeUnit:a,config:i,omitTimeFormatConfig:s})}return tM({type:e,specifiedFormat:n,config:i})}}function Fit(t,e,n){var r;if(t&&(gt(t)||t==="number"||t==="time"))return t;if(Fp(e)&&n!=="time"&&n!=="utc")return Q(e)&&((r=Dn(e==null?void 0:e.timeUnit))!=null&&r.utc)?"utc":"time"}function tM({type:t,specifiedFormat:e,config:n,normalizeStack:r}){if(at(e))return e;if(t===Kf)return r?n.normalizedNumberFormat:n.numberFormat}function Hzt({specifiedFormat:t,timeUnit:e,config:n,omitTimeFormatConfig:r}){return t||(e?{signal:lit(e)}:r?void 0:n.timeFormat)}function Nit(t,e){return`format(${t}, "${e||""}")`}function C9(t,e,n,r){return Jf(n)?Mit(n,t,e):Nit(t,(at(e)?e:void 0)??r.numberFormat)}function _1(t,e,n,r,i){if(n===void 0&&r===void 0&&i.customFormatTypes&&i.numberFormatType)return _1(t,e,i.numberFormat,i.numberFormatType,i);const s=C9(t,n,r,i),o=C9(e,n,r,i);return`${XS(t,!1)} ? "null" : ${s} + "${Yzt}" + ${o}`}function Xzt({field:t,timeUnit:e,format:n,formatType:r,rawTimeFormat:i,isUTCScale:s}){return!e||n?!e&&r?`${r}(${t}, '${n}')`:(n=at(n)?n:i,`${s?"utc":"time"}Format(${t}, '${n}')`):rzt(e,t,s)}const tE="min",Kzt={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function I9(t){return ft(Kzt,t)}function Qzt(t){return X(t,"encoding")}function cu(t){return t&&(t.op==="count"||X(t,"field"))}function Oit(t){return t&&W(t)}function S1(t){return X(t,"row")||X(t,"column")}function $R(t){return X(t,"header")}function eE(t){return X(t,"facet")}function Jzt(t){return X(t,"param")}function Zzt(t){return!at(t)&&X(t,"repeat")}function F9(t){const{field:e,timeUnit:n,bin:r,aggregate:i}=t;return{...n?{timeUnit:n}:{},...r?{bin:r}:{},...i?{aggregate:i}:{},field:e}}function TR(t){return X(t,"sort")}function rl({fieldDef:t,fieldDef2:e,markDef:n,config:r}){if(Bt(t)&&t.bandPosition!==void 0)return t.bandPosition;if(Q(t)){const{timeUnit:i,bin:s}=t;if(i&&!e)return ia("timeUnitBandPosition",n,r);if(Ne(s))return .5}}function Rit({channel:t,fieldDef:e,fieldDef2:n,markDef:r,config:i,scaleType:s,useVlSizeChannel:o}){var c,l,f;const a=mi(t),u=we(o?"size":a,r,i,{vgChannel:a});if(u!==void 0)return u;if(Q(e)){const{timeUnit:d,bin:h}=e;if(d&&!n)return{band:ia("timeUnitBandSize",r,i)};if(Ne(h)&&!Bn(s))return{band:1}}if(oy(r.type))return s?Bn(s)?((c=i[r.type])==null?void 0:c.discreteBandSize)||{band:1}:(l=i[r.type])==null?void 0:l.continuousBandSize:(f=i[r.type])==null?void 0:f.discreteBandSize}function Dit(t,e,n,r){return Ne(t.bin)||t.timeUnit&&Gr(t)&&t.type==="temporal"?rl({fieldDef:t,fieldDef2:e,markDef:n,config:r})!==void 0:!1}function Lit(t){return X(t,"sort")&&!X(t,"field")}function E1(t){return X(t,"condition")}function nE(t){const e=t==null?void 0:t.condition;return!!e&&!W(e)&&Q(e)}function A1(t){const e=t==null?void 0:t.condition;return!!e&&!W(e)&&Bt(e)}function tUt(t){const e=t==null?void 0:t.condition;return!!e&&(W(e)||Ks(e))}function Q(t){return X(t,"field")||(t==null?void 0:t.aggregate)==="count"}function Cp(t){return t==null?void 0:t.type}function Ea(t){return X(t,"datum")}function xc(t){return Gr(t)&&!s2(t)||i2(t)}function N9(t){return Gr(t)&&t.type==="quantitative"&&!t.bin||i2(t)}function i2(t){return Ea(t)&&ue(t.datum)}function Bt(t){return Q(t)||Ea(t)}function Gr(t){return t&&(X(t,"field")||t.aggregate==="count")&&X(t,"type")}function Ks(t){return X(t,"value")}function _d(t){return X(t,"scale")||X(t,"sort")}function Ip(t){return X(t,"axis")||X(t,"stack")||X(t,"impute")}function Bit(t){return X(t,"legend")}function Pit(t){return X(t,"format")||X(t,"formatType")}function eUt(t){return oi(t,["legend","axis","header","scale"])}function nUt(t){return X(t,"op")}function nt(t,e={}){let n=t.field;const r=e.prefix;let i=e.suffix,s="";if(iUt(t))n=krt("count");else{let o;if(!e.nofn)if(nUt(t))o=t.op;else{const{bin:a,aggregate:u,timeUnit:c}=t;Ne(a)?(o=jrt(a),i=(e.binSuffix??"")+(e.suffix??"")):u?El(u)?(s=`["${n}"]`,n=`argmax_${u.argmax}`):xu(u)?(s=`["${n}"]`,n=`argmin_${u.argmin}`):o=String(u):c&&!xd(c)&&(o=izt(c),i=(!["range","mid"].includes(e.binSuffix)&&e.binSuffix||"")+(e.suffix??""))}o&&(n=n?`${o}_${n}`:o)}return i&&(n=`${n}_${i}`),r&&(n=`${r}_${n}`),e.forAs?_g(n):e.expr?Art(n,e.expr)+s:xs(n)+s}function s2(t){switch(t.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return Q(t)&&!!t.bin;case"temporal":return!1}throw new Error(Jrt(t.type))}function rUt(t){var e;return _d(t)&&Mp((e=t.scale)==null?void 0:e.type)}function iUt(t){return t.aggregate==="count"}function sUt(t,e){var o;const{field:n,bin:r,timeUnit:i,aggregate:s}=t;if(s==="count")return e.countTitle;if(Ne(r))return`${n} (binned)`;if(i&&!xd(i)){const a=(o=Dn(i))==null?void 0:o.unit;if(a)return`${n} (${HS(a).join("-")})`}else if(s)return El(s)?`${n} for max ${s.argmax}`:xu(s)?`${n} for min ${s.argmin}`:`${m1(s)} of ${n}`;return n}function oUt(t){const{aggregate:e,bin:n,timeUnit:r,field:i}=t;if(El(e))return`${i} for argmax(${e.argmax})`;if(xu(e))return`${i} for argmin(${e.argmin})`;const s=r&&!xd(r)?Dn(r):void 0,o=e||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||Ne(n)&&"bin";return o?`${o.toUpperCase()}(${i})`:i}const zit=(t,e)=>{switch(e.fieldTitle){case"plain":return t.field;case"functional":return oUt(t);default:return sUt(t,e)}};let Uit=zit;function jit(t){Uit=t}function aUt(){jit(zit)}function Ph(t,e,{allowDisabling:n,includeDefault:r=!0}){var a;const i=(a=kR(t))==null?void 0:a.title;if(!Q(t))return i??t.title;const s=t,o=r?MR(s,e):void 0;return n?ln(i,s.title,o):i??s.title??o}function kR(t){if(Ip(t)&&t.axis)return t.axis;if(Bit(t)&&t.legend)return t.legend;if($R(t)&&t.header)return t.header}function MR(t,e){return Uit(t,e)}function o2(t){if(Pit(t)){const{format:e,formatType:n}=t;return{format:e,formatType:n}}else{const e=kR(t)??{},{format:n,formatType:r}=e;return{format:n,formatType:r}}}function uUt(t,e){var s;switch(e){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(TR(t)&&W(t.sort))return"ordinal";const{aggregate:n,bin:r,timeUnit:i}=t;if(i)return"temporal";if(r||n&&!El(n)&&!xu(n))return"quantitative";if(_d(t)&&((s=t.scale)!=null&&s.type))switch(Jk[t.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function Qs(t){if(Q(t))return t;if(nE(t))return t.condition}function Sn(t){if(Bt(t))return t;if(A1(t))return t.condition}function qit(t,e,n,r={}){if(at(t)||ue(t)||gl(t)){const i=at(t)?"string":ue(t)?"number":"boolean";return K(aPt(e,i,t)),{value:t}}return Bt(t)?a2(t,e,n,r):A1(t)?{...t,condition:a2(t.condition,e,n,r)}:t}function a2(t,e,n,r){if(Pit(t)){const{format:i,formatType:s,...o}=t;if(Jf(s)&&!n.customFormatTypes)return K(A9(e)),a2(o,e,n,r)}else{const i=Ip(t)?"axis":Bit(t)?"legend":$R(t)?"header":null;if(i&&t[i]){const{format:s,formatType:o,...a}=t[i];if(Jf(o)&&!n.customFormatTypes)return K(A9(e)),a2({...t,[i]:a},e,n,r)}}return Q(t)?CR(t,e,r):cUt(t)}function cUt(t){let e=t.type;if(e)return t;const{datum:n}=t;return e=ue(n)?"quantitative":at(n)?"nominal":wd(n)?"temporal":void 0,{...t,type:e}}function CR(t,e,{compositeMark:n=!1}={}){const{aggregate:r,timeUnit:i,bin:s,field:o}=t,a={...t};if(!n&&r&&!eR(r)&&!El(r)&&!xu(r)&&(K(cPt(r)),delete a.aggregate),i&&(a.timeUnit=Dn(i)),o&&(a.field=`${o}`),Ne(s)&&(a.bin=rE(s,e)),Un(s)&&!fn(e)&&K(UPt(e)),Gr(a)){const{type:u}=a,c=dzt(u);u!==c&&(a.type=c),u!=="quantitative"&&VS(r)&&(K(uPt(u,r)),a.type="quantitative")}else if(!Drt(e)){const u=uUt(a,e);a.type=u}if(Gr(a)){const{compatible:u,warning:c}=lUt(a,e)||{};u===!1&&K(c)}if(TR(a)&&at(a.sort)){const{sort:u}=a;if(I9(u))return{...a,sort:{encoding:u}};const c=u.substring(1);if(u.charAt(0)==="-"&&I9(c))return{...a,sort:{encoding:c,order:"descending"}}}if($R(a)){const{header:u}=a;if(u){const{orient:c,...l}=u;if(c)return{...a,header:{...l,labelOrient:u.labelOrient||c,titleOrient:u.titleOrient||c}}}}return a}function rE(t,e){return gl(t)?{maxbins:m9(e)}:t==="binned"?{binned:!0}:!t.maxbins&&!t.step?{...t,maxbins:m9(e)}:t}const Gd={compatible:!0};function lUt(t,e){const n=t.type;if(n==="geojson"&&e!=="shape")return{compatible:!1,warning:`Channel ${e} should not be used with a geojson data.`};switch(e){case au:case uu:case PS:return s2(t)?Gd:{compatible:!1,warning:hPt(e)};case We:case zn:case bl:case Sg:case pi:case wa:case xa:case y1:case b1:case zS:case Yf:case US:case jS:case md:case As:case co:case qS:return Gd;case fo:case _s:case lo:case ho:return n!==Kf?{compatible:!1,warning:`Channel ${e} should be used with a quantitative field only, not ${t.type} field.`}:Gd;case Pu:case wl:case xl:case _l:case Bu:case Lu:case Du:case uo:case va:case vl:return n==="nominal"&&!t.sort?{compatible:!1,warning:`Channel ${e} should not be used with an unsorted discrete field.`}:Gd;case gi:case Sl:return!s2(t)&&!rUt(t)?{compatible:!1,warning:pPt(e)}:Gd;case Tp:return t.type==="nominal"&&!("sort"in t)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:Gd}}function Fp(t){const{formatType:e}=o2(t);return e==="time"||!e&&fUt(t)}function fUt(t){return t&&(t.type==="temporal"||Q(t)&&!!t.timeUnit)}function iE(t,{timeUnit:e,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var u;const s=e&&((u=Dn(e))==null?void 0:u.unit);let o=s||n==="temporal",a;return w1(t)?a=t.expr:gt(t)?a=t.signal:wd(t)?(o=!0,a=Xf(t)):(at(t)||ue(t))&&o&&(a=`datetime(${_e(t)})`,ZPt(s)&&(ue(t)&&t<1e4||at(t)&&isNaN(Date.parse(t)))&&(a=Xf({[s]:t}))),a?r&&o?`time(${a})`:a:i?void 0:_e(t)}function Wit(t,e){const{type:n}=t;return e.map(r=>{const i=Q(t)&&!xd(t.timeUnit)?t.timeUnit:void 0,s=iE(r,{timeUnit:i,type:n,undefinedIfExprNotRequired:!0});return s!==void 0?{signal:s}:r})}function $1(t,e){return Ne(t.bin)?Sa(e)&&["ordinal","nominal"].includes(t.type):(console.warn("Only call this method for binned field defs."),!1)}const O9={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function T1(t){return t==null?void 0:t.condition}const Vit=["domain","grid","labels","ticks","title"],dUt={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Git={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},hUt={...Git,style:1,labelExpr:1,encoding:1};function R9(t){return ft(hUt,t)}const pUt={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},Yit=H(pUt);function Uu(t){return X(t,"mark")}class sE{constructor(e,n){this.name=e,this.run=n}hasMatchingType(e){return Uu(e)?jzt(e.mark)===this.name:!1}}function wf(t,e){const n=t&&t[e];return n?W(n)?Ap(n,r=>!!r.field):Q(n)||nE(n):!1}function Hit(t,e){const n=t&&t[e];return n?W(n)?Ap(n,r=>!!r.field):Q(n)||Ea(n)||A1(n):!1}function Xit(t,e){if(fn(e)){const n=t[e];if((Q(n)||Ea(n))&&(git(n.type)||Q(n)&&n.timeUnit)){const r=KO(e);return Hit(t,r)}}return!1}function Kit(t){return Ap(cBt,e=>{if(wf(t,e)){const n=t[e];if(W(n))return Ap(n,r=>!!r.aggregate);{const r=Qs(n);return r&&!!r.aggregate}}return!1})}function Qit(t,e){const n=[],r=[],i=[],s=[],o={};return IR(t,(a,u)=>{if(Q(a)){const{field:c,aggregate:l,bin:f,timeUnit:d,...h}=a;if(l||d||f){const p=kR(a),g=p==null?void 0:p.title;let m=nt(a,{forAs:!0});const y={...g?[]:{title:Ph(a,e,{allowDisabling:!0})},...h,field:m};if(l){let b;if(El(l)?(b="argmax",m=nt({op:"argmax",field:l.argmax},{forAs:!0}),y.field=`${m}.${c}`):xu(l)?(b="argmin",m=nt({op:"argmin",field:l.argmin},{forAs:!0}),y.field=`${m}.${c}`):l!=="boxplot"&&l!=="errorbar"&&l!=="errorband"&&(b=l),b){const w={op:b,as:m};c&&(w.field=c),s.push(w)}}else if(n.push(m),Gr(a)&&Ne(f)){if(r.push({bin:f,field:c,as:m}),n.push(nt(a,{binSuffix:"end"})),$1(a,u)&&n.push(nt(a,{binSuffix:"range"})),fn(u)){const b={field:`${m}_end`};o[`${u}2`]=b}y.bin="binned",Drt(u)||(y.type=Kf)}else if(d&&!xd(d)){i.push({timeUnit:d,field:c,as:m});const b=Gr(a)&&a.type!==kp&&"time";b&&(u===y1||u===Yf?y.formatType=b:wBt(u)?y.legend={formatType:b,...y.legend}:fn(u)&&(y.axis={formatType:b,...y.axis}))}o[u]=y}else n.push(c),o[u]=t[u]}else o[u]=t[u]}),{bins:r,timeUnits:i,aggregate:s,groupby:n,encoding:o}}function gUt(t,e,n){const r=_Bt(e,n);if(r){if(r==="binned"){const i=t[e===uo?We:zn];return!!(Q(i)&&Q(t[e])&&Un(i.bin))}}else return!1;return!0}function mUt(t,e,n,r){const i={};for(const s of H(t))Rrt(s)||K(dPt(s));for(let s of gBt){if(!t[s])continue;const o=t[s];if(v1(s)){const a=pBt(s),u=i[a];if(Q(u)&&fzt(u.type)&&Q(o)&&!u.timeUnit){K(oPt(a));continue}}if(s==="angle"&&e==="arc"&&!t.theta&&(K(sPt),s=As),!gUt(t,s,e)){K(YS(s,e));continue}if(s===Bu&&e==="line"){const a=Qs(t[s]);if(a!=null&&a.aggregate){K(fPt);continue}}if(s===pi&&(n?"fill"in t:"stroke"in t)){K(Zrt("encoding",{fill:"fill"in t,stroke:"stroke"in t}));continue}if(s===b1||s===Tp&&!W(o)&&!Ks(o)||s===Yf&&W(o)){if(o){if(s===Tp){const a=t[s];if(Lit(a)){i[s]=a;continue}}i[s]=ot(o).reduce((a,u)=>(Q(u)?a.push(CR(u,s)):K(Qk(u,s)),a),[])}}else{if(s===Yf&&o===null)i[s]=null;else if(!Q(o)&&!Ea(o)&&!Ks(o)&&!E1(o)&&!gt(o)){K(Qk(o,s));continue}i[s]=qit(o,s,r)}}return i}function oE(t,e){const n={};for(const r of H(t)){const i=qit(t[r],r,e,{compositeMark:!0});n[r]=i}return n}function yUt(t){const e=[];for(const n of H(t))if(wf(t,n)){const r=t[n],i=ot(r);for(const s of i)Q(s)?e.push(s):nE(s)&&e.push(s.condition)}return e}function IR(t,e,n){if(t)for(const r of H(t)){const i=t[r];if(W(i))for(const s of i)e.call(n,s,r);else e.call(n,i,r)}}function bUt(t,e,n,r){return t?H(t).reduce((i,s)=>{const o=t[s];return W(o)?o.reduce((a,u)=>e.call(r,a,u,s),i):e.call(r,i,o,s)},n):n}function Jit(t,e){return H(e).reduce((n,r)=>{switch(r){case We:case zn:case US:case qS:case jS:case uo:case va:case bl:case Sg:case As:case Lu:case co:case Du:case vl:case lo:case fo:case ho:case _s:case y1:case gi:case md:case Yf:return n;case Tp:if(t==="line"||t==="trail")return n;case b1:case zS:{const i=e[r];if(W(i)||Q(i))for(const s of ot(i))s.aggregate||n.push(nt(s,{}));return n}case Bu:if(t==="trail")return n;case pi:case wa:case xa:case Pu:case wl:case xl:case Sl:case _l:{const i=Qs(e[r]);return i&&!i.aggregate&&n.push(nt(i,{})),n}}},[])}function vUt(t){const{tooltip:e,...n}=t;if(!e)return{filteredEncoding:n};let r,i;if(W(e)){for(const s of e)s.aggregate?(r||(r=[]),r.push(s)):(i||(i=[]),i.push(s));r&&(n.tooltip=r)}else e.aggregate?n.tooltip=e:i=e;return W(i)&&i.length===1&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}function eM(t,e,n,r=!0){if("tooltip"in n)return{tooltip:n.tooltip};const i=t.map(({fieldPrefix:o,titlePrefix:a})=>{const u=r?` of ${FR(e)}`:"";return{field:o+e.field,type:e.type,title:gt(a)?{signal:`${a}"${escape(u)}"`}:a+u}}),s=yUt(n).map(eUt);return{tooltip:[...i,...Bo(s,Qt)]}}function FR(t){const{title:e,field:n}=t;return ln(e,n)}function NR(t,e,n,r,i){const{scale:s,axis:o}=n;return({partName:a,mark:u,positionPrefix:c,endPositionPrefix:l=void 0,extraEncoding:f={}})=>{const d=FR(n);return Zit(t,a,i,{mark:u,encoding:{[e]:{field:`${c}_${n.field}`,type:n.type,...d!==void 0?{title:d}:{},...s!==void 0?{scale:s}:{},...o!==void 0?{axis:o}:{}},...at(l)?{[`${e}2`]:{field:`${l}_${n.field}`}}:{},...r,...f}})}}function Zit(t,e,n,r){const{clip:i,color:s,opacity:o}=t,a=t.type;return t[e]||t[e]===void 0&&n[e]?[{...r,mark:{...n[e],...i?{clip:i}:{},...s?{color:s}:{},...o?{opacity:o}:{},...sa(r.mark)?r.mark:{type:r.mark},style:`${a}-${String(e)}`,...gl(t[e])?{}:t[e]}}]:[]}function tst(t,e,n){const{encoding:r}=t,i=e==="vertical"?"y":"x",s=r[i],o=r[`${i}2`],a=r[`${i}Error`],u=r[`${i}Error2`];return{continuousAxisChannelDef:Cb(s,n),continuousAxisChannelDef2:Cb(o,n),continuousAxisChannelDefError:Cb(a,n),continuousAxisChannelDefError2:Cb(u,n),continuousAxis:i}}function Cb(t,e){if(t!=null&&t.aggregate){const{aggregate:n,...r}=t;return n!==e&&K(zPt(n,e)),r}else return t}function est(t,e){const{mark:n,encoding:r}=t,{x:i,y:s}=r;if(sa(n)&&n.orient)return n.orient;if(xc(i)){if(xc(s)){const o=Q(i)&&i.aggregate,a=Q(s)&&s.aggregate;if(!o&&a===e)return"vertical";if(!a&&o===e)return"horizontal";if(o===e&&a===e)throw new Error("Both x and y cannot have aggregate");return Fp(s)&&!Fp(i)?"horizontal":"vertical"}return"horizontal"}else{if(xc(s))return"vertical";throw new Error(`Need a valid continuous axis for ${e}s`)}}const u2="boxplot",wUt=["box","median","outliers","rule","ticks"],xUt=new sE(u2,rst);function nst(t){return ue(t)?"tukey":t}function rst(t,{config:e}){t={...t,encoding:oE(t.encoding,e)};const{mark:n,encoding:r,params:i,projection:s,...o}=t,a=sa(n)?n:{type:n};i&&K(Qrt("boxplot"));const u=a.extent??e.boxplot.extent,c=we("size",a,e),l=a.invalid,f=nst(u),{bins:d,timeUnits:h,transform:p,continuousAxisChannelDef:g,continuousAxis:m,groupby:y,aggregate:b,encodingWithoutContinuousAxis:w,ticksOrient:v,boxOrient:x,customTooltipWithoutAggregatedField:S}=_Ut(t,u,e),_=_g(g.field),{color:E,size:A,...$}=w,T=ie=>NR(a,m,g,ie,e.boxplot),C=T($),F=T(w),M=(st(e.boxplot.box)?e.boxplot.box.color:e.mark.color)||"#4c78a8",k=T({...$,...A?{size:A}:{},color:{condition:{test:`${ye(`lower_box_${g.field}`)} >= ${ye(`upper_box_${g.field}`)}`,...E||{value:M}}}}),I=eM([{fieldPrefix:f==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:f==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],g,w),N={type:"tick",color:"black",opacity:1,orient:v,invalid:l,aria:!1},R=f==="min-max"?I:eM([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],g,w),D=[...C({partName:"rule",mark:{type:"rule",invalid:l,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:R}),...C({partName:"rule",mark:{type:"rule",invalid:l,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:R}),...C({partName:"ticks",mark:N,positionPrefix:"lower_whisker",extraEncoding:R}),...C({partName:"ticks",mark:N,positionPrefix:"upper_whisker",extraEncoding:R})],L=[...f!=="tukey"?D:[],...F({partName:"box",mark:{type:"bar",...c?{size:c}:{},orient:x,invalid:l,ariaRoleDescription:"box"},positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:I}),...k({partName:"median",mark:{type:"tick",invalid:l,...st(e.boxplot.median)&&e.boxplot.median.color?{color:e.boxplot.median.color}:{},...c?{size:c}:{},orient:v,aria:!1},positionPrefix:"mid_box",extraEncoding:I})];if(f==="min-max")return{...o,transform:(o.transform??[]).concat(p),layer:L};const P=ye(`lower_box_${g.field}`),B=ye(`upper_box_${g.field}`),G=`(${B} - ${P})`,ct=`${P} - ${u} * ${G}`,Z=`${B} + ${u} * ${G}`,lt=ye(g.field),et={joinaggregate:ist(g.field),groupby:y},ut={transform:[{filter:`(${ct} <= ${lt}) && (${lt} <= ${Z})`},{aggregate:[{op:"min",field:g.field,as:`lower_whisker_${_}`},{op:"max",field:g.field,as:`upper_whisker_${_}`},{op:"min",field:`lower_box_${g.field}`,as:`lower_box_${_}`},{op:"max",field:`upper_box_${g.field}`,as:`upper_box_${_}`},...b],groupby:y}],layer:D},{tooltip:V,...rt}=$,{scale:dt,axis:q}=g,Ot=FR(g),yt=oi(q,["title"]),Wt=Zit(a,"outliers",e.boxplot,{transform:[{filter:`(${lt} < ${ct}) || (${lt} > ${Z})`}],mark:"point",encoding:{[m]:{field:g.field,type:g.type,...Ot!==void 0?{title:Ot}:{},...dt!==void 0?{scale:dt}:{},...xe(yt)?{}:{axis:yt}},...rt,...E?{color:E}:{},...S?{tooltip:S}:{}}})[0];let qt;const ht=[...d,...h,et];return Wt?qt={transform:ht,layer:[Wt,ut]}:(qt=ut,qt.transform.unshift(...ht)),{...o,layer:[qt,{transform:p,layer:L}]}}function ist(t){const e=_g(t);return[{op:"q1",field:t,as:`lower_box_${e}`},{op:"q3",field:t,as:`upper_box_${e}`}]}function _Ut(t,e,n){const r=est(t,u2),{continuousAxisChannelDef:i,continuousAxis:s}=tst(t,r,u2),o=i.field,a=_g(o),u=nst(e),c=[...ist(o),{op:"median",field:o,as:`mid_box_${a}`},{op:"min",field:o,as:(u==="min-max"?"lower_whisker_":"min_")+a},{op:"max",field:o,as:(u==="min-max"?"upper_whisker_":"max_")+a}],l=u==="min-max"||u==="tukey"?[]:[{calculate:`${ye(`upper_box_${a}`)} - ${ye(`lower_box_${a}`)}`,as:`iqr_${a}`},{calculate:`min(${ye(`upper_box_${a}`)} + ${ye(`iqr_${a}`)} * ${e}, ${ye(`max_${a}`)})`,as:`upper_whisker_${a}`},{calculate:`max(${ye(`lower_box_${a}`)} - ${ye(`iqr_${a}`)} * ${e}, ${ye(`min_${a}`)})`,as:`lower_whisker_${a}`}],{[s]:f,...d}=t.encoding,{customTooltipWithoutAggregatedField:h,filteredEncoding:p}=vUt(d),{bins:g,timeUnits:m,aggregate:y,groupby:b,encoding:w}=Qit(p,n),v=r==="vertical"?"horizontal":"vertical",x=r,S=[...g,...m,{aggregate:[...y,...c],groupby:b},...l];return{bins:g,timeUnits:m,transform:S,groupby:b,aggregate:y,continuousAxisChannelDef:i,continuousAxis:s,encodingWithoutContinuousAxis:w,ticksOrient:v,boxOrient:x,customTooltipWithoutAggregatedField:h}}const OR="errorbar",SUt=["ticks","rule"],EUt=new sE(OR,sst);function sst(t,{config:e}){t={...t,encoding:oE(t.encoding,e)};const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:u,tooltipEncoding:c}=ost(t,OR,e);delete s.size;const l=NR(a,i,r,s,e.errorbar),f=a.thickness,d=a.size,h={type:"tick",orient:o,aria:!1,...f!==void 0?{thickness:f}:{},...d!==void 0?{size:d}:{}},p=[...l({partName:"ticks",mark:h,positionPrefix:"lower",extraEncoding:c}),...l({partName:"ticks",mark:h,positionPrefix:"upper",extraEncoding:c}),...l({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar",...f!==void 0?{size:f}:{}},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c})];return{...u,transform:n,...p.length>1?{layer:p}:{...p[0]}}}function AUt(t,e){const{encoding:n}=t;if($Ut(n))return{orient:est(t,e),inputType:"raw"};const r=TUt(n),i=kUt(n),s=n.x,o=n.y;if(r){if(i)throw new Error(`${e} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,u=n.y2;if(Bt(a)&&Bt(u))throw new Error(`${e} cannot have both x2 and y2`);if(Bt(a)){if(xc(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${e}`)}else if(Bt(u)){if(xc(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${e}`)}throw new Error("No ranged axis")}else{const a=n.xError,u=n.xError2,c=n.yError,l=n.yError2;if(Bt(u)&&!Bt(a))throw new Error(`${e} cannot have xError2 without xError`);if(Bt(l)&&!Bt(c))throw new Error(`${e} cannot have yError2 without yError`);if(Bt(a)&&Bt(c))throw new Error(`${e} cannot have both xError and yError with both are quantiative`);if(Bt(a)){if(xc(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(Bt(c)){if(xc(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function $Ut(t){return(Bt(t.x)||Bt(t.y))&&!Bt(t.x2)&&!Bt(t.y2)&&!Bt(t.xError)&&!Bt(t.xError2)&&!Bt(t.yError)&&!Bt(t.yError2)}function TUt(t){return Bt(t.x2)||Bt(t.y2)}function kUt(t){return Bt(t.xError)||Bt(t.xError2)||Bt(t.yError)||Bt(t.yError2)}function ost(t,e,n){const{mark:r,encoding:i,params:s,projection:o,...a}=t,u=sa(r)?r:{type:r};s&&K(Qrt(e));const{orient:c,inputType:l}=AUt(t,e),{continuousAxisChannelDef:f,continuousAxisChannelDef2:d,continuousAxisChannelDefError:h,continuousAxisChannelDefError2:p,continuousAxis:g}=tst(t,c,e),{errorBarSpecificAggregate:m,postAggregateCalculates:y,tooltipSummary:b,tooltipTitleWithFieldName:w}=MUt(u,f,d,h,p,l,e,n),{[g]:v,[g==="x"?"x2":"y2"]:x,[g==="x"?"xError":"yError"]:S,[g==="x"?"xError2":"yError2"]:_,...E}=i,{bins:A,timeUnits:$,aggregate:T,groupby:C,encoding:F}=Qit(E,n),M=[...T,...m],k=l!=="raw"?[]:C,I=eM(b,f,F,w);return{transform:[...a.transform??[],...A,...$,...M.length===0?[]:[{aggregate:M,groupby:k}],...y],groupby:k,continuousAxisChannelDef:f,continuousAxis:g,encodingWithoutContinuousAxis:F,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:u,outerSpec:a,tooltipEncoding:I}}function MUt(t,e,n,r,i,s,o,a){let u=[],c=[];const l=e.field;let f,d=!1;if(s==="raw"){const h=t.center?t.center:t.extent?t.extent==="iqr"?"median":"mean":a.errorbar.center,p=t.extent?t.extent:h==="mean"?"stderr":"iqr";if(h==="median"!=(p==="iqr")&&K(PPt(h,p,o)),p==="stderr"||p==="stdev")u=[{op:p,field:l,as:`extent_${l}`},{op:h,field:l,as:`center_${l}`}],c=[{calculate:`${ye(`center_${l}`)} + ${ye(`extent_${l}`)}`,as:`upper_${l}`},{calculate:`${ye(`center_${l}`)} - ${ye(`extent_${l}`)}`,as:`lower_${l}`}],f=[{fieldPrefix:"center_",titlePrefix:m1(h)},{fieldPrefix:"upper_",titlePrefix:D9(h,p,"+")},{fieldPrefix:"lower_",titlePrefix:D9(h,p,"-")}],d=!0;else{let g,m,y;p==="ci"?(g="mean",m="ci0",y="ci1"):(g="median",m="q1",y="q3"),u=[{op:m,field:l,as:`lower_${l}`},{op:y,field:l,as:`upper_${l}`},{op:g,field:l,as:`center_${l}`}],f=[{fieldPrefix:"upper_",titlePrefix:Ph({field:l,aggregate:y,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:Ph({field:l,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:Ph({field:l,aggregate:g,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(t.center||t.extent)&&K(BPt(t.center,t.extent)),s==="aggregated-upper-lower"?(f=[],c=[{calculate:ye(n.field),as:`upper_${l}`},{calculate:ye(l),as:`lower_${l}`}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:l}],c=[{calculate:`${ye(l)} + ${ye(r.field)}`,as:`upper_${l}`}],i?c.push({calculate:`${ye(l)} + ${ye(i.field)}`,as:`lower_${l}`}):c.push({calculate:`${ye(l)} - ${ye(r.field)}`,as:`lower_${l}`}));for(const h of c)f.push({fieldPrefix:h.as.substring(0,6),titlePrefix:Gf(Gf(h.calculate,"datum['",""),"']","")})}return{postAggregateCalculates:c,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:d}}function D9(t,e,n){return`${m1(t)} ${n} ${e}`}const RR="errorband",CUt=["band","borders"],IUt=new sE(RR,ast);function ast(t,{config:e}){t={...t,encoding:oE(t.encoding,e)};const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:u}=ost(t,RR,e),c=o,l=NR(c,i,r,s,e.errorband),f=t.encoding.x!==void 0&&t.encoding.y!==void 0;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const p={...c.interpolate?{interpolate:c.interpolate}:{},...c.tension&&c.interpolate?{tension:c.tension}:{}};return f?(d={...d,...p,ariaRoleDescription:"errorband"},h={...h,...p,aria:!1}):c.interpolate?K(T9("interpolate")):c.tension&&K(T9("tension")),{...a,transform:n,layer:[...l({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...l({partName:"borders",mark:h,positionPrefix:"lower",extraEncoding:u}),...l({partName:"borders",mark:h,positionPrefix:"upper",extraEncoding:u})]}}const ust={};function DR(t,e,n){const r=new sE(t,e);ust[t]={normalizer:r,parts:n}}function FUt(){return H(ust)}DR(u2,rst,wUt);DR(OR,sst,SUt);DR(RR,ast,CUt);const NUt=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],cst={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},lst={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},OUt=H(cst),RUt=H(lst),DUt={header:1,headerRow:1,headerColumn:1,headerFacet:1},fst=H(DUt),dst=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],LUt={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},BUt={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Js="_vgsid_",PUt={point:{on:"click",fields:[Js],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[pointerdown, window:pointerup] > window:pointermove!",encodings:["x","y"],translate:"[pointerdown, window:pointerup] > window:pointermove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function LR(t){return t==="legend"||!!(t!=null&&t.legend)}function T$(t){return LR(t)&&st(t)}function BR(t){return!!(t!=null&&t.select)}function hst(t){const e=[];for(const n of t||[]){if(BR(n))continue;const{expr:r,bind:i,...s}=n;if(i&&r){const o={...s,bind:i,init:r};e.push(o)}else{const o={...s,...r?{update:r}:{},...i?{bind:i}:{}};e.push(o)}}return e}function zUt(t){return aE(t)||zR(t)||PR(t)}function PR(t){return X(t,"concat")}function aE(t){return X(t,"vconcat")}function zR(t){return X(t,"hconcat")}function pst({step:t,offsetIsDiscrete:e}){return e?t.for??"offset":"position"}function oa(t){return X(t,"step")}function L9(t){return X(t,"view")||X(t,"width")||X(t,"height")}const B9=20,UUt={align:1,bounds:1,center:1,columns:1,spacing:1},jUt=H(UUt);function qUt(t,e,n){const r=n[e],i={},{spacing:s,columns:o}=r;s!==void 0&&(i.spacing=s),o!==void 0&&(eE(t)&&!S1(t.facet)||PR(t))&&(i.columns=o),aE(t)&&(i.columns=1);for(const a of jUt)if(t[a]!==void 0)if(a==="spacing"){const u=t[a];i[a]=ue(u)?u:{row:u.row??s,column:u.column??s}}else i[a]=t[a];return i}function nM(t,e){return t[e]??t[e==="width"?"continuousWidth":"continuousHeight"]}function rM(t,e){const n=c2(t,e);return oa(n)?n.step:gst}function c2(t,e){const n=t[e]??t[e==="width"?"discreteWidth":"discreteHeight"];return ln(n,{step:t.step})}const gst=20,WUt={continuousWidth:200,continuousHeight:200,step:gst},VUt={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:WUt,mark:Dzt,arc:{},area:{},bar:zzt,circle:{},geoshape:{},image:{},line:{},point:{},rect:xR,rule:{color:"black"},square:{},text:{color:"black"},tick:Uzt,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:yzt,projection:{},legend:LUt,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:PUt,style:{},title:{},facet:{spacing:B9},concat:{spacing:B9},normalizedNumberFormat:".0%"},Ra=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],P9={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},z9={blue:Ra[0],orange:Ra[1],red:Ra[2],teal:Ra[3],green:Ra[4],yellow:Ra[5],purple:Ra[6],pink:Ra[7],brown:Ra[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function GUt(t={}){return{signals:[{name:"color",value:st(t)?{...z9,...t}:z9}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function YUt(t){return{signals:[{name:"fontSize",value:st(t)?{...P9,...t}:P9}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function HUt(t){return{text:{font:t},style:{"guide-label":{font:t},"guide-title":{font:t},"group-title":{font:t},"group-subtitle":{font:t}}}}function mst(t){const e=H(t||{}),n={};for(const r of e){const i=t[r];n[r]=T1(i)?Wrt(i):Ai(i)}return n}function XUt(t){const e=H(t),n={};for(const r of e)n[r]=mst(t[r]);return n}const KUt=[...Ait,...Yit,...fst,"background","padding","legend","lineBreak","scale","style","title","view"];function yst(t={}){const{color:e,font:n,fontSize:r,selection:i,...s}=t,o=fg({},Rt(VUt),n?HUt(n):{},e?GUt(e):{},r?YUt(r):{},s||{});i&&dg(o,"selection",i,!0);const a=oi(o,KUt);for(const u of["background","lineBreak","padding"])o[u]&&(a[u]=Ai(o[u]));for(const u of Ait)o[u]&&(a[u]=jn(o[u]));for(const u of Yit)o[u]&&(a[u]=mst(o[u]));for(const u of fst)o[u]&&(a[u]=jn(o[u]));if(o.legend&&(a.legend=jn(o.legend)),o.scale){const{invalid:u,...c}=o.scale,l=jn(u,{level:1});a.scale={...jn(c),...H(l).length>0?{invalid:l}:{}}}return o.style&&(a.style=XUt(o.style)),o.title&&(a.title=jn(o.title)),o.view&&(a.view=jn(o.view)),a}const QUt=new Set(["view",...Czt]),JUt=["color","fontSize","background","padding","facet","concat","numberFormat","numberFormatType","normalizedNumberFormat","normalizedNumberFormatType","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],ZUt={view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"],...Rzt};function tjt(t){t=Rt(t);for(const e of JUt)delete t[e];if(t.axis)for(const e in t.axis)T1(t.axis[e])&&delete t.axis[e];if(t.legend)for(const e of NUt)delete t.legend[e];if(t.mark){for(const e of M9)delete t.mark[e];t.mark.tooltip&&st(t.mark.tooltip)&&delete t.mark.tooltip}t.params&&(t.signals=(t.signals||[]).concat(hst(t.params)),delete t.params);for(const e of QUt){for(const r of M9)delete t[e][r];const n=ZUt[e];if(n)for(const r of n)delete t[e][r];njt(t,e)}for(const e of FUt())delete t[e];ejt(t);for(const e in t)st(t[e])&&xe(t[e])&&delete t[e];return xe(t)?void 0:t}function ejt(t){const{titleMarkConfig:e,subtitleMarkConfig:n,subtitle:r}=qrt(t.title);xe(e)||(t.style["group-title"]={...t.style["group-title"],...e}),xe(n)||(t.style["group-subtitle"]={...t.style["group-subtitle"],...n}),xe(r)?delete t.title:t.title=r}function njt(t,e,n,r){const i=t[e];e==="view"&&(n="cell");const s={...i,...t.style[n??e]};xe(s)||(t.style[n??e]=s),delete t[e]}function uE(t){return X(t,"layer")}function rjt(t){return X(t,"repeat")}function ijt(t){return!W(t.repeat)&&X(t.repeat,"layer")}class UR{map(e,n){return eE(e)?this.mapFacet(e,n):rjt(e)?this.mapRepeat(e,n):zR(e)?this.mapHConcat(e,n):aE(e)?this.mapVConcat(e,n):PR(e)?this.mapConcat(e,n):this.mapLayerOrUnit(e,n)}mapLayerOrUnit(e,n){if(uE(e))return this.mapLayer(e,n);if(Uu(e))return this.mapUnit(e,n);throw new Error(nR(e))}mapLayer(e,n){return{...e,layer:e.layer.map(r=>this.mapLayerOrUnit(r,n))}}mapHConcat(e,n){return{...e,hconcat:e.hconcat.map(r=>this.map(r,n))}}mapVConcat(e,n){return{...e,vconcat:e.vconcat.map(r=>this.map(r,n))}}mapConcat(e,n){const{concat:r,...i}=e;return{...i,concat:r.map(s=>this.map(s,n))}}mapFacet(e,n){return{...e,spec:this.map(e.spec,n)}}mapRepeat(e,n){return{...e,spec:this.map(e.spec,n)}}}const sjt={zero:1,center:1,normalize:1};function ojt(t){return ft(sjt,t)}const ajt=new Set([_it,QS,KS,n2,ZS,vR,wR,JS,Sit,bR]),ujt=new Set([QS,KS,_it]);function Yd(t){return Q(t)&&Cp(t)==="quantitative"&&!t.bin}function U9(t,e,{orient:n,type:r}){const i=e==="x"?"y":"radius",s=e==="x"&&["bar","area"].includes(r),o=t[e],a=t[i];if(Q(o)&&Q(a))if(Yd(o)&&Yd(a)){if(o.stack)return e;if(a.stack)return i;const u=Q(o)&&!!o.aggregate,c=Q(a)&&!!a.aggregate;if(u!==c)return u?e:i;if(s){if(n==="vertical")return i;if(n==="horizontal")return e}}else{if(Yd(o))return e;if(Yd(a))return i}else{if(Yd(o))return s&&n==="vertical"?void 0:e;if(Yd(a))return s&&n==="horizontal"?void 0:i}}function cjt(t){switch(t){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function bst(t,e){var g,m;const n=sa(t)?t:{type:t},r=n.type;if(!ajt.has(r))return null;const i=U9(e,"x",n)||U9(e,"theta",n);if(!i)return null;const s=e[i],o=Q(s)?nt(s,{}):void 0,a=cjt(i),u=[],c=new Set;if(e[a]){const y=e[a],b=Q(y)?nt(y,{}):void 0;b&&b!==o&&(u.push(a),c.add(b))}const l=a==="x"?"xOffset":"yOffset",f=e[l],d=Q(f)?nt(f,{}):void 0;d&&d!==o&&(u.push(l),c.add(d));const h=mBt.reduce((y,b)=>{if(b!=="tooltip"&&wf(e,b)){const w=e[b];for(const v of ot(w)){const x=Qs(v);if(x.aggregate)continue;const S=nt(x,{});(!S||!c.has(S))&&y.push({channel:b,fieldDef:x})}}return y},[]);let p;return s.stack!==void 0?gl(s.stack)?p=s.stack?"zero":null:p=s.stack:ujt.has(r)&&(p="zero"),!p||!ojt(p)||Kit(e)&&h.length===0?null:((g=s==null?void 0:s.scale)!=null&&g.type&&((m=s==null?void 0:s.scale)==null?void 0:m.type)!==Wn.LINEAR&&s!=null&&s.stack&&K(RPt(s.scale.type)),Bt(e[_a(i)])?(s.stack!==void 0&&K(OPt(i)),null):(Q(s)&&s.aggregate&&!MBt.has(s.aggregate)&&K(DPt(s.aggregate)),{groupbyChannels:u,groupbyFields:c,fieldChannel:i,impute:s.impute===null?!1:Al(r),stackBy:h,offset:p}))}function vst(t,e,n){const r=jn(t),i=we("orient",r,n);if(r.orient=hjt(r.type,e,i),i!==void 0&&i!==r.orient&&K(bPt(r.orient,i)),r.type==="bar"&&r.orient){const u=we("cornerRadiusEnd",r,n);if(u!==void 0){const c=r.orient==="horizontal"&&e.x2||r.orient==="vertical"&&e.y2?["cornerRadius"]:Bzt[r.orient];for(const l of c)r[l]=u;r.cornerRadiusEnd!==void 0&&delete r.cornerRadiusEnd}}const s=we("opacity",r,n),o=we("fillOpacity",r,n);return s===void 0&&o===void 0&&(r.opacity=fjt(r.type,e)),we("cursor",r,n)===void 0&&(r.cursor=ljt(r,e,n)),r}function ljt(t,e,n){return e.href||t.href||we("href",t,n)?"pointer":t.cursor}function fjt(t,e){if(Xt([ZS,bR,vR,wR],t)&&!Kit(e))return .7}function djt(t,e,{graticule:n}){if(n)return!1;const r=ia("filled",t,e),i=t.type;return ln(r,i!==ZS&&i!==JS&&i!==n2)}function hjt(t,e,n){switch(t){case ZS:case vR:case wR:case Sit:case kzt:case Tzt:return}const{x:r,y:i,x2:s,y2:o}=e;switch(t){case QS:if(Q(r)&&(Un(r.bin)||Q(i)&&i.aggregate&&!r.aggregate))return"vertical";if(Q(i)&&(Un(i.bin)||Q(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s)return(Q(r)&&r.type===Kf&&!Ne(r.bin)||i2(r))&&Q(i)&&Un(i.bin)?"horizontal":"vertical";if(!o)return(Q(i)&&i.type===Kf&&!Ne(i.bin)||i2(i))&&Q(r)&&Un(r.bin)?"vertical":"horizontal"}case n2:if(s&&!(Q(r)&&Un(r.bin))&&o&&!(Q(i)&&Un(i.bin)))return;case KS:if(o)return Q(i)&&Un(i.bin)?"horizontal":"vertical";if(s)return Q(r)&&Un(r.bin)?"vertical":"horizontal";if(t===n2){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case JS:case bR:{const a=N9(r),u=N9(i);if(n)return n;if(a&&!u)return t!=="tick"?"horizontal":"vertical";if(!a&&u)return t!=="tick"?"vertical":"horizontal";if(a&&u)return"vertical";{const c=Gr(r)&&r.type===kp,l=Gr(i)&&i.type===kp;if(c&&!l)return"vertical";if(!c&&l)return"horizontal"}return}}return"vertical"}function pjt(t){const{point:e,line:n,...r}=t;return H(r).length>1?r:r.type}function gjt(t){for(const e of["line","area","rule","trail"])t[e]&&(t={...t,[e]:oi(t[e],["point","line"])});return t}function k$(t,e={},n){return t.point==="transparent"?{opacity:0}:t.point?st(t.point)?t.point:{}:t.point!==void 0?null:e.point||n.shape?st(e.point)?e.point:{}:void 0}function j9(t,e={}){return t.line?t.line===!0?{}:t.line:t.line!==void 0?null:e.line?e.line===!0?{}:e.line:void 0}class mjt{constructor(){this.name="path-overlay"}hasMatchingType(e,n){if(Uu(e)){const{mark:r,encoding:i}=e,s=sa(r)?r:{type:r};switch(s.type){case"line":case"rule":case"trail":return!!k$(s,n[s.type],i);case"area":return!!k$(s,n[s.type],i)||!!j9(s,n[s.type])}}return!1}run(e,n,r){const{config:i}=n,{params:s,projection:o,mark:a,name:u,encoding:c,...l}=e,f=oE(c,i),d=sa(a)?a:{type:a},h=k$(d,i[d.type],f),p=d.type==="area"&&j9(d,i[d.type]),g=[{name:u,...s?{params:s}:{},mark:pjt({...d.type==="area"&&d.opacity===void 0&&d.fillOpacity===void 0?{opacity:.7}:{},...d}),encoding:oi(f,["shape"])}],m=bst(vst(d,f,i),f);let y=f;if(m){const{fieldChannel:b,offset:w}=m;y={...f,[b]:{...f[b],...w?{stack:w}:{}}}}return y=oi(y,["y2","x2"]),p&&g.push({...o?{projection:o}:{},mark:{type:"line",...Ep(d,["clip","interpolate","tension","tooltip"]),...p},encoding:y}),h&&g.push({...o?{projection:o}:{},mark:{type:"point",opacity:1,filled:!0,...Ep(d,["clip","tooltip"]),...h},encoding:y}),r({...l,layer:g},{...n,config:gjt(i)})}}function yjt(t,e){return e?S1(t)?xst(t,e):wst(t,e):t}function M$(t,e){return e?xst(t,e):t}function iM(t,e,n){const r=e[t];if(Zzt(r)){if(r.repeat in n)return{...e,[t]:n[r.repeat]};K(XBt(r.repeat));return}return e}function wst(t,e){if(t=iM("field",t,e),t!==void 0){if(t===null)return null;if(TR(t)&&cu(t.sort)){const n=iM("field",t.sort,e);t={...t,...n?{sort:n}:{}}}return t}}function q9(t,e){if(Q(t))return wst(t,e);{const n=iM("datum",t,e);return n!==t&&!n.type&&(n.type="nominal"),n}}function W9(t,e){if(Bt(t)){const n=q9(t,e);if(n)return n;if(E1(t))return{condition:t.condition}}else{if(A1(t)){const n=q9(t.condition,e);if(n)return{...t,condition:n};{const{condition:r,...i}=t;return i}}return t}}function xst(t,e){const n={};for(const r in t)if(X(t,r)){const i=t[r];if(W(i))n[r]=i.map(s=>W9(s,e)).filter(s=>s);else{const s=W9(i,e);s!==void 0&&(n[r]=s)}}return n}class bjt{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(Uu(e)){const{encoding:n,mark:r}=e;if(r==="line"||sa(r)&&r.type==="line")for(const i of hBt){const s=yd(i),o=n[s];if(n[i]&&(Q(o)&&!Un(o.bin)||Ea(o)))return!0}}return!1}run(e,n,r){const{encoding:i,mark:s}=e;return K(yPt(!!i.x2,!!i.y2)),r({...e,mark:st(s)?{...s,type:"rule"}:"rule"},n)}}class vjt extends UR{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[xUt,EUt,IUt,new mjt,new bjt]}map(e,n){if(Uu(e)){const r=wf(e.encoding,au),i=wf(e.encoding,uu),s=wf(e.encoding,PS);if(r||i||s)return this.mapFacetedUnit(e,n)}return super.map(e,n)}mapUnit(e,n){const{parentEncoding:r,parentProjection:i}=n,s=M$(e.encoding,n.repeater),o={...e,...e.name?{name:[n.repeaterPrefix,e.name].filter(u=>u).join("_")}:{},...s?{encoding:s}:{}};if(r||i)return this.mapUnitWithParentEncodingOrProjection(o,n);const a=this.mapLayerOrUnit.bind(this);for(const u of this.nonFacetUnitNormalizers)if(u.hasMatchingType(o,n.config))return u.run(o,n,a);return o}mapRepeat(e,n){return ijt(e)?this.mapLayerRepeat(e,n):this.mapNonLayerRepeat(e,n)}mapLayerRepeat(e,n){const{repeat:r,spec:i,...s}=e,{row:o,column:a,layer:u}=r,{repeater:c={},repeaterPrefix:l=""}=n;return o||a?this.mapRepeat({...e,repeat:{...o?{row:o}:{},...a?{column:a}:{}},spec:{repeat:{layer:u},spec:i}},n):{...s,layer:u.map(f=>{const d={...c,layer:f},h=`${(i.name?`${i.name}_`:"")+l}child__layer_${qe(f)}`,p=this.mapLayerOrUnit(i,{...n,repeater:d,repeaterPrefix:h});return p.name=h,p})}}mapNonLayerRepeat(e,n){const{repeat:r,spec:i,data:s,...o}=e;!W(r)&&e.columns&&(e=oi(e,["columns"]),K(S9("repeat")));const a=[],{repeater:u={},repeaterPrefix:c=""}=n,l=!W(r)&&r.row||[u?u.row:null],f=!W(r)&&r.column||[u?u.column:null],d=W(r)&&r||[u?u.repeat:null];for(const p of d)for(const g of l)for(const m of f){const y={repeat:p,row:g,column:m,layer:u.layer},b=(i.name?`${i.name}_`:"")+c+"child__"+(W(r)?`${qe(p)}`:(r.row?`row_${qe(g)}`:"")+(r.column?`column_${qe(m)}`:"")),w=this.map(i,{...n,repeater:y,repeaterPrefix:b});w.name=b,a.push(oi(w,["data"]))}const h=W(r)?e.columns:r.column?r.column.length:1;return{data:i.data??s,align:"all",...o,columns:h,concat:a}}mapFacet(e,n){const{facet:r}=e;return S1(r)&&e.columns&&(e=oi(e,["columns"]),K(S9("facet"))),super.mapFacet(e,n)}mapUnitWithParentEncodingOrProjection(e,n){const{encoding:r,projection:i}=e,{parentEncoding:s,parentProjection:o,config:a}=n,u=G9({parentProjection:o,projection:i}),c=V9({parentEncoding:s,encoding:M$(r,n.repeater)});return this.mapUnit({...e,...u?{projection:u}:{},...c?{encoding:c}:{}},{config:a})}mapFacetedUnit(e,n){const{row:r,column:i,facet:s,...o}=e.encoding,{mark:a,width:u,projection:c,height:l,view:f,params:d,encoding:h,...p}=e,{facetMapping:g,layout:m}=this.getFacetMappingAndLayout({row:r,column:i,facet:s},n),y=M$(o,n.repeater);return this.mapFacet({...p,...m,facet:g,spec:{...u?{width:u}:{},...l?{height:l}:{},...f?{view:f}:{},...c?{projection:c}:{},mark:a,encoding:y,...d?{params:d}:{}}},n)}getFacetMappingAndLayout(e,n){const{row:r,column:i,facet:s}=e;if(r||i){s&&K(gPt([...r?[au]:[],...i?[uu]:[]]));const o={},a={};for(const u of[au,uu]){const c=e[u];if(c){const{align:l,center:f,spacing:d,columns:h,...p}=c;o[u]=p;for(const g of["align","center","spacing"])c[g]!==void 0&&(a[g]??(a[g]={}),a[g][u]=c[g])}}return{facetMapping:o,layout:a}}else{const{align:o,center:a,spacing:u,columns:c,...l}=s;return{facetMapping:yjt(l,n.repeater),layout:{...o?{align:o}:{},...a?{center:a}:{},...u?{spacing:u}:{},...c?{columns:c}:{}}}}}mapLayer(e,{parentEncoding:n,parentProjection:r,...i}){const{encoding:s,projection:o,...a}=e,u={...i,parentEncoding:V9({parentEncoding:n,encoding:s,layer:!0}),parentProjection:G9({parentProjection:r,projection:o})};return super.mapLayer({...a,...e.name?{name:[u.repeaterPrefix,e.name].filter(c=>c).join("_")}:{}},u)}}function V9({parentEncoding:t,encoding:e={},layer:n}){let r={};if(t){const i=new Set([...H(t),...H(e)]);for(const s of i){const o=e[s],a=t[s];if(Bt(o)){const u={...a,...o};r[s]=u}else A1(o)?r[s]={...o,condition:{...a,...o.condition}}:o||o===null?r[s]=o:(n||Ks(a)||gt(a)||Bt(a)||W(a))&&(r[s]=a)}}else r=e;return!r||xe(r)?void 0:r}function G9(t){const{parentProjection:e,projection:n}=t;return e&&n&&K(iPt({parentProjection:e,projection:n})),n??e}function jR(t){return X(t,"filter")}function wjt(t){return X(t,"stop")}function _st(t){return X(t,"lookup")}function xjt(t){return X(t,"data")}function _jt(t){return X(t,"param")}function Sjt(t){return X(t,"pivot")}function Ejt(t){return X(t,"density")}function Ajt(t){return X(t,"quantile")}function $jt(t){return X(t,"regression")}function Tjt(t){return X(t,"loess")}function kjt(t){return X(t,"sample")}function Mjt(t){return X(t,"window")}function Cjt(t){return X(t,"joinaggregate")}function Ijt(t){return X(t,"flatten")}function Fjt(t){return X(t,"calculate")}function Sst(t){return X(t,"bin")}function Njt(t){return X(t,"impute")}function Ojt(t){return X(t,"timeUnit")}function Rjt(t){return X(t,"aggregate")}function Djt(t){return X(t,"stack")}function Ljt(t){return X(t,"fold")}function Bjt(t){return X(t,"extent")&&!X(t,"density")&&!X(t,"regression")}function Pjt(t){return t.map(e=>jR(e)?{filter:Lh(e.filter,lzt)}:e)}class zjt extends UR{map(e,n){return n.emptySelections??(n.emptySelections={}),n.selectionPredicates??(n.selectionPredicates={}),e=Y9(e,n),super.map(e,n)}mapLayerOrUnit(e,n){if(e=Y9(e,n),e.encoding){const r={};for(const[i,s]of el(e.encoding))r[i]=Est(s,n);e={...e,encoding:r}}return super.mapLayerOrUnit(e,n)}mapUnit(e,n){const{selection:r,...i}=e;return r?{...i,params:el(r).map(([s,o])=>{const{init:a,bind:u,empty:c,...l}=o;l.type==="single"?(l.type="point",l.toggle=!1):l.type==="multi"&&(l.type="point"),n.emptySelections[s]=c!=="none";for(const f of Zn(n.selectionPredicates[s]??{}))f.empty=c!=="none";return{name:s,value:a,select:l,bind:u}})}:e}}function Y9(t,e){const{transform:n,...r}=t;if(n){const i=n.map(s=>{if(jR(s))return{filter:sM(s,e)};if(Sst(s)&&bd(s.bin))return{...s,bin:Ast(s.bin)};if(_st(s)){const{selection:o,...a}=s.from;return o?{...s,from:{param:o,...a}}:s}return s});return{...r,transform:i}}return t}function Est(t,e){var r,i;const n=Rt(t);if(Q(n)&&bd(n.bin)&&(n.bin=Ast(n.bin)),_d(n)&&((i=(r=n.scale)==null?void 0:r.domain)!=null&&i.selection)){const{selection:s,...o}=n.scale.domain;n.scale.domain={...o,...s?{param:s}:{}}}if(E1(n))if(W(n.condition))n.condition=n.condition.map(s=>{const{selection:o,param:a,test:u,...c}=s;return a?s:{...c,test:sM(s,e)}});else{const{selection:s,param:o,test:a,...u}=Est(n.condition,e);n.condition=o?n.condition:{...u,test:sM(n.condition,e)}}return n}function Ast(t){const e=t.extent;if(e!=null&&e.selection){const{selection:n,...r}=e;return{...t,extent:{...r,param:n}}}return t}function sM(t,e){const n=r=>Lh(r,i=>{var s;const o=e.emptySelections[i]??!0,a={param:i,empty:o};return(s=e.selectionPredicates)[i]??(s[i]=[]),e.selectionPredicates[i].push(a),a});return t.selection?n(t.selection):Lh(t.test||t.filter,r=>r.selection?n(r.selection):r)}class oM extends UR{map(e,n){const r=n.selections??[];if(e.params&&!Uu(e)){const i=[];for(const s of e.params)BR(s)?r.push(s):i.push(s);e.params=i}return n.selections=r,super.map(e,n)}mapUnit(e,n){const r=n.selections;if(!r||!r.length)return e;const i=(n.path??[]).concat(e.name),s=[];for(const o of r)if(!o.views||!o.views.length)s.push(o);else for(const a of o.views)(at(a)&&(a===e.name||i.includes(a))||W(a)&&a.map(u=>i.indexOf(u)).every((u,c,l)=>u!==-1&&(c===0||u>l[c-1])))&&s.push(o);return s.length&&(e.params=s),e}}for(const t of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const e=oM.prototype[t];oM.prototype[t]=function(n,r){return e.call(this,n,Ujt(n,r))}}function Ujt(t,e){return t.name?{...e,path:(e.path??[]).concat(t.name)}:e}function $st(t,e){e===void 0&&(e=yst(t.config));const n=Vjt(t,e),{width:r,height:i}=t,s=Gjt(n,{width:r,height:i,autosize:t.autosize},e);return{...n,...s?{autosize:s}:{}}}const jjt=new vjt,qjt=new zjt,Wjt=new oM;function Vjt(t,e={}){const n={config:e};return Wjt.map(jjt.map(qjt.map(t,n),n),n)}function H9(t){return at(t)?{type:t}:t??{}}function Gjt(t,e,n){let{width:r,height:i}=e;const s=Uu(t)||uE(t),o={};s?r=="container"&&i=="container"?(o.type="fit",o.contains="padding"):r=="container"?(o.type="fit-x",o.contains="padding"):i=="container"&&(o.type="fit-y",o.contains="padding"):(r=="container"&&(K(v9("width")),r=void 0),i=="container"&&(K(v9("height")),i=void 0));const a={type:"pad",...o,...n?H9(n.autosize):{},...H9(t.autosize)};if(a.type==="fit"&&!s&&(K(BBt),a.type="pad"),r=="container"&&!(a.type=="fit"||a.type=="fit-x")&&K(w9("width")),i=="container"&&!(a.type=="fit"||a.type=="fit-y")&&K(w9("height")),!ki(a,{type:"pad"}))return a}function Yjt(t){return["fit","fit-x","fit-y"].includes(t)}function Hjt(t){return t?`fit-${WS(t)}`:"fit"}const Xjt=["background","padding"];function X9(t,e){const n={};for(const r of Xjt)t&&t[r]!==void 0&&(n[r]=Ai(t[r]));return e&&(n.params=t.params),n}class ju{constructor(e={},n={}){this.explicit=e,this.implicit=n}clone(){return new ju(Rt(this.explicit),Rt(this.implicit))}combine(){return{...this.explicit,...this.implicit}}get(e){return ln(this.explicit[e],this.implicit[e])}getWithExplicit(e){return this.explicit[e]!==void 0?{explicit:!0,value:this.explicit[e]}:this.implicit[e]!==void 0?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,{value:n,explicit:r}){n!==void 0&&this.set(e,n,r)}set(e,n,r){return delete this[r?"implicit":"explicit"][e],this[r?"explicit":"implicit"][e]=n,this}copyKeyFromSplit(e,{explicit:n,implicit:r}){n[e]!==void 0?this.set(e,n[e],!0):r[e]!==void 0&&this.set(e,r[e],!1)}copyKeyFromObject(e,n){n[e]!==void 0&&this.set(e,n[e],!0)}copyAll(e){for(const n of H(e.combine())){const r=e.getWithExplicit(n);this.setWithExplicit(n,r)}}}function Eo(t){return{explicit:!0,value:t}}function wi(t){return{explicit:!1,value:t}}function Tst(t){return(e,n,r,i)=>{const s=t(e.value,n.value);return s>0?e:s<0?n:cE(e,n,r,i)}}function cE(t,e,n,r){return t.explicit&&e.explicit&&K(TPt(n,r,t.value,e.value)),t}function il(t,e,n,r,i=cE){return t===void 0||t.value===void 0?e:t.explicit&&!e.explicit?t:e.explicit&&!t.explicit?e:ki(t.value,e.value)?t:i(t,e,n,r)}class Kjt extends ju{constructor(e={},n={},r=!1){super(e,n),this.explicit=e,this.implicit=n,this.parseNothing=r}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function Np(t){return X(t,"url")}function ay(t){return X(t,"values")}function kst(t){return X(t,"name")&&!Np(t)&&!ay(t)&&!kc(t)}function kc(t){return t&&(Mst(t)||Cst(t)||qR(t))}function Mst(t){return X(t,"sequence")}function Cst(t){return X(t,"sphere")}function qR(t){return X(t,"graticule")}var Ke;(function(t){t[t.Raw=0]="Raw",t[t.Main=1]="Main",t[t.Row=2]="Row",t[t.Column=3]="Column",t[t.Lookup=4]="Lookup",t[t.PreFilterInvalid=5]="PreFilterInvalid",t[t.PostFilterInvalid=6]="PostFilterInvalid"})(Ke||(Ke={}));function Ist({invalid:t,isPath:e}){switch($it(t,{isPath:e})){case"filter":return{marks:"exclude-invalid-values",scales:"exclude-invalid-values"};case"break-paths-show-domains":return{marks:e?"include-invalid-values":"exclude-invalid-values",scales:"include-invalid-values"};case"break-paths-filter-domains":return{marks:e?"include-invalid-values":"exclude-invalid-values",scales:"exclude-invalid-values"};case"show":return{marks:"include-invalid-values",scales:"include-invalid-values"}}}function Qjt(t){const{marks:e,scales:n}=Ist(t);return e===n?Ke.Main:n==="include-invalid-values"?Ke.PreFilterInvalid:Ke.PostFilterInvalid}class ve{constructor(e,n){this.debugName=n,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,n){if(this._children.includes(e)){K(ePt);return}n!==void 0?this._children.splice(n,0,e):this._children.push(e)}removeChild(e){const n=this._children.indexOf(e);return this._children.splice(n,1),n}remove(){let e=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,e++)}insertAsParentOf(e){const n=e.parent;n.removeChild(this),this.parent=n,e.parent=this}swapWithParent(){const e=this._parent,n=e.parent;for(const i of this._children)i.parent=e;this._children=[],e.removeChild(this);const r=e.parent.removeChild(e);this._parent=n,n.addChild(this,r),e.parent=this}}class ai extends ve{clone(){const e=new this.constructor;return e.debugName=`clone_${this.debugName}`,e._source=this._source,e._name=`clone_${this._name}`,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}constructor(e,n,r,i){super(e,n),this.type=r,this.refCounts=i,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${Trt()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}function C$(t){return t.as!==void 0}function K9(t){return`${t}_end`}class qo extends ve{clone(){return new qo(null,Rt(this.timeUnits))}constructor(e,n){super(e),this.timeUnits=n}static makeFromEncoding(e,n){const r=n.reduceFieldDef((i,s,o)=>{const{field:a,timeUnit:u}=s;if(u){let c;if(xd(u)){if(Ge(n)){const{mark:l,markDef:f,config:d}=n,h=rl({fieldDef:s,markDef:f,config:d});(oy(l)||h)&&(c={timeUnit:Dn(u),field:a})}}else c={as:nt(s,{forAs:!0}),field:a,timeUnit:u};if(Ge(n)){const{mark:l,markDef:f,config:d}=n,h=rl({fieldDef:s,markDef:f,config:d});oy(l)&&fn(o)&&h!==.5&&(c.rectBandPosition=h)}c&&(i[Qt(c)]=c)}return i},{});return xe(r)?null:new qo(e,r)}static makeFromTransform(e,n){const{timeUnit:r,...i}={...n},s=Dn(r),o={...i,timeUnit:s};return new qo(e,{[Qt(o)]:o})}merge(e){this.timeUnits={...this.timeUnits};for(const n in e.timeUnits)this.timeUnits[n]||(this.timeUnits[n]=e.timeUnits[n]);for(const n of e.children)e.removeChild(n),n.parent=this;e.remove()}removeFormulas(e){const n={};for(const[r,i]of el(this.timeUnits)){const s=C$(i)?i.as:`${i.field}_end`;e.has(s)||(n[r]=i)}this.timeUnits=n}producedFields(){return new Set(Zn(this.timeUnits).map(e=>C$(e)?e.as:K9(e.field)))}dependentFields(){return new Set(Zn(this.timeUnits).map(e=>e.field))}hash(){return`TimeUnit ${Qt(this.timeUnits)}`}assemble(){const e=[];for(const n of Zn(this.timeUnits)){const{rectBandPosition:r}=n,i=Dn(n.timeUnit);if(C$(n)){const{field:s,as:o}=n,{unit:a,utc:u,...c}=i,l=[o,`${o}_end`];e.push({field:xs(s),type:"timeunit",...a?{units:HS(a)}:{},...u?{timezone:"utc"}:{},...c,as:l}),e.push(...Q9(l,r,i))}else if(n){const{field:s}=n,o=s.replaceAll("\\.","."),a=Fst({timeUnit:i,field:o}),u=K9(o);e.push({type:"formula",expr:a,as:u}),e.push(...Q9([o,u],r,i))}}return e}}const lE="offsetted_rect_start",fE="offsetted_rect_end";function Fst({timeUnit:t,field:e,reverse:n}){const{unit:r,utc:i}=t,s=uit(r),{part:o,step:a}=dit(s,t.step);return`${i?"utcOffset":"timeOffset"}('${o}', ${ye(e)}, ${n?-a:a})`}function Q9([t,e],n,r){if(n!==void 0&&n!==.5){const i=ye(t),s=ye(e);return[{type:"formula",expr:J9([Fst({timeUnit:r,field:t,reverse:!0}),i],n+.5),as:`${t}_${lE}`},{type:"formula",expr:J9([i,s],n+.5),as:`${t}_${fE}`}]}return[]}function J9([t,e],n){return`${1-n} * ${t} + ${n} * ${e}`}const k1="_tuple_fields";class Jjt{constructor(...e){this.items=e,this.hasChannel={},this.hasField={},this.hasSelectionId=!1}}const Zjt={defined:()=>!0,parse:(t,e,n)=>{const r=e.name,i=e.project??(e.project=new Jjt),s={},o={},a=new Set,u=(p,g)=>{const m=g==="visual"?p.channel:p.field;let y=qe(`${r}_${m}`);for(let b=1;a.has(y);b++)y=qe(`${r}_${m}_${b}`);return a.add(y),{[g]:y}},c=e.type,l=t.config.selection[c],f=n.value!==void 0?ot(n.value):null;let{fields:d,encodings:h}=st(n.select)?n.select:{};if(!d&&!h&&f){for(const p of f)if(st(p))for(const g of H(p))dBt(g)?(h||(h=[])).push(g):c==="interval"?(K(HBt),h=l.encodings):(d??(d=[])).push(g)}!d&&!h&&(h=l.encodings,"fields"in l&&(d=l.fields));for(const p of h??[]){const g=t.fieldDef(p);if(g){let m=g.field;if(g.aggregate){K(PBt(p,g.aggregate));continue}else if(!m){K(_9(p));continue}if(g.timeUnit&&!xd(g.timeUnit)){m=t.vgField(p);const y={timeUnit:g.timeUnit,as:m,field:g.field};o[Qt(y)]=y}if(!s[m]){const y=c==="interval"&&Sa(p)&&Xs(t.getScaleComponent(p).get("type"))?"R":g.bin?"R-RE":"E",b={field:m,channel:p,type:y,index:i.items.length};b.signals={...u(b,"data"),...u(b,"visual")},i.items.push(s[m]=b),i.hasField[m]=s[m],i.hasSelectionId=i.hasSelectionId||m===Js,Nrt(p)?(b.geoChannel=p,b.channel=Frt(p),i.hasChannel[b.channel]=s[m]):i.hasChannel[p]=s[m]}}else K(_9(p))}for(const p of d??[]){if(i.hasField[p])continue;const g={type:"E",field:p,index:i.items.length};g.signals={...u(g,"data")},i.items.push(g),i.hasField[p]=g,i.hasSelectionId=i.hasSelectionId||p===Js}f&&(e.init=f.map(p=>i.items.map(g=>st(p)?p[g.geoChannel||g.channel]!==void 0?p[g.geoChannel||g.channel]:p[g.field]:p))),xe(o)||(i.timeUnit=new qo(null,o))},signals:(t,e,n)=>{const r=e.name+k1;return n.filter(s=>s.name===r).length>0||e.project.hasSelectionId?n:n.concat({name:r,value:e.project.items.map(Dst)})}},Nst="_curr",Ov="anim_value",ah="anim_clock",aM="eased_anim_clock",Ost="min_extent",Rst="max_range_extent",I$="last_tick_at",F$="is_playing",tqt=1/60*1e3,eqt=(t,e)=>[{name:aM,update:ah},{name:`${t}_domain`,init:`domain('${e}')`},{name:Ost,init:`extent(${t}_domain)[0]`},{name:Rst,init:`extent(range('${e}'))[1]`},{name:Ov,update:`invert('${e}', ${aM})`}],nqt={defined:t=>t.type==="point",topLevelSignals:(t,e,n)=>(Wo(e)&&(n=n.concat([{name:ah,init:"0",on:[{events:{type:"timer",throttle:tqt},update:`${F$} ? (${ah} + (now() - ${I$}) > ${Rst} ? 0 : ${ah} + (now() - ${I$})) : ${ah}`}]},{name:I$,init:"now()",on:[{events:[{signal:ah},{signal:F$}],update:"now()"}]},{name:F$,init:"true"}])),n),signals:(t,e,n)=>{const r=e.name,i=r+k1,s=e.project,o="(item().isVoronoi ? datum.datum : datum)",a=Zn(t.component.selection??{}).reduce((l,f)=>f.type==="interval"?l.concat(f.name+zh):l,[]).map(l=>`indexof(item().mark.name, '${l}') < 0`).join(" && "),u=`datum && item().mark.marktype !== 'group' && indexof(item().mark.role, 'legend') < 0${a?` && ${a}`:""}`;let c=`unit: ${xf(t)}, `;if(e.project.hasSelectionId)c+=`${Js}: ${o}[${J(Js)}]`;else if(Wo(e))c+=`fields: ${i}, values: [${Ov} ? ${Ov} : ${Ost}]`;else{const l=s.items.map(f=>{const d=t.fieldDef(f.channel);return d!=null&&d.bin?`[${o}[${J(t.vgField(f.channel,{}))}], ${o}[${J(t.vgField(f.channel,{binSuffix:"end"}))}]]`:`${o}[${J(f.field)}]`}).join(", ");c+=`fields: ${i}, values: [${l}]`}if(Wo(e))return n.concat(eqt(e.name,t.scaleName(vl)),[{name:r+Su,on:[{events:[{signal:aM},{signal:Ov}],update:`{${c}}`,force:!0}]}]);{const l=e.events;return n.concat([{name:r+Su,on:l?[{events:l,update:`${u} ? {${c}} : null`,force:!0}]:[]}])}}};function Dst(t){const{signals:e,hasLegend:n,index:r,...i}=t;return i.field=xs(i.field),i}function Zf(t,e=!0,n=Er){if(W(t)){const r=t.map(i=>Zf(i,e,n));return e?`[${r.join(", ")}]`:r}else if(wd(t))return n(e?Xf(t):JPt(t));return e?n(_e(t)):t}function rqt(t,e){for(const n of Zn(t.component.selection??{})){const r=n.name;let i=`${r}${Su}, ${n.resolve==="global"?"true":`{unit: ${xf(t)}}`}`;for(const s of hE)s.defined(n)&&(s.signals&&(e=s.signals(t,n,e)),s.modifyExpr&&(i=s.modifyExpr(t,n,i)));e.push({name:r+Cqt,on:[{events:{signal:n.name+Su},update:`modify(${J(n.name+td)}, ${i})`}]})}return WR(e)}function iqt(t,e){if(t.component.selection&&H(t.component.selection).length){const n=J(t.getName("cell"));e.unshift({name:"facet",value:{},on:[{events:yl("pointermove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return WR(e)}function sqt(t,e){let n=!1;for(const r of Zn(t.component.selection??{})){const i=r.name,s=J(i+td);if(e.filter(a=>a.name===i).length===0){const a=r.resolve==="global"?"union":r.resolve,u=r.type==="point"?", true, true)":")";e.push({name:r.name,update:`${Zst}(${s}, ${J(a)}${u}`})}n=!0;for(const a of hE)a.defined(r)&&a.topLevelSignals&&(e=a.topLevelSignals(t,r,e))}return n&&e.filter(i=>i.name==="unit").length===0&&e.unshift({name:"unit",value:{},on:[{events:"pointermove",update:"isTuple(group()) ? group() : unit"}]}),WR(e)}function oqt(t,e){const n=[],r=[],i=xf(t,{escape:!1});for(const s of Zn(t.component.selection??{})){const o={name:s.name+td};if(s.project.hasSelectionId&&(o.transform=[{type:"collect",sort:{field:Js}}]),s.init){const u=s.project.items.map(Dst);o.values=s.project.hasSelectionId?s.init.map(c=>({unit:i,[Js]:Zf(c,!1)[0]})):s.init.map(c=>({unit:i,fields:u,values:Zf(c,!1)}))}if([...n,...e].filter(u=>u.name===s.name+td).length||n.push(o),Wo(s)&&e.length){const u=t.lookupDataSource(t.getDataName(Ke.Main)),c=e.find(f=>f.name===u),l=c.transform.find(f=>f.type==="filter"&&f.expr.includes("vlSelectionTest"));if(l){c.transform=c.transform.filter(d=>d!==l);const f={name:c.name+Nst,source:c.name,transform:[l]};r.push(f)}}}return n.concat(e,r)}function Lst(t,e){for(const n of Zn(t.component.selection??{}))for(const r of hE)r.defined(n)&&r.marks&&(e=r.marks(t,n,e));return e}function aqt(t,e){for(const n of t.children)Ge(n)&&(e=Lst(n,e));return e}function uqt(t,e,n,r){const i=iot(t,e.param,e);return{signal:Xs(n.get("type"))&&W(r)&&r[0]>r[1]?`isValid(${i}) && reverse(${i})`:i}}function WR(t){return t.map(e=>(e.on&&!e.on.length&&delete e.on,e))}const lu={defined:t=>t.type==="interval"&&t.resolve==="global"&&t.bind&&t.bind==="scales",parse:(t,e)=>{const n=e.scales=[];for(const r of e.project.items){const i=r.channel;if(!Sa(i))continue;const s=t.getScaleComponent(i),o=s?s.get("type"):void 0;if(o=="sequential"&&K(qBt),!s||!Xs(o)){K(jBt);continue}s.set("selectionExtent",{param:e.name,field:r.field},!0),n.push(r)}},topLevelSignals:(t,e,n)=>{const r=e.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!t.parent||cM(t)||r.length===0)return n;const i=n.find(o=>o.name===e.name);let s=i.update;if(s.includes(Zst))i.update=`{${r.map(o=>`${J(xs(o.field))}: ${o.signals.data}`).join(", ")}}`;else{for(const o of r){const a=`${J(xs(o.field))}: ${o.signals.data}`;s.includes(a)||(s=`${s.substring(0,s.length-1)}, ${a}}`)}i.update=s}return n.concat(r.map(o=>({name:o.signals.data})))},signals:(t,e,n)=>{if(t.parent&&!cM(t))for(const r of e.scales){const i=n.find(s=>s.name===r.signals.data);i.push="outer",delete i.value,delete i.update}return n}};function uM(t,e){return`domain(${J(t.scaleName(e))})`}function cM(t){return t.parent&&Mg(t.parent)&&(!t.parent.parent||cM(t.parent.parent))}const zh="_brush",Bst="_scale_trigger",im="geo_interval_init_tick",Pst="_init",cqt="_center",lqt={defined:t=>t.type==="interval",parse:(t,e,n)=>{var r;if(t.hasProjection){const i={...st(n.select)?n.select:{}};i.fields=[Js],i.encodings||(i.encodings=n.value?H(n.value):[fo,lo]),n.select={type:"interval",...i}}if(e.translate&&!lu.defined(e)){const i=`!event.item || event.item.mark.name !== ${J(e.name+zh)}`;for(const s of e.events){if(!s.between){K(`${s} is not an ordered event stream for interval selections.`);continue}const o=ot((r=s.between[0]).filter??(r.filter=[]));o.includes(i)||o.push(i)}}},signals:(t,e,n)=>{const r=e.name,i=r+Su,s=Zn(e.project.hasChannel).filter(a=>a.channel===We||a.channel===zn),o=e.init?e.init[0]:null;if(n.push(...s.reduce((a,u)=>a.concat(fqt(t,e,u,o&&o[u.index])),[])),t.hasProjection){const a=J(t.projectionName()),u=t.projectionName()+cqt,{x:c,y:l}=e.project.hasChannel,f=c&&c.signals.visual,d=l&&l.signals.visual,h=c?o&&o[c.index]:`${u}[0]`,p=l?o&&o[l.index]:`${u}[1]`,g=x=>t.getSizeSignalRef(x).signal,m=`[[${f?f+"[0]":"0"}, ${d?d+"[0]":"0"}],[${f?f+"[1]":g("width")}, ${d?d+"[1]":g("height")}]]`;o&&(n.unshift({name:r+Pst,init:`[scale(${a}, [${c?h[0]:h}, ${l?p[0]:p}]), scale(${a}, [${c?h[1]:h}, ${l?p[1]:p}])]`}),(!c||!l)&&(n.find(S=>S.name===u)||n.unshift({name:u,update:`invert(${a}, [${g("width")}/2, ${g("height")}/2])`})));const y=`intersect(${m}, {markname: ${J(t.getName("marks"))}}, unit.mark)`,b=`{unit: ${xf(t)}}`,w=`vlSelectionTuples(${y}, ${b})`,v=s.map(x=>x.signals.visual);return n.concat({name:i,on:[{events:[...v.length?[{signal:v.join(" || ")}]:[],...o?[{signal:im}]:[]],update:w}]})}else{if(!lu.defined(e)){const c=r+Bst,l=s.map(f=>{const d=f.channel,{data:h,visual:p}=f.signals,g=J(t.scaleName(d)),m=t.getScaleComponent(d).get("type"),y=Xs(m)?"+":"";return`(!isArray(${h}) || (${y}invert(${g}, ${p})[0] === ${y}${h}[0] && ${y}invert(${g}, ${p})[1] === ${y}${h}[1]))`});l.length&&n.push({name:c,value:{},on:[{events:s.map(f=>({scale:t.scaleName(f.channel)})),update:l.join(" && ")+` ? ${c} : {}`}]})}const a=s.map(c=>c.signals.data),u=`unit: ${xf(t)}, fields: ${r+k1}, values`;return n.concat({name:i,...o?{init:`{${u}: ${Zf(o)}}`}:{},...a.length?{on:[{events:[{signal:a.join(" || ")}],update:`${a.join(" && ")} ? {${u}: [${a}]} : null`}]}:{}})}},topLevelSignals:(t,e,n)=>(Ge(t)&&t.hasProjection&&e.init&&(n.filter(i=>i.name===im).length||n.unshift({name:im,value:null,on:[{events:"timer{1}",update:`${im} === null ? {} : ${im}`}]})),n),marks:(t,e,n)=>{const r=e.name,{x:i,y:s}=e.project.hasChannel,o=i==null?void 0:i.signals.visual,a=s==null?void 0:s.signals.visual,u=`data(${J(e.name+td)})`;if(lu.defined(e)||!i&&!s)return n;const c={x:i!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:i!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(e.resolve==="global")for(const m of H(c))c[m]=[{test:`${u}.length && ${u}[0].unit === ${xf(t)}`,...c[m]},{value:0}];const{fill:l,fillOpacity:f,cursor:d,...h}=e.mark,p=H(h).reduce((m,y)=>(m[y]=[{test:[i!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(b=>b).join(" && "),value:h[y]},{value:null}],m),{}),g=d??(e.translate?"move":null);return[{name:`${r+zh}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:l},fillOpacity:{value:f}},update:c}},...n,{name:r+zh,type:"rect",clip:!0,encode:{enter:{...g?{cursor:{value:g}}:{},fill:{value:"transparent"}},update:{...c,...p}}}]}};function fqt(t,e,n,r){const i=!t.hasProjection,s=n.channel,o=n.signals.visual,a=J(i?t.scaleName(s):t.projectionName()),u=d=>`scale(${a}, ${d})`,c=t.getSizeSignalRef(s===We?"width":"height").signal,l=`${s}(unit)`,f=e.events.reduce((d,h)=>[...d,{events:h.between[0],update:`[${l}, ${l}]`},{events:h,update:`[${o}[0], clamp(${l}, 0, ${c})]`}],[]);if(i){const d=n.signals.data,h=lu.defined(e),p=t.getScaleComponent(s),g=p?p.get("type"):void 0,m=r?{init:Zf(r,!0,u)}:{value:[]};return f.push({events:{signal:e.name+Bst},update:Xs(g)?`[${u(`${d}[0]`)}, ${u(`${d}[1]`)}]`:"[0, 0]"}),h?[{name:d,on:[]}]:[{name:o,...m,on:f},{name:d,...r?{init:Zf(r)}:{},on:[{events:{signal:o},update:`${o}[0] === ${o}[1] ? null : invert(${a}, ${o})`}]}]}else{const d=s===We?0:1,h=e.name+Pst,p=r?{init:`[${h}[0][${d}], ${h}[1][${d}]]`}:{value:[]};return[{name:o,...p,on:f}]}}function Ag({model:t,channelDef:e,vgChannel:n,invalidValueRef:r,mainRefFn:i}){const s=E1(e)&&e.condition;let o=[];s&&(o=ot(s).map(c=>{const l=i(c);if(Jzt(c)){const{param:f,empty:d}=c;return{test:rot(t,{param:f,empty:d}),...l}}else return{test:d2(t,c.test),...l}})),r!==void 0&&o.push(r);const a=i(e);return a!==void 0&&o.push(a),o.length>1||o.length===1&&o[0].test?{[n]:o}:o.length===1?{[n]:o[0]}:{}}function VR(t,e="text"){const n=t.encoding[e];return Ag({model:t,channelDef:n,vgChannel:e,mainRefFn:r=>dE(r,t.config),invalidValueRef:void 0})}function dE(t,e,n="datum"){if(t){if(Ks(t))return Re(t.value);if(Bt(t)){const{format:r,formatType:i}=o2(t);return AR({fieldOrDatumDef:t,format:r,formatType:i,expr:n,config:e})}}}function zst(t,e={}){const{encoding:n,markDef:r,config:i,stack:s}=t,o=n.tooltip;if(W(o))return{tooltip:Z9({tooltip:o},s,i,e)};{const a=e.reactiveGeom?"datum.datum":"datum";return Ag({model:t,channelDef:o,vgChannel:"tooltip",mainRefFn:c=>{const l=dE(c,i,a);if(l)return l;if(c===null)return;let f=we("tooltip",r,i);if(f===!0&&(f={content:"encoding"}),at(f))return{value:f};if(st(f))return gt(f)?f:f.content==="encoding"?Z9(n,s,i,e):{signal:a}},invalidValueRef:void 0})}}function Ust(t,e,n,{reactiveGeom:r}={}){const i={...n,...n.tooltipFormat},s=new Set,o=r?"datum.datum":"datum",a=[];function u(l,f){const d=yd(f),h=Gr(l)?l:{...l,type:t[d].type},p=h.title||MR(h,i),g=ot(p).join(", ").replaceAll(/"/g,'\\"');let m;if(fn(f)){const y=f==="x"?"x2":"y2",b=Qs(t[y]);if(Un(h.bin)&&b){const w=nt(h,{expr:o}),v=nt(b,{expr:o}),{format:x,formatType:S}=o2(h);m=_1(w,v,x,S,i),s.add(y)}}if((fn(f)||f===As||f===co)&&e&&e.fieldChannel===f&&e.offset==="normalize"){const{format:y,formatType:b}=o2(h);m=AR({fieldOrDatumDef:h,format:y,formatType:b,expr:o,config:i,normalizeStack:!0}).signal}m??(m=dE(h,i,o).signal),a.push({channel:f,key:g,value:m})}IR(t,(l,f)=>{Q(l)?u(l,f):nE(l)&&u(l.condition,f)});const c={};for(const{channel:l,key:f,value:d}of a)!s.has(l)&&!c[f]&&(c[f]=d);return c}function Z9(t,e,n,{reactiveGeom:r}={}){const i=Ust(t,e,n,{reactiveGeom:r}),s=el(i).map(([o,a])=>`"${o}": ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function dqt(t){const{markDef:e,config:n}=t,r=we("aria",e,n);return r===!1?{}:{...r?{aria:r}:{},...hqt(t),...pqt(t)}}function hqt(t){const{mark:e,markDef:n,config:r}=t;if(r.aria===!1)return{};const i=we("ariaRoleDescription",n,r);return i!=null?{ariaRoleDescription:{value:i}}:ft(RBt,e)?{}:{ariaRoleDescription:{value:e}}}function pqt(t){const{encoding:e,markDef:n,config:r,stack:i}=t,s=e.description;if(s)return Ag({model:t,channelDef:s,vgChannel:"description",mainRefFn:u=>dE(u,t.config),invalidValueRef:void 0});const o=we("description",n,r);if(o!=null)return{description:Re(o)};if(r.aria===!1)return{};const a=Ust(e,i,r);if(!xe(a))return{description:{signal:el(a).map(([u,c],l)=>`"${l>0?"; ":""}${u}: " + (${c})`).join(" + ")}}}function Vn(t,e,n={}){const{markDef:r,encoding:i,config:s}=e,{vgChannel:o}=n;let{defaultRef:a,defaultValue:u}=n;const c=i[t];a===void 0&&(u??(u=we(t,r,s,{vgChannel:o,ignoreVgConfig:!E1(c)})),u!==void 0&&(a=Re(u)));const l={markDef:r,config:s,scaleName:e.scaleName(t),scale:e.getScaleComponent(t)},f=kit({...l,scaleChannel:t,channelDef:c});return Ag({model:e,channelDef:c,vgChannel:o??t,invalidValueRef:f,mainRefFn:h=>ER({...l,channel:t,channelDef:h,stack:null,defaultRef:a})})}function jst(t,e={filled:void 0}){const{markDef:n,encoding:r,config:i}=t,{type:s}=n,o=e.filled??we("filled",n,i),a=Xt(["bar","point","circle","square","geoshape"],s)?"transparent":void 0,u=we(o===!0?"color":void 0,n,i,{vgChannel:"fill"})??i.mark[o===!0&&"color"]??a,c=we(o===!1?"color":void 0,n,i,{vgChannel:"stroke"})??i.mark[o===!1&&"color"],l=o?"fill":"stroke",f={...u?{fill:Re(u)}:{},...c?{stroke:Re(c)}:{}};return n.color&&(o?n.fill:n.stroke)&&K(Zrt("property",{fill:"fill"in n,stroke:"stroke"in n})),{...f,...Vn("color",t,{vgChannel:l,defaultValue:o?u:c}),...Vn("fill",t,{defaultValue:r.fill?u:void 0}),...Vn("stroke",t,{defaultValue:r.stroke?c:void 0})}}function gqt(t){const{encoding:e,mark:n}=t,r=e.order;return!Al(n)&&Ks(r)?Ag({model:t,channelDef:r,vgChannel:"zindex",mainRefFn:i=>Re(i.value),invalidValueRef:void 0}):{}}function Op({channel:t,markDef:e,encoding:n={},model:r,bandPosition:i}){const s=`${t}Offset`,o=e[s],a=n[s];if((s==="xOffset"||s==="yOffset")&&a)return{offsetType:"encoding",offset:ER({channel:s,channelDef:a,markDef:e,config:r==null?void 0:r.config,scaleName:r.scaleName(s),scale:r.getScaleComponent(s),stack:null,defaultRef:Re(o),bandPosition:i})};const u=e[s];return u?{offsetType:"visual",offset:u}:{}}function Br(t,e,{defaultPos:n,vgChannel:r}){const{encoding:i,markDef:s,config:o,stack:a}=e,u=i[t],c=i[_a(t)],l=e.scaleName(t),f=e.getScaleComponent(t),{offset:d,offsetType:h}=Op({channel:t,markDef:s,encoding:i,model:e,bandPosition:.5}),p=GR({model:e,defaultPos:n,channel:t,scaleName:l,scale:f}),g=!u&&fn(t)&&(i.latitude||i.longitude)?{field:e.getName(t)}:mqt({channel:t,channelDef:u,channel2Def:c,markDef:s,config:o,scaleName:l,scale:f,stack:a,offset:d,defaultRef:p,bandPosition:h==="encoding"?0:void 0});return g?{[r||t]:g}:void 0}function mqt(t){const{channel:e,channelDef:n,scaleName:r,stack:i,offset:s,markDef:o}=t;if(Bt(n)&&i&&e===i.fieldChannel){if(Q(n)){let a=n.bandPosition;if(a===void 0&&o.type==="text"&&(e==="radius"||e==="theta")&&(a=.5),a!==void 0)return r2({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",bandPosition:a,offset:s})}return vf(n,r,{suffix:"end"},{offset:s})}return SR(t)}function GR({model:t,defaultPos:e,channel:n,scaleName:r,scale:i}){const{markDef:s,config:o}=t;return()=>{const a=yd(n),u=nl(n),c=we(n,s,o,{vgChannel:u});if(c!==void 0)return u0(n,c);switch(e){case"zeroOrMin":return tB({scaleName:r,scale:i,mode:"zeroOrMin",mainChannel:a,config:o});case"zeroOrMax":return tB({scaleName:r,scale:i,mode:{zeroOrMax:{widthSignal:t.width.signal,heightSignal:t.height.signal}},mainChannel:a,config:o});case"mid":return{...t[mi(n)],mult:.5}}}}function tB({mainChannel:t,config:e,...n}){const r=Tit(n),{mode:i}=n;if(r)return r;switch(t){case"radius":{if(i==="zeroOrMin")return{value:0};const{widthSignal:s,heightSignal:o}=i.zeroOrMax;return{signal:`min(${s},${o})/2`}}case"theta":return i==="zeroOrMin"?{value:0}:{signal:"2*PI"};case"x":return i==="zeroOrMin"?{value:0}:{field:{group:"width"}};case"y":return i==="zeroOrMin"?{field:{group:"height"}}:{value:0}}}const yqt={left:"x",center:"xc",right:"x2"},bqt={top:"y",middle:"yc",bottom:"y2"};function qst(t,e,n,r="middle"){if(t==="radius"||t==="theta")return nl(t);const i=t==="x"?"align":"baseline",s=we(i,e,n);let o;return gt(s)?(K(mPt(i)),o=void 0):o=s,t==="x"?yqt[o||(r==="top"?"left":"center")]:bqt[o||r]}function l2(t,e,{defaultPos:n,defaultPos2:r,range:i}){return i?Wst(t,e,{defaultPos:n,defaultPos2:r}):Br(t,e,{defaultPos:n})}function Wst(t,e,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:s}=e,o=_a(t),a=mi(t),u=vqt(e,r,o),c=u[a]?qst(t,i,s):nl(t);return{...Br(t,e,{defaultPos:n,vgChannel:c}),...u}}function vqt(t,e,n){const{encoding:r,mark:i,markDef:s,stack:o,config:a}=t,u=yd(n),c=mi(n),l=nl(n),f=r[u],d=t.scaleName(u),h=t.getScaleComponent(u),{offset:p}=n in r||n in s?Op({channel:n,markDef:s,encoding:r,model:t}):Op({channel:u,markDef:s,encoding:r,model:t});if(!f&&(n==="x2"||n==="y2")&&(r.latitude||r.longitude)){const m=mi(n),y=t.markDef[m];return y!=null?{[m]:{value:y}}:{[l]:{field:t.getName(n)}}}const g=wqt({channel:n,channelDef:f,channel2Def:r[n],markDef:s,config:a,scaleName:d,scale:h,stack:o,offset:p,defaultRef:void 0});return g!==void 0?{[l]:g}:Ib(n,s)||Ib(n,{[n]:Kk(n,s,a.style),[c]:Kk(c,s,a.style)})||Ib(n,a[i])||Ib(n,a.mark)||{[l]:GR({model:t,defaultPos:e,channel:n,scaleName:d,scale:h})()}}function wqt({channel:t,channelDef:e,channel2Def:n,markDef:r,config:i,scaleName:s,scale:o,stack:a,offset:u,defaultRef:c}){return Bt(e)&&a&&t.charAt(0)===a.fieldChannel.charAt(0)?vf(e,s,{suffix:"start"},{offset:u}):SR({channel:t,channelDef:n,scaleName:s,scale:o,stack:a,markDef:r,config:i,offset:u,defaultRef:c})}function Ib(t,e){const n=mi(t),r=nl(t);if(e[r]!==void 0)return{[r]:u0(t,e[r])};if(e[t]!==void 0)return{[r]:u0(t,e[t])};if(e[n]){const i=e[n];if(Qf(i))K(lPt(n));else return{[n]:u0(t,i)}}}function _u(t,e){const{config:n,encoding:r,markDef:i}=t,s=i.type,o=_a(e),a=mi(e),u=r[e],c=r[o],l=t.getScaleComponent(e),f=l?l.get("type"):void 0,d=i.orient,h=r[a]??r.size??we("size",i,n,{vgChannel:a}),p=Lrt(e),g=s==="bar"&&(e==="x"?d==="vertical":d==="horizontal")||s==="tick"&&(e==="y"?d==="vertical":d==="horizontal");return Q(u)&&(Ne(u.bin)||Un(u.bin)||u.timeUnit&&!c)&&!(h&&!Qf(h))&&!r[p]&&!Bn(f)?Sqt({fieldDef:u,fieldDef2:c,channel:e,model:t}):(Bt(u)&&Bn(f)||g)&&!c?_qt(u,e,t):Wst(e,t,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function xqt(t,e,n,r,i,s,o){if(Qf(i))if(n){const u=n.get("type");if(u==="band"){let c=`bandwidth('${e}')`;i.band!==1&&(c=`${i.band} * ${c}`);const l=ia("minBandSize",{type:o},r);return{signal:l?`max(${Ps(l)}, ${c})`:c}}else i.band!==1&&(K(wPt(u)),i=void 0)}else return{mult:i.band,field:{group:t}};else{if(gt(i))return i;if(i)return{value:i}}if(n){const u=n.get("range");if(vd(u)&&ue(u.step))return{value:u.step-2}}if(!s){const{bandPaddingInner:u,barBandPaddingInner:c,rectBandPaddingInner:l,tickBandPaddingInner:f}=r.scale,d=ln(u,o==="tick"?f:o==="bar"?c:l);if(gt(d))return{signal:`(1 - (${d.signal})) * ${t}`};if(ue(d))return{signal:`${1-d} * ${t}`}}return{value:rM(r.view,t)-2}}function _qt(t,e,n){var A,$;const{markDef:r,encoding:i,config:s,stack:o}=n,a=r.orient,u=n.scaleName(e),c=n.getScaleComponent(e),l=mi(e),f=_a(e),d=Lrt(e),h=n.scaleName(d),p=n.getScaleComponent(KO(e)),g=r.type==="tick"||a==="horizontal"&&e==="y"||a==="vertical"&&e==="x";let m;(i.size||r.size)&&(g?m=Vn("size",n,{vgChannel:l,defaultRef:Re(r.size)}):K(EPt(r.type)));const y=!!m,b=Rit({channel:e,fieldDef:t,markDef:r,config:s,scaleType:(A=c||p)==null?void 0:A.get("type"),useVlSizeChannel:g});m=m||{[l]:xqt(l,h||u,p||c,s,b,!!t,r.type)};const w=(($=c||p)==null?void 0:$.get("type"))==="band"&&Qf(b)&&!y?"top":"middle",v=qst(e,r,s,w),x=v==="xc"||v==="yc",{offset:S,offsetType:_}=Op({channel:e,markDef:r,encoding:i,model:n,bandPosition:x?.5:0}),E=SR({channel:e,channelDef:t,markDef:r,config:s,scaleName:u,scale:c,stack:o,offset:S,defaultRef:GR({model:n,defaultPos:"mid",channel:e,scaleName:u,scale:c}),bandPosition:x?_==="encoding"?0:.5:gt(b)?{signal:`(1-${b})/2`}:Qf(b)?(1-b.band)/2:0});if(l)return{[v]:E,...m};{const T=nl(f),C=m[l],F=S?{...C,offset:S}:C;return{[v]:E,[T]:W(E)?[E[0],{...E[1],offset:F}]:{...E,offset:F}}}}function eB(t,e,n,r,i,s,o){if(Irt(t))return 0;const a=t==="x"||t==="y2",u=a?-e/2:e/2;if(gt(n)||gt(i)||gt(r)||s){const c=Ps(n),l=Ps(i),f=Ps(r),d=Ps(s),p=s?`(${o} < ${d} ? ${a?"":"-"}0.5 * (${d} - (${o})) : ${u})`:u,g=f?`${f} + `:"",m=c?`(${c} ? -1 : 1) * `:"",y=l?`(${l} + ${p})`:p;return{signal:g+m+y}}else return i=i||0,r+(n?-i-u:+i+u)}function Sqt({fieldDef:t,fieldDef2:e,channel:n,model:r}){var $;const{config:i,markDef:s,encoding:o}=r,a=r.getScaleComponent(n),u=r.scaleName(n),c=a?a.get("type"):void 0,l=a.get("reverse"),f=Rit({channel:n,fieldDef:t,markDef:s,config:i,scaleType:c}),d=($=r.component.axes[n])==null?void 0:$[0],h=(d==null?void 0:d.get("translate"))??.5,p=fn(n)?we("binSpacing",s,i)??0:0,g=_a(n),m=nl(n),y=nl(g),b=ia("minBandSize",s,i),{offset:w}=Op({channel:n,markDef:s,encoding:o,model:r,bandPosition:0}),{offset:v}=Op({channel:g,markDef:s,encoding:o,model:r,bandPosition:0}),x=Gzt({fieldDef:t,scaleName:u}),S=eB(n,p,l,h,w,b,x),_=eB(g,p,l,h,v??w,b,x),E=gt(f)?{signal:`(1-${f.signal})/2`}:Qf(f)?(1-f.band)/2:.5,A=rl({fieldDef:t,fieldDef2:e,markDef:s,config:i});if(Ne(t.bin)||t.timeUnit){const T=t.timeUnit&&A!==.5;return{[y]:nB({fieldDef:t,scaleName:u,bandPosition:E,offset:_,useRectOffsetField:T}),[m]:nB({fieldDef:t,scaleName:u,bandPosition:gt(E)?{signal:`1-${E.signal}`}:1-E,offset:S,useRectOffsetField:T})}}else if(Un(t.bin)){const T=vf(t,u,{},{offset:_});if(Q(e))return{[y]:T,[m]:vf(e,u,{},{offset:S})};if(bd(t.bin)&&t.bin.step)return{[y]:T,[m]:{signal:`scale("${u}", ${nt(t,{expr:"datum"})} + ${t.bin.step})`,offset:S}}}K(nit(g))}function nB({fieldDef:t,scaleName:e,bandPosition:n,offset:r,useRectOffsetField:i}){return r2({scaleName:e,fieldOrDatumDef:t,bandPosition:n,offset:r,...i?{startSuffix:lE,endSuffix:fE}:{}})}const Eqt=new Set(["aria","width","height"]);function $s(t,e){const{fill:n=void 0,stroke:r=void 0}=e.color==="include"?jst(t):{};return{...Aqt(t.markDef,e),...rB("fill",n),...rB("stroke",r),...Vn("opacity",t),...Vn("fillOpacity",t),...Vn("strokeOpacity",t),...Vn("strokeWidth",t),...Vn("strokeDash",t),...gqt(t),...zst(t),...VR(t,"href"),...dqt(t)}}function rB(t,e){return e?{[t]:e}:{}}function Aqt(t,e){return OBt.reduce((n,r)=>(!Eqt.has(r)&&X(t,r)&&e[r]!=="ignore"&&(n[r]=Re(t[r])),n),{})}function YR(t){const{config:e,markDef:n}=t,r=new Set;if(t.forEachFieldDef((i,s)=>{var c;let o;if(!Sa(s)||!(o=t.getScaleType(s)))return;const a=VS(i.aggregate),u=_R({scaleChannel:s,markDef:n,config:e,scaleType:o,isCountAggregate:a});if(qzt(u)){const l=t.vgField(s,{expr:"datum",binSuffix:(c=t.stack)!=null&&c.impute?"mid":void 0});l&&r.add(l)}}),r.size>0)return{defined:{signal:[...r].map(s=>XS(s,!0)).join(" && ")}}}function iB(t,e){if(e!==void 0)return{[t]:Re(e)}}const N$="voronoi",Vst={defined:t=>t.type==="point"&&t.nearest,parse:(t,e)=>{if(e.events)for(const n of e.events)n.markname=t.getName(N$)},marks:(t,e,n)=>{const{x:r,y:i}=e.project.hasChannel,s=t.mark;if(Al(s))return K(zBt(s)),n;const o={name:t.getName(N$),type:"path",interactive:!0,from:{data:t.getName("marks")},encode:{update:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0},...zst(t,{reactiveGeom:!0})}},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]}]};let a=0,u=!1;return n.forEach((c,l)=>{const f=c.name??"";f===t.component.mark[0].name?a=l:f.includes(N$)&&(u=!0)}),u||n.splice(a+1,0,o),n}},Gst={defined:t=>t.type==="point"&&t.resolve==="global"&&t.bind&&t.bind!=="scales"&&!LR(t.bind),parse:(t,e,n)=>tot(e,n),topLevelSignals:(t,e,n)=>{const r=e.name,i=e.project,s=e.bind,o=e.init&&e.init[0],a=Vst.defined(e)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach((u,c)=>{const l=qe(`${r}_${u.field}`);n.filter(d=>d.name===l).length||n.unshift({name:l,...o?{init:Zf(o[c])}:{value:null},on:e.events?[{events:e.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${J(u.field)}] : null`}]:[],bind:s[u.field]??s[u.channel]??s})}),n},signals:(t,e,n)=>{const r=e.name,i=e.project,s=n.find(c=>c.name===r+Su),o=r+k1,a=i.items.map(c=>qe(`${r}_${c.field}`)),u=a.map(c=>`${c} !== null`).join(" && ");return a.length&&(s.update=`${u} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},f2="_toggle",Yst={defined:t=>t.type==="point"&&!Wo(t)&&!!t.toggle,signals:(t,e,n)=>n.concat({name:e.name+f2,value:!1,on:[{events:e.events,update:e.toggle}]}),modifyExpr:(t,e)=>{const n=e.name+Su,r=e.name+f2;return`${r} ? null : ${n}, `+(e.resolve==="global"?`${r} ? null : true, `:`${r} ? null : {unit: ${xf(t)}}, `)+`${r} ? ${n} : null`}},$qt={defined:t=>t.clear!==void 0&&t.clear!==!1&&!Wo(t),parse:(t,e)=>{e.clear&&(e.clear=at(e.clear)?yl(e.clear,"view"):e.clear)},topLevelSignals:(t,e,n)=>{if(Gst.defined(e))for(const r of e.project.items){const i=n.findIndex(s=>s.name===qe(`${e.name}_${r.field}`));i!==-1&&n[i].on.push({events:e.clear,update:"null"})}return n},signals:(t,e,n)=>{function r(i,s){i!==-1&&n[i].on&&n[i].on.push({events:e.clear,update:s})}if(e.type==="interval")for(const i of e.project.items){const s=n.findIndex(o=>o.name===i.signals.visual);if(r(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===i.signals.data);r(o,"null")}}else{let i=n.findIndex(s=>s.name===e.name+Su);r(i,"null"),Yst.defined(e)&&(i=n.findIndex(s=>s.name===e.name+f2),r(i,"false"))}return n}},Hst={defined:t=>{const e=t.resolve==="global"&&t.bind&&LR(t.bind),n=t.project.items.length===1&&t.project.items[0].field!==Js;return e&&!n&&K(WBt),e&&n},parse:(t,e,n)=>{const r=Rt(n);if(r.select=at(r.select)?{type:r.select,toggle:e.toggle}:{...r.select,toggle:e.toggle},tot(e,r),st(n.select)&&(n.select.on||n.select.clear)){const o='event.item && indexof(event.item.mark.role, "legend") < 0';for(const a of e.events)a.filter=ot(a.filter??[]),a.filter.includes(o)||a.filter.push(o)}const i=T$(e.bind)?e.bind.legend:"click",s=at(i)?yl(i,"view"):ot(i);e.bind={legend:{merge:s}}},topLevelSignals:(t,e,n)=>{const r=e.name,i=T$(e.bind)&&e.bind.legend,s=o=>a=>{const u=Rt(a);return u.markname=o,u};for(const o of e.project.items){if(!o.hasLegend)continue;const a=`${qe(o.field)}_legend`,u=`${r}_${a}`;if(n.filter(l=>l.name===u).length===0){const l=i.merge.map(s(`${a}_symbols`)).concat(i.merge.map(s(`${a}_labels`))).concat(i.merge.map(s(`${a}_entries`)));n.unshift({name:u,...e.init?{}:{value:null},on:[{events:l,update:"isDefined(datum.value) ? datum.value : item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${u}`,force:!0}]})}}return n},signals:(t,e,n)=>{const r=e.name,i=e.project,s=n.find(d=>d.name===r+Su),o=r+k1,a=i.items.filter(d=>d.hasLegend).map(d=>qe(`${r}_${qe(d.field)}_legend`)),c=`${a.map(d=>`${d} !== null`).join(" && ")} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;e.events&&a.length>0?s.on.push({events:a.map(d=>({signal:d})),update:c}):a.length>0&&(s.update=c,delete s.value,delete s.on);const l=n.find(d=>d.name===r+f2),f=T$(e.bind)&&e.bind.legend;return l&&(e.events?l.on.push({...l.on[0],events:f}):l.on[0].events=f),n}};function Tqt(t,e,n){var i;const r=(i=t.fieldDef(e))==null?void 0:i.field;for(const s of Zn(t.component.selection??{})){const o=s.project.hasField[r]??s.project.hasChannel[e];if(o&&Hst.defined(s)){const a=n.get("selections")??[];a.push(s.name),n.set("selections",a,!1),o.hasLegend=!0}}}const Xst="_translate_anchor",Kst="_translate_delta",kqt={defined:t=>t.type==="interval"&&t.translate,signals:(t,e,n)=>{const r=e.name,i=lu.defined(e),s=r+Xst,{x:o,y:a}=e.project.hasChannel;let u=yl(e.translate,"scope");return i||(u=u.map(c=>(c.between[0].markname=r+zh,c))),n.push({name:s,value:{},on:[{events:u.map(c=>c.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?`, extent_x: ${i?uM(t,We):`slice(${o.signals.visual})`}`:"")+(a!==void 0?`, extent_y: ${i?uM(t,zn):`slice(${a.signals.visual})`}`:"")+"}"}]},{name:r+Kst,value:{},on:[{events:u,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&sB(t,e,o,"width",n),a!==void 0&&sB(t,e,a,"height",n),n}};function sB(t,e,n,r,i){const s=e.name,o=s+Xst,a=s+Kst,u=n.channel,c=lu.defined(e),l=i.find(x=>x.name===n.signals[c?"data":"visual"]),f=t.getSizeSignalRef(r).signal,d=t.getScaleComponent(u),h=d&&d.get("type"),p=d&&d.get("reverse"),g=c?u===We?p?"":"-":p?"-":"":"",m=`${o}.extent_${u}`,y=`${g}${a}.${u} / ${c?`${f}`:`span(${m})`}`,b=!c||!d?"panLinear":h==="log"?"panLog":h==="symlog"?"panSymlog":h==="pow"?"panPow":"panLinear",w=c?h==="pow"?`, ${d.get("exponent")??1}`:h==="symlog"?`, ${d.get("constant")??1}`:"":"",v=`${b}(${m}, ${y}${w})`;l.on.push({events:{signal:a},update:c?v:`clampRange(${v}, 0, ${f})`})}const Qst="_zoom_anchor",Jst="_zoom_delta",Mqt={defined:t=>t.type==="interval"&&t.zoom,signals:(t,e,n)=>{const r=e.name,i=lu.defined(e),s=r+Jst,{x:o,y:a}=e.project.hasChannel,u=J(t.scaleName(We)),c=J(t.scaleName(zn));let l=yl(e.zoom,"scope");return i||(l=l.map(f=>(f.markname=r+zh,f))),n.push({name:r+Qst,on:[{events:l,update:i?"{"+[u?`x: invert(${u}, x(unit))`:"",c?`y: invert(${c}, y(unit))`:""].filter(f=>f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:l,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&oB(t,e,o,"width",n),a!==void 0&&oB(t,e,a,"height",n),n}};function oB(t,e,n,r,i){const s=e.name,o=n.channel,a=lu.defined(e),u=i.find(b=>b.name===n.signals[a?"data":"visual"]),c=t.getSizeSignalRef(r).signal,l=t.getScaleComponent(o),f=l&&l.get("type"),d=a?uM(t,o):u.name,h=s+Jst,p=`${s}${Qst}.${o}`,g=!a||!l?"zoomLinear":f==="log"?"zoomLog":f==="symlog"?"zoomSymlog":f==="pow"?"zoomPow":"zoomLinear",m=a?f==="pow"?`, ${l.get("exponent")??1}`:f==="symlog"?`, ${l.get("constant")??1}`:"":"",y=`${g}(${d}, ${p}, ${h}${m})`;u.on.push({events:{signal:h},update:a?y:`clampRange(${y}, 0, ${c})`})}const td="_store",Su="_tuple",Cqt="_modify",Zst="vlSelectionResolve",hE=[nqt,lqt,Zjt,Yst,Gst,lu,Hst,$qt,kqt,Mqt,Vst];function Iqt(t){let e=t.parent;for(;e&&!Fi(e);)e=e.parent;return e}function xf(t,{escape:e}={escape:!0}){let n=e?J(t.name):t.name;const r=Iqt(t);if(r){const{facet:i}=r;for(const s of es)i[s]&&(n+=` + '__facet_${s}_' + (facet[${J(r.vgField(s))}])`)}return n}function HR(t){return Zn(t.component.selection??{}).reduce((e,n)=>e||n.project.hasSelectionId,!1)}function tot(t,e){(at(e.select)||!e.select.on)&&delete t.events,(at(e.select)||!e.select.clear)&&delete t.clear,(at(e.select)||!e.select.toggle)&&delete t.toggle}function Wo(t){var e;return(e=t.events)==null?void 0:e.find(n=>"type"in n&&n.type==="timer")}function lM(t){const e=[];return t.type==="Identifier"?[t.name]:t.type==="Literal"?[t.value]:(t.type==="MemberExpression"&&(e.push(...lM(t.object)),e.push(...lM(t.property))),e)}function eot(t){return t.object.type==="MemberExpression"?eot(t.object):t.object.name==="datum"}function not(t){const e=hO(t),n=new Set;return e.visit(r=>{r.type==="MemberExpression"&&eot(r)&&n.add(lM(r).slice(1).join("."))}),n}class $g extends ve{clone(){return new $g(null,this.model,Rt(this.filter))}constructor(e,n,r){super(e),this.model=n,this.filter=r,this.expr=d2(this.model,this.filter,this),this._dependentFields=not(this.expr)}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function Fqt(t,e){const n={},r=t.config.selection;if(!e||!e.length)return n;let i=0;for(const s of e){const o=qe(s.name),a=s.select,u=at(a)?a:a.type,c=st(a)?Rt(a):{type:u},l=r[u];for(const h in l)h==="fields"||h==="encodings"||(h==="mark"&&(c.mark={...l.mark,...c.mark}),(c[h]===void 0||c[h]===!0)&&(c[h]=Rt(l[h]??c[h])));const f=n[o]={...c,name:o,type:u,init:s.value,bind:s.bind,events:at(c.on)?yl(c.on,"scope"):ot(Rt(c.on))};if(Wo(f)&&(i++,i>1)){delete n[o];continue}const d=Rt(s);for(const h of hE)h.defined(f)&&h.parse&&h.parse(t,f,d)}return i>1&&K(KBt),n}function rot(t,e,n,r="datum"){const i=at(e)?e:e.param,s=qe(i),o=J(s+td);let a;try{a=t.getSelectionComponent(s,i)}catch{return`!!${s}`}if(a.project.timeUnit){const d=n??t.component.data.raw,h=a.project.timeUnit.clone();d.parent?h.insertAsParentOf(d):d.parent=h}const u=a.project.hasSelectionId?"vlSelectionIdTest(":"vlSelectionTest(",c=a.resolve==="global"?")":`, ${J(a.resolve)})`,l=`${u}${o}, ${r}${c}`,f=`length(data(${o}))`;return e.empty===!1?`${f} && ${l}`:`!${f} || ${l}`}function iot(t,e,n){const r=qe(e),i=n.encoding;let s=n.field,o;try{o=t.getSelectionComponent(r,e)}catch{return r}if(!i&&!s)s=o.project.items[0].field,o.project.items.length>1&&K(QBt(s));else if(i&&!s){const a=o.project.items.filter(u=>u.channel===i);!a.length||a.length>1?(s=o.project.items[0].field,K(JBt(a,i,n,s))):s=a[0].field}return`${o.name}[${J(xs(s))}]`}function Nqt(t,e){for(const[n,r]of el(t.component.selection??{})){const i=t.getName(`lookup_${n}`);t.component.data.outputNodes[i]=r.materialized=new ai(new $g(e,t,{param:n}),i,Ke.Lookup,t.component.data.outputNodeRefCounts)}}function d2(t,e,n){return a0(e,r=>at(r)?r:azt(r)?rot(t,r,n):pit(r))}function Oqt(t,e){if(t)return W(t)&&!sc(t)?t.map(n=>MR(n,e)).join(", "):t}function O$(t,e,n,r){var i,s;t.encode??(t.encode={}),(i=t.encode)[e]??(i[e]={}),(s=t.encode[e]).update??(s.update={}),t.encode[e].update[n]=r}function Um(t,e,n,r={header:!1}){var f,d;const{disable:i,orient:s,scale:o,labelExpr:a,title:u,zindex:c,...l}=t.combine();if(!i){for(const h in l){const p=h,g=dUt[p],m=l[p];if(g&&g!==e&&g!=="both")delete l[p];else if(T1(m)){const{condition:y,...b}=m,w=ot(y),v=O9[p];if(v){const{vgProp:x,part:S}=v,_=[...w.map(E=>{const{test:A,...$}=E;return{test:d2(null,A),...$}}),b];O$(l,S,x,_),delete l[p]}else if(v===null){const x={signal:w.map(S=>{const{test:_,...E}=S;return`${d2(null,_)} ? ${b9(E)} : `}).join("")+b9(b)};l[p]=x}}else if(gt(m)){const y=O9[p];if(y){const{vgProp:b,part:w}=y;O$(l,w,b,m),delete l[p]}}Xt(["labelAlign","labelBaseline"],p)&&l[p]===null&&delete l[p]}if(e==="grid"){if(!l.grid)return;if(l.encode){const{grid:h}=l.encode;l.encode={...h?{grid:h}:{}},xe(l.encode)&&delete l.encode}return{scale:o,orient:s,...l,domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:ln(c,0)}}else{if(!r.header&&t.mainExtracted)return;if(a!==void 0){let p=a;(d=(f=l.encode)==null?void 0:f.labels)!=null&&d.update&&gt(l.encode.labels.update.text)&&(p=Gf(a,"datum.label",l.encode.labels.update.text.signal)),O$(l,"labels","text",{signal:p})}if(l.labelAlign===null&&delete l.labelAlign,l.encode){for(const p of Vit)t.hasAxisPart(p)||delete l.encode[p];xe(l.encode)&&delete l.encode}const h=Oqt(u,n);return{scale:o,orient:s,grid:!1,...h?{title:h}:{},...l,...n.aria===!1?{aria:!1}:{},zindex:ln(c,0)}}}}function sot(t){const{axes:e}=t.component,n=[];for(const r of zu)if(e[r]){for(const i of e[r])if(!i.get("disable")&&!i.get("gridScale")){const s=r==="x"?"height":"width",o=t.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function Rqt(t,e){const{x:n=[],y:r=[]}=t;return[...n.map(i=>Um(i,"grid",e)),...r.map(i=>Um(i,"grid",e)),...n.map(i=>Um(i,"main",e)),...r.map(i=>Um(i,"main",e))].filter(i=>i)}function aB(t,e,n,r){return Object.assign.apply(null,[{},...t.map(i=>{if(i==="axisOrient"){const s=n==="x"?"bottom":"left",o=e[n==="x"?"axisBottom":"axisLeft"]||{},a=e[n==="x"?"axisTop":"axisRight"]||{},u=new Set([...H(o),...H(a)]),c={};for(const l of u.values())c[l]={signal:`${r.signal} === "${s}" ? ${Ps(o[l])} : ${Ps(a[l])}`};return c}return e[i]})])}function Dqt(t,e,n,r){const i=e==="band"?["axisDiscrete","axisBand"]:e==="point"?["axisDiscrete","axisPoint"]:bit(e)?["axisQuantitative"]:e==="time"||e==="utc"?["axisTemporal"]:[],s=t==="x"?"axisX":"axisY",o=gt(n)?"axisOrient":`axis${m1(n)}`,a=[...i,...i.map(c=>s+c.substr(4))],u=["axis",o,s];return{vlOnlyAxisConfig:aB(a,r,t,n),vgAxisConfig:aB(u,r,t,n),axisConfigStyle:Lqt([...u,...a],r)}}function Lqt(t,e){var r;const n=[{}];for(const i of t){let s=(r=e[i])==null?void 0:r.style;if(s){s=ot(s);for(const o of s)n.push(e.style[o])}}return Object.assign.apply(null,n)}function fM(t,e,n,r={}){var s;const i=Grt(t,n,e);if(i!==void 0)return{configFrom:"style",configValue:i};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((s=r[o])==null?void 0:s[t])!==void 0)return{configFrom:o,configValue:r[o][t]};return{}}const uB={scale:({model:t,channel:e})=>t.scaleName(e),format:({format:t})=>t,formatType:({formatType:t})=>t,grid:({fieldOrDatumDef:t,axis:e,scaleType:n})=>e.grid??Bqt(n,t),gridScale:({model:t,channel:e})=>Pqt(t,e),labelAlign:({axis:t,labelAngle:e,orient:n,channel:r})=>t.labelAlign||aot(e,n,r),labelAngle:({labelAngle:t})=>t,labelBaseline:({axis:t,labelAngle:e,orient:n,channel:r})=>t.labelBaseline||oot(e,n,r),labelFlush:({axis:t,fieldOrDatumDef:e,channel:n})=>t.labelFlush??Uqt(e.type,n),labelOverlap:({axis:t,fieldOrDatumDef:e,scaleType:n})=>t.labelOverlap??jqt(e.type,n,Q(e)&&!!e.timeUnit,Q(e)?e.sort:void 0),orient:({orient:t})=>t,tickCount:({channel:t,model:e,axis:n,fieldOrDatumDef:r,scaleType:i})=>{const s=t==="x"?"width":t==="y"?"height":void 0,o=s?e.getSizeSignalRef(s):void 0;return n.tickCount??Wqt({fieldOrDatumDef:r,scaleType:i,size:o,values:n.values})},tickMinStep:Vqt,title:({axis:t,model:e,channel:n})=>{if(t.title!==void 0)return t.title;const r=uot(e,n);if(r!==void 0)return r;const i=e.typedFieldDef(n),s=n==="x"?"x2":"y2",o=e.fieldDef(s);return Hrt(i?[F9(i)]:[],Q(o)?[F9(o)]:[])},values:({axis:t,fieldOrDatumDef:e})=>Gqt(t,e),zindex:({axis:t,fieldOrDatumDef:e,mark:n})=>t.zindex??Yqt(n,e)};function Bqt(t,e){return!Bn(t)&&Q(e)&&!Ne(e==null?void 0:e.bin)&&!Un(e==null?void 0:e.bin)}function Pqt(t,e){const n=e==="x"?"y":"x";if(t.getScaleComponent(n))return t.scaleName(n)}function zqt(t,e,n,r,i){const s=e==null?void 0:e.labelAngle;if(s!==void 0)return gt(s)?s:sy(s);{const{configValue:o}=fM("labelAngle",r,e==null?void 0:e.style,i);return o!==void 0?sy(o):n===We&&Xt([yR,mR],t.type)&&!(Q(t)&&t.timeUnit)?270:void 0}}function dM(t){return`(((${t.signal} % 360) + 360) % 360)`}function oot(t,e,n,r){if(t!==void 0)if(n==="x"){if(gt(t)){const i=dM(t),s=gt(e)?`(${e.signal} === "top")`:e==="top";return{signal:`(45 < ${i} && ${i} < 135) || (225 < ${i} && ${i} < 315) ? "middle" :(${i} <= 45 || 315 <= ${i}) === ${s} ? "bottom" : "top"`}}if(45<t&&t<135||225<t&&t<315)return"middle";if(gt(e)){const i=t<=45||315<=t?"===":"!==";return{signal:`${e.signal} ${i} "top" ? "bottom" : "top"`}}return(t<=45||315<=t)==(e==="top")?"bottom":"top"}else{if(gt(t)){const i=dM(t),s=gt(e)?`(${e.signal} === "left")`:e==="left";return{signal:`${i} <= 45 || 315 <= ${i} || (135 <= ${i} && ${i} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${i} && ${i} <= 135) === ${s} ? "top" : "bottom"`}}if(t<=45||315<=t||135<=t&&t<=225)return r?"middle":null;if(gt(e)){const i=45<=t&&t<=135?"===":"!==";return{signal:`${e.signal} ${i} "left" ? "top" : "bottom"`}}return(45<=t&&t<=135)==(e==="left")?"top":"bottom"}}function aot(t,e,n){if(t===void 0)return;const r=n==="x",i=r?0:90,s=r?"bottom":"left";if(gt(t)){const o=dM(t),a=gt(e)?`(${e.signal} === "${s}")`:e===s;return{signal:`(${i?`(${o} + 90)`:o} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${o} && ${o} < ${180+i}) === ${a} ? "left" : "right"`}}if((t+i)%180===0)return r?null:"center";if(gt(e)){const o=i<t&&t<180+i?"===":"!==";return{signal:`${`${e.signal} ${o} "${s}"`} ? "left" : "right"`}}return(i<t&&t<180+i)==(e===s)?"left":"right"}function Uqt(t,e){if(e==="x"&&Xt(["quantitative","temporal"],t))return!0}function jqt(t,e,n,r){if(n&&!st(r)||t!=="nominal"&&t!=="ordinal")return e==="log"||e==="symlog"?"greedy":!0}function qqt(t){return t==="x"?"bottom":"left"}function Wqt({fieldOrDatumDef:t,scaleType:e,size:n,values:r}){var i;if(!r&&!Bn(e)&&e!=="log"){if(Q(t)){if(Ne(t.bin))return{signal:`ceil(${n.signal}/10)`};if(t.timeUnit&&Xt(["month","hours","day","quarter"],(i=Dn(t.timeUnit))==null?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}}function Vqt({format:t,fieldOrDatumDef:e}){if(t==="d")return 1;if(Q(e)){const{timeUnit:n}=e;if(n){const r=fit(n);if(r)return{signal:r}}}}function uot(t,e){const n=e==="x"?"x2":"y2",r=t.fieldDef(e),i=t.fieldDef(n),s=r?r.title:void 0,o=i?i.title:void 0;if(s&&o)return Xrt(s,o);if(s)return s;if(o)return o;if(s!==void 0)return s;if(o!==void 0)return o}function Gqt(t,e){const n=t.values;if(W(n))return Wit(e,n);if(gt(n))return n}function Yqt(t,e){return t==="rect"&&s2(e)?1:0}class Rp extends ve{clone(){return new Rp(null,Rt(this.transform))}constructor(e,n){super(e),this.transform=n,this._dependentFields=not(this.transform.calculate)}static parseAllForSortIndex(e,n){return n.forEachFieldDef((r,i)=>{if(_d(r)&&Oit(r.sort)){const{field:s,timeUnit:o}=r,a=r.sort,u=a.map((c,l)=>`${pit({field:s,timeUnit:o,equal:c})} ? ${l} : `).join("")+a.length;e=new Rp(e,{calculate:u,as:Dp(r,i,{forAs:!0})})}}),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${Qt(this.transform)}`}}function Dp(t,e,n){return nt(t,{prefix:e,suffix:"sort_index",...n})}function pE(t,e){return Xt(["top","bottom"],e)?"column":Xt(["left","right"],e)||t==="row"?"row":"column"}function Lp(t,e,n,r){const i=r==="row"?n.headerRow:r==="column"?n.headerColumn:n.headerFacet;return ln((e||{})[t],i[t],n.header[t])}function gE(t,e,n,r){const i={};for(const s of t){const o=Lp(s,e||{},n,r);o!==void 0&&(i[s]=o)}return i}const XR=["row","column"],KR=["header","footer"];function Hqt(t,e){const n=t.component.layoutHeaders[e].title,r=t.config?t.config:void 0,i=t.component.layoutHeaders[e].facetFieldDef?t.component.layoutHeaders[e].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=gE(["titleAnchor","titleAngle","titleOrient"],i.header,r,e),u=pE(e,a),c=sy(o);return{name:`${e}-title`,type:"group",role:`${u}-title`,title:{text:n,...e==="row"?{orient:"left"}:{},style:"guide-title",...lot(c,u),...cot(u,c,s),...fot(r,i,e,OUt,cst)}}}function cot(t,e,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=aot(e,t==="row"?"left":"top",t==="row"?"y":"x");return r?{align:r}:{}}function lot(t,e){const n=oot(t,e==="row"?"left":"top",e==="row"?"y":"x",!0);return n?{baseline:n}:{}}function Xqt(t,e){const n=t.component.layoutHeaders[e],r=[];for(const i of KR)if(n[i])for(const s of n[i]){const o=Qqt(t,e,i,n,s);o!=null&&r.push(o)}return r}function Kqt(t,e){const{sort:n}=t;return cu(n)?{field:nt(n,{expr:"datum"}),order:n.order??"ascending"}:W(n)?{field:Dp(t,e,{expr:"datum"}),order:"ascending"}:{field:nt(t,{expr:"datum"}),order:n??"ascending"}}function hM(t,e,n){const{format:r,formatType:i,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:u}=gE(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],t.header,n,e),c=AR({fieldOrDatumDef:t,format:r,formatType:i,expr:"parent",config:n}).signal,l=pE(e,a);return{text:{signal:u?Gf(Gf(u,"datum.label",c),"datum.value",nt(t,{expr:"parent"})):c},...e==="row"?{orient:"left"}:{},style:"guide-label",frame:"group",...lot(s,l),...cot(l,s,o),...fot(n,t,e,RUt,lst)}}function Qqt(t,e,n,r,i){if(i){let s=null;const{facetFieldDef:o}=r,a=t.config?t.config:void 0;if(o&&i.labels){const{labelOrient:f}=gE(["labelOrient"],o.header,a,e);(e==="row"&&!Xt(["top","bottom"],f)||e==="column"&&!Xt(["left","right"],f))&&(s=hM(o,e,a))}const u=Fi(t)&&!S1(t.facet),c=i.axes,l=(c==null?void 0:c.length)>0;if(s||l){const f=e==="row"?"height":"width";return{name:t.getName(`${e}_${n}`),type:"group",role:`${e}-${n}`,...r.facetFieldDef?{from:{data:t.getName(`${e}_domain`)},sort:Kqt(o,e)}:{},...l&&u?{from:{data:t.getName(`facet_domain_${e}`)}}:{},...s?{title:s}:{},...i.sizeSignal?{encode:{update:{[f]:i.sizeSignal}}}:{},...l?{axes:c}:{}}}}return null}const Jqt={column:{start:0,end:1},row:{start:1,end:0}};function Zqt(t,e){return Jqt[e][t]}function tWt(t,e){const n={};for(const r of es){const i=t[r];if(i!=null&&i.facetFieldDef){const{titleAnchor:s,titleOrient:o}=gE(["titleAnchor","titleOrient"],i.facetFieldDef.header,e,r),a=pE(r,o),u=Zqt(s,a);u!==void 0&&(n[a]=u)}}return xe(n)?void 0:n}function fot(t,e,n,r,i){const s={};for(const o of r){if(!i[o])continue;const a=Lp(o,e==null?void 0:e.header,t,n);a!==void 0&&(s[i[o]]=a)}return s}function QR(t){return[...Fb(t,"width"),...Fb(t,"height"),...Fb(t,"childWidth"),...Fb(t,"childHeight")]}function Fb(t,e){const n=e==="width"?"x":"y",r=t.component.layoutSize.get(e);if(!r||r==="merged")return[];const i=t.getSizeSignalRef(e).signal;if(r==="step"){const s=t.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(Bn(o)&&vd(a)){const u=t.scaleName(n);return Fi(t.parent)&&t.parent.component.resolve.scale[n]==="independent"?[cB(u,a)]:[cB(u,a),{name:i,update:dot(u,s,`domain('${u}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(r=="container"){const s=i.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=nM(t.config.view,s?"width":"height"),u=`isFinite(${o}) ? ${o} : ${a}`;return[{name:i,init:u,on:[{update:u,events:"window:resize"}]}]}else return[{name:i,value:r}]}function cB(t,e){const n=`${t}_step`;return gt(e.step)?{name:n,update:e.step.signal}:{name:n,value:e.step}}function dot(t,e,n){const r=e.get("type"),i=e.get("padding"),s=ln(e.get("paddingOuter"),i);let o=e.get("paddingInner");return o=r==="band"?o!==void 0?o:i:1,`bandspace(${n}, ${Ps(o)}, ${Ps(s)}) * ${t}_step`}function hot(t){return t==="childWidth"?"width":t==="childHeight"?"height":t}function pot(t,e){return H(t).reduce((n,r)=>({...n,...Ag({model:e,channelDef:t[r],vgChannel:r,mainRefFn:i=>Re(i.value),invalidValueRef:void 0})}),{})}function got(t,e){if(Fi(e))return t==="theta"?"independent":"shared";if(Mg(e))return"shared";if(iD(e))return fn(t)||t==="theta"||t==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function JR(t,e){const n=t.scale[e],r=fn(e)?"axis":"legend";return n==="independent"?(t[r][e]==="shared"&&K(MPt(e)),"independent"):t[r][e]||"shared"}const eWt={...BUt,disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1},mot=H(eWt);class nWt extends ju{}const lB={symbols:rWt,gradient:iWt,labels:sWt,entries:oWt};function rWt(t,{fieldOrDatumDef:e,model:n,channel:r,legendCmpt:i,legendType:s}){if(s!=="symbol")return;const{markDef:o,encoding:a,config:u,mark:c}=n,l=o.filled&&c!=="trail";let f={...LBt({},n,Nzt),...jst(n,{filled:l})};const d=i.get("symbolOpacity")??u.legend.symbolOpacity,h=i.get("symbolFillColor")??u.legend.symbolFillColor,p=i.get("symbolStrokeColor")??u.legend.symbolStrokeColor,g=d===void 0?yot(a.opacity)??o.opacity:void 0;if(f.fill){if(r==="fill"||l&&r===pi)delete f.fill;else if(X(f.fill,"field"))h?delete f.fill:(f.fill=Re(u.legend.symbolBaseFillColor??"black"),f.fillOpacity=Re(g??1));else if(W(f.fill)){const m=pM(a.fill??a.color)??o.fill??(l&&o.color);m&&(f.fill=Re(m))}}if(f.stroke){if(r==="stroke"||!l&&r===pi)delete f.stroke;else if(X(f.stroke,"field")||p)delete f.stroke;else if(W(f.stroke)){const m=ln(pM(a.stroke||a.color),o.stroke,l?o.color:void 0);m&&(f.stroke={value:m})}}if(r!==Pu){const m=Q(e)&&vot(n,i,e);m?f.opacity=[{test:m,...Re(g??1)},Re(u.legend.unselectedOpacity)]:g&&(f.opacity=Re(g))}return f={...f,...t},xe(f)?void 0:f}function iWt(t,{model:e,legendType:n,legendCmpt:r}){if(n!=="gradient")return;const{config:i,markDef:s,encoding:o}=e;let a={};const c=(r.get("gradientOpacity")??i.legend.gradientOpacity)===void 0?yot(o.opacity)||s.opacity:void 0;return c&&(a.opacity=Re(c)),a={...a,...t},xe(a)?void 0:a}function sWt(t,{fieldOrDatumDef:e,model:n,channel:r,legendCmpt:i}){const s=n.legend(r)||{},o=n.config,a=Q(e)?vot(n,i,e):void 0,u=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:c,formatType:l}=s;let f;Jf(l)?f=zs({fieldOrDatumDef:e,field:"datum.value",format:c,formatType:l,config:o}):c===void 0&&l===void 0&&o.customFormatTypes&&(e.type==="quantitative"&&o.numberFormatType?f=zs({fieldOrDatumDef:e,field:"datum.value",format:o.numberFormat,formatType:o.numberFormatType,config:o}):e.type==="temporal"&&o.timeFormatType&&Q(e)&&e.timeUnit===void 0&&(f=zs({fieldOrDatumDef:e,field:"datum.value",format:o.timeFormat,formatType:o.timeFormatType,config:o})));const d={...u?{opacity:u}:{},...f?{text:f}:{},...t};return xe(d)?void 0:d}function oWt(t,{legendCmpt:e}){const n=e.get("selections");return n!=null&&n.length?{...t,fill:{value:"transparent"}}:t}function yot(t){return bot(t,(e,n)=>Math.max(e,n.value))}function pM(t){return bot(t,(e,n)=>ln(e,n.value))}function bot(t,e){if(tUt(t))return ot(t.condition).reduce(e,t.value);if(Ks(t))return t.value}function vot(t,e,n){const r=e.get("selections");if(!(r!=null&&r.length))return;const i=J(n.field);return r.map(s=>`(!length(data(${J(qe(s)+td)})) || (${s}[${i}] && indexof(${s}[${i}], datum.value) >= 0))`).join(" || ")}const fB={direction:({direction:t})=>t,format:({fieldOrDatumDef:t,legend:e,config:n})=>{const{format:r,formatType:i}=e;return Iit(t,t.type,r,i,n,!1)},formatType:({legend:t,fieldOrDatumDef:e,scaleType:n})=>{const{formatType:r}=t;return Fit(r,e,n)},gradientLength:t=>{const{legend:e,legendConfig:n}=t;return e.gradientLength??n.gradientLength??hWt(t)},labelOverlap:({legend:t,legendConfig:e,scaleType:n})=>t.labelOverlap??e.labelOverlap??pWt(n),symbolType:({legend:t,markDef:e,channel:n,encoding:r})=>t.symbolType??uWt(e.type,n,r.shape,e.shape),title:({fieldOrDatumDef:t,config:e})=>Ph(t,e,{allowDisabling:!0}),type:({legendType:t,scaleType:e,channel:n})=>{if(Bh(n)&&Po(e)){if(t==="gradient")return}else if(t==="symbol")return;return t},values:({fieldOrDatumDef:t,legend:e})=>aWt(e,t)};function aWt(t,e){const n=t.values;if(W(n))return Wit(e,n);if(gt(n))return n}function uWt(t,e,n,r){if(e!=="shape"){const i=pM(n)??r;if(i)return i}switch(t){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function cWt(t){const{legend:e}=t;return ln(e.type,lWt(t))}function lWt({channel:t,timeUnit:e,scaleType:n}){if(Bh(t)){if(Xt(["quarter","month","day"],e))return"symbol";if(Po(n))return"gradient"}return"symbol"}function fWt({legendConfig:t,legendType:e,orient:n,legend:r}){return r.direction??t[e?"gradientDirection":"symbolDirection"]??dWt(n,e)}function dWt(t,e){switch(t){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return e==="gradient"?"horizontal":void 0}}function hWt({legendConfig:t,model:e,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:u}=t;if(Po(i))return n==="horizontal"?r==="top"||r==="bottom"?dB(e,"width",o,s):o:dB(e,"height",u,a)}function dB(t,e,n,r){return{signal:`clamp(${t.getSizeSignalRef(e).signal}, ${n}, ${r})`}}function pWt(t){if(Xt(["quantile","threshold","log","symlog"],t))return"greedy"}function wot(t){const e=Ge(t)?gWt(t):vWt(t);return t.component.legends=e,e}function gWt(t){const{encoding:e}=t,n={};for(const r of[pi,...dst]){const i=Sn(e[r]);!i||!t.getScaleComponent(r)||r===gi&&Q(i)&&i.type===Eg||(n[r]=bWt(t,r))}return n}function mWt(t,e){const n=t.scaleName(e);if(t.mark==="trail"){if(e==="color")return{stroke:n};if(e==="size")return{strokeWidth:n}}return e==="color"?t.markDef.filled?{fill:n}:{stroke:n}:{[e]:n}}function yWt(t,e,n,r){switch(e){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(e==="title"&&t===(r==null?void 0:r.title))return!0}return t===(n||{})[e]}function bWt(t,e){var v;let n=t.legend(e);const{markDef:r,encoding:i,config:s}=t,o=s.legend,a=new nWt({},mWt(t,e));Tqt(t,e,a);const u=n!==void 0?!n:o.disable;if(a.set("disable",u,n!==void 0),u)return a;n=n||{};const c=t.getScaleComponent(e).get("type"),l=Sn(i[e]),f=Q(l)?(v=Dn(l.timeUnit))==null?void 0:v.unit:void 0,d=n.orient||s.legend.orient||"right",h=cWt({legend:n,channel:e,timeUnit:f,scaleType:c}),p=fWt({legend:n,legendType:h,orient:d,legendConfig:o}),g={legend:n,channel:e,model:t,markDef:r,encoding:i,fieldOrDatumDef:l,legendConfig:o,config:s,scaleType:c,orient:d,legendType:h,direction:p};for(const x of mot){if(h==="gradient"&&x.startsWith("symbol")||h==="symbol"&&x.startsWith("gradient"))continue;const S=x in fB?fB[x](g):n[x];if(S!==void 0){const _=yWt(S,x,n,t.fieldDef(e));(_||s.legend[x]===void 0)&&a.set(x,S,_)}}const m=(n==null?void 0:n.encoding)??{},y=a.get("selections"),b={},w={fieldOrDatumDef:l,model:t,channel:e,legendCmpt:a,legendType:h};for(const x of["labels","legend","title","symbols","gradient","entries"]){const S=pot(m[x]??{},t),_=x in lB?lB[x](S,w):S;_!==void 0&&!xe(_)&&(b[x]={...y!=null&&y.length&&Q(l)?{name:`${qe(l.field)}_legend_${x}`}:{},...y!=null&&y.length?{interactive:!!y}:{},update:_})}return xe(b)||a.set("encode",b,!!(n!=null&&n.encoding)),a}function vWt(t){const{legends:e,resolve:n}=t.component;for(const r of t.children){wot(r);for(const i of H(r.component.legends))n.legend[i]=JR(t.component.resolve,i),n.legend[i]==="shared"&&(e[i]=xot(e[i],r.component.legends[i]),e[i]||(n.legend[i]="independent",delete e[i]))}for(const r of H(e))for(const i of t.children)i.component.legends[r]&&n.legend[r]==="shared"&&delete i.component.legends[r];return e}function xot(t,e){var s,o,a,u;if(!t)return e.clone();const n=t.getWithExplicit("orient"),r=e.getWithExplicit("orient");if(n.explicit&&r.explicit&&n.value!==r.value)return;let i=!1;for(const c of mot){const l=il(t.getWithExplicit(c),e.getWithExplicit(c),c,"legend",(f,d)=>{switch(c){case"symbolType":return wWt(f,d);case"title":return Krt(f,d);case"type":return i=!0,wi("symbol")}return cE(f,d,c,"legend")});t.setWithExplicit(c,l)}return i&&((o=(s=t.implicit)==null?void 0:s.encode)!=null&&o.gradient&&t2(t.implicit,["encode","gradient"]),(u=(a=t.explicit)==null?void 0:a.encode)!=null&&u.gradient&&t2(t.explicit,["encode","gradient"])),t}function wWt(t,e){return e.value==="circle"?e:t}function xWt(t,e,n,r){var i,s;t.encode??(t.encode={}),(i=t.encode)[e]??(i[e]={}),(s=t.encode[e]).update??(s.update={}),t.encode[e].update[n]=r}function _ot(t){const e=t.component.legends,n={};for(const i of H(e)){const s=t.getScaleComponent(i),o=_e(s.get("domains"));if(n[o])for(const a of n[o])xot(a,e[i])||n[o].push(e[i]);else n[o]=[e[i].clone()]}return Zn(n).flat().map(i=>_Wt(i,t.config)).filter(i=>i!==void 0)}function _Wt(t,e){var o,a,u;const{disable:n,labelExpr:r,selections:i,...s}=t.combine();if(!n){if(e.aria===!1&&s.aria==null&&(s.aria=!1),(o=s.encode)!=null&&o.symbols){const c=s.encode.symbols.update;c.fill&&c.fill.value!=="transparent"&&!c.stroke&&!s.stroke&&(c.stroke={value:"transparent"});for(const l of dst)s[l]&&delete c[l]}if(s.title||delete s.title,r!==void 0){let c=r;(u=(a=s.encode)==null?void 0:a.labels)!=null&&u.update&&gt(s.encode.labels.update.text)&&(c=Gf(r,"datum.label",s.encode.labels.update.text.signal)),xWt(s,"labels","text",{signal:c})}return s}}function SWt(t){return Mg(t)||iD(t)?EWt(t):Sot(t)}function EWt(t){return t.children.reduce((e,n)=>e.concat(n.assembleProjections()),Sot(t))}function Sot(t){const e=t.component.projection;if(!e||e.merged)return[];const n=e.combine(),{name:r}=n;if(e.data){const i={signal:`[${e.size.map(o=>o.signal).join(", ")}]`},s=e.data.reduce((o,a)=>{const u=gt(a)?a.signal:`data('${t.lookupDataSource(a)}')`;return Xt(o,u)||o.push(u),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[{name:r,size:i,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]},...n}]}else return[{name:r,translate:{signal:"[width / 2, height / 2]"},...n}]}const AWt=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Eot extends ju{constructor(e,n,r,i){super({...n},{name:e}),this.specifiedProjection=n,this.size=r,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function Aot(t){t.component.projection=Ge(t)?$Wt(t):MWt(t)}function $Wt(t){if(t.hasProjection){const e=jn(t.specifiedProjection),n=!(e&&(e.scale!=null||e.translate!=null)),r=n?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:void 0,i=n?TWt(t):void 0,s=new Eot(t.projectionName(!0),{...jn(t.config.projection),...e},r,i);return s.get("type")||s.set("type","equalEarth",!1),s}}function TWt(t){const e=[],{encoding:n}=t;for(const r of[[fo,lo],[_s,ho]])(Sn(n[r[0]])||Sn(n[r[1]]))&&e.push({signal:t.getName(`geojson_${e.length}`)});return t.channelHasField(gi)&&t.typedFieldDef(gi).type===Eg&&e.push({signal:t.getName(`geojson_${e.length}`)}),e.length===0&&e.push(t.requestDataName(Ke.Main)),e}function kWt(t,e){const n=qO(AWt,i=>!!(!ft(t.explicit,i)&&!ft(e.explicit,i)||ft(t.explicit,i)&&ft(e.explicit,i)&&ki(t.get(i),e.get(i))));if(ki(t.size,e.size)){if(n)return t;if(ki(t.explicit,{}))return e;if(ki(e.explicit,{}))return t}return null}function MWt(t){if(t.children.length===0)return;let e;for(const r of t.children)Aot(r);const n=qO(t.children,r=>{const i=r.component.projection;if(i)if(e){const s=kWt(e,i);return s&&(e=s),!!s}else return e=i,!0;else return!0});if(e&&n){const r=t.projectionName(!0),i=new Eot(r,e.specifiedProjection,e.size,Rt(e.data));for(const s of t.children){const o=s.component.projection;o&&(o.isFit&&i.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),r),o.merged=!0)}return i}}function CWt(t,e,n,r){if($1(e,n)){const i=Ge(t)?t.axis(n)??t.legend(n)??{}:{},s=nt(e,{expr:"datum"}),o=nt(e,{expr:"datum",binSuffix:"end"});return{formulaAs:nt(e,{binSuffix:"range",forAs:!0}),formula:_1(s,o,i.format,i.formatType,r)}}return{}}function $ot(t,e){return`${jrt(t)}_${e}`}function IWt(t,e){return{signal:t.getName(`${e}_bins`),extentSignal:t.getName(`${e}_extent`)}}function ZR(t,e,n){const r=rE(n,void 0)??{},i=$ot(r,e);return t.getName(`${i}_bins`)}function FWt(t){return"as"in t}function hB(t,e,n){let r,i;FWt(t)?r=at(t.as)?[t.as,`${t.as}_end`]:[t.as[0],t.as[1]]:r=[nt(t,{forAs:!0}),nt(t,{binSuffix:"end",forAs:!0})];const s={...rE(e,void 0)},o=$ot(s,t.field),{signal:a,extentSignal:u}=IWt(n,o);if(GS(s.extent)){const l=s.extent;i=iot(n,l.param,l),delete s.extent}const c={bin:s,field:t.field,as:[r],...a?{signal:a}:{},...u?{extentSignal:u}:{},...i?{span:i}:{}};return{key:o,binComponent:c}}class Vo extends ve{clone(){return new Vo(null,Rt(this.bins))}constructor(e,n){super(e),this.bins=n}static makeFromEncoding(e,n){const r=n.reduceFieldDef((i,s,o)=>{if(Gr(s)&&Ne(s.bin)){const{key:a,binComponent:u}=hB(s,s.bin,n);i[a]={...u,...i[a],...CWt(n,s,o,n.config)}}return i},{});return xe(r)?null:new Vo(e,r)}static makeFromTransform(e,n,r){const{key:i,binComponent:s}=hB(n,n.bin,r);return new Vo(e,{[i]:s})}merge(e,n){for(const r of H(e.bins))r in this.bins?(n(e.bins[r].signal,this.bins[r].signal),this.bins[r].as=Bo([...this.bins[r].as,...e.bins[r].as],Qt)):this.bins[r]=e.bins[r];for(const r of e.children)e.removeChild(r),r.parent=this;e.remove()}producedFields(){return new Set(Zn(this.bins).map(e=>e.as).flat(2))}dependentFields(){return new Set(Zn(this.bins).map(e=>e.field))}hash(){return`Bin ${Qt(this.bins)}`}assemble(){return Zn(this.bins).flatMap(e=>{const n=[],[r,...i]=e.as,{extent:s,...o}=e.bin,a={type:"bin",field:xs(e.field),as:r,signal:e.signal,...GS(s)?{extent:null}:{extent:s},...e.span?{span:{signal:`span(${e.span})`}}:{},...o};!s&&e.extentSignal&&(n.push({type:"extent",field:xs(e.field),signal:e.extentSignal}),a.extent={signal:e.extentSignal}),n.push(a);for(const u of i)for(let c=0;c<2;c++)n.push({type:"formula",expr:nt({field:r[c]},{expr:"datum"}),as:u[c]});return e.formula&&n.push({type:"formula",expr:e.formula,as:e.formulaAs}),n})}}function NWt(t,e,n,r){var s;const i=Ge(r)?r.encoding[_a(e)]:void 0;if(Gr(n)&&Ge(r)&&Dit(n,i,r.markDef,r.config)){t.add(nt(n,{})),t.add(nt(n,{suffix:"end"}));const{mark:o,markDef:a,config:u}=r,c=rl({fieldDef:n,markDef:a,config:u});oy(o)&&c!==.5&&fn(e)&&(t.add(nt(n,{suffix:lE})),t.add(nt(n,{suffix:fE}))),n.bin&&$1(n,e)&&t.add(nt(n,{binSuffix:"range"}))}else if(Nrt(e)){const o=Frt(e);t.add(r.getName(o))}else t.add(nt(n));return _d(n)&&wzt((s=n.scale)==null?void 0:s.range)&&t.add(n.scale.range.field),t}function OWt(t,e){for(const n of H(e)){const r=e[n];for(const i of H(r))n in t?t[n][i]=new Set([...t[n][i]??[],...r[i]]):t[n]={[i]:r[i]}}}class Ws extends ve{clone(){return new Ws(null,new Set(this.dimensions),Rt(this.measures))}constructor(e,n,r){super(e),this.dimensions=n,this.measures=r}get groupBy(){return this.dimensions}static makeFromEncoding(e,n){let r=!1;n.forEachFieldDef(o=>{o.aggregate&&(r=!0)});const i={},s=new Set;return!r||(n.forEachFieldDef((o,a)=>{const{aggregate:u,field:c}=o;if(u)if(u==="count")i["*"]??(i["*"]={}),i["*"].count=new Set([nt(o,{forAs:!0})]);else{if(xu(u)||El(u)){const l=xu(u)?"argmin":"argmax",f=u[l];i[f]??(i[f]={}),i[f][l]=new Set([nt({op:l,field:f},{forAs:!0})])}else i[c]??(i[c]={}),i[c][u]=new Set([nt(o,{forAs:!0})]);Sa(a)&&n.scaleDomain(a)==="unaggregated"&&(i[c]??(i[c]={}),i[c].min=new Set([nt({field:c,aggregate:"min"},{forAs:!0})]),i[c].max=new Set([nt({field:c,aggregate:"max"},{forAs:!0})]))}else NWt(s,a,o,n)}),s.size+H(i).length===0)?null:new Ws(e,s,i)}static makeFromTransform(e,n){var r;const i=new Set,s={};for(const o of n.aggregate){const{op:a,field:u,as:c}=o;a&&(a==="count"?(s["*"]??(s["*"]={}),s["*"].count=new Set([c||nt(o,{forAs:!0})])):(s[u]??(s[u]={}),(r=s[u])[a]??(r[a]=new Set),s[u][a].add(c||nt(o,{forAs:!0}))))}for(const o of n.groupby??[])i.add(o);return i.size+H(s).length===0?null:new Ws(e,i,s)}merge(e){return Ert(this.dimensions,e.dimensions)?(OWt(this.measures,e.measures),!0):(VPt("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...H(this.measures)])}producedFields(){const e=new Set;for(const n of H(this.measures))for(const r of H(this.measures[n])){const i=this.measures[n][r];i.size===0?e.add(`${r}_${n}`):i.forEach(e.add,e)}return e}hash(){return`Aggregate ${Qt({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],n=[],r=[];for(const s of H(this.measures))for(const o of H(this.measures[s]))for(const a of this.measures[s][o])r.push(a),e.push(o),n.push(s==="*"?null:xs(s));return{type:"aggregate",groupby:[...this.dimensions].map(xs),ops:e,fields:n,as:r}}}class Tg extends ve{constructor(e,n,r,i){super(e),this.model=n,this.name=r,this.data=i;for(const s of es){const o=n.facet[s];if(o){const{bin:a,sort:u}=o;this[s]={name:n.getName(`${s}_domain`),fields:[nt(o),...Ne(a)?[nt(o,{binSuffix:"end"})]:[]],...cu(u)?{sortField:u}:W(u)?{sortIndexField:Dp(o,s)}:{}}}}this.childModel=n.child}hash(){let e="Facet";for(const n of es)this[n]&&(e+=` ${n.charAt(0)}:${Qt(this[n])}`);return e}get fields(){var n;const e=[];for(const r of es)(n=this[r])!=null&&n.fields&&e.push(...this[r].fields);return e}dependentFields(){const e=new Set(this.fields);for(const n of es)this[n]&&(this[n].sortField&&e.add(this[n].sortField.field),this[n].sortIndexField&&e.add(this[n].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const n of zu){const r=this.childModel.component.scales[n];if(r&&!r.merged){const i=r.get("type"),s=r.get("range");if(Bn(i)&&vd(s)){const o=mE(this.childModel,n),a=rD(o);a?e[n]=a:K(rR(n))}}}return e}assembleRowColumnHeaderData(e,n,r){const i={row:"y",column:"x",facet:void 0}[e],s=[],o=[],a=[];i&&r&&r[i]&&(n?(s.push(`distinct_${r[i]}`),o.push("max")):(s.push(r[i]),o.push("distinct")),a.push(`distinct_${r[i]}`));const{sortField:u,sortIndexField:c}=this[e];if(u){const{op:l=tE,field:f}=u;s.push(f),o.push(l),a.push(nt(u,{forAs:!0}))}else c&&(s.push(c),o.push("max"),a.push(c));return{name:this[e].name,source:n??this.data,transform:[{type:"aggregate",groupby:this[e].fields,...s.length?{fields:s,ops:o,as:a}:{}}]}}assembleFacetHeaderData(e){var u;const{columns:n}=this.model.layout,{layoutHeaders:r}=this.model.component,i=[],s={};for(const c of XR){for(const l of KR){const f=(r[c]&&r[c][l])??[];for(const d of f)if(((u=d.axes)==null?void 0:u.length)>0){s[c]=!0;break}}if(s[c]){const l=`length(data("${this.facet.name}"))`,f=c==="row"?n?{signal:`ceil(${l} / ${n})`}:1:n?{signal:`min(${l}, ${n})`}:{signal:l};i.push({name:`${this.facet.name}_${c}`,transform:[{type:"sequence",start:0,stop:f}]})}}const{row:o,column:a}=s;return(o||a)&&i.unshift(this.assembleRowColumnHeaderData("facet",null,e)),i}assemble(){const e=[];let n=null;const r=this.getChildIndependentFieldsWithStep(),{column:i,row:s,facet:o}=this;if(i&&s&&(r.x||r.y)){n=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(r.x??[],r.y??[]),u=a.map(()=>"distinct");e.push({name:n,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:u}]})}for(const a of[uu,au])this[a]&&e.push(this.assembleRowColumnHeaderData(a,n,r));if(o){const a=this.assembleFacetHeaderData(r);a&&e.push(...a)}return e}}function pB(t){return t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1):t}function RWt(t,e){const n=GO(t);if(e==="number")return`toNumber(${n})`;if(e==="boolean")return`toBoolean(${n})`;if(e==="string")return`toString(${n})`;if(e==="date")return`toDate(${n})`;if(e==="flatten")return n;if(e.startsWith("date:")){const r=pB(e.slice(5,e.length));return`timeParse(${n},'${r}')`}else if(e.startsWith("utc:")){const r=pB(e.slice(4,e.length));return`utcParse(${n},'${r}')`}else return K(tPt(e)),null}function DWt(t){const e={};return Nv(t.filter,n=>{if(hit(n)){let r=null;cR(n)?r=Ai(n.equal):fR(n)?r=Ai(n.lte):lR(n)?r=Ai(n.lt):dR(n)?r=Ai(n.gt):hR(n)?r=Ai(n.gte):pR(n)?r=n.range[0]:gR(n)&&(r=(n.oneOf??n.in)[0]),r&&(wd(r)?e[n.field]="date":ue(r)?e[n.field]="number":at(r)&&(e[n.field]="string")),n.timeUnit&&(e[n.field]="date")}}),e}function LWt(t){const e={};function n(r){Fp(r)?e[r.field]="date":r.type==="quantitative"&&kBt(r.aggregate)?e[r.field]="number":$p(r.field)>1?r.field in e||(e[r.field]="flatten"):_d(r)&&cu(r.sort)&&$p(r.sort.field)>1&&(r.sort.field in e||(e[r.sort.field]="flatten"))}if((Ge(t)||Fi(t))&&t.forEachFieldDef((r,i)=>{if(Gr(r))n(r);else{const s=yd(i),o=t.fieldDef(s);n({...r,type:o.type})}}),Ge(t)){const{mark:r,markDef:i,encoding:s}=t;if(Al(r)&&!t.encoding.order){const o=i.orient==="horizontal"?"y":"x",a=s[o];Q(a)&&a.type==="quantitative"&&!(a.field in e)&&(e[a.field]="number")}}return e}function BWt(t){const e={};if(Ge(t)&&t.component.selection)for(const n of H(t.component.selection)){const r=t.component.selection[n];for(const i of r.project.items)!i.channel&&$p(i.field)>1&&(e[i.field]="flatten")}return e}class gr extends ve{clone(){return new gr(null,Rt(this._parse))}constructor(e,n){super(e),this._parse=n}hash(){return`Parse ${Qt(this._parse)}`}static makeExplicit(e,n,r){var o;let i={};const s=n.data;return!kc(s)&&((o=s==null?void 0:s.format)!=null&&o.parse)&&(i=s.format.parse),this.makeWithAncestors(e,i,{},r)}static makeWithAncestors(e,n,r,i){for(const a of H(r)){const u=i.getWithExplicit(a);u.value!==void 0&&(u.explicit||u.value===r[a]||u.value==="derived"||r[a]==="flatten"?delete r[a]:K(E9(a,r[a],u.value)))}for(const a of H(n)){const u=i.get(a);u!==void 0&&(u===n[a]?delete n[a]:K(E9(a,n[a],u)))}const s=new ju(n,r);i.copyAll(s);const o={};for(const a of H(s.combine())){const u=s.get(a);u!==null&&(o[a]=u)}return H(o).length===0||i.parseNothing?null:new gr(e,o)}get parse(){return this._parse}merge(e){this._parse={...this._parse,...e.parse},e.remove()}assembleFormatParse(){const e={};for(const n of H(this._parse)){const r=this._parse[n];$p(n)===1&&(e[n]=r)}return e}producedFields(){return new Set(H(this._parse))}dependentFields(){return new Set(H(this._parse))}assembleTransforms(e=!1){return H(this._parse).filter(n=>e?$p(n)>1:!0).map(n=>{const r=RWt(n,this._parse[n]);return r?{type:"formula",expr:r,as:_g(n)}:null}).filter(n=>n!==null)}}class sl extends ve{clone(){return new sl(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([Js])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Js}}}class M1 extends ve{clone(){return new M1(null,this.params)}constructor(e,n){super(e),this.params=n}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${Qt(this.params)}`}assemble(){return{type:"graticule",...this.params===!0?{}:this.params}}}class C1 extends ve{clone(){return new C1(null,this.params)}constructor(e,n){super(e),this.params=n}dependentFields(){return new Set}producedFields(){return new Set([this.params.as??"data"])}hash(){return`Hash ${Qt(this.params)}`}assemble(){return{type:"sequence",...this.params}}}class ed extends ve{constructor(e){super(null),e??(e={name:"source"});let n;if(kc(e)||(n=e.format?{...oi(e.format,["parse"])}:{}),ay(e))this._data={values:e.values};else if(Np(e)){if(this._data={url:e.url},!n.type){let r=/(?:\.([^.]+))?$/.exec(e.url)[1];Xt(["json","csv","tsv","dsv","topojson"],r)||(r="json"),n.type=r}}else Cst(e)?this._data={values:[{type:"Sphere"}]}:(kst(e)||kc(e))&&(this._data={});this._generator=kc(e),e.name&&(this._name=e.name),n&&!xe(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return{name:this._name,...this._data,transform:[]}}}var gB=function(t,e,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},PWt=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},jm;function tD(t){return t instanceof ed||t instanceof M1||t instanceof C1}class eD{constructor(){jm.set(this,void 0),gB(this,jm,!1,"f")}setModified(){gB(this,jm,!0,"f")}get modifiedFlag(){return PWt(this,jm,"f")}}jm=new WeakMap;class Sd extends eD{getNodeDepths(e,n,r){r.set(e,n);for(const i of e.children)this.getNodeDepths(i,n+1,r);return r}optimize(e){const r=[...this.getNodeDepths(e,0,new Map).entries()].sort((i,s)=>s[1]-i[1]);for(const i of r)this.run(i[0]);return this.modifiedFlag}}class nD extends eD{optimize(e){this.run(e);for(const n of e.children)this.optimize(n);return this.modifiedFlag}}class zWt extends nD{mergeNodes(e,n){const r=n.shift();for(const i of n)e.removeChild(i),i.parent=r,i.remove()}run(e){const n=e.children.map(i=>i.hash()),r={};for(let i=0;i<n.length;i++)r[n[i]]===void 0?r[n[i]]=[e.children[i]]:r[n[i]].push(e.children[i]);for(const i of H(r))r[i].length>1&&(this.setModified(),this.mergeNodes(e,r[i]))}}class UWt extends nD{constructor(e){super(),this.requiresSelectionId=e&&HR(e)}run(e){e instanceof sl&&(this.requiresSelectionId&&(tD(e.parent)||e.parent instanceof Ws||e.parent instanceof gr)||(this.setModified(),e.remove()))}}class jWt extends eD{optimize(e){return this.run(e,new Set),this.modifiedFlag}run(e,n){let r=new Set;e instanceof qo&&(r=e.producedFields(),WO(r,n)&&(this.setModified(),e.removeFormulas(n),e.producedFields.length===0&&e.remove()));for(const i of e.children)this.run(i,new Set([...n,...r]))}}class qWt extends nD{constructor(){super()}run(e){e instanceof ai&&!e.isRequired()&&(this.setModified(),e.remove())}}class WWt extends Sd{run(e){if(!tD(e)&&!(e.numChildren()>1)){for(const n of e.children)if(n instanceof gr)if(e instanceof gr)this.setModified(),e.merge(n);else{if(VO(e.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}}}}class VWt extends Sd{run(e){const n=[...e.children],r=e.children.filter(i=>i instanceof gr);if(e.numChildren()>1&&r.length>=1){const i={},s=new Set;for(const o of r){const a=o.parse;for(const u of H(a))u in i?i[u]!==a[u]&&s.add(u):i[u]=a[u]}for(const o of s)delete i[o];if(!xe(i)){this.setModified();const o=new gr(e,i);for(const a of n){if(a instanceof gr)for(const u of H(i))delete a.parse[u];e.removeChild(a),a.parent=o,a instanceof gr&&H(a.parse).length===0&&a.remove()}}}}}class GWt extends Sd{run(e){e instanceof ai||e.numChildren()>0||e instanceof Tg||e instanceof ed||(this.setModified(),e.remove())}}class YWt extends Sd{run(e){const n=e.children.filter(i=>i instanceof qo),r=n.pop();for(const i of n)this.setModified(),r.merge(i)}}class HWt extends Sd{run(e){const n=e.children.filter(i=>i instanceof Ws),r={};for(const i of n){const s=Qt(i.groupBy);s in r||(r[s]=[]),r[s].push(i)}for(const i of H(r)){const s=r[i];if(s.length>1){const o=s.pop();for(const a of s)o.merge(a)&&(e.removeChild(a),a.parent=o,a.remove(),this.setModified())}}}}class XWt extends Sd{constructor(e){super(),this.model=e}run(e){const n=!(tD(e)||e instanceof $g||e instanceof gr||e instanceof sl),r=[],i=[];for(const s of e.children)s instanceof Vo&&(n&&!VO(e.producedFields(),s.dependentFields())?r.push(s):i.push(s));if(r.length>0){const s=r.pop();for(const o of r)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified(),e instanceof Vo?e.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(i.length>1){const s=i.pop();for(const o of i)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified()}}}class KWt extends Sd{run(e){const n=[...e.children];if(!Ap(n,o=>o instanceof ai)||e.numChildren()<=1)return;const i=[];let s;for(const o of n)if(o instanceof ai){let a=o;for(;a.numChildren()===1;){const[u]=a.children;if(u instanceof ai)a=u;else break}i.push(...a.children),s?(e.removeChild(o),o.parent=s.parent,s.parent.removeChild(s),s.parent=a,this.setModified()):s=a}else i.push(o);if(i.length){this.setModified();for(const o of i)o.parent.removeChild(o),o.parent=s}}}class Ed extends ve{clone(){return new Ed(null,Rt(this.transform))}constructor(e,n){super(e),this.transform=n}addDimensions(e){this.transform.groupby=Bo(this.transform.groupby.concat(e),n=>n)}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){return e.as??nt(e)}hash(){return`JoinAggregateTransform ${Qt(this.transform)}`}assemble(){const e=[],n=[],r=[];for(const s of this.transform.joinaggregate)n.push(s.op),r.push(this.getDefaultName(s)),e.push(s.field===void 0?null:s.field);const i=this.transform.groupby;return{type:"joinaggregate",as:r,ops:n,fields:e,...i!==void 0?{groupby:i}:{}}}}class Bp extends ve{clone(){return new Bp(null,{...this.filter})}constructor(e,n){super(e),this.filter=n}static make(e,n,r){const{config:i,markDef:s}=n,{marks:o,scales:a}=r;if(o==="include-invalid-values"&&a==="include-invalid-values")return null;const u=n.reduceFieldDef((c,l,f)=>{const d=Sa(f)&&n.getScaleComponent(f);if(d){const h=d.get("type"),{aggregate:p}=l,g=_R({scaleChannel:f,markDef:s,config:i,scaleType:h,isCountAggregate:VS(p)});g!=="show"&&g!=="always-valid"&&(c[l.field]=l)}return c},{});return H(u).length?new Bp(e,u):null}dependentFields(){return new Set(H(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${Qt(this.filter)}`}assemble(){const e=H(this.filter).reduce((n,r)=>{const i=this.filter[r],s=nt(i,{expr:"datum"});return i!==null&&(i.type==="temporal"?n.push(`(isDate(${s}) || (${gM(s)}))`):i.type==="quantitative"&&n.push(gM(s))),n},[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}function gM(t){return`isValid(${t}) && isFinite(+${t})`}function QWt(t){return t.stack.stackBy.reduce((e,n)=>{const r=n.fieldDef,i=nt(r);return i&&e.push(i),e},[])}function JWt(t){return W(t)&&t.every(e=>at(e))&&t.length>1}class fu extends ve{clone(){return new fu(null,Rt(this._stack))}constructor(e,n){super(e),this._stack=n}static makeFromTransform(e,n){const{stack:r,groupby:i,as:s,offset:o="zero"}=n,a=[],u=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),u.push(ln(f.order,"ascending"));const c={field:a,order:u};let l;return JWt(s)?l=s:at(s)?l=[s,`${s}_end`]:l=[`${n.stack}_start`,`${n.stack}_end`],new fu(e,{dimensionFieldDefs:[],stackField:r,groupby:i,offset:o,sort:c,facetby:[],as:l})}static makeFromEncoding(e,n){const r=n.stack,{encoding:i}=n;if(!r)return null;const{groupbyChannels:s,fieldChannel:o,offset:a,impute:u}=r,c=s.map(h=>{const p=i[h];return Qs(p)}).filter(h=>!!h),l=QWt(n),f=n.encoding.order;let d;if(W(f)||Q(f))d=Yrt(f);else{const h=Lit(f)?f.sort:o==="y"?"descending":"ascending";d=l.reduce((p,g)=>(p.field.includes(g)||(p.field.push(g),p.order.push(h)),p),{field:[],order:[]})}return new fu(e,{dimensionFieldDefs:c,stackField:n.vgField(o),facetby:[],stackby:l,sort:d,offset:a,impute:u,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${Qt(this._stack)}`}getGroupbyFields(){const{dimensionFieldDefs:e,impute:n,groupby:r}=this._stack;return e.length>0?e.map(i=>i.bin?n?[nt(i,{binSuffix:"mid"})]:[nt(i,{}),nt(i,{binSuffix:"end"})]:[nt(i)]).flat():r??[]}assemble(){const e=[],{facetby:n,dimensionFieldDefs:r,stackField:i,stackby:s,sort:o,offset:a,impute:u,as:c}=this._stack;if(u)for(const l of r){const{bandPosition:f=.5,bin:d}=l;if(d){const h=nt(l,{expr:"datum"}),p=nt(l,{expr:"datum",binSuffix:"end"});e.push({type:"formula",expr:`${gM(h)} ? ${f}*${h}+${1-f}*${p} : ${h}`,as:nt(l,{binSuffix:"mid",forAs:!0})})}e.push({type:"impute",field:i,groupby:[...s,...n],key:nt(l,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:i,sort:o,as:c,offset:a}),e}}class kg extends ve{clone(){return new kg(null,Rt(this.transform))}constructor(e,n){super(e),this.transform=n}addDimensions(e){this.transform.groupby=Bo(this.transform.groupby.concat(e),n=>n)}dependentFields(){const e=new Set;return(this.transform.groupby??[]).forEach(e.add,e),(this.transform.sort??[]).forEach(n=>e.add(n.field)),this.transform.window.map(n=>n.field).filter(n=>n!==void 0).forEach(e.add,e),e}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){return e.as??nt(e)}hash(){return`WindowTransform ${Qt(this.transform)}`}assemble(){const e=[],n=[],r=[],i=[];for(const f of this.transform.window)n.push(f.op),r.push(this.getDefaultName(f)),i.push(f.param===void 0?null:f.param),e.push(f.field===void 0?null:f.field);const s=this.transform.frame,o=this.transform.groupby;if(s&&s[0]===null&&s[1]===null&&n.every(f=>eR(f)))return{type:"joinaggregate",as:r,ops:n,fields:e,...o!==void 0?{groupby:o}:{}};const a=[],u=[];if(this.transform.sort!==void 0)for(const f of this.transform.sort)a.push(f.field),u.push(f.order??"ascending");const c={field:a,order:u},l=this.transform.ignorePeers;return{type:"window",params:i,as:r,ops:n,fields:e,sort:c,...l!==void 0?{ignorePeers:l}:{},...o!==void 0?{groupby:o}:{},...s!==void 0?{frame:s}:{}}}}function ZWt(t){function e(n){if(!(n instanceof Tg)){const r=n.clone();if(r instanceof ai){const i=yM+r.getSource();r.setSource(i),t.model.component.data.outputNodes[i]=r}else(r instanceof Ws||r instanceof fu||r instanceof kg||r instanceof Ed)&&r.addDimensions(t.fields);for(const i of n.children.flatMap(e))i.parent=r;return[r]}return n.children.flatMap(e)}return e}function mM(t){if(t instanceof Tg)if(t.numChildren()===1&&!(t.children[0]instanceof ai)){const e=t.children[0];(e instanceof Ws||e instanceof fu||e instanceof kg||e instanceof Ed)&&e.addDimensions(t.fields),e.swapWithParent(),mM(t)}else{const e=t.model.component.data.main;Tot(e);const n=ZWt(t),r=t.children.map(n).flat();for(const i of r)i.parent=e}else t.children.map(mM)}function Tot(t){if(t instanceof ai&&t.type===Ke.Main&&t.numChildren()===1){const e=t.children[0];e instanceof Tg||(e.swapWithParent(),Tot(t))}}const yM="scale_",Nb=5;function bM(t){for(const e of t){for(const n of e.children)if(n.parent!==e)return!1;if(!bM(e.children))return!1}return!0}function Ts(t,e){let n=!1;for(const r of e)n=t.optimize(r)||n;return n}function mB(t,e,n){let r=t.sources,i=!1;return i=Ts(new qWt,r)||i,i=Ts(new UWt(e),r)||i,r=r.filter(s=>s.numChildren()>0),i=Ts(new GWt,r)||i,r=r.filter(s=>s.numChildren()>0),n||(i=Ts(new WWt,r)||i,i=Ts(new XWt(e),r)||i,i=Ts(new jWt,r)||i,i=Ts(new VWt,r)||i,i=Ts(new HWt,r)||i,i=Ts(new YWt,r)||i,i=Ts(new zWt,r)||i,i=Ts(new KWt,r)||i),t.sources=r,i}function tVt(t,e){bM(t.sources);let n=0,r=0;for(let i=0;i<Nb&&mB(t,e,!0);i++)n++;t.sources.map(mM);for(let i=0;i<Nb&&mB(t,e,!1);i++)r++;bM(t.sources),Math.max(n,r)===Nb&&K(`Maximum optimization runs(${Nb}) reached.`)}class kn{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,n){return new kn(()=>e(n))}}function kot(t){Ge(t)?eVt(t):nVt(t)}function eVt(t){const e=t.component.scales;for(const n of H(e)){const r=iVt(t,n);if(e[n].setWithExplicit("domains",r),oVt(t,n),t.component.data.isFaceted){let s=t;for(;!Fi(s)&&s.parent;)s=s.parent;if(s.component.resolve.scale[n]==="shared")for(const a of r.value)nu(a)&&(a.data=yM+a.data.replace(yM,""))}}}function nVt(t){for(const n of t.children)kot(n);const e=t.component.scales;for(const n of H(e)){let r,i=null;for(const s of t.children){const o=s.component.scales[n];if(o){r===void 0?r=o.getWithExplicit("domains"):r=il(r,o.getWithExplicit("domains"),"domains","scale",vM);const a=o.get("selectionExtent");i&&a&&i.param!==a.param&&K(YBt),i=a}}e[n].setWithExplicit("domains",r),i&&e[n].set("selectionExtent",i,!0)}}function rVt(t,e,n,r){if(t==="unaggregated"){const{valid:i,reason:s}=yB(e,n);if(!i){K(s);return}}else if(t===void 0&&r.useUnaggregatedDomain){const{valid:i}=yB(e,n);if(i)return"unaggregated"}return t}function iVt(t,e){const n=t.getScaleComponent(e).get("type"),{encoding:r}=t,i=rVt(t.scaleDomain(e),t.typedFieldDef(e),n,t.config.scale);return i!==t.scaleDomain(e)&&(t.specifiedScales[e]={...t.specifiedScales[e],domain:i}),e==="x"&&Sn(r.x2)?Sn(r.x)?il(Ku(n,i,t,"x"),Ku(n,i,t,"x2"),"domain","scale",vM):Ku(n,i,t,"x2"):e==="y"&&Sn(r.y2)?Sn(r.y)?il(Ku(n,i,t,"y"),Ku(n,i,t,"y2"),"domain","scale",vM):Ku(n,i,t,"y2"):Ku(n,i,t,e)}function sVt(t,e,n){return t.map(r=>({signal:`{data: ${iE(r,{timeUnit:n,type:e})}}`}))}function R$(t,e,n){var i;const r=(i=Dn(n))==null?void 0:i.unit;return e==="temporal"||r?sVt(t,e,r):[t]}function Ku(t,e,n,r){const{encoding:i,markDef:s,mark:o,config:a,stack:u}=n,c=Sn(i[r]),{type:l}=c,f=c.timeUnit,d=Qjt({invalid:ia("invalid",s,a),isPath:Al(o)});if(vzt(e)){const g=Ku(t,void 0,n,r),m=R$(e.unionWith,l,f);return Eo([...m,...g.value])}else{if(gt(e))return Eo([e]);if(e&&e!=="unaggregated"&&!wit(e))return Eo(R$(e,l,f))}if(u&&r===u.fieldChannel){if(u.offset==="normalize")return wi([[0,1]]);const g=n.requestDataName(d);return wi([{data:g,field:n.vgField(r,{suffix:"start"})},{data:g,field:n.vgField(r,{suffix:"end"})}])}const h=Sa(r)&&Q(c)?aVt(n,r,t):void 0;if(Ea(c)){const g=R$([c.datum],l,f);return wi(g)}const p=c;if(e==="unaggregated"){const{field:g}=c;return wi([{data:n.requestDataName(d),field:nt({field:g,aggregate:"min"})},{data:n.requestDataName(d),field:nt({field:g,aggregate:"max"})}])}else if(Ne(p.bin)){if(Bn(t))return wi(t==="bin-ordinal"?[]:[{data:iy(h)?n.requestDataName(d):n.requestDataName(Ke.Raw),field:n.vgField(r,$1(p,r)?{binSuffix:"range"}:{}),sort:h===!0||!st(h)?{field:n.vgField(r,{}),op:"min"}:h}]);{const{bin:g}=p;if(Ne(g)){const m=ZR(n,p.field,g);return wi([new kn(()=>{const y=n.getSignalName(m);return`[${y}.start, ${y}.stop]`})])}else return wi([{data:n.requestDataName(d),field:n.vgField(r,{})}])}}else if(p.timeUnit&&Xt(["time","utc"],t)){const g=i[_a(r)];if(Dit(p,g,s,a)){const m=n.requestDataName(d),y=rl({fieldDef:p,fieldDef2:g,markDef:s,config:a}),b=oy(o)&&y!==.5&&fn(r);return wi([{data:m,field:n.vgField(r,b?{suffix:lE}:{})},{data:m,field:n.vgField(r,{suffix:b?fE:"end"})}])}}return wi(h?[{data:iy(h)?n.requestDataName(d):n.requestDataName(Ke.Raw),field:n.vgField(r),sort:h}]:[{data:n.requestDataName(d),field:n.vgField(r)}])}function D$(t,e){const{op:n,field:r,order:i}=t;return{op:n??(e?"sum":tE),...r?{field:xs(r)}:{},...i?{order:i}:{}}}function oVt(t,e){var a;const n=t.component.scales[e],r=t.specifiedScales[e].domain,i=(a=t.fieldDef(e))==null?void 0:a.bin,s=wit(r)?r:void 0,o=bd(i)&&GS(i.extent)?i.extent:void 0;(s||o)&&n.set("selectionExtent",s??o,!0)}function aVt(t,e,n){if(!Bn(n))return;const r=t.fieldDef(e),i=r.sort;if(Oit(i))return{op:"min",field:Dp(r,e),order:"ascending"};const{stack:s}=t,o=s?new Set([...s.groupbyFields,...s.stackBy.map(a=>a.fieldDef.field)]):void 0;if(cu(i)){const a=s&&!o.has(i.field);return D$(i,a)}else if(Qzt(i)){const{encoding:a,order:u}=i,c=t.fieldDef(a),{aggregate:l,field:f}=c,d=s&&!o.has(f);if(xu(l)||El(l))return D$({field:nt(c),order:u},d);if(eR(l)||!l)return D$({op:l,field:f,order:u},d)}else{if(i==="descending")return{op:"min",field:t.vgField(e),order:"descending"};if(Xt(["ascending",void 0],i))return!0}}function yB(t,e){const{aggregate:n,type:r}=t;return n?at(n)&&!CBt.has(n)?{valid:!1,reason:_Pt(n)}:r==="quantitative"&&e==="log"?{valid:!1,reason:SPt(t)}:{valid:!0}:{valid:!1,reason:xPt(t)}}function vM(t,e,n,r){return t.explicit&&e.explicit&&K(kPt(n,r,t.value,e.value)),{explicit:t.explicit,value:[...t.value,...e.value]}}function uVt(t){const e=Bo(t.map(o=>{if(nu(o)){const{sort:a,...u}=o;return u}return o}),Qt),n=Bo(t.map(o=>{if(nu(o)){const a=o.sort;return a!==void 0&&!iy(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}}).filter(o=>o!==void 0),Qt);if(e.length===0)return;if(e.length===1){const o=t[0];if(nu(o)&&n.length>0){let a=n[0];if(n.length>1){K($9);const u=n.filter(c=>st(c)&&"op"in c&&c.op!=="min");n.every(c=>st(c)&&"op"in c)&&u.length===1?a=u[0]:a=!0}else if(st(a)&&"field"in a){const u=a.field;o.field===u&&(a=a.order?{order:a.order}:!0)}return{...o,sort:a}}return o}const r=Bo(n.map(o=>iy(o)||!("op"in o)||at(o.op)&&ft($Bt,o.op)?o:(K(CPt(o)),!0)),Qt);let i;r.length===1?i=r[0]:r.length>1&&(K($9),i=!0);const s=Bo(t.map(o=>nu(o)?o.data:null),o=>o);return s.length===1&&s[0]!==null?{data:s[0],fields:e.map(a=>a.field),...i?{sort:i}:{}}:{fields:e,...i?{sort:i}:{}}}function rD(t){if(nu(t)&&at(t.field))return t.field;if(IBt(t)){let e;for(const n of t.fields)if(nu(n)&&at(n.field)){if(!e)e=n.field;else if(e!==n.field)return K(IPt),e}return K(FPt),e}else if(FBt(t)){K(NPt);const e=t.fields[0];return at(e)?e:void 0}}function mE(t,e){const r=t.component.scales[e].get("domains").map(i=>(nu(i)&&(i.data=t.lookupDataSource(i.data)),i));return uVt(r)}function Mot(t){return Mg(t)||iD(t)?t.children.reduce((e,n)=>e.concat(Mot(n)),bB(t)):bB(t)}function bB(t){return H(t.component.scales).reduce((e,n)=>{const r=t.component.scales[n];if(r.merged)return e;const i=r.combine(),{name:s,type:o,selectionExtent:a,domains:u,range:c,reverse:l,...f}=i,d=cVt(i.range,s,n,t),h=mE(t,n),p=a?uqt(t,a,r,h):null;return e.push({name:s,type:o,...h?{domain:h}:{},...p?{domainRaw:p}:{},range:d,...l!==void 0?{reverse:l}:{},...f}),e},[])}function cVt(t,e,n,r){if(fn(n)){if(vd(t))return{step:{signal:`${e}_step`}}}else if(st(t)&&nu(t))return{...t,data:r.lookupDataSource(t.data)};return t}class Cot extends ju{constructor(e,n){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",n)}domainHasZero(){const e=this.get("type");if(Xt([Wn.LOG,Wn.TIME,Wn.UTC],e))return"definitely-not";const n=this.get("zero");if(n===!0||n===void 0&&Xt([Wn.LINEAR,Wn.SQRT,Wn.POW],e))return"definitely";const r=this.get("domains");if(r.length>0){let i=!1,s=!1,o=!1;for(const a of r){if(W(a)){const u=a[0],c=a[a.length-1];if(ue(u)&&ue(c))if(u<=0&&c>=0){i=!0;continue}else{s=!0;continue}}o=!0}if(i)return"definitely";if(s&&!o)return"definitely-not"}return"maybe"}}const lVt=["range","scheme"];function fVt(t){const e=t.component.scales;for(const n of tR){const r=e[n];if(!r)continue;const i=dVt(n,t);r.setWithExplicit("range",i)}}function vB(t,e){const n=t.fieldDef(e);if(n!=null&&n.bin){const{bin:r,field:i}=n,s=mi(e),o=t.getName(s);if(st(r)&&r.binned&&r.step!==void 0)return new kn(()=>{const a=t.scaleName(e),u=`(domain("${a}")[1] - domain("${a}")[0]) / ${r.step}`;return`${t.getSignalName(o)} / (${u})`});if(Ne(r)){const a=ZR(t,i,r);return new kn(()=>{const u=t.getSignalName(a),c=`(${u}.stop - ${u}.start) / ${u}.step`;return`${t.getSignalName(o)} / (${c})`})}}}function dVt(t,e){const n=e.specifiedScales[t],{size:r}=e,s=e.getScaleComponent(t).get("type");for(const f of lVt)if(n[f]!==void 0){const d=Zk(s,f),h=xit(t,f);if(!d)K(tit(s,f,t));else if(h)K(h);else switch(f){case"range":{const p=n.range;if(W(p)){if(fn(t))return Eo(p.map(g=>{if(g==="width"||g==="height"){const m=e.getName(g),y=e.getSignalName.bind(e);return kn.fromName(y,m)}return g}))}else if(st(p))return Eo({data:e.requestDataName(Ke.Main),field:p.field,sort:{op:"min",field:e.vgField(t)}});return Eo(p)}case"scheme":return Eo(hVt(n[f]))}}const o=t===We||t==="xOffset"?"width":"height",a=r[o];if(oa(a)){if(fn(t))if(Bn(s)){const f=Fot(a,e,t);if(f)return Eo({step:f})}else K(eit(o));else if(v1(t)){const f=t===bl?"x":"y";if(e.getScaleComponent(f).get("type")==="band"){const p=Not(a,s);if(p)return Eo(p)}}}const{rangeMin:u,rangeMax:c}=n,l=pVt(t,e);return(u!==void 0||c!==void 0)&&Zk(s,"rangeMin")&&W(l)&&l.length===2?Eo([u??l[0],c??l[1]]):wi(l)}function hVt(t){return bzt(t)?{scheme:t.name,...oi(t,["name"])}:{scheme:t}}function Iot(t,e,n,{center:r}={}){const i=mi(t),s=e.getName(i),o=e.getSignalName.bind(e);return t===zn&&Xs(n)?r?[kn.fromName(a=>`${o(a)}/2`,s),kn.fromName(a=>`-${o(a)}/2`,s)]:[kn.fromName(o,s),0]:r?[kn.fromName(a=>`-${o(a)}/2`,s),kn.fromName(a=>`${o(a)}/2`,s)]:[0,kn.fromName(o,s)]}function pVt(t,e){const{size:n,config:r,mark:i,encoding:s}=e,{type:o}=Sn(s[t]),u=e.getScaleComponent(t).get("type"),{domain:c,domainMid:l}=e.specifiedScales[t];switch(t){case We:case zn:{if(Xt(["point","band"],u)){const f=Oot(t,n,r.view);if(oa(f))return{step:Fot(f,e,t)}}return Iot(t,e,u)}case bl:case Sg:return gVt(t,e,u);case Bu:{const f=bVt(i,r),d=vVt(i,n,e,r);return Mp(u)?yVt(f,d,mVt(u,r,c,t)):[f,d]}case As:return[0,Math.PI*2];case md:return[0,360];case co:return[0,new kn(()=>{const f=e.getSignalName(Fi(e.parent)?"child_width":"width"),d=e.getSignalName(Fi(e.parent)?"child_height":"height");return`min(${f},${d})/2`})];case vl:return{step:1e3/r.scale.framesPerSecond};case _l:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case Sl:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case gi:return"symbol";case pi:case wa:case xa:return u==="ordinal"?o==="nominal"?"category":"ordinal":l!==void 0?"diverging":i==="rect"||i==="geoshape"?"heatmap":"ramp";case Pu:case wl:case xl:return[r.scale.minOpacity,r.scale.maxOpacity]}}function Fot(t,e,n){const{encoding:r}=e,i=e.getScaleComponent(n),s=KO(n),o=r[s];if(pst({step:t,offsetIsDiscrete:Bt(o)&&git(o.type)})==="offset"&&Hit(r,s)){const u=e.getScaleComponent(s);let l=`domain('${e.scaleName(s)}').length`;if(u.get("type")==="band"){const d=u.get("paddingInner")??u.get("padding")??0,h=u.get("paddingOuter")??u.get("padding")??0;l=`bandspace(${l}, ${d}, ${h})`}const f=i.get("paddingInner")??i.get("padding");return{signal:`${t.step} * ${l} / (1-${DBt(f)})`}}else return t.step}function Not(t,e){if(pst({step:t,offsetIsDiscrete:Bn(e)})==="offset")return{step:t.step}}function gVt(t,e,n){const r=t===bl?"x":"y",i=e.getScaleComponent(r);if(!i)return Iot(r,e,n,{center:!0});const s=i.get("type"),o=e.scaleName(r),{markDef:a,config:u}=e;if(s==="band"){const c=Oot(r,e.size,e.config.view);if(oa(c)){const l=Not(c,n);if(l)return l}return[0,{signal:`bandwidth('${o}')`}]}else{const c=e.encoding[r];if(Q(c)&&c.timeUnit){const l=fit(c.timeUnit,p=>`scale('${o}', ${p})`),f=e.config.scale.bandWithNestedOffsetPaddingInner,d=rl({fieldDef:c,markDef:a,config:u})-.5,h=d!==0?` + ${d}`:"";if(f){const p=gt(f)?`${f.signal}/2`+h:`${f/2+d}`,g=gt(f)?`(1 - ${f.signal}/2)`+h:`${1-f/2+d}`;return[{signal:`${p} * (${l})`},{signal:`${g} * (${l})`}]}return[0,{signal:l}]}return _rt(`Cannot use ${t} scale if ${r} scale is not discrete.`)}}function Oot(t,e,n){const r=t===We?"width":"height",i=e[r];return i||c2(n,r)}function mVt(t,e,n,r){switch(t){case"quantile":return e.scale.quantileCount;case"quantize":return e.scale.quantizeCount;case"threshold":return n!==void 0&&W(n)?n.length+1:(K(jPt(r)),3)}}function yVt(t,e,n){const r=()=>{const i=Ps(e),s=Ps(t),o=`(${i} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${i} + ${o}, ${o})`};return gt(e)?new kn(r):{signal:r()}}function bVt(t,e){switch(t){case"bar":case"tick":return e.scale.minBandSize;case"line":case"trail":case"rule":return e.scale.minStrokeWidth;case"text":return e.scale.minFontSize;case"point":case"square":case"circle":return e.scale.minSize}throw new Error(YS("size",t))}const wB=.95;function vVt(t,e,n,r){const i={x:vB(n,"x"),y:vB(n,"y")};switch(t){case"bar":case"tick":{if(r.scale.maxBandSize!==void 0)return r.scale.maxBandSize;const s=xB(e,i,r.view);return ue(s)?s-1:new kn(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const s=xB(e,i,r.view);return ue(s)?Math.pow(wB*s,2):new kn(()=>`pow(${wB} * ${s.signal}, 2)`)}}throw new Error(YS("size",t))}function xB(t,e,n){const r=oa(t.width)?t.width.step:rM(n,"width"),i=oa(t.height)?t.height.step:rM(n,"height");return e.x||e.y?new kn(()=>`min(${[e.x?e.x.signal:r,e.y?e.y.signal:i].join(", ")})`):Math.min(r,i)}function Rot(t,e){Ge(t)?wVt(t,e):Lot(t,e)}function wVt(t,e){const n=t.component.scales,{config:r,encoding:i,markDef:s,specifiedScales:o}=t;for(const a of H(n)){const u=o[a],c=n[a],l=t.getScaleComponent(a),f=Sn(i[a]),d=u[e],h=l.get("type"),p=l.get("padding"),g=l.get("paddingInner"),m=Zk(h,e),y=xit(a,e);if(d!==void 0&&(m?y&&K(y):K(tit(h,e,a))),m&&y===void 0)if(d!==void 0){const b=f.timeUnit,w=f.type;switch(e){case"domainMax":case"domainMin":wd(u[e])||w==="temporal"||b?c.set(e,{signal:iE(u[e],{type:w,timeUnit:b})},!0):c.set(e,u[e],!0);break;default:c.copyKeyFromObject(e,u)}}else{const b=X(_B,e)?_B[e]({model:t,channel:a,fieldOrDatumDef:f,scaleType:h,scalePadding:p,scalePaddingInner:g,domain:u.domain,domainMin:u.domainMin,domainMax:u.domainMax,markDef:s,config:r,hasNestedOffsetScale:Xit(i,a),hasSecondaryRangeChannel:!!i[_a(a)]}):r.scale[e];b!==void 0&&c.set(e,b,!1)}}}const _B={bins:({model:t,fieldOrDatumDef:e})=>Q(e)?xVt(t,e):void 0,interpolate:({channel:t,fieldOrDatumDef:e})=>_Vt(t,e.type),nice:({scaleType:t,channel:e,domain:n,domainMin:r,domainMax:i,fieldOrDatumDef:s})=>SVt(t,e,n,r,i,s),padding:({channel:t,scaleType:e,fieldOrDatumDef:n,markDef:r,config:i})=>EVt(t,e,i.scale,n,r,i.bar),paddingInner:({scalePadding:t,channel:e,markDef:n,scaleType:r,config:i,hasNestedOffsetScale:s})=>AVt(t,e,n.type,r,i.scale,s),paddingOuter:({scalePadding:t,channel:e,scaleType:n,scalePaddingInner:r,config:i,hasNestedOffsetScale:s})=>$Vt(t,e,n,r,i.scale,s),reverse:({fieldOrDatumDef:t,scaleType:e,channel:n,config:r})=>{const i=Q(t)?t.sort:void 0;return TVt(e,i,n,r.scale)},zero:({channel:t,fieldOrDatumDef:e,domain:n,markDef:r,scaleType:i,config:s,hasSecondaryRangeChannel:o})=>kVt(t,e,n,r,i,s.scale,o)};function Dot(t){Ge(t)?fVt(t):Lot(t,"range")}function Lot(t,e){const n=t.component.scales;for(const r of t.children)e==="range"?Dot(r):Rot(r,e);for(const r of H(n)){let i;for(const s of t.children){const o=s.component.scales[r];if(o){const a=o.getWithExplicit(e);i=il(i,a,e,"scale",Tst((u,c)=>{switch(e){case"range":return u.step&&c.step?u.step-c.step:0}return 0}))}}n[r].setWithExplicit(e,i)}}function xVt(t,e){const n=e.bin;if(Ne(n)){const r=ZR(t,e.field,n);return new kn(()=>t.getSignalName(r))}else if(Un(n)&&bd(n)&&n.step!==void 0)return{step:n.step}}function _Vt(t,e){if(Xt([pi,wa,xa],t)&&e!=="nominal")return"hcl"}function SVt(t,e,n,r,i,s){var o;if(!((o=Qs(s))!=null&&o.bin||W(n)||i!=null||r!=null||Xt([Wn.TIME,Wn.UTC],t)))return fn(e)?!0:void 0}function EVt(t,e,n,r,i,s){if(fn(t)){if(Po(e)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=i;if(o==="bar"&&!(Q(r)&&(r.bin||r.timeUnit))&&(a==="vertical"&&t==="x"||a==="horizontal"&&t==="y"))return s.continuousBandSize}if(e===Wn.POINT)return n.pointPadding}}function AVt(t,e,n,r,i,s=!1){if(t===void 0){if(fn(e)){const{bandPaddingInner:o,barBandPaddingInner:a,rectBandPaddingInner:u,tickBandPaddingInner:c,bandWithNestedOffsetPaddingInner:l}=i;return s?l:ln(o,n==="bar"?a:n==="tick"?c:u)}else if(v1(e)&&r===Wn.BAND)return i.offsetBandPaddingInner}}function $Vt(t,e,n,r,i,s=!1){if(t===void 0){if(fn(e)){const{bandPaddingOuter:o,bandWithNestedOffsetPaddingOuter:a}=i;if(s)return a;if(n===Wn.BAND)return ln(o,gt(r)?{signal:`${r.signal}/2`}:r/2)}else if(v1(e)){if(n===Wn.POINT)return .5;if(n===Wn.BAND)return i.offsetBandPaddingOuter}}}function TVt(t,e,n,r){if(n==="x"&&r.xReverse!==void 0)return Xs(t)&&e==="descending"?gt(r.xReverse)?{signal:`!${r.xReverse.signal}`}:!r.xReverse:r.xReverse;if(Xs(t)&&e==="descending")return!0}function kVt(t,e,n,r,i,s,o){if(!!n&&n!=="unaggregated"&&Xs(i)){if(W(n)){const u=n[0],c=n[n.length-1];if(ue(u)&&u<=0&&ue(c)&&c>=0)return!0}return!1}if(t==="size"&&e.type==="quantitative"&&!Mp(i))return!0;if(!(Q(e)&&e.bin)&&Xt([...zu,...yBt],t)){const{orient:u,type:c}=r;return Xt(["bar","area","line","trail"],c)&&(u==="horizontal"&&t==="y"||u==="vertical"&&t==="x")?!1:Xt(["bar","area"],c)&&!o?!0:s==null?void 0:s.zero}return!1}function MVt(t,e,n,r,i=!1){const s=CVt(e,n,r,i),{type:o}=t;return Sa(e)?o!==void 0?Azt(e,o)?Q(n)&&!Ezt(o,n.type)?(K($Pt(o,s)),s):o:(K(APt(e,o,s)),s):s:null}function CVt(t,e,n,r){var i;switch(e.type){case"nominal":case"ordinal":{if(Bh(t)||E$(t)==="discrete")return t==="shape"&&e.type==="ordinal"&&K(A$(t,"ordinal")),"ordinal";if(S$(t))return"band";if(fn(t)||v1(t)){if(Xt(["rect","bar","image","rule","tick"],n.type)||r)return"band"}else if(n.type==="arc"&&t in ZO)return"band";const s=n[mi(t)];return Qf(s)||Ip(e)&&((i=e.axis)!=null&&i.tickBand)?"band":"point"}case"temporal":return Bh(t)?"time":E$(t)==="discrete"?(K(A$(t,"temporal")),"ordinal"):Q(e)&&e.timeUnit&&Dn(e.timeUnit).utc?"utc":S$(t)?"band":"time";case"quantitative":return Bh(t)?Q(e)&&Ne(e.bin)?"bin-ordinal":"linear":E$(t)==="discrete"?(K(A$(t,"quantitative")),"ordinal"):S$(t)?"band":"linear";case"geojson":return}throw new Error(Jrt(e.type))}function IVt(t,{ignoreRange:e}={}){Bot(t),kot(t);for(const n of Szt)Rot(t,n);e||Dot(t)}function Bot(t){Ge(t)?t.component.scales=FVt(t):t.component.scales=OVt(t)}function FVt(t){const{encoding:e,mark:n,markDef:r}=t,i={};for(const s of tR){const o=Sn(e[s]);if(o&&n===Eit&&s===gi&&o.type===Eg)continue;let a=o&&o.scale;if(o&&a!==null&&a!==!1){a??(a={});const u=Xit(e,s),c=MVt(a,s,o,r,u);i[s]=new Cot(t.scaleName(`${s}`,!0),{value:c,explicit:a.type===c})}}return i}const NVt=Tst((t,e)=>k9(t)-k9(e));function OVt(t){var e;const n=t.component.scales={},r={},i=t.component.resolve;for(const s of t.children){Bot(s);for(const o of H(s.component.scales))if((e=i.scale)[o]??(e[o]=got(o,t)),i.scale[o]==="shared"){const a=r[o],u=s.component.scales[o].getWithExplicit("type");a?hzt(a.value,u.value)?r[o]=il(a,u,"type","scale",NVt):(i.scale[o]="independent",delete r[o]):r[o]=u}}for(const s of H(r)){const o=t.scaleName(s,!0),a=r[s];n[s]=new Cot(o,a);for(const u of t.children){const c=u.component.scales[s];c&&(u.renameScale(c.get("name"),o),c.merged=!0)}}return n}class L${constructor(){this.nameMap={}}rename(e,n){this.nameMap[e]=n}has(e){return this.nameMap[e]!==void 0}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function Ge(t){return(t==null?void 0:t.type)==="unit"}function Fi(t){return(t==null?void 0:t.type)==="facet"}function iD(t){return(t==null?void 0:t.type)==="concat"}function Mg(t){return(t==null?void 0:t.type)==="layer"}class sD{constructor(e,n,r,i,s,o,a){this.type=n,this.parent=r,this.config=s,this.parent=r,this.config=s,this.view=jn(a),this.name=e.name??i,this.title=sc(e.title)?{text:e.title}:e.title?jn(e.title):void 0,this.scaleNameMap=r?r.scaleNameMap:new L$,this.projectionNameMap=r?r.projectionNameMap:new L$,this.signalNameMap=r?r.signalNameMap:new L$,this.data=e.data,this.description=e.description,this.transforms=Pjt(e.transform??[]),this.layout=n==="layer"||n==="unit"?{}:qUt(e,n,s),this.component={data:{sources:r?r.component.data.sources:[],outputNodes:r?r.component.data.outputNodes:{},outputNodeRefCounts:r?r.component.data.outputNodeRefCounts:{},isFaceted:eE(e)||(r==null?void 0:r.component.data.isFaceted)&&e.data===void 0},layoutSize:new ju,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:{scale:{},axis:{},legend:{},...o?Rt(o):{}},selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){IVt(this)}parseProjection(){Aot(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){wot(this)}assembleEncodeFromView(e){const{style:n,...r}=e,i={};for(const s of H(r)){const o=r[s];o!==void 0&&(i[s]=Re(o))}return i}assembleGroupEncodeEntry(e){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!e&&(this.description&&(n.description=Re(this.description)),this.type==="unit"||this.type==="layer")?{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height"),...n}:xe(n)?void 0:n}assembleLayout(){if(!this.layout)return;const{spacing:e,...n}=this.layout,{component:r,config:i}=this,s=tWt(r.layoutHeaders,i);return{padding:e,...this.assembleDefaultLayout(),...n,...s?{titleBand:s}:{}}}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let n=[];for(const r of es)e[r].title&&n.push(Hqt(this,r));for(const r of XR)n=n.concat(Xqt(this,r));return n}assembleAxes(){return Rqt(this.component.axes,this.config)}assembleLegends(){return _ot(this)}assembleProjections(){return SWt(this)}assembleTitle(){const{encoding:e,...n}=this.title??{},r={...qrt(this.config.title).nonMarkTitleProperties,...n,...e?{encode:{update:e}}:{}};if(r.text)return Xt(["unit","layer"],this.type)?Xt(["middle",void 0],r.anchor)&&(r.frame??(r.frame="group")):r.anchor??(r.anchor="start"),xe(r)?void 0:r}assembleGroup(e=[]){const n={};e=e.concat(this.assembleSignals()),e.length>0&&(n.signals=e);const r=this.assembleLayout();r&&(n.layout=r),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||Fi(this.parent)?Mot(this):[];i.length>0&&(n.scales=i);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(e){return qe((this.name?`${this.name}_`:"")+e)}getDataName(e){return this.getName(Ke[e].toLowerCase())}requestDataName(e){const n=this.getDataName(e),r=this.component.data.outputNodeRefCounts;return r[n]=(r[n]||0)+1,n}getSizeSignalRef(e){if(Fi(this.parent)){const n=hot(e),r=WS(n),i=this.component.scales[r];if(i&&!i.merged){const s=i.get("type"),o=i.get("range");if(Bn(s)&&vd(o)){const a=i.get("name"),u=mE(this,r),c=rD(u);if(c){const l=nt({aggregate:"distinct",field:c},{expr:"datum"});return{signal:dot(a,i,l)}}else return K(rR(r)),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const n=this.component.data.outputNodes[e];return n?n.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,n){this.signalNameMap.rename(e,n)}renameScale(e,n){this.scaleNameMap.rename(e,n)}renameProjection(e,n){this.projectionNameMap.rename(e,n)}scaleName(e,n){if(n)return this.getName(e);if(Rrt(e)&&Sa(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e)))return this.scaleNameMap.get(this.getName(e))}projectionName(e){if(e)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[e];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(e):void 0}getScaleType(e){const n=this.getScaleComponent(e);return n?n.get("type"):void 0}getSelectionComponent(e,n){let r=this.component.selection[e];if(!r&&this.parent&&(r=this.parent.getSelectionComponent(e,n)),!r)throw new Error(UBt(n));return r}hasAxisOrientSignalRef(){var e,n;return((e=this.component.axes.x)==null?void 0:e.some(r=>r.hasOrientSignalRef()))||((n=this.component.axes.y)==null?void 0:n.some(r=>r.hasOrientSignalRef()))}}class Pot extends sD{vgField(e,n={}){const r=this.fieldDef(e);if(r)return nt(r,n)}reduceFieldDef(e,n){return bUt(this.getMapping(),(r,i,s)=>{const o=Qs(i);return o?e(r,o,s):r},n)}forEachFieldDef(e,n){IR(this.getMapping(),(r,i)=>{const s=Qs(r);s&&e(s,i)},n)}}class yE extends ve{clone(){return new yE(null,Rt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Rt(n);const r=this.transform.as??[void 0,void 0];this.transform.as=[r[0]??"value",r[1]??"density"];const i=this.transform.resolve??"shared";this.transform.resolve=i}dependentFields(){return new Set([this.transform.density,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${Qt(this.transform)}`}assemble(){const{density:e,...n}=this.transform,r={type:"kde",field:e,...n};return r.resolve=this.transform.resolve,r}}class bE extends ve{clone(){return new bE(null,Rt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Rt(n)}dependentFields(){return new Set([this.transform.extent])}producedFields(){return new Set([])}hash(){return`ExtentTransform ${Qt(this.transform)}`}assemble(){const{extent:e,param:n}=this.transform;return{type:"extent",field:e,signal:n}}}class vE extends ve{clone(){return new vE(this.parent,Rt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Rt(n);const{flatten:r,as:i=[]}=this.transform;this.transform.as=r.map((s,o)=>i[o]??s)}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${Qt(this.transform)}`}assemble(){const{flatten:e,as:n}=this.transform;return{type:"flatten",fields:e,as:n}}}class wE extends ve{clone(){return new wE(null,Rt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Rt(n);const r=this.transform.as??[void 0,void 0];this.transform.as=[r[0]??"key",r[1]??"value"]}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${Qt(this.transform)}`}assemble(){const{fold:e,as:n}=this.transform;return{type:"fold",fields:e,as:n}}}class Uh extends ve{clone(){return new Uh(null,Rt(this.fields),this.geojson,this.signal)}static parseAll(e,n){if(n.component.projection&&!n.component.projection.isFit)return e;let r=0;for(const i of[[fo,lo],[_s,ho]]){const s=i.map(o=>{const a=Sn(n.encoding[o]);return Q(a)?a.field:Ea(a)?{expr:`${a.datum}`}:Ks(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(e=new Uh(e,s,null,n.getName(`geojson_${r++}`)))}if(n.channelHasField(gi)){const i=n.typedFieldDef(gi);i.type===Eg&&(e=new Uh(e,null,i.field,n.getName(`geojson_${r++}`)))}return e}constructor(e,n,r,i){super(e),this.fields=n,this.geojson=r,this.signal=i}dependentFields(){const e=(this.fields??[]).filter(at);return new Set([...this.geojson?[this.geojson]:[],...e])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${Qt(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],{type:"geojson",...this.fields?{fields:this.fields}:{},...this.geojson?{geojson:this.geojson}:{},signal:this.signal}]}}class uy extends ve{clone(){return new uy(null,this.projection,Rt(this.fields),Rt(this.as))}constructor(e,n,r,i){super(e),this.projection=n,this.fields=r,this.as=i}static parseAll(e,n){if(!n.projectionName())return e;for(const r of[[fo,lo],[_s,ho]]){const i=r.map(o=>{const a=Sn(n.encoding[o]);return Q(a)?a.field:Ea(a)?{expr:`${a.datum}`}:Ks(a)?{expr:`${a.value}`}:void 0}),s=r[0]===_s?"2":"";(i[0]||i[1])&&(e=new uy(e,n.projectionName(),i,[n.getName(`x${s}`),n.getName(`y${s}`)]))}return e}dependentFields(){return new Set(this.fields.filter(at))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${Qt(this.fields)} ${Qt(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class _f extends ve{clone(){return new _f(null,Rt(this.transform))}constructor(e,n){super(e),this.transform=n}dependentFields(){return new Set([this.transform.impute,this.transform.key,...this.transform.groupby??[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:n=0,stop:r,step:i}=e;return{signal:`sequence(${[n,r,...i?[i]:[]].join(",")})`}}static makeFromTransform(e,n){return new _f(e,n)}static makeFromEncoding(e,n){const r=n.encoding,i=r.x,s=r.y;if(Q(i)&&Q(s)){const o=i.impute?i:s.impute?s:void 0;if(o===void 0)return;const a=i.impute?s:s.impute?i:void 0,{method:u,value:c,frame:l,keyvals:f}=o.impute,d=Jit(n.mark,r);return new _f(e,{impute:o.field,key:a.field,...u?{method:u}:{},...c!==void 0?{value:c}:{},...l?{frame:l}:{},...f!==void 0?{keyvals:f}:{},...d.length?{groupby:d}:{}})}return null}hash(){return`Impute ${Qt(this.transform)}`}assemble(){const{impute:e,key:n,keyvals:r,method:i,groupby:s,value:o,frame:a=[null,null]}=this.transform,u={type:"impute",field:e,key:n,...r?{keyvals:wjt(r)?this.processSequence(r):r}:{},method:"value",...s?{groupby:s}:{},value:!i||i==="value"?o:null};if(i&&i!=="value"){const c={type:"window",as:[`imputed_${e}_value`],ops:[i],fields:[e],frame:a,ignorePeers:!1,...s?{groupby:s}:{}},l={type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e};return[u,c,l]}else return[u]}}class xE extends ve{clone(){return new xE(null,Rt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Rt(n);const r=this.transform.as??[void 0,void 0];this.transform.as=[r[0]??n.on,r[1]??n.loess]}dependentFields(){return new Set([this.transform.loess,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${Qt(this.transform)}`}assemble(){const{loess:e,on:n,...r}=this.transform;return{type:"loess",x:n,y:e,...r}}}class cy extends ve{clone(){return new cy(null,Rt(this.transform),this.secondary)}constructor(e,n,r){super(e),this.transform=n,this.secondary=r}static make(e,n,r,i){const s=n.component.data.sources,{from:o}=r;let a=null;if(xjt(o)){let u=jot(o.data,s);u||(u=new ed(o.data),s.push(u));const c=n.getName(`lookup_${i}`);a=new ai(u,c,Ke.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[c]=a}else if(_jt(o)){const u=o.param;r={as:u,...r};let c;try{c=n.getSelectionComponent(qe(u),u)}catch{throw new Error(VBt(u))}if(a=c.materialized,!a)throw new Error(GBt(u))}return new cy(e,r,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?ot(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${Qt({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e={values:this.transform.from.fields,...this.transform.as?{as:ot(this.transform.as)}:{}};else{let n=this.transform.as;at(n)||(K(rPt),n="_lookup"),e={as:[n]}}return{type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup],...e,...this.transform.default?{default:this.transform.default}:{}}}}class _E extends ve{clone(){return new _E(null,Rt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Rt(n);const r=this.transform.as??[void 0,void 0];this.transform.as=[r[0]??"prob",r[1]??"value"]}dependentFields(){return new Set([this.transform.quantile,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${Qt(this.transform)}`}assemble(){const{quantile:e,...n}=this.transform;return{type:"quantile",field:e,...n}}}class SE extends ve{clone(){return new SE(null,Rt(this.transform))}constructor(e,n){super(e),this.transform=n,this.transform=Rt(n);const r=this.transform.as??[void 0,void 0];this.transform.as=[r[0]??n.on,r[1]??n.regression]}dependentFields(){return new Set([this.transform.regression,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${Qt(this.transform)}`}assemble(){const{regression:e,on:n,...r}=this.transform;return{type:"regression",x:n,y:e,...r}}}class EE extends ve{clone(){return new EE(null,Rt(this.transform))}constructor(e,n){super(e),this.transform=n}addDimensions(e){this.transform.groupby=Bo((this.transform.groupby??[]).concat(e),n=>n)}producedFields(){}dependentFields(){return new Set([this.transform.pivot,this.transform.value,...this.transform.groupby??[]])}hash(){return`PivotTransform ${Qt(this.transform)}`}assemble(){const{pivot:e,value:n,groupby:r,limit:i,op:s}=this.transform;return{type:"pivot",field:e,value:n,...i!==void 0?{limit:i}:{},...s!==void 0?{op:s}:{},...r!==void 0?{groupby:r}:{}}}}class AE extends ve{clone(){return new AE(null,Rt(this.transform))}constructor(e,n){super(e),this.transform=n}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${Qt(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function zot(t){let e=0;function n(r,i){if(r instanceof ed&&!r.isGenerator&&!Np(r.data)&&(t.push(i),i={name:null,source:i.name,transform:[]}),r instanceof gr&&(r.parent instanceof ed&&!i.source?(i.format={...i.format,parse:r.assembleFormatParse()},i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof Tg){i.name||(i.name=`data_${e++}`),!i.source||i.transform.length>0?(t.push(i),r.data=i.name):r.data=i.source,t.push(...r.assemble());return}switch((r instanceof M1||r instanceof C1||r instanceof Bp||r instanceof $g||r instanceof Rp||r instanceof uy||r instanceof Ws||r instanceof cy||r instanceof kg||r instanceof Ed||r instanceof wE||r instanceof vE||r instanceof yE||r instanceof xE||r instanceof _E||r instanceof SE||r instanceof sl||r instanceof AE||r instanceof EE||r instanceof bE)&&i.transform.push(r.assemble()),(r instanceof Vo||r instanceof qo||r instanceof _f||r instanceof fu||r instanceof Uh)&&i.transform.push(...r.assemble()),r instanceof ai&&(i.source&&i.transform.length===0?r.setSource(i.source):r.parent instanceof ai?r.setSource(i.name):(i.name||(i.name=`data_${e++}`),r.setSource(i.name),r.numChildren()===1&&(t.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof ai&&(!i.source||i.transform.length>0)&&t.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name=`data_${e++}`);let s=i.name;!i.source||i.transform.length>0?t.push(i):s=i.source;for(const o of r.children)n(o,{name:null,source:s,transform:[]});break}}}return n}function RVt(t){const e=[],n=zot(e);for(const r of t.children)n(r,{source:t.name,name:null,transform:[]});return e}function DVt(t,e){const n=[],r=zot(n);let i=0;for(const o of t.sources){o.hasName()||(o.dataName=`source_${i++}`);const a=o.assemble();r(o,a)}for(const o of n)o.transform.length===0&&delete o.transform;let s=0;for(const[o,a]of n.entries())(a.transform??[]).length===0&&!a.source&&n.splice(s++,0,n.splice(o,1)[0]);for(const o of n)for(const a of o.transform??[])a.type==="lookup"&&(a.from=t.outputNodes[a.from].getSource());for(const o of n)o.name in e&&(o.values=e[o.name]);return n}function LVt(t){return t==="top"||t==="left"||gt(t)?"header":"footer"}function BVt(t){for(const e of es)PVt(t,e);SB(t,"x"),SB(t,"y")}function PVt(t,e){var o;const{facet:n,config:r,child:i,component:s}=t;if(t.channelHasField(e)){const a=n[e],u=Lp("title",null,r,e);let c=Ph(a,r,{allowDisabling:!0,includeDefault:u===void 0||!!u});i.component.layoutHeaders[e].title&&(c=W(c)?c.join(", "):c,c+=` / ${i.component.layoutHeaders[e].title}`,i.component.layoutHeaders[e].title=null);const l=Lp("labelOrient",a.header,r,e),f=a.header!==null?ln((o=a.header)==null?void 0:o.labels,r.header.labels,!0):!1,d=Xt(["bottom","right"],l)?"footer":"header";s.layoutHeaders[e]={title:a.header!==null?c:null,facetFieldDef:a,[d]:e==="facet"?[]:[Uot(t,e,f)]}}}function Uot(t,e,n){const r=e==="row"?"height":"width";return{labels:n,sizeSignal:t.child.component.layoutSize.get(r)?t.child.getSizeSignalRef(r):void 0,axes:[]}}function SB(t,e){const{child:n}=t;if(n.component.axes[e]){const{layoutHeaders:r,resolve:i}=t.component;if(i.axis[e]=JR(i,e),i.axis[e]==="shared"){const s=e==="x"?"column":"row",o=r[s];for(const a of n.component.axes[e]){const u=LVt(a.get("orient"));o[u]??(o[u]=[Uot(t,s,!1)]);const c=Um(a,"main",t.config,{header:!0});c&&o[u][0].axes.push(c),a.mainExtracted=!0}}}}function zVt(t){oD(t),h2(t,"width"),h2(t,"height")}function UVt(t){oD(t);const e=t.layout.columns===1?"width":"childWidth",n=t.layout.columns===void 0?"height":"childHeight";h2(t,e),h2(t,n)}function oD(t){for(const e of t.children)e.parseLayoutSize()}function h2(t,e){const n=hot(e),r=WS(n),i=t.component.resolve,s=t.component.layoutSize;let o;for(const a of t.children){const u=a.component.layoutSize.getWithExplicit(n),c=i.scale[r]??got(r,t);if(c==="independent"&&u.value==="step"){o=void 0;break}if(o){if(c==="independent"&&o.value!==u.value){o=void 0;break}o=il(o,u,n,"")}else o=u}if(o){for(const a of t.children)t.renameSignal(a.getName(n),t.getName(e)),a.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(e,o)}else s.setWithExplicit(e,{explicit:!1,value:void 0})}function jVt(t){const{size:e,component:n}=t;for(const r of zu){const i=mi(r);if(e[i]){const s=e[i];n.layoutSize.set(i,oa(s)?"step":s,!0)}else{const s=qVt(t,i);n.layoutSize.set(i,s,!1)}}}function qVt(t,e){const n=e==="width"?"x":"y",r=t.config,i=t.getScaleComponent(n);if(i){const s=i.get("type"),o=i.get("range");if(Bn(s)){const a=c2(r.view,e);return vd(o)||oa(a)?"step":a}else return nM(r.view,e)}else{if(t.hasProjection||t.mark==="arc")return nM(r.view,e);{const s=c2(r.view,e);return oa(s)?s.step:s}}}function wM(t,e,n){return nt(e,{suffix:`by_${nt(t)}`,...n})}class c0 extends Pot{constructor(e,n,r,i){super(e,"facet",n,r,i,e.resolve),this.child=fD(e.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(e.facet)}initFacet(e){if(!S1(e))return{facet:this.initFacetFieldDef(e,"facet")};const n=H(e),r={};for(const i of n){if(![au,uu].includes(i)){K(YS(i,"facet"));break}const s=e[i];if(s.field===void 0){K(Qk(s,i));break}r[i]=this.initFacetFieldDef(s,i)}return r}initFacetFieldDef(e,n){const r=CR(e,n);return r.header?r.header=jn(r.header):r.header===null&&(r.header=null),r}channelHasField(e){return X(this.facet,e)}fieldDef(e){return this.facet[e]}parseData(){this.component.data=$E(this),this.child.parseData()}parseLayoutSize(){oD(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection,Object.values(this.component.selection).some(e=>Wo(e))&&sR(iR)}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),BVt(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){const e={};for(const n of es)for(const r of KR){const i=this.component.layoutHeaders[n],s=i[r],{facetFieldDef:o}=i;if(o){const a=Lp("titleOrient",o.header,this.config,n);if(["right","bottom"].includes(a)){const u=pE(n,a);e.titleAnchor??(e.titleAnchor={}),e.titleAnchor[u]="end"}}if(s!=null&&s[0]){const a=n==="row"?"height":"width",u=r==="header"?"headerBand":"footerBand";n!=="facet"&&!this.child.component.layoutSize.get(a)&&(e[u]??(e[u]={}),e[u][n]=.5),i.title&&(e.offset??(e.offset={}),e.offset[n==="row"?"rowTitle":"columnTitle"]=10)}}return e}assembleDefaultLayout(){const{column:e,row:n}=this.facet,r=e?this.columnDistinctSignal():n?1:void 0;let i="all";return(!n&&this.component.resolve.scale.x==="independent"||!e&&this.component.resolve.scale.y==="independent")&&(i="none"),{...this.getHeaderLayoutMixins(),...r?{columns:r}:{},bounds:"full",align:i}}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof c0))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroupStyle(){}assembleGroup(e){return this.parent&&this.parent instanceof c0?{...this.channelHasField("column")?{encode:{update:{columns:{field:nt(this.facet.column,{prefix:"distinct"})}}}}:{},...super.assembleGroup(e)}:super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],n=[],r=[];if(this.child instanceof c0){if(this.child.channelHasField("column")){const i=nt(this.child.facet.column);e.push(i),n.push("distinct"),r.push(`distinct_${i}`)}}else for(const i of zu){const s=this.child.component.scales[i];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(Bn(o)&&vd(a)){const u=mE(this.child,i),c=rD(u);c?(e.push(c),n.push("distinct"),r.push(`distinct_${c}`)):K(rR(i))}}}return{fields:e,ops:n,as:r}}assembleFacet(){const{name:e,data:n}=this.component.data.facetRoot,{row:r,column:i}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),u=[];for(const l of es){const f=this.facet[l];if(f){u.push(nt(f));const{bin:d,sort:h}=f;if(Ne(d)&&u.push(nt(f,{binSuffix:"end"})),cu(h)){const{field:p,op:g=tE}=h,m=wM(f,h);r&&i?(s.push(m),o.push("max"),a.push(m)):(s.push(p),o.push(g),a.push(m))}else if(W(h)){const p=Dp(f,l);s.push(p),o.push("max"),a.push(p)}}}const c=!!r&&!!i;return{name:e,data:n,groupby:u,...c||s.length>0?{aggregate:{...c?{cross:c}:{},...s.length?{fields:s,ops:o,as:a}:{}}}:{}}}facetSortFields(e){const{facet:n}=this,r=n[e];return r?cu(r.sort)?[wM(r,r.sort,{expr:"datum"})]:W(r.sort)?[Dp(r,e,{expr:"datum"})]:[nt(r,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:n}=this,r=n[e];if(r){const{sort:i}=r;return[(cu(i)?i.order:!W(i)&&i)||"ascending"]}return[]}assembleLabelTitle(){var i;const{facet:e,config:n}=this;if(e.facet)return hM(e.facet,"facet",n);const r={row:["top","bottom"],column:["left","right"]};for(const s of XR)if(e[s]){const o=Lp("labelOrient",(i=e[s])==null?void 0:i.header,n,s);if(r[s].includes(o))return hM(e[s],s,n)}}assembleMarks(){const{child:e}=this,n=this.component.data.facetRoot,r=RVt(n),i=e.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||e.assembleTitle(),o=e.assembleGroupStyle();return[{name:this.getName("cell"),type:"group",...s?{title:s}:{},...o?{style:o}:{},from:{facet:this.assembleFacet()},sort:{field:es.map(u=>this.facetSortFields(u)).flat(),order:es.map(u=>this.facetSortOrder(u)).flat()},...r.length>0?{data:r}:{},...i?{encode:{update:i}}:{},...e.assembleGroup(iqt(this,[]))}]}getMapping(){return this.facet}}function WVt(t,e){const{row:n,column:r}=e;if(n&&r){let i=null;for(const s of[n,r])if(cu(s.sort)){const{field:o,op:a=tE}=s.sort;t=i=new Ed(t,{joinaggregate:[{op:a,field:o,as:wM(s,s.sort,{forAs:!0})}],groupby:[nt(s)]})}return i}return null}function jot(t,e){var n,r,i,s;for(const o of e){const a=o.data;if(t.name&&o.hasName()&&t.name!==o.dataName)continue;const u=(n=t.format)==null?void 0:n.mesh,c=(r=a.format)==null?void 0:r.feature;if(u&&c)continue;const l=(i=t.format)==null?void 0:i.feature;if((l||c)&&l!==c)continue;const f=(s=a.format)==null?void 0:s.mesh;if(!((u||f)&&u!==f)){if(ay(t)&&ay(a)){if(ki(t.values,a.values))return o}else if(Np(t)&&Np(a)){if(t.url===a.url)return o}else if(kst(t)&&t.name===o.dataName)return o}}return null}function VVt(t,e){if(t.data||!t.parent){if(t.data===null){const r=new ed({values:[]});return e.push(r),r}const n=jot(t.data,e);if(n)return kc(t.data)||(n.data.format=Srt({},t.data.format,n.data.format)),!n.hasName()&&t.data.name&&(n.dataName=t.data.name),n;{const r=new ed(t.data);return e.push(r),r}}else return t.parent.component.data.facetRoot?t.parent.component.data.facetRoot:t.parent.component.data.main}function GVt(t,e,n){let r=0;for(const i of e.transforms){let s,o;if(Fjt(i))o=t=new Rp(t,i),s="derived";else if(jR(i)){const a=DWt(i);o=t=gr.makeWithAncestors(t,{},a,n)??t,t=new $g(t,e,i.filter)}else if(Sst(i))o=t=Vo.makeFromTransform(t,i,e),s="number";else if(Ojt(i))s="date",n.getWithExplicit(i.field).value===void 0&&(t=new gr(t,{[i.field]:s}),n.set(i.field,s,!1)),o=t=qo.makeFromTransform(t,i);else if(Rjt(i))o=t=Ws.makeFromTransform(t,i),s="number",HR(e)&&(t=new sl(t));else if(_st(i))o=t=cy.make(t,e,i,r++),s="derived";else if(Mjt(i))o=t=new kg(t,i),s="number";else if(Cjt(i))o=t=new Ed(t,i),s="number";else if(Djt(i))o=t=fu.makeFromTransform(t,i),s="derived";else if(Ljt(i))o=t=new wE(t,i),s="derived";else if(Bjt(i))o=t=new bE(t,i),s="derived";else if(Ijt(i))o=t=new vE(t,i),s="derived";else if(Sjt(i))o=t=new EE(t,i),s="derived";else if(kjt(i))t=new AE(t,i);else if(Njt(i))o=t=_f.makeFromTransform(t,i),s="derived";else if(Ejt(i))o=t=new yE(t,i),s="derived";else if(Ajt(i))o=t=new _E(t,i),s="derived";else if($jt(i))o=t=new SE(t,i),s="derived";else if(Tjt(i))o=t=new xE(t,i),s="derived";else{K(nPt(i));continue}if(o&&s!==void 0)for(const a of o.producedFields()??[])n.set(a,s,!1)}return t}function $E(t){var m;let e=VVt(t,t.component.data.sources);const{outputNodes:n,outputNodeRefCounts:r}=t.component.data,i=t.data,o=!(i&&(kc(i)||Np(i)||ay(i)))&&t.parent?t.parent.component.data.ancestorParse.clone():new Kjt;kc(i)?(Mst(i)?e=new C1(e,i.sequence):qR(i)&&(e=new M1(e,i.graticule)),o.parseNothing=!0):((m=i==null?void 0:i.format)==null?void 0:m.parse)===null&&(o.parseNothing=!0),e=gr.makeExplicit(e,t,o)??e,e=new sl(e);const a=t.parent&&Mg(t.parent);(Ge(t)||Fi(t))&&a&&(e=Vo.makeFromEncoding(e,t)??e),t.transforms.length>0&&(e=GVt(e,t,o));const u=BWt(t),c=LWt(t);e=gr.makeWithAncestors(e,{},{...u,...c},o)??e,Ge(t)&&(e=Uh.parseAll(e,t),e=uy.parseAll(e,t)),(Ge(t)||Fi(t))&&(a||(e=Vo.makeFromEncoding(e,t)??e),e=qo.makeFromEncoding(e,t)??e,e=Rp.parseAllForSortIndex(e,t));const l=e=Ob(Ke.Raw,t,e);if(Ge(t)){const y=Ws.makeFromEncoding(e,t);y&&(e=y,HR(t)&&(e=new sl(e))),e=_f.makeFromEncoding(e,t)??e,e=fu.makeFromEncoding(e,t)??e}let f,d;if(Ge(t)){const{markDef:y,mark:b,config:w}=t,v=we("invalid",y,w),{marks:x,scales:S}=d=Ist({invalid:v,isPath:Al(b)});x!==S&&S==="include-invalid-values"&&(f=e=Ob(Ke.PreFilterInvalid,t,e)),x==="exclude-invalid-values"&&(e=Bp.make(e,t,d)??e)}const h=e=Ob(Ke.Main,t,e);let p;if(Ge(t)&&d){const{marks:y,scales:b}=d;y==="include-invalid-values"&&b==="exclude-invalid-values"&&(e=Bp.make(e,t,d)??e,p=e=Ob(Ke.PostFilterInvalid,t,e))}Ge(t)&&Nqt(t,h);let g=null;if(Fi(t)){const y=t.getName("facet");e=WVt(e,t.facet)??e,g=new Tg(e,t,y,h.getSource()),n[y]=g}return{...t.component.data,outputNodes:n,outputNodeRefCounts:r,raw:l,main:h,facetRoot:g,ancestorParse:o,preFilterInvalid:f,postFilterInvalid:p}}function Ob(t,e,n){const{outputNodes:r,outputNodeRefCounts:i}=e.component.data,s=e.getDataName(t),o=new ai(n,s,t,i);return r[s]=o,o}class YVt extends sD{constructor(e,n,r,i){var s,o,a,u;super(e,"concat",n,r,i,e.resolve),(((o=(s=e.resolve)==null?void 0:s.axis)==null?void 0:o.x)==="shared"||((u=(a=e.resolve)==null?void 0:a.axis)==null?void 0:u.y)==="shared")&&K(ZBt),this.children=this.getChildren(e).map((c,l)=>fD(c,this,this.getName(`concat_${l}`),void 0,i))}parseData(){this.component.data=$E(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const n of H(e.component.selection))this.component.selection[n]=e.component.selection[n]}Object.values(this.component.selection).some(e=>Wo(e))&&sR(iR)}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return aE(e)?e.vconcat:zR(e)?e.hconcat:e.concat}parseLayoutSize(){UVt(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),e)}assembleSignals(){return this.children.forEach(e=>e.assembleSignals()),[]}assembleLayoutSignals(){const e=QR(this);for(const n of this.children)e.push(...n.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce((n,r)=>r.assembleSelectionData(n),e)}assembleMarks(){return this.children.map(e=>{const n=e.assembleTitle(),r=e.assembleGroupStyle(),i=e.assembleGroupEncodeEntry(!1);return{type:"group",name:e.getName("group"),...n?{title:n}:{},...r?{style:r}:{},...i?{encode:{update:i}}:{},...e.assembleGroup()}})}assembleGroupStyle(){}assembleDefaultLayout(){const e=this.layout.columns;return{...e!=null?{columns:e}:{},bounds:"full",align:"each"}}}function HVt(t){return t===!1||t===null}const XVt={disable:1,gridScale:1,scale:1,...Git,labelExpr:1,encode:1},qot=H(XVt);class aD extends ju{constructor(e={},n={},r=!1){super(),this.explicit=e,this.implicit=n,this.mainExtracted=r}clone(){return new aD(Rt(this.explicit),Rt(this.implicit),this.mainExtracted)}hasAxisPart(e){return e==="axis"?!0:e==="grid"||e==="title"?!!this.get(e):!HVt(this.get(e))}hasOrientSignalRef(){return gt(this.explicit.orient)}}function KVt(t,e,n){const{encoding:r,config:i}=t,s=Sn(r[e])??Sn(r[_a(e)]),o=t.axis(e)||{},{format:a,formatType:u}=o;if(Jf(u))return{text:zs({fieldOrDatumDef:s,field:"datum.value",format:a,formatType:u,config:i}),...n};if(a===void 0&&u===void 0&&i.customFormatTypes){if(Cp(s)==="quantitative"){if(Ip(s)&&s.stack==="normalize"&&i.normalizedNumberFormatType)return{text:zs({fieldOrDatumDef:s,field:"datum.value",format:i.normalizedNumberFormat,formatType:i.normalizedNumberFormatType,config:i}),...n};if(i.numberFormatType)return{text:zs({fieldOrDatumDef:s,field:"datum.value",format:i.numberFormat,formatType:i.numberFormatType,config:i}),...n}}if(Cp(s)==="temporal"&&i.timeFormatType&&Q(s)&&!s.timeUnit)return{text:zs({fieldOrDatumDef:s,field:"datum.value",format:i.timeFormat,formatType:i.timeFormatType,config:i}),...n}}return n}function QVt(t){return zu.reduce((e,n)=>(t.component.scales[n]&&(e[n]=[iGt(n,t)]),e),{})}const JVt={bottom:"top",top:"bottom",left:"right",right:"left"};function ZVt(t){const{axes:e,resolve:n}=t.component,r={top:0,bottom:0,right:0,left:0};for(const i of t.children){i.parseAxesAndHeaders();for(const s of H(i.component.axes))n.axis[s]=JR(t.component.resolve,s),n.axis[s]==="shared"&&(e[s]=tGt(e[s],i.component.axes[s]),e[s]||(n.axis[s]="independent",delete e[s]))}for(const i of zu){for(const s of t.children)if(s.component.axes[i]){if(n.axis[i]==="independent"){e[i]=(e[i]??[]).concat(s.component.axes[i]);for(const o of s.component.axes[i]){const{value:a,explicit:u}=o.getWithExplicit("orient");if(!gt(a)){if(r[a]>0&&!u){const c=JVt[a];r[a]>r[c]&&o.set("orient",c,!1)}r[a]++}}}delete s.component.axes[i]}if(n.axis[i]==="independent"&&e[i]&&e[i].length>1)for(const[s,o]of(e[i]||[]).entries())s>0&&o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function tGt(t,e){if(t){if(t.length!==e.length)return;const n=t.length;for(let r=0;r<n;r++){const i=t[r],s=e[r];if(!!i!=!!s)return;if(i&&s){const o=i.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;t[r]=eGt(i,s)}}}else return e.map(n=>n.clone());return t}function eGt(t,e){for(const n of qot){const r=il(t.getWithExplicit(n),e.getWithExplicit(n),n,"axis",(i,s)=>{switch(n){case"title":return Krt(i,s);case"gridScale":return{explicit:i.explicit,value:ln(i.value,s.value)}}return cE(i,s,n,"axis")});t.setWithExplicit(n,r)}return t}function nGt(t,e,n,r,i){if(e==="disable")return n!==void 0;switch(n=n||{},e){case"titleAngle":case"labelAngle":return t===(gt(n.labelAngle)?n.labelAngle:sy(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(t===uot(r,i))return!0}return t===n[e]}const rGt=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function iGt(t,e){var y,b;let n=e.axis(t);const r=new aD,i=Sn(e.encoding[t]),{mark:s,config:o}=e,a=(n==null?void 0:n.orient)||((y=o[t==="x"?"axisX":"axisY"])==null?void 0:y.orient)||((b=o.axis)==null?void 0:b.orient)||qqt(t),u=e.getScaleComponent(t).get("type"),c=Dqt(t,u,a,e.config),l=n!==void 0?!n:fM("disable",o.style,n==null?void 0:n.style,c).configValue;if(r.set("disable",l,n!==void 0),l)return r;n=n||{};const f=zqt(i,n,t,o.style,c),d=Fit(n.formatType,i,u),h=Iit(i,i.type,n.format,n.formatType,o,!0),p={fieldOrDatumDef:i,axis:n,channel:t,model:e,scaleType:u,orient:a,labelAngle:f,format:h,formatType:d,mark:s,config:o};for(const w of qot){const v=w in uB?uB[w](p):R9(w)?n[w]:void 0,x=v!==void 0,S=nGt(v,w,n,e,t);if(x&&S)r.set(w,v,S);else{const{configValue:_=void 0,configFrom:E=void 0}=R9(w)&&w!=="values"?fM(w,o.style,n.style,c):{},A=_!==void 0;x&&!A?r.set(w,v,S):(E!=="vgAxisConfig"||rGt.has(w)&&A||T1(_)||gt(_))&&r.set(w,_,!1)}}const g=n.encoding??{},m=Vit.reduce((w,v)=>{if(!r.hasAxisPart(v))return w;const x=pot(g[v]??{},e),S=v==="labels"?KVt(e,t,x):x;return S!==void 0&&!xe(S)&&(w[v]={update:S}),w},{});return xe(m)||r.set("encode",m,!!n.encoding||n.labelAngle!==void 0),r}function sGt({encoding:t,size:e}){for(const n of zu){const r=mi(n);oa(e[r])&&xc(t[n])&&(delete e[r],K(eit(r)))}return e}const oGt={vgMark:"arc",encodeEntry:t=>({...$s(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...Br("x",t,{defaultPos:"mid"}),...Br("y",t,{defaultPos:"mid"}),..._u(t,"radius"),..._u(t,"theta")})},aGt={vgMark:"area",encodeEntry:t=>({...$s(t,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"}),...l2("x",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:t.markDef.orient==="horizontal"}),...l2("y",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:t.markDef.orient==="vertical"}),...YR(t)})},uGt={vgMark:"rect",encodeEntry:t=>({...$s(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),..._u(t,"x"),..._u(t,"y")})},cGt={vgMark:"shape",encodeEntry:t=>({...$s(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})}),postEncodingTransform:t=>{const{encoding:e}=t,n=e.shape;return[{type:"geoshape",projection:t.projectionName(),...n&&Q(n)&&n.type===Eg?{field:nt(n,{expr:"datum"})}:{}}]}},lGt={vgMark:"image",encodeEntry:t=>({...$s(t,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"}),..._u(t,"x"),..._u(t,"y"),...VR(t,"url")})},fGt={vgMark:"line",encodeEntry:t=>({...$s(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...Br("x",t,{defaultPos:"mid"}),...Br("y",t,{defaultPos:"mid"}),...Vn("size",t,{vgChannel:"strokeWidth"}),...YR(t)})},dGt={vgMark:"trail",encodeEntry:t=>({...$s(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...Br("x",t,{defaultPos:"mid"}),...Br("y",t,{defaultPos:"mid"}),...Vn("size",t),...YR(t)})};function uD(t,e){const{config:n}=t;return{...$s(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...Br("x",t,{defaultPos:"mid"}),...Br("y",t,{defaultPos:"mid"}),...Vn("size",t),...Vn("angle",t),...hGt(t,n,e)}}function hGt(t,e,n){return n?{shape:{value:n}}:Vn("shape",t)}const pGt={vgMark:"symbol",encodeEntry:t=>uD(t)},gGt={vgMark:"symbol",encodeEntry:t=>uD(t,"circle")},mGt={vgMark:"symbol",encodeEntry:t=>uD(t,"square")},yGt={vgMark:"rect",encodeEntry:t=>({...$s(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),..._u(t,"x"),..._u(t,"y")})},bGt={vgMark:"rule",encodeEntry:t=>{const{markDef:e}=t,n=e.orient;return!t.encoding.x&&!t.encoding.y&&!t.encoding.latitude&&!t.encoding.longitude?{}:{...$s(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...l2("x",t,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"}),...l2("y",t,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"}),...Vn("size",t,{vgChannel:"strokeWidth"})}}},vGt={vgMark:"text",encodeEntry:t=>{const{config:e,encoding:n}=t;return{...$s(t,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"}),...Br("x",t,{defaultPos:"mid"}),...Br("y",t,{defaultPos:"mid"}),...VR(t),...Vn("size",t,{vgChannel:"fontSize"}),...Vn("angle",t),...iB("align",wGt(t.markDef,n,e)),...iB("baseline",xGt(t.markDef,n,e)),...Br("radius",t,{defaultPos:null}),...Br("theta",t,{defaultPos:null})}}};function wGt(t,e,n){if(we("align",t,n)===void 0)return"center"}function xGt(t,e,n){if(we("baseline",t,n)===void 0)return"middle"}const _Gt={vgMark:"rect",encodeEntry:t=>{const{config:e,markDef:n}=t,r=n.orient,i=r==="horizontal"?"x":"y",s=r==="horizontal"?"y":"x",o=r==="horizontal"?"height":"width";return{...$s(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),..._u(t,i),...Br(s,t,{defaultPos:"mid",vgChannel:s==="y"?"yc":"xc"}),[o]:Re(we("thickness",n,e))}}},Rb={arc:oGt,area:aGt,bar:uGt,circle:gGt,geoshape:cGt,image:lGt,line:fGt,point:pGt,rect:yGt,rule:bGt,square:mGt,text:vGt,tick:_Gt,trail:dGt};function SGt(t){if(Xt([JS,KS,Mzt],t.mark)){const e=Jit(t.mark,t.encoding);if(e.length>0)return EGt(t,e)}else if(t.mark===QS){const e=Xk.some(n=>we(n,t.markDef,t.config));if(t.stack&&!t.fieldDef("size")&&e)return AGt(t)}return cD(t)}const EB="faceted_path_";function EGt(t,e){return[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:EB+t.requestDataName(Ke.Main),data:t.requestDataName(Ke.Main),groupby:e}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:cD(t,{fromPrefix:EB})}]}const AB="stack_group_";function AGt(t){var c;const[e]=cD(t,{fromPrefix:AB}),n=t.scaleName(t.stack.fieldChannel),r=(l={})=>t.vgField(t.stack.fieldChannel,l),i=(l,f)=>{const d=[r({prefix:"min",suffix:"start",expr:f}),r({prefix:"max",suffix:"start",expr:f}),r({prefix:"min",suffix:"end",expr:f}),r({prefix:"max",suffix:"end",expr:f})];return`${l}(${d.map(h=>`scale('${n}',${h})`).join(",")})`};let s,o;t.stack.fieldChannel==="x"?(s={...Ep(e.encode.update,["y","yc","y2","height",...Xk]),x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:!0}},o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},e.encode.update={...oi(e.encode.update,["y","yc","y2"]),height:{field:{group:"height"}}}):(s={...Ep(e.encode.update,["x","xc","x2","width"]),y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:!0}},o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},e.encode.update={...oi(e.encode.update,["x","xc","x2"]),width:{field:{group:"width"}}});for(const l of Xk){const f=ia(l,t.markDef,t.config);e.encode.update[l]?(s[l]=e.encode.update[l],delete e.encode.update[l]):f&&(s[l]=Re(f)),f&&(e.encode.update[l]={value:0})}const a=[];if(((c=t.stack.groupbyChannels)==null?void 0:c.length)>0)for(const l of t.stack.groupbyChannels){const f=t.fieldDef(l),d=nt(f);d&&a.push(d),(f!=null&&f.bin||f!=null&&f.timeUnit)&&a.push(nt(f,{binSuffix:"end"}))}return s=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((l,f)=>{if(e.encode.update[f])return{...l,[f]:e.encode.update[f]};{const d=ia(f,t.markDef,t.config);return d!==void 0?{...l,[f]:Re(d)}:l}},s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:t.requestDataName(Ke.Main),name:AB+t.requestDataName(Ke.Main),groupby:a,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:o},marks:[e]}]}]}function $Gt(t){const{encoding:e,stack:n,mark:r,markDef:i,config:s}=t,o=e.order;if(!(!W(o)&&Ks(o)&&Yk(o.value)||!o&&Yk(we("order",i,s)))){if((W(o)||Q(o))&&!n)return Yrt(o,{expr:"datum"});if(Al(r)){const a=i.orient==="horizontal"?"y":"x",u=e[a];if(Q(u))return{field:a}}}}function cD(t,e={fromPrefix:""}){const{mark:n,markDef:r,encoding:i,config:s}=t,o=ln(r.clip,TGt(t),kGt(t)),a=Vrt(r),u=i.key,c=$Gt(t),l=MGt(t),f=we("aria",r,s),d=Rb[n].postEncodingTransform?Rb[n].postEncodingTransform(t):null;return[{name:t.getName("marks"),type:Rb[n].vgMark,...o?{clip:o}:{},...a?{style:a}:{},...u?{key:u.field}:{},...c?{sort:c}:{},...l||{},...f===!1?{aria:f}:{},from:{data:e.fromPrefix+t.requestDataName(Ke.Main)},encode:{update:Rb[n].encodeEntry(t)},...d?{transform:d}:{}}]}function TGt(t){const e=t.getScaleComponent("x"),n=t.getScaleComponent("y");return e!=null&&e.get("selectionExtent")||n!=null&&n.get("selectionExtent")?!0:void 0}function kGt(t){const e=t.component.projection;return e&&!e.isFit?!0:void 0}function MGt(t){if(!t.component.selection)return null;const e=H(t.component.selection).length;let n=e,r=t.parent;for(;r&&n===0;)n=H(r.component.selection).length,r=r.parent;return n?{interactive:e>0||t.mark==="geoshape"||!!t.encoding.tooltip||!!t.markDef.tooltip}:null}class Wot extends Pot{constructor(e,n,r,i={},s){super(e,"unit",n,r,s,void 0,L9(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[],this.correctDataNames=c=>{var l,f,d;return(l=c.from)!=null&&l.data&&(c.from.data=this.lookupDataSource(c.from.data),"time"in this.encoding&&(c.from.data=c.from.data+Nst)),(d=(f=c.from)==null?void 0:f.facet)!=null&&d.data&&(c.from.facet.data=this.lookupDataSource(c.from.facet.data)),c};const o=sa(e.mark)?{...e.mark}:{type:e.mark},a=o.type;o.filled===void 0&&(o.filled=djt(o,s,{graticule:e.data&&qR(e.data)}));const u=this.encoding=mUt(e.encoding||{},a,o.filled,s);this.markDef=vst(o,u,s),this.size=sGt({encoding:u,size:L9(e)?{...i,...e.width?{width:e.width}:{},...e.height?{height:e.height}:{}}:i}),this.stack=bst(this.markDef,u),this.specifiedScales=this.initScales(a,u),this.specifiedAxes=this.initAxes(u),this.specifiedLegends=this.initLegends(u),this.specifiedProjection=e.projection,this.selection=(e.params??[]).filter(c=>BR(c))}get hasProjection(){const{encoding:e}=this,n=this.mark===Eit,r=e&&uBt.some(i=>Bt(e[i]));return n||r}scaleDomain(e){const n=this.specifiedScales[e];return n?n.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,n){return tR.reduce((r,i)=>{const s=Sn(n[i]);return s&&(r[i]=this.initScale(s.scale??{})),r},{})}initScale(e){const{domain:n,range:r}=e,i=jn(e);return W(n)&&(i.domain=n.map(Ai)),W(r)&&(i.range=r.map(Ai)),i}initAxes(e){return zu.reduce((n,r)=>{const i=e[r];if(Bt(i)||r===We&&Bt(e.x2)||r===zn&&Bt(e.y2)){const s=Bt(i)?i.axis:void 0;n[r]=s&&this.initAxis({...s})}return n},{})}initAxis(e){const n=H(e),r={};for(const i of n){const s=e[i];r[i]=T1(s)?Wrt(s):Ai(s)}return r}initLegends(e){return vBt.reduce((n,r)=>{const i=Sn(e[r]);if(i&&xBt(r)){const s=i.legend;n[r]=s&&jn(s)}return n},{})}parseData(){this.component.data=$E(this)}parseLayoutSize(){jVt(this)}parseSelections(){this.component.selection=Fqt(this,this.selection)}parseMarkGroup(){this.component.mark=SGt(this)}parseAxesAndHeaders(){this.component.axes=QVt(this)}assembleSelectionTopLevelSignals(e){return sqt(this,e)}assembleSignals(){return[...sot(this),...rqt(this,[])]}assembleSelectionData(e){return oqt(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return QR(this)}assembleMarks(){let e=this.component.mark??[];return(!this.parent||!Mg(this.parent))&&(e=Lst(this,e)),e.map(this.correctDataNames)}assembleGroupStyle(){const{style:e}=this.view||{};return e!==void 0?e:this.encoding.x||this.encoding.y?"cell":"view"}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return wf(this.encoding,e)}fieldDef(e){const n=this.encoding[e];return Qs(n)}typedFieldDef(e){const n=this.fieldDef(e);return Gr(n)?n:null}}class lD extends sD{constructor(e,n,r,i,s){super(e,"layer",n,r,s,e.resolve,e.view);const o={...i,...e.width?{width:e.width}:{},...e.height?{height:e.height}:{}};this.children=e.layer.map((a,u)=>{if(uE(a))return new lD(a,this,this.getName(`layer_${u}`),o,s);if(Uu(a))return new Wot(a,this,this.getName(`layer_${u}`),o,s);throw new Error(nR(a))})}parseData(){this.component.data=$E(this);for(const e of this.children)e.parseData()}parseLayoutSize(){zVt(this)}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const n of H(e.component.selection))this.component.selection[n]=e.component.selection[n]}Object.values(this.component.selection).some(e=>Wo(e))&&sR(iR)}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){ZVt(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),e)}assembleSignals(){return this.children.reduce((e,n)=>e.concat(n.assembleSignals()),sot(this))}assembleLayoutSignals(){return this.children.reduce((e,n)=>e.concat(n.assembleLayoutSignals()),QR(this))}assembleSelectionData(e){return this.children.reduce((n,r)=>r.assembleSelectionData(n),e)}assembleGroupStyle(){const e=new Set;for(const r of this.children)for(const i of ot(r.assembleGroupStyle()))e.add(i);const n=Array.from(e);return n.length>1?n:n.length===1?n[0]:void 0}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const n of this.children)if(e=n.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return aqt(this,this.children.flatMap(e=>e.assembleMarks()))}assembleLegends(){return this.children.reduce((e,n)=>e.concat(n.assembleLegends()),_ot(this))}}function fD(t,e,n,r,i){if(eE(t))return new c0(t,e,n,i);if(uE(t))return new lD(t,e,n,r,i);if(Uu(t))return new Wot(t,e,n,r,i);if(zUt(t))return new YVt(t,e,n,i);throw new Error(nR(t))}function CGt(t,e={}){e.logger&&qPt(e.logger),e.fieldTitle&&jit(e.fieldTitle);try{const n=yst(fg(e.config,t.config)),r=$st(t,n),i=fD(r,null,"",void 0,n);return i.parse(),tVt(i.component.data,i),{spec:FGt(i,IGt(t,r.autosize,n,i),t.datasets,t.usermeta),normalized:r}}finally{e.logger&&WPt(),e.fieldTitle&&aUt()}}function IGt(t,e,n,r){const i=r.component.layoutSize.get("width"),s=r.component.layoutSize.get("height");if(e===void 0?(e={type:"pad"},r.hasAxisOrientSignalRef()&&(e.resize=!0)):at(e)&&(e={type:e}),i&&s&&Yjt(e.type)){if(i==="step"&&s==="step")K(x9()),e.type="pad";else if(i==="step"||s==="step"){const o=i==="step"?"width":"height";K(x9(WS(o)));const a=o==="width"?"height":"width";e.type=Hjt(a)}}return{...H(e).length===1&&e.type?e.type==="pad"?{}:{autosize:e.type}:{autosize:e},...X9(n,!1),...X9(t,!0)}}function FGt(t,e,n={},r){const i=t.config?tjt(t.config):void 0,s=DVt(t.component.data,n),o=t.assembleSelectionData(s),a=t.assembleProjections(),u=t.assembleTitle(),c=t.assembleGroupStyle(),l=t.assembleGroupEncodeEntry(!0);let f=t.assembleLayoutSignals();f=f.filter(p=>(p.name==="width"||p.name==="height")&&p.value!==void 0?(e[p.name]=+p.value,!1):!0);const{params:d,...h}=e;return{$schema:"https://vega.github.io/schema/vega/v5.json",...t.description?{description:t.description}:{},...h,...u?{title:u}:{},...c?{style:c}:{},...l?{encode:{update:l}}:{},data:o,...a.length>0?{projections:a}:{},...t.assembleGroup([...f,...t.assembleSelectionTopLevelSignals([]),...hst(d)]),...i?{config:i}:{},...r?{usermeta:r}:{}}}const NGt=nBt.version,OGt=Object.freeze(Object.defineProperty({__proto__:null,accessPathDepth:$p,accessPathWithDatum:GO,accessWithDatumToUnescapedPath:ye,compile:CGt,contains:Xt,deepEqual:ki,deleteNestedProperty:t2,duplicate:Rt,entries:el,every:qO,fieldIntersection:VO,flatAccessWithDatum:Art,getFirstDefined:ln,hasIntersection:WO,hasProperty:X,hash:Qt,internalField:krt,isBoolean:iy,isEmpty:xe,isEqual:iBt,isInternalField:Mrt,isNullOrFalse:Yk,isNumeric:BS,keys:H,logicalExpr:a0,mergeDeep:Srt,never:_rt,normalize:$st,normalizeAngle:sy,omit:oi,pick:Ep,prefixGenerator:Hk,removePathFromField:_g,replaceAll:Gf,replacePathInField:xs,resetIdCounter:oBt,setEqual:Ert,some:Ap,stringify:_e,titleCase:m1,unique:Bo,uniqueId:Trt,vals:Zn,varName:qe,version:NGt},Symbol.toStringTag,{value:"Module"}));function Vot(t){const[e,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(t).slice(1,3);return{library:e,version:n}}var RGt="2.15.0",DGt={version:RGt};const Hd="#fff",$B="#888",LGt={background:"#333",view:{stroke:$B},title:{color:Hd,subtitleColor:Hd},style:{"guide-label":{fill:Hd},"guide-title":{fill:Hd}},axis:{domainColor:Hd,gridColor:$B,tickColor:Hd}},Il="#4572a7",BGt={background:"#fff",arc:{fill:Il},area:{fill:Il},line:{stroke:Il,strokeWidth:2},path:{stroke:Il},rect:{fill:Il},shape:{stroke:Il},symbol:{fill:Il,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},Fl="#30a2da",B$="#cbcbcb",PGt="#999",zGt="#333",TB="#f0f0f0",kB="#333",UGt={arc:{fill:Fl},area:{fill:Fl},axis:{domainColor:B$,grid:!0,gridColor:B$,gridWidth:1,labelColor:PGt,labelFontSize:10,titleColor:zGt,tickColor:B$,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:TB,group:{fill:TB},legend:{labelColor:kB,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:kB,titleFontSize:14,titlePadding:10},line:{stroke:Fl,strokeWidth:2},path:{stroke:Fl,strokeWidth:.5},rect:{fill:Fl},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:Fl},bar:{binSpacing:2,fill:Fl,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},Nl="#000",jGt={group:{fill:"#e5e5e5"},arc:{fill:Nl},area:{fill:Nl},line:{stroke:Nl},path:{stroke:Nl},rect:{fill:Nl},shape:{stroke:Nl},symbol:{fill:Nl,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},qGt=22,WGt="normal",MB="Benton Gothic, sans-serif",CB=11.5,VGt="normal",Ol="#82c6df",P$="Benton Gothic Bold, sans-serif",IB="normal",FB=13,sm={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"]},GGt={background:"#ffffff",title:{anchor:"start",color:"#000000",font:P$,fontSize:qGt,fontWeight:WGt},arc:{fill:Ol},area:{fill:Ol},line:{stroke:Ol,strokeWidth:2},path:{stroke:Ol},rect:{fill:Ol},shape:{stroke:Ol},symbol:{fill:Ol,size:30},axis:{labelFont:MB,labelFontSize:CB,labelFontWeight:VGt,titleFont:P$,titleFontSize:FB,titleFontWeight:IB},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:MB,labelFontSize:CB,symbolType:"square",titleFont:P$,titleFontSize:FB,titleFontWeight:IB},range:{category:sm["category-6"],diverging:sm["fireandice-6"],heatmap:sm["fire-7"],ordinal:sm["fire-7"],ramp:sm["fire-7"]}},Rl="#ab5787",Db="#979797",YGt={background:"#f9f9f9",arc:{fill:Rl},area:{fill:Rl},line:{stroke:Rl},path:{stroke:Rl},rect:{fill:Rl},shape:{stroke:Rl},symbol:{fill:Rl,size:30},axis:{domainColor:Db,domainWidth:.5,gridWidth:.2,labelColor:Db,tickColor:Db,tickWidth:.2,titleColor:Db},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},Dl="#3e5c69",HGt={background:"#fff",arc:{fill:Dl},area:{fill:Dl},line:{stroke:Dl},path:{stroke:Dl},rect:{fill:Dl},shape:{stroke:Dl},symbol:{fill:Dl},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},Wi="#1696d2",NB="#000000",XGt="#FFFFFF",Lb="Lato",z$="Lato",KGt="Lato",QGt="#DEDDDD",JGt=18,om={"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},ZGt={background:XGt,title:{anchor:"start",fontSize:JGt,font:Lb},axisX:{domain:!0,domainColor:NB,domainWidth:1,grid:!1,labelFontSize:12,labelFont:z$,labelAngle:0,tickColor:NB,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:Lb},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:QGt,gridWidth:1,labelFontSize:12,labelFont:z$,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:Lb,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:z$,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:Lb,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:om["six-groups-cat-1"],diverging:om["diverging-colors"],heatmap:om["diverging-colors"],ordinal:om["six-groups-seq"],ramp:om["shades-blue"]},area:{fill:Wi},rect:{fill:Wi},line:{color:Wi,stroke:Wi,strokeWidth:5},trail:{color:Wi,stroke:Wi,strokeWidth:0,size:1},path:{stroke:Wi,strokeWidth:.5},point:{filled:!0},text:{font:KGt,color:Wi,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:Wi,stroke:null}},arc:{fill:Wi},shape:{stroke:Wi},symbol:{fill:Wi,size:30}},Ll="#3366CC",OB="#ccc",Bb="Arial, sans-serif",tYt={arc:{fill:Ll},area:{fill:Ll},path:{stroke:Ll},rect:{fill:Ll},shape:{stroke:Ll},symbol:{stroke:Ll},circle:{fill:Ll},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:Bb,fontSize:12},"guide-title":{font:Bb,fontSize:12},"group-title":{font:Bb,fontSize:12}},title:{font:Bb,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:OB,tickColor:OB,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},dD=t=>t*(1/3+1),RB=dD(9),DB=dD(10),LB=dD(12),am="Segoe UI",BB="wf_standard-font, helvetica, arial, sans-serif",PB="#252423",um="#605E5C",zB="transparent",eYt="#C8C6C4",Cs="#118DFF",nYt="#12239E",rYt="#E66C37",iYt="#6B007B",sYt="#E044A7",oYt="#744EC2",aYt="#D9B300",uYt="#D64550",Got=Cs,Yot="#DEEFFF",UB=[Yot,Got],cYt=[Yot,"#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff",Got],lYt={view:{stroke:zB},background:zB,font:am,header:{titleFont:BB,titleFontSize:LB,titleColor:PB,labelFont:am,labelFontSize:DB,labelColor:um},axis:{ticks:!1,grid:!1,domain:!1,labelColor:um,labelFontSize:RB,titleFont:BB,titleColor:PB,titleFontSize:LB,titleFontWeight:"normal"},axisQuantitative:{tickCount:3,grid:!0,gridColor:eYt,gridDash:[1,5],labelFlush:!1},axisBand:{tickExtra:!0},axisX:{labelPadding:5},axisY:{labelPadding:10},bar:{fill:Cs},line:{stroke:Cs,strokeWidth:3,strokeCap:"round",strokeJoin:"round"},text:{font:am,fontSize:RB,fill:um},arc:{fill:Cs},area:{fill:Cs,line:!0,opacity:.6},path:{stroke:Cs},rect:{fill:Cs},point:{fill:Cs,filled:!0,size:75},shape:{stroke:Cs},symbol:{fill:Cs,strokeWidth:1.5,size:50},legend:{titleFont:am,titleFontWeight:"bold",titleColor:um,labelFont:am,labelFontSize:DB,labelColor:um,symbolType:"circle",symbolSize:75},range:{category:[Cs,nYt,rYt,iYt,sYt,oYt,aYt,uYt],diverging:UB,heatmap:UB,ordinal:cYt}},U$='IBM Plex Sans,system-ui,-apple-system,BlinkMacSystemFont,".sfnstext-regular",sans-serif',fYt='IBM Plex Sans Condensed, system-ui, -apple-system, BlinkMacSystemFont, ".SFNSText-Regular", sans-serif',j$=400,Pb={textPrimary:{g90:"#f4f4f4",g100:"#f4f4f4",white:"#161616",g10:"#161616"},textSecondary:{g90:"#c6c6c6",g100:"#c6c6c6",white:"#525252",g10:"#525252"},layerAccent01:{white:"#e0e0e0",g10:"#e0e0e0",g90:"#525252",g100:"#393939"},gridBg:{white:"#ffffff",g10:"#ffffff",g90:"#161616",g100:"#161616"}},dYt=["#8a3ffc","#33b1ff","#007d79","#ff7eb6","#fa4d56","#fff1f1","#6fdc8c","#4589ff","#d12771","#d2a106","#08bdba","#bae6ff","#ba4e00","#d4bbff"],hYt=["#6929c4","#1192e8","#005d5d","#9f1853","#fa4d56","#570408","#198038","#002d9c","#ee538b","#b28600","#009d9a","#012749","#8a3800","#a56eff"];function TE({theme:t,background:e}){const n=["white","g10"].includes(t)?"light":"dark",r=Pb.gridBg[t],i=Pb.textPrimary[t],s=Pb.textSecondary[t],o=n==="dark"?dYt:hYt,a=n==="dark"?"#d4bbff":"#6929c4";return{background:e,arc:{fill:a},area:{fill:a},path:{stroke:a},rect:{fill:a},shape:{stroke:a},symbol:{stroke:a},circle:{fill:a},view:{fill:r,stroke:r},group:{fill:r},title:{color:i,anchor:"start",dy:-15,fontSize:16,font:U$,fontWeight:600},axis:{labelColor:s,labelFontSize:12,labelFont:fYt,labelFontWeight:j$,titleColor:i,titleFontWeight:600,titleFontSize:12,grid:!0,gridColor:Pb.layerAccent01[t],labelAngle:0},axisX:{titlePadding:10},axisY:{titlePadding:2.5},style:{"guide-label":{font:U$,fill:s,fontWeight:j$},"guide-title":{font:U$,fill:s,fontWeight:j$}},range:{category:o,diverging:["#750e13","#a2191f","#da1e28","#fa4d56","#ff8389","#ffb3b8","#ffd7d9","#fff1f1","#e5f6ff","#bae6ff","#82cfff","#33b1ff","#1192e8","#0072c3","#00539a","#003a6d"],heatmap:["#f6f2ff","#e8daff","#d4bbff","#be95ff","#a56eff","#8a3ffc","#6929c4","#491d8b","#31135e","#1c0f30"]}}}const pYt=TE({theme:"white",background:"#ffffff"}),gYt=TE({theme:"g10",background:"#f4f4f4"}),mYt=TE({theme:"g90",background:"#262626"}),yYt=TE({theme:"g100",background:"#161616"}),bYt=DGt.version,vYt=Object.freeze(Object.defineProperty({__proto__:null,carbong10:gYt,carbong100:yYt,carbong90:mYt,carbonwhite:pYt,dark:LGt,excel:BGt,fivethirtyeight:UGt,ggplot2:jGt,googlecharts:tYt,latimes:GGt,powerbi:lYt,quartz:YGt,urbaninstitute:ZGt,version:bYt,vox:HGt},Symbol.toStringTag,{value:"Module"}));function wYt(t,e,n,r){if(W(t))return`[${t.map(i=>e(at(i)?i:jB(i,n))).join(", ")}]`;if(st(t)){let i="";const{title:s,image:o,...a}=t;s&&(i+=`<h2>${e(s)}</h2>`),o&&(i+=`<img src="${new URL(e(o),r||location.href).href}">`);const u=Object.keys(a);if(u.length>0){i+="<table>";for(const c of u){let l=a[c];l!==void 0&&(st(l)&&(l=jB(l,n)),i+=`<tr><td class="key">${e(c)}</td><td class="value">${e(l)}</td></tr>`)}i+="</table>"}return i||"{}"}return e(t)}function xYt(t){const e=[];return function(n,r){if(typeof r!="object"||r===null)return r;const i=e.indexOf(this)+1;return e.length=i,e.length>t?"[Object]":e.indexOf(r)>=0?"[Circular]":(e.push(r),r)}}function jB(t,e){return JSON.stringify(t,xYt(e))}var _Yt=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black;
}
#vg-tooltip-element.visible {
  visibility: visible;
}
#vg-tooltip-element h2 {
  margin-top: 0;
  margin-bottom: 10px;
  font-size: 13px;
}
#vg-tooltip-element table {
  border-spacing: 0;
}
#vg-tooltip-element table tr {
  border: none;
}
#vg-tooltip-element table tr td {
  overflow: hidden;
  text-overflow: ellipsis;
  padding-top: 2px;
  padding-bottom: 2px;
}
#vg-tooltip-element table tr td.key {
  color: #808080;
  max-width: 150px;
  text-align: right;
  padding-right: 4px;
}
#vg-tooltip-element table tr td.value {
  display: block;
  max-width: 300px;
  max-height: 7em;
  text-align: left;
}
#vg-tooltip-element.dark-theme {
  background-color: rgba(32, 32, 32, 0.9);
  border: 1px solid #f5f5f5;
  color: white;
}
#vg-tooltip-element.dark-theme td.key {
  color: #bfbfbf;
}
`;const Hot="vg-tooltip-element",SYt={offsetX:10,offsetY:10,id:Hot,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:EYt,maxDepth:2,formatTooltip:wYt,baseURL:"",anchor:"cursor",position:["top","bottom","left","right","top-left","top-right","bottom-left","bottom-right"]};function EYt(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function AYt(t){if(!/^[A-Za-z]+[-:.\w]*$/.test(t))throw new Error("Invalid HTML ID");return _Yt.toString().replace(Hot,t)}function Xot(t,e,{offsetX:n,offsetY:r}){const i=Kot({x1:t.clientX,x2:t.clientX,y1:t.clientY,y2:t.clientY},e,n,r),s=["bottom-right","bottom-left","top-right","top-left"];for(const o of s)if(Qot(i[o],e))return i[o];return i["top-left"]}function $Yt(t,e,n,r,i){const{position:s,offsetX:o,offsetY:a}=i,u=t._el.getBoundingClientRect(),c=t._origin,l=TYt(u,c,n),f=Kot(l,r,o,a),d=Array.isArray(s)?s:[s];for(const h of d)if(Qot(f[h],r)&&!kYt(e,f[h],r))return f[h];return Xot(e,r,i)}function TYt(t,e,n){const r=n.isVoronoi?n.datum.bounds:n.bounds;let i=t.left+e[0]+r.x1,s=t.top+e[1]+r.y1,o=n;for(;o.mark.group;)o=o.mark.group,i+=o.x??0,s+=o.y??0;const a=r.x2-r.x1,u=r.y2-r.y1;return{x1:i,x2:i+a,y1:s,y2:s+u}}function Kot(t,e,n,r){const i=(t.x1+t.x2)/2,s=(t.y1+t.y2)/2,o=t.x1-e.width-n,a=i-e.width/2,u=t.x2+n,c=t.y1-e.height-r,l=s-e.height/2,f=t.y2+r;return{top:{x:a,y:c},bottom:{x:a,y:f},left:{x:o,y:l},right:{x:u,y:l},"top-left":{x:o,y:c},"top-right":{x:u,y:c},"bottom-left":{x:o,y:f},"bottom-right":{x:u,y:f}}}function Qot(t,e){return t.x>=0&&t.y>=0&&t.x+e.width<=window.innerWidth&&t.y+e.height<=window.innerHeight}function kYt(t,e,n){return t.clientX>=e.x&&t.clientX<=e.x+n.width&&t.clientY>=e.y&&t.clientY<=e.y+n.height}class MYt{constructor(e){this.options={...SYt,...e};const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const r=document.createElement("style");r.setAttribute("id",this.options.styleId),r.innerHTML=AYt(n);const i=document.head;i.childNodes.length>0?i.insertBefore(r,i.childNodes[0]):i.appendChild(r)}}tooltipHandler(e,n,r,i){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),(document.fullscreenElement??document.body).appendChild(this.el)),i==null||i===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=this.options.formatTooltip(i,this.options.sanitize,this.options.maxDepth,this.options.baseURL),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:s,y:o}=this.options.anchor==="mark"?$Yt(e,n,r,this.el.getBoundingClientRect(),this.options):Xot(n,this.el.getBoundingClientRect(),this.options);this.el.style.top=`${o}px`,this.el.style.left=`${s}px`}}var q$={};/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var CYt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),IYt=Object.prototype.hasOwnProperty;function xM(t,e){return IYt.call(t,e)}function _M(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)xM(t,i)&&r.push(i);return r}function Mi(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function SM(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Wl(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Jot(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function EM(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(EM(t[e]))return!0}else if(typeof t=="object"){for(var r=_M(t),i=r.length,s=0;s<i;s++)if(EM(t[r[s]]))return!0}}return!1}function qB(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Zot=function(t){CYt(e,t);function e(n,r,i,s,o){var a=this.constructor,u=t.call(this,qB(n,{name:r,index:i,operation:s,tree:o}))||this;return u.name=r,u.index=i,u.operation=s,u.tree=o,Object.setPrototypeOf(u,a.prototype),u.message=qB(n,{name:r,index:i,operation:s,tree:o}),u}return e}(Error),tn=Zot,FYt=Mi,xh={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=p2(n,this.path);r&&(r=Mi(r));var i=Sf(n,{op:"remove",path:this.from}).removed;return Sf(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=p2(n,this.from);return Sf(n,{op:"add",path:this.path,value:Mi(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:ly(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},NYt={add:function(t,e,n){return SM(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:xh.move,copy:xh.copy,test:xh.test,_get:xh._get};function p2(t,e){if(e=="")return t;var n={op:"_get",path:e};return Sf(t,n),n.value}function Sf(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):g2(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=p2(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=ly(t,e.value),o.test===!1)throw new tn("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new tn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=Mi(t));var a=e.path||"",u=a.split("/"),c=t,l=1,f=u.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=g2;;){if(h=u[l],h&&h.indexOf("~")!=-1&&(h=Jot(h)),i&&(h=="__proto__"||h=="prototype"&&l>0&&u[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(c[h]===void 0?d=u.slice(0,l).join("/"):l==f-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),l++,Array.isArray(c)){if(h==="-")h=c.length;else{if(n&&!SM(h))throw new tn("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);SM(h)&&(h=~~h)}if(l>=f){if(n&&e.op==="add"&&h>c.length)throw new tn("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=NYt[e.op].call(e,c,h,t);if(o.test===!1)throw new tn("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(l>=f){var o=xh[e.op].call(e,c,h,t);if(o.test===!1)throw new tn("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(c=c[h],n&&l<f&&(!c||typeof c!="object"))throw new tn("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function kE(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new tn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Mi(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=Sf(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function OYt(t,e,n){var r=Sf(t,e);if(r.test===!1)throw new tn("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function g2(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new tn("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(xh[t.op]){if(typeof t.path!="string")throw new tn("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new tn('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new tn("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new tn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&EM(t.value))throw new tn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new tn("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new tn("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=tat([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new tn("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new tn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function tat(t,e,n){try{if(!Array.isArray(t))throw new tn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)kE(Mi(e),Mi(t),n||!0);else{n=n||g2;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof tn)return i;throw i}}function ly(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!ly(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!ly(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var RYt=Object.freeze({__proto__:null,JsonPatchError:tn,_areEquals:ly,applyOperation:Sf,applyPatch:kE,applyReducer:OYt,deepClone:FYt,getValueByPointer:p2,validate:tat,validator:g2});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var hD=new WeakMap,DYt=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),LYt=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function BYt(t){return hD.get(t)}function PYt(t,e){return t.observers.get(e)}function zYt(t,e){t.observers.delete(e.callback)}function UYt(t,e){e.unobserve()}function jYt(t,e){var n=[],r,i=BYt(t);if(!i)i=new DYt(t),hD.set(t,i);else{var s=PYt(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Mi(t),e){r.callback=e,r.next=null;var o=function(){AM(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){AM(r),clearTimeout(r.next),zYt(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new LYt(e,r)),r}function AM(t,e){e===void 0&&(e=!1);var n=hD.get(t.object);pD(n.value,t.object,t.patches,"",e),t.patches.length&&kE(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function pD(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=_M(e),o=_M(t),a=!1,u=o.length-1;u>=0;u--){var c=o[u],l=t[c];if(xM(e,c)&&!(e[c]===void 0&&l!==void 0&&Array.isArray(e)===!1)){var f=e[c];typeof l=="object"&&l!=null&&typeof f=="object"&&f!=null&&Array.isArray(l)===Array.isArray(f)?pD(l,f,n,r+"/"+Wl(c),i):l!==f&&(i&&n.push({op:"test",path:r+"/"+Wl(c),value:Mi(l)}),n.push({op:"replace",path:r+"/"+Wl(c),value:Mi(f)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+Wl(c),value:Mi(l)}),n.push({op:"remove",path:r+"/"+Wl(c)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var u=0;u<s.length;u++){var c=s[u];!xM(t,c)&&e[c]!==void 0&&n.push({op:"add",path:r+"/"+Wl(c),value:Mi(e[c])})}}}function qYt(t,e,n){n===void 0&&(n=!1);var r=[];return pD(t,e,r,"",n),r}var WYt=Object.freeze({__proto__:null,compare:qYt,generate:AM,observe:jYt,unobserve:UYt});Object.assign({},RYt,WYt,{JsonPatchError:Zot,deepClone:Mi,escapePathComponent:Wl,unescapePathComponent:Jot});function VYt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var W$,WB;function GYt(){if(WB)return W$;WB=1;class t{constructor(){this.max=1e3,this.map=new Map}get(n){const r=this.map.get(n);if(r!==void 0)return this.map.delete(n),this.map.set(n,r),r}delete(n){return this.map.delete(n)}set(n,r){if(!this.delete(n)&&r!==void 0){if(this.map.size>=this.max){const s=this.map.keys().next().value;this.delete(s)}this.map.set(n,r)}return this}}return W$=t,W$}var V$,VB;function gD(){if(VB)return V$;VB=1;const t=Object.freeze({loose:!0}),e=Object.freeze({});return V$=r=>r?typeof r!="object"?t:r:e,V$}var zb={exports:{}},G$,GB;function mD(){if(GB)return G$;GB=1;const t="2.0.0",e=256,n=Number.MAX_SAFE_INTEGER||9007199254740991,r=16,i=e-6;return G$={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:i,MAX_SAFE_INTEGER:n,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:t,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},G$}var Y$,YB;function ME(){return YB||(YB=1,Y$=typeof process=="object"&&q$&&q$.NODE_DEBUG&&/\bsemver\b/i.test(q$.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{}),Y$}var HB;function yD(){return HB||(HB=1,function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:i}=mD(),s=ME();e=t.exports={};const o=e.re=[],a=e.safeRe=[],u=e.src=[],c=e.t={};let l=0;const f="[a-zA-Z0-9-]",d=[["\\s",1],["\\d",i],[f,r]],h=g=>{for(const[m,y]of d)g=g.split(`${m}*`).join(`${m}{0,${y}}`).split(`${m}+`).join(`${m}{1,${y}}`);return g},p=(g,m,y)=>{const b=h(m),w=l++;s(g,w,m),c[g]=w,u[w]=m,o[w]=new RegExp(m,y?"g":void 0),a[w]=new RegExp(b,y?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),p("MAINVERSION",`(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${u[c.NUMERICIDENTIFIER]}|${u[c.NONNUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${u[c.NUMERICIDENTIFIERLOOSE]}|${u[c.NONNUMERICIDENTIFIER]})`),p("PRERELEASE",`(?:-(${u[c.PRERELEASEIDENTIFIER]}(?:\\.${u[c.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${u[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[c.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${f}+`),p("BUILD",`(?:\\+(${u[c.BUILDIDENTIFIER]}(?:\\.${u[c.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${u[c.MAINVERSION]}${u[c.PRERELEASE]}?${u[c.BUILD]}?`),p("FULL",`^${u[c.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${u[c.MAINVERSIONLOOSE]}${u[c.PRERELEASELOOSE]}?${u[c.BUILD]}?`),p("LOOSE",`^${u[c.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${u[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${u[c.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:${u[c.PRERELEASE]})?${u[c.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:${u[c.PRERELEASELOOSE]})?${u[c.BUILD]}?)?)?`),p("XRANGE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAINLOOSE]}$`),p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),p("COERCE",`${u[c.COERCEPLAIN]}(?:$|[^\\d])`),p("COERCEFULL",u[c.COERCEPLAIN]+`(?:${u[c.PRERELEASE]})?(?:${u[c.BUILD]})?(?:$|[^\\d])`),p("COERCERTL",u[c.COERCE],!0),p("COERCERTLFULL",u[c.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${u[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",p("TILDE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${u[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",p("CARET",`^${u[c.LONECARET]}${u[c.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${u[c.LONECARET]}${u[c.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${u[c.GTLT]}\\s*(${u[c.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]}|${u[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${u[c.XRANGEPLAIN]})\\s+-\\s+(${u[c.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${u[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[c.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(zb,zb.exports)),zb.exports}var H$,XB;function YYt(){if(XB)return H$;XB=1;const t=/^[0-9]+$/,e=(r,i)=>{const s=t.test(r),o=t.test(i);return s&&o&&(r=+r,i=+i),r===i?0:s&&!o?-1:o&&!s?1:r<i?-1:1};return H$={compareIdentifiers:e,rcompareIdentifiers:(r,i)=>e(i,r)},H$}var X$,KB;function bD(){if(KB)return X$;KB=1;const t=ME(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:n}=mD(),{safeRe:r,t:i}=yD(),s=gD(),{compareIdentifiers:o}=YYt();class a{constructor(c,l){if(l=s(l),c instanceof a){if(c.loose===!!l.loose&&c.includePrerelease===!!l.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>e)throw new TypeError(`version is longer than ${e} characters`);t("SemVer",c,l),this.options=l,this.loose=!!l.loose,this.includePrerelease=!!l.includePrerelease;const f=c.trim().match(l.loose?r[i.LOOSE]:r[i.FULL]);if(!f)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>n||this.major<0)throw new TypeError("Invalid major version");if(this.minor>n||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>n||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(d=>{if(/^[0-9]+$/.test(d)){const h=+d;if(h>=0&&h<n)return h}return d}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(t("SemVer.compare",this.version,this.options,c),!(c instanceof a)){if(typeof c=="string"&&c===this.version)return 0;c=new a(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof a||(c=new a(c,this.options)),o(this.major,c.major)||o(this.minor,c.minor)||o(this.patch,c.patch)}comparePre(c){if(c instanceof a||(c=new a(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let l=0;do{const f=this.prerelease[l],d=c.prerelease[l];if(t("prerelease compare",l,f,d),f===void 0&&d===void 0)return 0;if(d===void 0)return 1;if(f===void 0)return-1;if(f===d)continue;return o(f,d)}while(++l)}compareBuild(c){c instanceof a||(c=new a(c,this.options));let l=0;do{const f=this.build[l],d=c.build[l];if(t("build compare",l,f,d),f===void 0&&d===void 0)return 0;if(d===void 0)return 1;if(f===void 0)return-1;if(f===d)continue;return o(f,d)}while(++l)}inc(c,l,f){switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",l,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",l,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",l,f),this.inc("pre",l,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",l,f),this.inc("pre",l,f);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const d=Number(f)?1:0;if(!l&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[d];else{let h=this.prerelease.length;for(;--h>=0;)typeof this.prerelease[h]=="number"&&(this.prerelease[h]++,h=-2);if(h===-1){if(l===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(d)}}if(l){let h=[l,d];f===!1&&(h=[l]),o(this.prerelease[0],l)===0?isNaN(this.prerelease[1])&&(this.prerelease=h):this.prerelease=h}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return X$=a,X$}var K$,QB;function Cg(){if(QB)return K$;QB=1;const t=bD();return K$=(n,r,i)=>new t(n,i).compare(new t(r,i)),K$}var Q$,JB;function HYt(){if(JB)return Q$;JB=1;const t=Cg();return Q$=(n,r,i)=>t(n,r,i)===0,Q$}var J$,ZB;function XYt(){if(ZB)return J$;ZB=1;const t=Cg();return J$=(n,r,i)=>t(n,r,i)!==0,J$}var Z$,tP;function KYt(){if(tP)return Z$;tP=1;const t=Cg();return Z$=(n,r,i)=>t(n,r,i)>0,Z$}var t3,eP;function QYt(){if(eP)return t3;eP=1;const t=Cg();return t3=(n,r,i)=>t(n,r,i)>=0,t3}var e3,nP;function JYt(){if(nP)return e3;nP=1;const t=Cg();return e3=(n,r,i)=>t(n,r,i)<0,e3}var n3,rP;function ZYt(){if(rP)return n3;rP=1;const t=Cg();return n3=(n,r,i)=>t(n,r,i)<=0,n3}var r3,iP;function tHt(){if(iP)return r3;iP=1;const t=HYt(),e=XYt(),n=KYt(),r=QYt(),i=JYt(),s=ZYt();return r3=(a,u,c,l)=>{switch(u){case"===":return typeof a=="object"&&(a=a.version),typeof c=="object"&&(c=c.version),a===c;case"!==":return typeof a=="object"&&(a=a.version),typeof c=="object"&&(c=c.version),a!==c;case"":case"=":case"==":return t(a,c,l);case"!=":return e(a,c,l);case">":return n(a,c,l);case">=":return r(a,c,l);case"<":return i(a,c,l);case"<=":return s(a,c,l);default:throw new TypeError(`Invalid operator: ${u}`)}},r3}var i3,sP;function eHt(){if(sP)return i3;sP=1;const t=Symbol("SemVer ANY");class e{static get ANY(){return t}constructor(l,f){if(f=n(f),l instanceof e){if(l.loose===!!f.loose)return l;l=l.value}l=l.trim().split(/\s+/).join(" "),o("comparator",l,f),this.options=f,this.loose=!!f.loose,this.parse(l),this.semver===t?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(l){const f=this.options.loose?r[i.COMPARATORLOOSE]:r[i.COMPARATOR],d=l.match(f);if(!d)throw new TypeError(`Invalid comparator: ${l}`);this.operator=d[1]!==void 0?d[1]:"",this.operator==="="&&(this.operator=""),d[2]?this.semver=new a(d[2],this.options.loose):this.semver=t}toString(){return this.value}test(l){if(o("Comparator.test",l,this.options.loose),this.semver===t||l===t)return!0;if(typeof l=="string")try{l=new a(l,this.options)}catch{return!1}return s(l,this.operator,this.semver,this.options)}intersects(l,f){if(!(l instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(l.value,f).test(this.value):l.operator===""?l.value===""?!0:new u(this.value,f).test(l.semver):(f=n(f),f.includePrerelease&&(this.value==="<0.0.0-0"||l.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||l.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&l.operator.startsWith(">")||this.operator.startsWith("<")&&l.operator.startsWith("<")||this.semver.version===l.semver.version&&this.operator.includes("=")&&l.operator.includes("=")||s(this.semver,"<",l.semver,f)&&this.operator.startsWith(">")&&l.operator.startsWith("<")||s(this.semver,">",l.semver,f)&&this.operator.startsWith("<")&&l.operator.startsWith(">")))}}i3=e;const n=gD(),{safeRe:r,t:i}=yD(),s=tHt(),o=ME(),a=bD(),u=eat();return i3}var s3,oP;function eat(){if(oP)return s3;oP=1;const t=/\s+/g;class e{constructor(k,I){if(I=i(I),k instanceof e)return k.loose===!!I.loose&&k.includePrerelease===!!I.includePrerelease?k:new e(k.raw,I);if(k instanceof s)return this.raw=k.value,this.set=[[k]],this.formatted=void 0,this;if(this.options=I,this.loose=!!I.loose,this.includePrerelease=!!I.includePrerelease,this.raw=k.trim().replace(t," "),this.set=this.raw.split("||").map(N=>this.parseRange(N.trim())).filter(N=>N.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const N=this.set[0];if(this.set=this.set.filter(R=>!g(R[0])),this.set.length===0)this.set=[N];else if(this.set.length>1){for(const R of this.set)if(R.length===1&&m(R[0])){this.set=[R];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let k=0;k<this.set.length;k++){k>0&&(this.formatted+="||");const I=this.set[k];for(let N=0;N<I.length;N++)N>0&&(this.formatted+=" "),this.formatted+=I[N].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(k){const N=((this.options.includePrerelease&&h)|(this.options.loose&&p))+":"+k,R=r.get(N);if(R)return R;const D=this.options.loose,L=D?u[c.HYPHENRANGELOOSE]:u[c.HYPHENRANGE];k=k.replace(L,C(this.options.includePrerelease)),o("hyphen replace",k),k=k.replace(u[c.COMPARATORTRIM],l),o("comparator trim",k),k=k.replace(u[c.TILDETRIM],f),o("tilde trim",k),k=k.replace(u[c.CARETTRIM],d),o("caret trim",k);let P=k.split(" ").map(Z=>b(Z,this.options)).join(" ").split(/\s+/).map(Z=>T(Z,this.options));D&&(P=P.filter(Z=>(o("loose invalid filter",Z,this.options),!!Z.match(u[c.COMPARATORLOOSE])))),o("range list",P);const B=new Map,G=P.map(Z=>new s(Z,this.options));for(const Z of G){if(g(Z))return[Z];B.set(Z.value,Z)}B.size>1&&B.has("")&&B.delete("");const ct=[...B.values()];return r.set(N,ct),ct}intersects(k,I){if(!(k instanceof e))throw new TypeError("a Range is required");return this.set.some(N=>y(N,I)&&k.set.some(R=>y(R,I)&&N.every(D=>R.every(L=>D.intersects(L,I)))))}test(k){if(!k)return!1;if(typeof k=="string")try{k=new a(k,this.options)}catch{return!1}for(let I=0;I<this.set.length;I++)if(F(this.set[I],k,this.options))return!0;return!1}}s3=e;const n=GYt(),r=new n,i=gD(),s=eHt(),o=ME(),a=bD(),{safeRe:u,t:c,comparatorTrimReplace:l,tildeTrimReplace:f,caretTrimReplace:d}=yD(),{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:p}=mD(),g=M=>M.value==="<0.0.0-0",m=M=>M.value==="",y=(M,k)=>{let I=!0;const N=M.slice();let R=N.pop();for(;I&&N.length;)I=N.every(D=>R.intersects(D,k)),R=N.pop();return I},b=(M,k)=>(o("comp",M,k),M=S(M,k),o("caret",M),M=v(M,k),o("tildes",M),M=E(M,k),o("xrange",M),M=$(M,k),o("stars",M),M),w=M=>!M||M.toLowerCase()==="x"||M==="*",v=(M,k)=>M.trim().split(/\s+/).map(I=>x(I,k)).join(" "),x=(M,k)=>{const I=k.loose?u[c.TILDELOOSE]:u[c.TILDE];return M.replace(I,(N,R,D,L,P)=>{o("tilde",M,N,R,D,L,P);let B;return w(R)?B="":w(D)?B=`>=${R}.0.0 <${+R+1}.0.0-0`:w(L)?B=`>=${R}.${D}.0 <${R}.${+D+1}.0-0`:P?(o("replaceTilde pr",P),B=`>=${R}.${D}.${L}-${P} <${R}.${+D+1}.0-0`):B=`>=${R}.${D}.${L} <${R}.${+D+1}.0-0`,o("tilde return",B),B})},S=(M,k)=>M.trim().split(/\s+/).map(I=>_(I,k)).join(" "),_=(M,k)=>{o("caret",M,k);const I=k.loose?u[c.CARETLOOSE]:u[c.CARET],N=k.includePrerelease?"-0":"";return M.replace(I,(R,D,L,P,B)=>{o("caret",M,R,D,L,P,B);let G;return w(D)?G="":w(L)?G=`>=${D}.0.0${N} <${+D+1}.0.0-0`:w(P)?D==="0"?G=`>=${D}.${L}.0${N} <${D}.${+L+1}.0-0`:G=`>=${D}.${L}.0${N} <${+D+1}.0.0-0`:B?(o("replaceCaret pr",B),D==="0"?L==="0"?G=`>=${D}.${L}.${P}-${B} <${D}.${L}.${+P+1}-0`:G=`>=${D}.${L}.${P}-${B} <${D}.${+L+1}.0-0`:G=`>=${D}.${L}.${P}-${B} <${+D+1}.0.0-0`):(o("no pr"),D==="0"?L==="0"?G=`>=${D}.${L}.${P}${N} <${D}.${L}.${+P+1}-0`:G=`>=${D}.${L}.${P}${N} <${D}.${+L+1}.0-0`:G=`>=${D}.${L}.${P} <${+D+1}.0.0-0`),o("caret return",G),G})},E=(M,k)=>(o("replaceXRanges",M,k),M.split(/\s+/).map(I=>A(I,k)).join(" ")),A=(M,k)=>{M=M.trim();const I=k.loose?u[c.XRANGELOOSE]:u[c.XRANGE];return M.replace(I,(N,R,D,L,P,B)=>{o("xRange",M,N,R,D,L,P,B);const G=w(D),ct=G||w(L),Z=ct||w(P),lt=Z;return R==="="&&lt&&(R=""),B=k.includePrerelease?"-0":"",G?R===">"||R==="<"?N="<0.0.0-0":N="*":R&&lt?(ct&&(L=0),P=0,R===">"?(R=">=",ct?(D=+D+1,L=0,P=0):(L=+L+1,P=0)):R==="<="&&(R="<",ct?D=+D+1:L=+L+1),R==="<"&&(B="-0"),N=`${R+D}.${L}.${P}${B}`):ct?N=`>=${D}.0.0${B} <${+D+1}.0.0-0`:Z&&(N=`>=${D}.${L}.0${B} <${D}.${+L+1}.0-0`),o("xRange return",N),N})},$=(M,k)=>(o("replaceStars",M,k),M.trim().replace(u[c.STAR],"")),T=(M,k)=>(o("replaceGTE0",M,k),M.trim().replace(u[k.includePrerelease?c.GTE0PRE:c.GTE0],"")),C=M=>(k,I,N,R,D,L,P,B,G,ct,Z,lt)=>(w(N)?I="":w(R)?I=`>=${N}.0.0${M?"-0":""}`:w(D)?I=`>=${N}.${R}.0${M?"-0":""}`:L?I=`>=${I}`:I=`>=${I}${M?"-0":""}`,w(G)?B="":w(ct)?B=`<${+G+1}.0.0-0`:w(Z)?B=`<${G}.${+ct+1}.0-0`:lt?B=`<=${G}.${ct}.${Z}-${lt}`:M?B=`<${G}.${ct}.${+Z+1}-0`:B=`<=${B}`,`${I} ${B}`.trim()),F=(M,k,I)=>{for(let N=0;N<M.length;N++)if(!M[N].test(k))return!1;if(k.prerelease.length&&!I.includePrerelease){for(let N=0;N<M.length;N++)if(o(M[N].semver),M[N].semver!==s.ANY&&M[N].semver.prerelease.length>0){const R=M[N].semver;if(R.major===k.major&&R.minor===k.minor&&R.patch===k.patch)return!0}return!1}return!0};return s3}var o3,aP;function nHt(){if(aP)return o3;aP=1;const t=eat();return o3=(n,r,i)=>{try{r=new t(r,i)}catch{return!1}return r.test(n)},o3}var rHt=nHt(),nat=VYt(rHt);function iHt(t,e,n){const r=t.open(e),i=250,{origin:s}=new URL(e);let o=40;function a(c){c.source===r&&(o=0,t.removeEventListener("message",a,!1))}t.addEventListener("message",a,!1);function u(){o<=0||(r.postMessage(n,s),setTimeout(u,i),o-=1)}setTimeout(u,i)}var sHt=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box;
}
.vega-embed.has-actions {
  padding-right: 38px;
}
.vega-embed details:not([open]) > :not(summary) {
  display: none !important;
}
.vega-embed summary {
  list-style: none;
  position: absolute;
  top: 0;
  right: 0;
  padding: 6px;
  z-index: 1000;
  background: white;
  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
  color: #1b1e23;
  border: 1px solid #aaa;
  border-radius: 999px;
  opacity: 0.2;
  transition: opacity 0.4s ease-in;
  cursor: pointer;
  line-height: 0px;
}
.vega-embed summary::-webkit-details-marker {
  display: none;
}
.vega-embed summary:active {
  box-shadow: #aaa 0px 0px 0px 1px inset;
}
.vega-embed summary svg {
  width: 14px;
  height: 14px;
}
.vega-embed details[open] summary {
  opacity: 0.7;
}
.vega-embed:hover summary, .vega-embed:focus-within summary {
  opacity: 1 !important;
  transition: opacity 0.2s ease;
}
.vega-embed .vega-actions {
  position: absolute;
  z-index: 1001;
  top: 35px;
  right: -9px;
  display: flex;
  flex-direction: column;
  padding-bottom: 8px;
  padding-top: 8px;
  border-radius: 4px;
  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
  border: 1px solid #d9d9d9;
  background: white;
  animation-duration: 0.15s;
  animation-name: scale-in;
  animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
  text-align: left;
}
.vega-embed .vega-actions a {
  padding: 8px 16px;
  font-family: sans-serif;
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
  color: #434a56;
  text-decoration: none;
}
.vega-embed .vega-actions a:hover, .vega-embed .vega-actions a:focus {
  background-color: #f7f7f9;
  color: black;
}
.vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
  content: "";
  display: inline-block;
  position: absolute;
}
.vega-embed .vega-actions::before {
  left: auto;
  right: 14px;
  top: -16px;
  border: 8px solid rgba(0, 0, 0, 0);
  border-bottom-color: #d9d9d9;
}
.vega-embed .vega-actions::after {
  left: auto;
  right: 15px;
  top: -14px;
  border: 7px solid rgba(0, 0, 0, 0);
  border-bottom-color: #fff;
}
.vega-embed .chart-wrapper.fit-x {
  width: 100%;
}
.vega-embed .chart-wrapper.fit-y {
  height: 100%;
}

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px;
}

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
`;function rat(t,...e){for(const n of e)oHt(t,n);return t}function oHt(t,e){for(const n of Object.keys(e))dg(t,n,e[n],!0)}const _o=W9t;let fy=OGt;const Ub=typeof window<"u"?window:void 0;var fP;fy===void 0&&((fP=Ub==null?void 0:Ub.vl)!=null&&fP.compile)&&(fy=Ub.vl);const aHt={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},uHt={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},qm={vega:"Vega","vega-lite":"Vega-Lite"},m2={vega:_o.version,"vega-lite":fy?fy.version:"not available"},cHt={vega:t=>t,"vega-lite":(t,e)=>fy.compile(t,{config:e}).spec},lHt=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,fHt="chart-wrapper";function dHt(t){return typeof t=="function"}function uP(t,e,n,r){const i=`<html><head>${e}</head><body><pre><code class="json">`,s=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(i+t+s),o.document.title=`${qm[r]} JSON Source`}function hHt(t,e){if(t.$schema){const n=Vot(t.$schema);e&&e!==n.library&&console.warn(`The given visualization spec is written in ${qm[n.library]}, but mode argument sets ${qm[e]??e}.`);const r=n.library;return nat(m2[r],`^${n.version.slice(1)}`)||console.warn(`The input spec uses ${qm[r]} ${n.version}, but the current version of ${qm[r]} is v${m2[r]}.`),r}return"mark"in t||"encoding"in t||"layer"in t||"hconcat"in t||"vconcat"in t||"facet"in t||"repeat"in t?"vega-lite":"marks"in t||"signals"in t||"scales"in t||"axes"in t?"vega":e??"vega"}function iat(t){return!!(t&&"load"in t)}function cP(t){return iat(t)?t:_o.loader(t)}function pHt(t){var n;const e=((n=t.usermeta)==null?void 0:n.embedOptions)??{};return at(e.defaultStyle)&&(e.defaultStyle=!1),e}async function gHt(t,e,n={}){let r,i;at(e)?(i=cP(n.loader),r=JSON.parse(await i.load(e))):r=e;const s=pHt(r),o=s.loader;(!i||o)&&(i=cP(n.loader??o));const a=await lP(s,i),u=await lP(n,i),c={...rat(u,a),config:fg(u.config??{},a.config??{})};return await yHt(t,r,c,i)}async function lP(t,e){const n=at(t.config)?JSON.parse(await e.load(t.config)):t.config??{},r=at(t.patch)?JSON.parse(await e.load(t.patch)):t.patch;return{...t,...r?{patch:r}:{},...n?{config:n}:{}}}function mHt(t){const e=t.getRootNode?t.getRootNode():document;return e instanceof ShadowRoot?{root:e,rootContainer:e}:{root:document,rootContainer:document.head??document.body}}async function yHt(t,e,n={},r){const i=n.theme?fg(vYt[n.theme],n.config??{}):n.config,s=gl(n.actions)?n.actions:rat({},aHt,n.actions??{}),o={...uHt,...n.i18n},a=n.renderer??"canvas",u=n.logLevel??_o.Warn,c=n.downloadFileName??"visualization",l=typeof t=="string"?document.querySelector(t):t;if(!l)throw new Error(`${t} does not exist`);if(n.defaultStyle!==!1){const x="vega-embed-style",{root:S,rootContainer:_}=mHt(l);if(!S.getElementById(x)){const E=document.createElement("style");E.id=x,E.innerHTML=n.defaultStyle===void 0||n.defaultStyle===!0?sHt.toString():n.defaultStyle,_.appendChild(E)}}const f=hHt(e,n.mode);let d=cHt[f](e,i);if(f==="vega-lite"&&d.$schema){const x=Vot(d.$schema);nat(m2.vega,`^${x.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${x.version}, but current version is v${m2.vega}.`)}l.classList.add("vega-embed"),s&&l.classList.add("has-actions"),l.innerHTML="";let h=l;if(s){const x=document.createElement("div");x.classList.add(fHt),l.appendChild(x),h=x}const p=n.patch;if(p&&(d=p instanceof Function?p(d):kE(d,p,!0,!1).newDocument),n.formatLocale&&_o.formatLocale(n.formatLocale),n.timeFormatLocale&&_o.timeFormatLocale(n.timeFormatLocale),n.expressionFunctions)for(const x in n.expressionFunctions){const S=n.expressionFunctions[x];"fn"in S?_o.expressionFunction(x,S.fn,S.visitor):S instanceof Function&&_o.expressionFunction(x,S)}const{ast:g}=n,m=_o.parse(d,f==="vega-lite"?{}:i,{ast:g}),y=new(n.viewClass||_o.View)(m,{loader:r,logLevel:u,renderer:a,...g?{expr:_o.expressionInterpreter??n.expr??tBt}:{}});if(y.addSignalListener("autosize",(x,S)=>{const{type:_}=S;_=="fit-x"?(h.classList.add("fit-x"),h.classList.remove("fit-y")):_=="fit-y"?(h.classList.remove("fit-x"),h.classList.add("fit-y")):_=="fit"?h.classList.add("fit-x","fit-y"):h.classList.remove("fit-x","fit-y")}),n.tooltip!==!1){const{loader:x,tooltip:S}=n,_=x&&!iat(x)?x==null?void 0:x.baseURL:void 0,E=dHt(S)?S:new MYt({baseURL:_,...S===!0?{}:S}).call;y.tooltip(E)}let{hover:b}=n;if(b===void 0&&(b=f==="vega"),b){const{hoverSet:x,updateSet:S}=typeof b=="boolean"?{}:b;y.hover(x,S)}n&&(n.width!=null&&y.width(n.width),n.height!=null&&y.height(n.height),n.padding!=null&&y.padding(n.padding)),await y.initialize(h,n.bind).runAsync();let w;if(s!==!1){let x=l;if(n.defaultStyle!==!1||n.forceActionsMenu){const _=document.createElement("details");_.title=o.CLICK_TO_VIEW_ACTIONS,l.append(_),x=_;const E=document.createElement("summary");E.innerHTML=lHt,_.append(E),w=A=>{_.contains(A.target)||_.removeAttribute("open")},document.addEventListener("click",w)}const S=document.createElement("div");if(x.append(S),S.classList.add("vega-actions"),s===!0||s.export!==!1){for(const _ of["svg","png"])if(s===!0||s.export===!0||s.export[_]){const E=o[`${_.toUpperCase()}_ACTION`],A=document.createElement("a"),$=st(n.scaleFactor)?n.scaleFactor[_]:n.scaleFactor;A.text=E,A.href="#",A.target="_blank",A.download=`${c}.${_}`,A.addEventListener("mousedown",async function(T){T.preventDefault();const C=await y.toImageURL(_,$);this.href=C}),S.append(A)}}if(s===!0||s.source!==!1){const _=document.createElement("a");_.text=o.SOURCE_ACTION,_.href="#",_.addEventListener("click",function(E){uP(VA(e),n.sourceHeader??"",n.sourceFooter??"",f),E.preventDefault()}),S.append(_)}if(f==="vega-lite"&&(s===!0||s.compiled!==!1)){const _=document.createElement("a");_.text=o.COMPILED_ACTION,_.href="#",_.addEventListener("click",function(E){uP(VA(d),n.sourceHeader??"",n.sourceFooter??"","vega"),E.preventDefault()}),S.append(_)}if(s===!0||s.editor!==!1){const _=n.editorUrl??"https://vega.github.io/editor/",E=document.createElement("a");E.text=o.EDITOR_ACTION,E.href="#",E.addEventListener("click",function(A){iHt(window,_,{config:i,mode:p?"vega":f,renderer:a,spec:VA(p?d:e)}),A.preventDefault()}),S.append(E)}}function v(){w&&document.removeEventListener("click",w),y.finalize()}return{view:y,spec:e,vgSpec:d,finalize:v,embedOptions:n}}const bHt={$schema:"https://vega.github.io/schema/vega-lite/v5.json",layer:[{data:{name:"table"},params:[{name:"brush",select:{type:"interval",encodings:["x"]}}],mark:"bar",encoding:{x:{timeUnit:"utcmonth",field:"date",type:"ordinal"},y:{field:"precipitation",type:"quantitative"},opacity:{condition:{param:"brush",value:1},value:.7}}},{data:{name:"filteredTable"},mark:"rule",encoding:{y:{field:"precipitation",type:"quantitative"},color:{value:"firebrick"},size:{value:3}}}]};class vHt extends k2{constructor(e){super();const{view:n,table:r,dataset:i,selection:s}=e;this.view=n,this.table=r,this.dataset=i,this.selection=s,this.selection&&this.view.addSignalListener("brush",(o,a)=>{const u=a.utcmonth_date,c=u?Uv(Fg("date"),[Fg(Fc(u.at(0))),Fg(Fc(u.at(-1)))]):null,l=this.view.scale("x"),f={source:this,schema:{type:"interval",scales:[{type:"time",domain:l.domain(),range:l.range()}]},value:c,predicate:c};s.activate(f),s.update(f)})}query(e=[]){return Ni.select({date:Fg("date"),precipitation:yz("precipitation")}).from(this.table).groupby(Fg("date")).where(e)}queryResult(e){return this.view.data(this.dataset,Array.from(e)).resize().run(),this}}class wHt extends k2{constructor(e){const{view:n,table:r,dataset:i,filter:s}=e;super(s),this.view=n,this.table=r,this.dataset=i}query(e=[]){return Ni.select({precipitation:yz("precipitation")}).from(this.table).where(e)}queryResult(e){return this.view.data(this.dataset,Array.from(e)).run(),this}}async function xHt(){const t=document.createElement("div"),e=await gHt(t,bHt,{actions:!1}),n=await hpt({log:!1});cm().databaseConnector(n),await cm().exec(Kct("weather",`${window.location}seattle-weather.csv`));const r=WM.intersect(),i=new vHt({view:e.view,table:"weather",dataset:"table",selection:r});cm().connect(i);const s=new wHt({view:e.view,table:"weather",dataset:"filteredTable",filter:r});cm().connect(s),document.querySelector("#plots").replaceChildren(BTt(lL(fL("2em"),LTt({from:"weather",column:"weather",label:"Weather",as:r})),PTt(4),lL(t,fL("1em"),JTt(XTt(VTt("weather",{filterBy:r}),{x:"temp_max",y:"wind",fill:"steelblue",fillOpacity:.3,r:2}),QTt({as:r}),jTt(qj),qTt(350),WTt(240)))))}xHt();
