data:
  athletes: { format: table }
params:
  brush: { select: crossfilter }
hconcat:
- vconcat:
  - plot:
    - mark: rectY
      data: { from: athletes, filterBy: $brush }
      x: { bin: weight }
      y: { count: "*" }
      fill: steelblue
      inset: 0.5
    - select: intervalX
      as: $brush
    width: 300
    height: 150
    xDomain: Fixed
  - plot:
    - mark: rectY
      data: { from: athletes, filterBy: $brush }
      x: { bin: height }
      y: { count: "*" }
      fill: steelblue
      inset: 0.5
    - select: intervalX
      as: $brush
    width: 300
    height: 150
    xDomain: Fixed
  - plot:
    - mark: dot
      data: { from: athletes, filterBy: $brush }
      x: weight
      y: height
      r: 1
      fill: sex
    - mark: regressionY
      data: { from: athletes, filterBy: $brush }
      x: weight
      y: height
      stroke: sex
    - select: intervalXY
      as: $brush
    width: 300
    height: 300
    xyDomain: Fixed
- hspace: 30
- plot:
  - mark: tickX
    data: { from: athletes }
    x: weight
    y: sport
    fx: sex
    strokeWidth: 0.5
    stroke: "#ccc"
  - mark: barX
    data: { from: athletes, filterBy: $brush }
    x1: { quantile: [weight, 0.25] }
    x2: { quantile: [weight, 0.75] }
    y: sport
    fx: sex
    fill: sex
    fillOpacity: 0.7
  - mark: tickX
    data: { from: athletes, filterBy: $brush }
    x: { avg: weight }
    y: sport
    fx: sex
    strokeWidth: 1.5
    stroke: black
  - select: intervalX
    as: $brush
  - mark: frame
    stroke: "#ccc"
  xyDomain: Fixed
  fxDomain: Fixed
  colorDomain: Fixed
  marginLeft: 100