<!DOCTYPE html>
<html>
  <head>
    <title>SQL Query Console</title>
    <link href="../styles.css" rel="stylesheet">
  </head>
  <body>
    <header>
      <strong>Query Console</strong>
      <span style="margin-right: 0.5em;"></span>
        Client:
        <select id="clients">
          <option value="socket" selected>Socket</option>
          <option value="rest">REST</option>
          <option value="wasm">WASM</option>
        </select>
      </span>
    </header>
    <textarea style="width: 98%; height: 140px;" id="sql"></textarea>
    <br/>
    <button id="submit">Query</button>
    <br/>
    <div id="output"></div>
<script type="module">
  import { setDatabaseClient, coordinator, table } from '../setup.js';

  const input = document.querySelector('#sql');
  const submit = document.querySelector('#submit');
  const output = document.querySelector('#output');
  const menu = document.querySelector('#clients');
  menu.addEventListener('change', () => setDatabaseClient(menu.value));

  const tableName = 'query_result';

  submit.addEventListener('click', async () => {
    await coordinator().exec(
      `DROP TABLE IF EXISTS ${tableName};
       CREATE TEMP TABLE ${tableName} AS ${input.value}`
    );
    coordinator().clear({ catalog: true });
    output.replaceChildren(table({ from: tableName, height: 500 }));
  });
</script>
  </body>
</html>
